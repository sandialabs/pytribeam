<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.7.0"/>
    <title>pytribeam.factory API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../pytribeam.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;pytribeam</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#factory-module">Factory Module</a>
  <ul>
    <li><a href="#functions">Functions</a></li>
  </ul></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#active_fib_applications">active_fib_applications</a>
            </li>
            <li>
                    <a class="function" href="#active_beam_with_settings">active_beam_with_settings</a>
            </li>
            <li>
                    <a class="function" href="#active_detector_settings">active_detector_settings</a>
            </li>
            <li>
                    <a class="function" href="#active_image_settings">active_image_settings</a>
            </li>
            <li>
                    <a class="function" href="#active_imaging_device">active_imaging_device</a>
            </li>
            <li>
                    <a class="function" href="#active_scan_settings">active_scan_settings</a>
            </li>
            <li>
                    <a class="function" href="#active_stage_position_settings">active_stage_position_settings</a>
            </li>
            <li>
                    <a class="function" href="#active_laser_state">active_laser_state</a>
            </li>
            <li>
                    <a class="function" href="#active_laser_settings">active_laser_settings</a>
            </li>
            <li>
                    <a class="function" href="#available_detector_types">available_detector_types</a>
            </li>
            <li>
                    <a class="function" href="#available_detector_modes">available_detector_modes</a>
            </li>
            <li>
                    <a class="function" href="#beam_object_type">beam_object_type</a>
            </li>
            <li>
                    <a class="function" href="#stage_limits">stage_limits</a>
            </li>
            <li>
                    <a class="function" href="#beam_limits">beam_limits</a>
            </li>
            <li>
                    <a class="function" href="#general">general</a>
            </li>
            <li>
                    <a class="function" href="#laser_box_pattern">laser_box_pattern</a>
            </li>
            <li>
                    <a class="function" href="#laser_line_pattern">laser_line_pattern</a>
            </li>
            <li>
                    <a class="function" href="#laser">laser</a>
            </li>
            <li>
                    <a class="function" href="#image">image</a>
            </li>
            <li>
                    <a class="function" href="#fib">fib</a>
            </li>
            <li>
                    <a class="function" href="#enforce_beam_type">enforce_beam_type</a>
            </li>
            <li>
                    <a class="function" href="#ebsd">ebsd</a>
            </li>
            <li>
                    <a class="function" href="#eds">eds</a>
            </li>
            <li>
                    <a class="function" href="#custom">custom</a>
            </li>
            <li>
                    <a class="function" href="#scan_limits">scan_limits</a>
            </li>
            <li>
                    <a class="function" href="#string_to_res">string_to_res</a>
            </li>
            <li>
                    <a class="function" href="#valid_string_resolution">valid_string_resolution</a>
            </li>
            <li>
                    <a class="function" href="#validate_auto_cb_settings">validate_auto_cb_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_stage_position">validate_stage_position</a>
            </li>
            <li>
                    <a class="function" href="#validate_beam_settings">validate_beam_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_detector_settings">validate_detector_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_EBSD_EDS_settings">validate_EBSD_EDS_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_general_settings">validate_general_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_scan_settings">validate_scan_settings</a>
            </li>
            <li>
                    <a class="function" href="#stage_position_settings">stage_position_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_pulse_settings">validate_pulse_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_laser_optics_settings">validate_laser_optics_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_laser_box_settings">validate_laser_box_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_laser_line_settings">validate_laser_line_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_laser_mode_settings">validate_laser_mode_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_laser_pattern_settings">validate_laser_pattern_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_fib_pattern_settings">validate_fib_pattern_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_fib_box_settings">validate_fib_box_settings</a>
            </li>
            <li>
                    <a class="function" href="#validate_fib_selected_area_settings">validate_fib_selected_area_settings</a>
            </li>
            <li>
                    <a class="function" href="#step">step</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../pytribeam.html">pytribeam</a><wbr>.factory    </h1>

                        <div class="docstring"><h1 id="factory-module">Factory Module</h1>

<p>This module contains functions for creating and validating various settings and objects used in the microscope operations. The functions are organized to handle different step types, including EBSD, EDS, IMAGE, LASER, CUSTOM, and FIB.</p>

<h2 id="functions">Functions</h2>

<p>active_fib_applications(microscope: tbt.Microscope) -> list
    Retrieve a list of all active FIB (Focused Ion Beam) application files from the microscope.</p>

<p>active_beam_with_settings(microscope: tbt.Microscope) -> tbt.Beam
    Retrieve the current active beam and its settings from the microscope to create a beam object.</p>

<p>active_detector_settings(microscope: tbt.Microscope) -> tbt.Detector
    Retrieve the current active detector settings from the microscope to create a detector object.</p>

<p>active_image_settings(microscope: tbt.Microscope) -> tbt.ImageSettings
    Retrieve the current active image settings from the microscope to create an image settings object.</p>

<p>active_imaging_device(microscope: tbt.Microscope) -> tbt.Beam
    Determine the active imaging device and return the corresponding internal beam type object with null beam settings.</p>

<p>active_scan_settings(microscope: tbt.Microscope) -> tbt.Scan
    Retrieve the current active scan settings from the microscope to create a scan object.</p>

<p>active_stage_position_settings(microscope: tbt.Microscope) -> tbt.StagePositionUser
    Retrieve the current stage position in the raw coordinate system and user units [mm, deg].</p>

<p>active_laser_state() -> tbt.LaserState
    Retrieve the current state of the laser, including various properties that can be quickly read.</p>

<p>active_laser_settings(microscope: tbt.Microscope) -> tbt.LaserSettings
    Retrieve the current active laser settings from the microscope to create a laser settings object.</p>

<p>available_detector_types(microscope: tbt.Microscope) -> List[str]
    Retrieve the available detector types on the current microscope.</p>

<p>available_detector_modes(microscope: tbt.Microscope) -> List[str]
    Retrieve the available detector modes on the current microscope.</p>

<p>beam_object_type(type: tbt.BeamType) -> tbt.Beam
    Retrieve the beam object type based on the given beam type.</p>

<p>stage_limits(microscope: tbt.Microscope) -> tbt.StageLimits
    Retrieve the stage limits from the current microscope connection.</p>

<p>beam_limits(selected_beam: property, beam_type: tbt.BeamType) -> tbt.BeamLimits
    Retrieve the beam limits for the selected beam and beam type.</p>

<p>general(general_db: dict, yml_format: tbt.YMLFormatVersion) -> tbt.GeneralSettings
    Convert a general settings dictionary to a built-in type and perform schema checking.</p>

<p>laser_box_pattern(settings: dict) -> tbt.LaserBoxPattern
    Convert a dictionary of laser box pattern settings to a <code>LaserBoxPattern</code> object.</p>

<p>laser_line_pattern(settings: dict) -> tbt.LaserLinePattern
    Convert a dictionary of laser line pattern settings to a <code>LaserLinePattern</code> object.</p>

<p>laser(microscope: tbt.Microscope, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -> tbt.LaserSettings
    Convert a laser step from a .yml file to microscope settings for performing laser milling.</p>

<p>image(microscope: tbt.Microscope, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -> tbt.ImageSettings
    Convert an image step from a .yml file to microscope settings for capturing an image.</p>

<p>fib(microscope: tbt.Microscope, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -> tbt.FIBSettings
    Convert a FIB step from a .yml file to microscope settings for performing a FIB operation.</p>

<p>enforce_beam_type(beam_type, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -> bool
    Enforce a specific beam type is used for an operation based on a dictionary.</p>

<p>ebsd(microscope: tbt.Microscope, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -> tbt.EBSDSettings
    Convert an EBSD step from a .yml file to microscope settings for performing an EBSD operation.</p>

<p>eds(microscope: tbt.Microscope, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -> tbt.EDSSettings
    Convert an EDS step from a .yml file to microscope settings for performing an EDS operation.</p>

<p>custom(microscope: tbt.Microscope, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -> tbt.CustomSettings
    Convert a custom step from a .yml file to custom settings for the microscope.</p>

<p>scan_limits(selected_beam: property) -> tbt.ScanLimits
    Retrieve the scan settings limits for the selected beam.</p>

<p>string_to_res(input: str) -> tbt.Resolution
    Convert a string in the format "{{width}}x{{height}}" to a resolution object.</p>

<p>valid_string_resolution(string_resolution: str) -> bool
    Validate a string resolution.</p>

<p>validate_auto_cb_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -> bool
    Perform schema checking for auto contrast/brightness setting dictionary.</p>

<p>validate_stage_position(microscope: tbt.Microscope, step_name: str, settings: dict, yml_format: tbt.YMLFormatVersion) -> bool
    Perform schema checking for stage position dictionary.</p>

<p>validate_beam_settings(microscope: tbt.Microscope, beam_type: tbt.BeamType, settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -> bool
    Perform schema checking for beam setting dictionary.</p>

<p>validate_detector_settings(microscope: tbt.Microscope, beam_type: tbt.BeamType, settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -> bool
    Perform schema checking for detector setting dictionary.</p>

<p>validate_EBSD_EDS_settings(yml_format: tbt.YMLFormatVersion, connection_host: str, connection_port: str, ebsd_oem: str, eds_oem: str) -> bool
    Check EBSD and EDS OEM and connection for supported OEMs.</p>

<p>validate_general_settings(settings: dict, yml_format: tbt.YMLFormatVersion) -> bool
    Perform schema checking for general setting dictionary.</p>

<p>validate_scan_settings(microscope: tbt.Microscope, beam_type: tbt.BeamType, settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -> bool
    Perform schema checking for scan setting dictionary.</p>

<p>stage_position_settings(microscope: tbt.Microscope, step_name: str, general_settings: tbt.GeneralSettings, step_stage_settings: dict, yml_format: tbt.YMLFormatVersion) -> tbt.StageSettings
    Create a StagePositionUser object from settings, including validation.</p>

<p>validate_pulse_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -> bool
    Perform schema checking for pulse setting dictionary.</p>

<p>validate_laser_optics_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -> bool
    Perform schema checking for laser optics setting dictionary.</p>

<p>validate_laser_box_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -> bool
    Perform schema checking for laser box pattern setting dictionary.</p>

<p>validate_laser_line_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -> bool
    Perform schema checking for laser line pattern setting dictionary.</p>

<p>validate_laser_mode_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -> bool
    Perform schema checking for laser mode setting dictionary.</p>

<p>validate_laser_pattern_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -> tbt.LaserPatternType
    Perform schema checking for laser pattern setting dictionary.</p>

<p>validate_fib_pattern_settings(microscope: tbt.Microscope, settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -> Union[tbt.FIBRectanglePattern, tbt.FIBRegularCrossSection, tbt.FIBCleaningCrossSection, tbt.FIBStreamPattern]
    Perform schema checking for FIB pattern setting dictionary.</p>

<p>validate_fib_box_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str, pattern_type: tbt.FIBPatternType) -> bool
    Perform schema checking for FIB box pattern setting dictionary.</p>

<p>validate_fib_selected_area_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str, pattern_type: tbt.FIBPatternType) -> bool
    Perform schema checking for FIB selected area pattern setting dictionary.</p>

<p>step(microscope: tbt.Microscope, step_name: str, step_settings: dict, general_settings: tbt.GeneralSettings, yml_format: tbt.YMLFormatVersion) -> tbt.Step
    Create a step object for different step types, including validation.</p>
</div>

                        <input id="mod-factory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-factory-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="ch">#!/usr/bin/python3</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">Factory Module</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">==============</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">This module contains functions for creating and validating various settings and objects used in the microscope operations. The functions are organized to handle different step types, including EBSD, EDS, IMAGE, LASER, CUSTOM, and FIB.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">Functions</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">---------</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">active_fib_applications(microscope: tbt.Microscope) -&gt; list</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">    Retrieve a list of all active FIB (Focused Ion Beam) application files from the microscope.</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd">active_beam_with_settings(microscope: tbt.Microscope) -&gt; tbt.Beam</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="sd">    Retrieve the current active beam and its settings from the microscope to create a beam object.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="sd">active_detector_settings(microscope: tbt.Microscope) -&gt; tbt.Detector</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">    Retrieve the current active detector settings from the microscope to create a detector object.</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">active_image_settings(microscope: tbt.Microscope) -&gt; tbt.ImageSettings</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="sd">    Retrieve the current active image settings from the microscope to create an image settings object.</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd">active_imaging_device(microscope: tbt.Microscope) -&gt; tbt.Beam</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">    Determine the active imaging device and return the corresponding internal beam type object with null beam settings.</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">active_scan_settings(microscope: tbt.Microscope) -&gt; tbt.Scan</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">    Retrieve the current active scan settings from the microscope to create a scan object.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">active_stage_position_settings(microscope: tbt.Microscope) -&gt; tbt.StagePositionUser</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">    Retrieve the current stage position in the raw coordinate system and user units [mm, deg].</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">active_laser_state() -&gt; tbt.LaserState</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">    Retrieve the current state of the laser, including various properties that can be quickly read.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">active_laser_settings(microscope: tbt.Microscope) -&gt; tbt.LaserSettings</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">    Retrieve the current active laser settings from the microscope to create a laser settings object.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">available_detector_types(microscope: tbt.Microscope) -&gt; List[str]</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">    Retrieve the available detector types on the current microscope.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">available_detector_modes(microscope: tbt.Microscope) -&gt; List[str]</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">    Retrieve the available detector modes on the current microscope.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">beam_object_type(type: tbt.BeamType) -&gt; tbt.Beam</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">    Retrieve the beam object type based on the given beam type.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">stage_limits(microscope: tbt.Microscope) -&gt; tbt.StageLimits</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">    Retrieve the stage limits from the current microscope connection.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">beam_limits(selected_beam: property, beam_type: tbt.BeamType) -&gt; tbt.BeamLimits</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">    Retrieve the beam limits for the selected beam and beam type.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">general(general_db: dict, yml_format: tbt.YMLFormatVersion) -&gt; tbt.GeneralSettings</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">    Convert a general settings dictionary to a built-in type and perform schema checking.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">laser_box_pattern(settings: dict) -&gt; tbt.LaserBoxPattern</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">    Convert a dictionary of laser box pattern settings to a `LaserBoxPattern` object.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd">laser_line_pattern(settings: dict) -&gt; tbt.LaserLinePattern</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">    Convert a dictionary of laser line pattern settings to a `LaserLinePattern` object.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">laser(microscope: tbt.Microscope, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -&gt; tbt.LaserSettings</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">    Convert a laser step from a .yml file to microscope settings for performing laser milling.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">image(microscope: tbt.Microscope, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -&gt; tbt.ImageSettings</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">    Convert an image step from a .yml file to microscope settings for capturing an image.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">fib(microscope: tbt.Microscope, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -&gt; tbt.FIBSettings</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">    Convert a FIB step from a .yml file to microscope settings for performing a FIB operation.</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">enforce_beam_type(beam_type, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -&gt; bool</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">    Enforce a specific beam type is used for an operation based on a dictionary.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">ebsd(microscope: tbt.Microscope, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -&gt; tbt.EBSDSettings</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">    Convert an EBSD step from a .yml file to microscope settings for performing an EBSD operation.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">eds(microscope: tbt.Microscope, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -&gt; tbt.EDSSettings</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">    Convert an EDS step from a .yml file to microscope settings for performing an EDS operation.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">custom(microscope: tbt.Microscope, step_settings: dict, step_name: str, yml_format: tbt.YMLFormatVersion) -&gt; tbt.CustomSettings</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">    Convert a custom step from a .yml file to custom settings for the microscope.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">scan_limits(selected_beam: property) -&gt; tbt.ScanLimits</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">    Retrieve the scan settings limits for the selected beam.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">string_to_res(input: str) -&gt; tbt.Resolution</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">    Convert a string in the format &quot;{{width}}x{{height}}&quot; to a resolution object.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">valid_string_resolution(string_resolution: str) -&gt; bool</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="sd">    Validate a string resolution.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">validate_auto_cb_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -&gt; bool</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">    Perform schema checking for auto contrast/brightness setting dictionary.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">validate_stage_position(microscope: tbt.Microscope, step_name: str, settings: dict, yml_format: tbt.YMLFormatVersion) -&gt; bool</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="sd">    Perform schema checking for stage position dictionary.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">validate_beam_settings(microscope: tbt.Microscope, beam_type: tbt.BeamType, settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -&gt; bool</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">    Perform schema checking for beam setting dictionary.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="sd">validate_detector_settings(microscope: tbt.Microscope, beam_type: tbt.BeamType, settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -&gt; bool</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="sd">    Perform schema checking for detector setting dictionary.</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="sd">validate_EBSD_EDS_settings(yml_format: tbt.YMLFormatVersion, connection_host: str, connection_port: str, ebsd_oem: str, eds_oem: str) -&gt; bool</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="sd">    Check EBSD and EDS OEM and connection for supported OEMs.</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="sd">validate_general_settings(settings: dict, yml_format: tbt.YMLFormatVersion) -&gt; bool</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">    Perform schema checking for general setting dictionary.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">validate_scan_settings(microscope: tbt.Microscope, beam_type: tbt.BeamType, settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -&gt; bool</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">    Perform schema checking for scan setting dictionary.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">stage_position_settings(microscope: tbt.Microscope, step_name: str, general_settings: tbt.GeneralSettings, step_stage_settings: dict, yml_format: tbt.YMLFormatVersion) -&gt; tbt.StageSettings</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">    Create a StagePositionUser object from settings, including validation.</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">validate_pulse_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -&gt; bool</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">    Perform schema checking for pulse setting dictionary.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">validate_laser_optics_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -&gt; bool</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">    Perform schema checking for laser optics setting dictionary.</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="sd">validate_laser_box_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -&gt; bool</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">    Perform schema checking for laser box pattern setting dictionary.</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">validate_laser_line_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -&gt; bool</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">    Perform schema checking for laser line pattern setting dictionary.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">validate_laser_mode_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -&gt; bool</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">    Perform schema checking for laser mode setting dictionary.</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">validate_laser_pattern_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -&gt; tbt.LaserPatternType</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">    Perform schema checking for laser pattern setting dictionary.</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">validate_fib_pattern_settings(microscope: tbt.Microscope, settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str) -&gt; Union[tbt.FIBRectanglePattern, tbt.FIBRegularCrossSection, tbt.FIBCleaningCrossSection, tbt.FIBStreamPattern]</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">    Perform schema checking for FIB pattern setting dictionary.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">validate_fib_box_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str, pattern_type: tbt.FIBPatternType) -&gt; bool</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">    Perform schema checking for FIB box pattern setting dictionary.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">validate_fib_selected_area_settings(settings: dict, yml_format: tbt.YMLFormatVersion, step_name: str, pattern_type: tbt.FIBPatternType) -&gt; bool</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="sd">    Perform schema checking for FIB selected area pattern setting dictionary.</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">step(microscope: tbt.Microscope, step_name: str, step_settings: dict, general_settings: tbt.GeneralSettings, yml_format: tbt.YMLFormatVersion) -&gt; tbt.Step</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">    Create a step object for different step types, including validation.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="c1">## python standard libraries</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="kn">import</span> <span class="nn">platform</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">singledispatch</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="kn">import</span> <span class="nn">math</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="c1"># 3rd party libraries</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="kn">import</span> <span class="nn">pytest</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="kn">from</span> <span class="nn">schema</span> <span class="kn">import</span> <span class="n">And</span><span class="p">,</span> <span class="n">Or</span><span class="p">,</span> <span class="n">Schema</span><span class="p">,</span> <span class="n">SchemaError</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="kn">import</span> <span class="nn">jsonschema</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="c1"># Local</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="kn">import</span> <span class="nn">pytribeam.insertable_devices</span> <span class="k">as</span> <span class="nn">devices</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="kn">import</span> <span class="nn">pytribeam.image</span> <span class="k">as</span> <span class="nn">img</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="kn">import</span> <span class="nn">pytribeam.utilities</span> <span class="k">as</span> <span class="nn">ut</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="kn">import</span> <span class="nn">pytribeam.stage</span> <span class="k">as</span> <span class="nn">stage</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="kn">from</span> <span class="nn">pytribeam.constants</span> <span class="kn">import</span> <span class="n">Conversions</span><span class="p">,</span> <span class="n">Constants</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="kn">from</span> <span class="nn">pytribeam.fib</span> <span class="kn">import</span> <span class="n">application_files</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="k">try</span><span class="p">:</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>    <span class="kn">import</span> <span class="nn">pytribeam.laser</span> <span class="k">as</span> <span class="nn">fs_laser</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="k">except</span><span class="p">:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>    <span class="k">pass</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="kn">import</span> <span class="nn">pytribeam.types</span> <span class="k">as</span> <span class="nn">tbt</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="k">def</span> <span class="nf">active_fib_applications</span><span class="p">(</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">    Retrieve a list of all active FIB (Focused Ion Beam) patterning application files from the microscope.</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">    Parameters</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">    ----------</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">        The microscope object from which to retrieve the application files.</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">    Returns</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="sd">    -------</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">    list</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">        A list of active FIB patterning application files.</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>    <span class="k">return</span> <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">list_all_application_files</span><span class="p">()</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="k">def</span> <span class="nf">active_beam_with_settings</span><span class="p">(</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Beam</span><span class="p">:</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">    Retrieve the current active beam and its settings from the microscope to create a beam object.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">    This function grabs the current beam and its settings on the microscope to make a beam object. These settings fully depend on the currently active beam as determined by xTUI. Tolerance values for voltage and current are auto-populated as a ratio of current values predetermined in the `Constants` class.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">    Parameters</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">    ----------</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">        The microscope object from which to retrieve the active beam and its settings.</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">    Returns</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">    -------</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">    tbt.Beam</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">        The active beam object with its settings.</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>    <span class="n">selected_beam</span> <span class="o">=</span> <span class="n">active_imaging_device</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>    <span class="n">beam</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">beam_type</span><span class="p">(</span><span class="n">selected_beam</span><span class="p">,</span> <span class="n">microscope</span><span class="p">)</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>    <span class="n">voltage_kv</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">high_voltage</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">V_TO_KV</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>    <span class="n">voltage_tol_kv</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">voltage_kv</span> <span class="o">*</span> <span class="n">Constants</span><span class="o">.</span><span class="n">voltage_tol_ratio</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>    <span class="n">current_na</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">beam_current</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">A_TO_NA</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>    <span class="n">current_tol_na</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">current_na</span> <span class="o">*</span> <span class="n">Constants</span><span class="o">.</span><span class="n">current_tol_ratio</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>    <span class="n">hfw_mm</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">horizontal_field_width</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>    <span class="n">working_dist_mm</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">working_distance</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>    <span class="n">active_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">(</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>        <span class="n">voltage_kv</span><span class="o">=</span><span class="n">voltage_kv</span><span class="p">,</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        <span class="n">current_na</span><span class="o">=</span><span class="n">current_na</span><span class="p">,</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>        <span class="n">hfw_mm</span><span class="o">=</span><span class="n">hfw_mm</span><span class="p">,</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>        <span class="n">working_dist_mm</span><span class="o">=</span><span class="n">working_dist_mm</span><span class="p">,</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>        <span class="n">voltage_tol_kv</span><span class="o">=</span><span class="n">voltage_tol_kv</span><span class="p">,</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>        <span class="n">current_tol_na</span><span class="o">=</span><span class="n">current_tol_na</span><span class="p">,</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>    <span class="p">)</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">selected_beam</span><span class="p">)(</span><span class="n">settings</span><span class="o">=</span><span class="n">active_settings</span><span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="k">def</span> <span class="nf">active_detector_settings</span><span class="p">(</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Detector</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">    Retrieve the current active detector settings from the microscope to create a detector object.</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">    This function grabs the current detector settings on the microscope to make a detector object. These settings fully depend on the currently active detector as determined by xTUI.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">    Parameters</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">    ----------</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">        The microscope object from which to retrieve the active detector settings.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">    Returns</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">    -------</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">    tbt.Detector</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">        The active detector object with its settings.</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>    <span class="n">detector_type</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>    <span class="n">detector_mode</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>    <span class="n">brightness</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">brightness</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>    <span class="n">contrast</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">contrast</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>    <span class="n">auto_cb_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ScanArea</span><span class="p">(</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>        <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>        <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>        <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>    <span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>    <span class="n">custom_settings</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>    <span class="n">active_detector</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Detector</span><span class="p">(</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>        <span class="nb">type</span><span class="o">=</span><span class="n">detector_type</span><span class="p">,</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>        <span class="n">mode</span><span class="o">=</span><span class="n">detector_mode</span><span class="p">,</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>        <span class="n">brightness</span><span class="o">=</span><span class="n">brightness</span><span class="p">,</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>        <span class="n">contrast</span><span class="o">=</span><span class="n">contrast</span><span class="p">,</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        <span class="n">auto_cb_settings</span><span class="o">=</span><span class="n">auto_cb_settings</span><span class="p">,</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>        <span class="n">custom_settings</span><span class="o">=</span><span class="n">custom_settings</span><span class="p">,</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>    <span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>    <span class="k">return</span> <span class="n">active_detector</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="k">def</span> <span class="nf">active_image_settings</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ImageSettings</span><span class="p">:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="sd">    Retrieve the current active image settings from the microscope to create an image settings object.</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">    This function grabs the current beam, detector, and scan settings on the microscope to make an image settings object. The bit depth is set to the default color depth defined in the `Constants` class.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">    Parameters</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">    ----------</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">        The microscope object from which to retrieve the active image settings.</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">    Returns</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">    -------</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a><span class="sd">    tbt.ImageSettings</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">        The active image settings object.</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>    <span class="n">beam</span> <span class="o">=</span> <span class="n">active_beam_with_settings</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>    <span class="n">detector</span> <span class="o">=</span> <span class="n">active_detector_settings</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>    <span class="n">scan</span> <span class="o">=</span> <span class="n">active_scan_settings</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>    <span class="n">bit_depth</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">default_color_depth</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>    <span class="n">active_image_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ImageSettings</span><span class="p">(</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>        <span class="n">beam</span><span class="o">=</span><span class="n">beam</span><span class="p">,</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>        <span class="n">detector</span><span class="o">=</span><span class="n">detector</span><span class="p">,</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>        <span class="n">scan</span><span class="o">=</span><span class="n">scan</span><span class="p">,</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>        <span class="n">bit_depth</span><span class="o">=</span><span class="n">bit_depth</span><span class="p">,</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>    <span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>    <span class="k">return</span> <span class="n">active_image_settings</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="k">def</span> <span class="nf">active_imaging_device</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Beam</span><span class="p">:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">    Determine the active imaging device and return the corresponding internal beam type object with null beam settings.</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">    This function identifies the currently active imaging device on the microscope and returns the appropriate beam type object (electron or ion) with null beam settings.</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">    Parameters</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">    ----------</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="sd">        The microscope object from which to determine the active imaging device.</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="sd">    Returns</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">    -------</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="sd">    tbt.Beam</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="sd">        The active beam object with null beam settings.</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="sd">    Raises</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="sd">    ------</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="sd">    ValueError</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="sd">        If the currently selected device is neither an electron beam nor an ion beam.</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>    <span class="n">curr_device</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span><span class="n">microscope</span><span class="o">.</span><span class="n">imaging</span><span class="o">.</span><span class="n">get_active_device</span><span class="p">())</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>    <span class="k">if</span> <span class="n">curr_device</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Device</span><span class="o">.</span><span class="n">ELECTRON_BEAM</span><span class="p">:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>        <span class="n">selected_beam</span> <span class="o">=</span> <span class="n">beam_object_type</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">)(</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">()</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>        <span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>    <span class="k">elif</span> <span class="n">curr_device</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Device</span><span class="o">.</span><span class="n">ION_BEAM</span><span class="p">:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>        <span class="n">selected_beam</span> <span class="o">=</span> <span class="n">beam_object_type</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">)(</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">()</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>        <span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>            <span class="sa">f</span><span class="s2">&quot;Currently selected device </span><span class="si">{</span><span class="n">curr_device</span><span class="si">}</span><span class="s2">, make sure a quadrant in xTUI with either an Electron beam or Ion beam active is selected.&quot;</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>        <span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>    <span class="k">return</span> <span class="n">selected_beam</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="k">def</span> <span class="nf">active_scan_settings</span><span class="p">(</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Scan</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">    Retrieve the current active scan settings from the microscope to create a scan object.</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">    This function grabs the current scan settings on the microscope to make a scan object. These settings fully depend on the currently active scan settings as determined by xTUI.</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">    Parameters</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="sd">    ----------</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">        The microscope object from which to retrieve the active scan settings.</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a><span class="sd">    Returns</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a><span class="sd">    -------</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a><span class="sd">    tbt.Scan</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a><span class="sd">        The active scan object with its settings.</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>    <span class="n">selected_beam</span> <span class="o">=</span> <span class="n">active_imaging_device</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>    <span class="n">beam</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">beam_type</span><span class="p">(</span><span class="n">selected_beam</span><span class="p">,</span> <span class="n">microscope</span><span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>    <span class="n">rotation_deg</span> <span class="o">=</span> <span class="n">beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">rotation</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">RAD_TO_DEG</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>    <span class="n">dwell_time_us</span> <span class="o">=</span> <span class="n">beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">dwell_time</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">S_TO_US</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>    <span class="n">current_res</span> <span class="o">=</span> <span class="n">beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">resolution</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">string_to_res</span><span class="p">(</span><span class="n">current_res</span><span class="p">)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>    <span class="n">resolution</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">PresetResolution</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>    <span class="n">active_scan</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Scan</span><span class="p">(</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>        <span class="n">rotation_deg</span><span class="o">=</span><span class="n">rotation_deg</span><span class="p">,</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        <span class="n">dwell_time_us</span><span class="o">=</span><span class="n">dwell_time_us</span><span class="p">,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>        <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>        <span class="c1"># mode=mode,</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>    <span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>    <span class="k">return</span> <span class="n">active_scan</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="k">def</span> <span class="nf">active_stage_position_settings</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StagePositionUser</span><span class="p">:</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="sd">    Retrieve the current stage position in the raw coordinate system and user units [mm, deg].</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a><span class="sd">    This function sets the stage coordinate system to RAW, retrieves the current stage position in encoder units (meters and radians), converts it to user units (millimeters and degrees), and ensures the r-axis is within the axis limit.</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="sd">    Parameters</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">    ----------</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">        The microscope object from which to retrieve the current stage position.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a><span class="sd">    Returns</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">    -------</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="sd">    tbt.StagePositionUser</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a><span class="sd">        The current stage position in user units [mm, deg].</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>    <span class="n">stage</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageCoordinateSystem</span><span class="o">.</span><span class="n">RAW</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>    <span class="c1"># encoder positions (pos) are in meters and radians</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>    <span class="n">direct_encoder_pos</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">current_position</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>    <span class="n">x_m</span><span class="p">,</span> <span class="n">y_m</span><span class="p">,</span> <span class="n">z_m</span> <span class="o">=</span> <span class="n">direct_encoder_pos</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">direct_encoder_pos</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">direct_encoder_pos</span><span class="o">.</span><span class="n">z</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>    <span class="n">r_rad</span><span class="p">,</span> <span class="n">t_rad</span> <span class="o">=</span> <span class="n">direct_encoder_pos</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">direct_encoder_pos</span><span class="o">.</span><span class="n">t</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>    <span class="n">coord_system_str</span> <span class="o">=</span> <span class="n">direct_encoder_pos</span><span class="o">.</span><span class="n">coordinate_system</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>    <span class="n">encoder_pos</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StagePositionEncoder</span><span class="p">(</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>        <span class="n">x</span><span class="o">=</span><span class="n">x_m</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_m</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z_m</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r_rad</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t_rad</span><span class="p">,</span> <span class="n">coordinate_system</span><span class="o">=</span><span class="n">coord_system_str</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>    <span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>    <span class="n">user_pos</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">encoder_to_user_position</span><span class="p">(</span><span class="n">encoder_pos</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>    <span class="c1"># ensure r-axis is kept in axis limit</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="n">val</span><span class="o">=</span><span class="n">user_pos</span><span class="o">.</span><span class="n">r_deg</span><span class="p">,</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="n">limit</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">rotation_axis_limit_deg</span><span class="p">,</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">RIGHT_OPEN</span><span class="p">,</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>    <span class="p">):</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>        <span class="c1"># used as right-open internal: 180.0 is not valid and should be converted to -180.0</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>        <span class="k">while</span> <span class="n">user_pos</span><span class="o">.</span><span class="n">r_deg</span> <span class="o">&gt;=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">rotation_axis_limit_deg</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>            <span class="n">new_r_deg</span> <span class="o">=</span> <span class="n">user_pos</span><span class="o">.</span><span class="n">r_deg</span> <span class="o">-</span> <span class="mf">360.0</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>        <span class="k">while</span> <span class="n">user_pos</span><span class="o">.</span><span class="n">r_deg</span> <span class="o">&lt;</span> <span class="n">Constants</span><span class="o">.</span><span class="n">rotation_axis_limit_deg</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>            <span class="n">new_r_deg</span> <span class="o">=</span> <span class="n">user_pos</span><span class="o">.</span><span class="n">r_deg</span> <span class="o">+</span> <span class="mf">360.0</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>        <span class="n">new_r_deg</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">new_r_deg</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>        <span class="n">user_pos</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StagePositionUser</span><span class="p">(</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>            <span class="n">x_mm</span><span class="o">=</span><span class="n">user_pos</span><span class="o">.</span><span class="n">x_mm</span><span class="p">,</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>            <span class="n">y_mm</span><span class="o">=</span><span class="n">user_pos</span><span class="o">.</span><span class="n">y_mm</span><span class="p">,</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>            <span class="n">z_mm</span><span class="o">=</span><span class="n">user_pos</span><span class="o">.</span><span class="n">z_mm</span><span class="p">,</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>            <span class="n">r_deg</span><span class="o">=</span><span class="n">new_r_deg</span><span class="p">,</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>            <span class="n">t_deg</span><span class="o">=</span><span class="n">user_pos</span><span class="o">.</span><span class="n">t_deg</span><span class="p">,</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>        <span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>    <span class="k">return</span> <span class="n">user_pos</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="k">def</span> <span class="nf">active_laser_state</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserState</span><span class="p">:</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">    Retrieve the current state of the laser, including various properties that can be quickly read.</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">    This function returns a dictionary object for all properties that can be quickly read from the laser (not exhaustive). Power can be read but has its own method and is more involved. Flipper configuration can only be set, not read.</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">    Returns</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a><span class="sd">    -------</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a><span class="sd">    tbt.LaserState</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="sd">        The current state of the laser, including wavelength, frequency, pulse divider, pulse energy, objective position, beam shift, pattern, and expected pattern duration.</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a><span class="sd">    Raises</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a><span class="sd">    ------</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a><span class="sd">    KeyError</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="sd">        If an unsupported LaserPatternType is encountered.</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>    <span class="n">vals</span> <span class="o">=</span> <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">Laser_ReadValues</span><span class="p">()</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;objective_position_mm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">LIP_GetZPosition</span><span class="p">()</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;beam_shift_um_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">BeamShift_Get_X</span><span class="p">()</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;beam_shift_um_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">BeamShift_Get_Y</span><span class="p">()</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;shutter_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">Shutter_GetState</span><span class="p">()</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">Patterning_ReadValues</span><span class="p">()</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;expected_pattern_duration_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>        <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">Patterning_GetExpectedDuration</span><span class="p">()</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>    <span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>    <span class="n">pattern_db</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">]</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>    <span class="n">pattern_type</span> <span class="o">=</span> <span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;patternType&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">pattern_type</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="p">):</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported LaserPatternType of </span><span class="si">{</span><span class="n">pattern_type</span><span class="si">}</span><span class="s2">, supported types include: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>        <span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>    <span class="n">pattern_type</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="p">(</span><span class="n">pattern_type</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>    <span class="n">mode</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternMode</span><span class="p">(</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;patterningMode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternMode</span><span class="o">.</span><span class="n">COARSE</span><span class="p">:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>        <span class="n">pixel_dwell_ms</span> <span class="o">=</span> <span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;dwellTime&quot;</span><span class="p">]</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>        <span class="n">pulses_per_pixel</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternMode</span><span class="o">.</span><span class="n">FINE</span><span class="p">:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>        <span class="n">pixel_dwell_ms</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>        <span class="n">pulses_per_pixel</span> <span class="o">=</span> <span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;pulsesPerPixel&quot;</span><span class="p">]</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>    <span class="n">rotation_deg</span> <span class="o">=</span> <span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;patternRotation_deg&quot;</span><span class="p">]</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>    <span class="k">if</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="o">.</span><span class="n">BOX</span><span class="p">:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserBoxPattern</span><span class="p">(</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>            <span class="n">passes</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;passes&quot;</span><span class="p">],</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>            <span class="n">size_x_um</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;xSize_um&quot;</span><span class="p">],</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>            <span class="n">size_y_um</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;ySize_um&quot;</span><span class="p">],</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>            <span class="n">pitch_x_um</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;xPitch_um&quot;</span><span class="p">],</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>            <span class="n">pitch_y_um</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;yPitch_um&quot;</span><span class="p">],</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>            <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">(</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;scanningMode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>            <span class="n">coordinate_ref</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="p">(</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>                <span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;coordReference&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>            <span class="p">),</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>    <span class="k">if</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="o">.</span><span class="n">LINE</span><span class="p">:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserLinePattern</span><span class="p">(</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>            <span class="n">passes</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;passes&quot;</span><span class="p">],</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>            <span class="n">size_um</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;xSize_um&quot;</span><span class="p">],</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>            <span class="n">pitch_um</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;xPitch_um&quot;</span><span class="p">],</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>            <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">(</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;scanningMode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>        <span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>    <span class="n">pattern</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPattern</span><span class="p">(</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>        <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>        <span class="n">rotation_deg</span><span class="o">=</span><span class="n">rotation_deg</span><span class="p">,</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>        <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>        <span class="n">pulses_per_pixel</span><span class="o">=</span><span class="n">pulses_per_pixel</span><span class="p">,</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>        <span class="n">pixel_dwell_ms</span><span class="o">=</span><span class="n">pixel_dwell_ms</span><span class="p">,</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>    <span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>    <span class="n">state</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserState</span><span class="p">(</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>        <span class="n">wavelength_nm</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;wavelength_nm&quot;</span><span class="p">],</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>        <span class="n">frequency_khz</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;frequency_kHz&quot;</span><span class="p">],</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="n">pulse_divider</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;pulse_divider&quot;</span><span class="p">],</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>        <span class="n">pulse_energy_uj</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;pulse_energy_uJ&quot;</span><span class="p">],</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>        <span class="n">objective_position_mm</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;objective_position_mm&quot;</span><span class="p">],</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>        <span class="n">beam_shift_um</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;beam_shift_um_x&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;beam_shift_um_y&quot;</span><span class="p">]),</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>        <span class="n">expected_pattern_duration_s</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;expected_pattern_duration_s&quot;</span><span class="p">],</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>    <span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>    <span class="k">return</span> <span class="n">state</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a><span class="k">def</span> <span class="nf">active_laser_settings</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserSettings</span><span class="p">:</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="sd">    Retrieve the current active laser settings from the microscope to create a laser settings object.</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a><span class="sd">    This function grabs the current laser state and uses it to create a laser settings object. Some values cannot be read by Laser Control and can only be set. For example, polarization will default to &quot;Vertical&quot; as this value cannot be read.</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="sd">    Parameters</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a><span class="sd">    ----------</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">        The microscope object from which to retrieve the active laser settings.</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">    Returns</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">    -------</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">    tbt.LaserSettings</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">        The active laser settings object.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>    <span class="n">state</span> <span class="o">=</span> <span class="n">active_laser_state</span><span class="p">()</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>    <span class="n">settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserSettings</span><span class="p">(</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>        <span class="n">pulse</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPulse</span><span class="p">(</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>            <span class="n">wavelength_nm</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">wavelength_nm</span><span class="p">,</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>            <span class="n">divider</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">pulse_divider</span><span class="p">,</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>            <span class="n">energy_uj</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">pulse_energy_uj</span><span class="p">,</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>            <span class="n">polarization</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPolarization</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">,</span>  <span class="c1"># TODO, can&#39;t read this, can only set it</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>        <span class="p">),</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>        <span class="n">objective_position_mm</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">objective_position_mm</span><span class="p">,</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>        <span class="n">beam_shift_um</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">beam_shift_um</span><span class="p">,</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>        <span class="n">pattern</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>    <span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>    <span class="k">return</span> <span class="n">settings</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="k">def</span> <span class="nf">available_detector_types</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">    Retrieve the available detector types on the current microscope.</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">    This function returns a list of available detector types on the current microscope.</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a><span class="sd">    Parameters</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="sd">    ----------</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">        The microscope object from which to retrieve the available detector types.</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="sd">    Returns</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a><span class="sd">    -------</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="sd">    List[str]</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a><span class="sd">        A list of available detector types.</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>    <span class="n">detectors</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">available_values</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>    <span class="c1"># available = [tbt.DetectorType(i) for i in detectors]</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>    <span class="k">return</span> <span class="n">detectors</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a><span class="k">def</span> <span class="nf">available_detector_modes</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="sd">    Retrieve the available detector modes on the current microscope.</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">    This function returns a list of available detector modes on the current microscope.</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">    Parameters</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a><span class="sd">    ----------</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a><span class="sd">        The microscope object from which to retrieve the available detector modes.</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="sd">    Returns</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">    -------</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="sd">    List[str]</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">        A list of available detector modes.</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>    <span class="n">modes</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">available_values</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>    <span class="c1"># available = [tbt.DetectorType(i) for i in modes]</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>    <span class="k">return</span> <span class="n">modes</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="k">def</span> <span class="nf">beam_object_type</span><span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Beam</span><span class="p">:</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">    Retrieve the beam object type based on the given beam type.</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">    This function returns the appropriate beam object type (electron or ion) based on the provided beam type.</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">    Parameters</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">    ----------</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">    type : tbt.BeamType</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">        The type of the beam (electron or ion).</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">    Returns</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a><span class="sd">    -------</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a><span class="sd">    tbt.Beam</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a><span class="sd">        The corresponding beam object type.</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a><span class="sd">    Raises</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="sd">    ------</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a><span class="sd">        If the provided beam type is unsupported.</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;electron&quot;</span><span class="p">:</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ElectronBeam</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;ion&quot;</span><span class="p">:</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">IonBeam</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported beam type </span><span class="si">{</span><span class="nb">type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="k">def</span> <span class="nf">stage_limits</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StageLimits</span><span class="p">:</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a><span class="sd">    Retrieve the stage limits from the current microscope connection.</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="sd">    This function retrieves the stage limits for the X, Y, Z, R, and T axes from the current microscope connection and returns them as a `StageLimits` object.</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">    Parameters</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a><span class="sd">    ----------</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a><span class="sd">        The microscope object from which to retrieve the stage limits.</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a><span class="sd">    Returns</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a><span class="sd">    -------</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a><span class="sd">    tbt.StageLimits</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="sd">        The stage limits for the X, Y, Z, R, and T axes in user units (mm and degrees).</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>    <span class="n">stage</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>    <span class="c1"># x position</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>    <span class="n">min_x_mm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>    <span class="p">)</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>    <span class="n">max_x_mm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>    <span class="p">)</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>    <span class="c1"># y position</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>    <span class="n">min_y_mm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>    <span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>    <span class="n">max_y_mm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>    <span class="p">)</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>    <span class="c1"># z position</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>    <span class="n">min_z_mm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>    <span class="p">)</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>    <span class="n">max_z_mm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>    <span class="p">)</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>    <span class="c1"># r position</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>    <span class="n">min_r_deg</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">rotation_axis_limit_deg</span><span class="o">.</span><span class="n">min</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>    <span class="n">max_r_deg</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">rotation_axis_limit_deg</span><span class="o">.</span><span class="n">max</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>    <span class="c1"># t position</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>    <span class="n">min_t_deg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">RAD_TO_DEG</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>    <span class="p">)</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>    <span class="n">max_t_deg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">RAD_TO_DEG</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>    <span class="p">)</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>    <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StageLimits</span><span class="p">(</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>        <span class="n">x_mm</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_x_mm</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_x_mm</span><span class="p">),</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>        <span class="n">y_mm</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_y_mm</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_y_mm</span><span class="p">),</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>        <span class="n">z_mm</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_z_mm</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_z_mm</span><span class="p">),</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>        <span class="n">r_deg</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_r_deg</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_r_deg</span><span class="p">),</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>        <span class="n">t_deg</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_t_deg</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_t_deg</span><span class="p">),</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>    <span class="p">)</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="k">def</span> <span class="nf">beam_limits</span><span class="p">(</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>    <span class="n">selected_beam</span><span class="p">:</span> <span class="nb">property</span><span class="p">,</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>    <span class="n">beam_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">,</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamLimits</span><span class="p">:</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">    Retrieve the beam limits for the selected beam and beam type.</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a><span class="sd">    This function retrieves the limits for voltage, current, horizontal field width (HFW), and working distance for the selected beam and beam type, and returns them as a `BeamLimits` object.</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">    Parameters</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a><span class="sd">    ----------</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="sd">    selected_beam : property</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="sd">        The selected beam property from which to retrieve the limits.</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="sd">    beam_type : tbt.BeamType</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">        The type of the beam (electron or ion).</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="sd">    Returns</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">    -------</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a><span class="sd">    tbt.BeamLimits</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="sd">        The beam limits for voltage, current, HFW, and working distance in user units (kV, nA, mm).</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="sd">    Raises</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a><span class="sd">    ------</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="sd">    ValueError</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">        If the beam type is unsupported.</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>    <span class="c1"># voltage range</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>    <span class="n">min_kv</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">high_voltage</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">min</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">V_TO_KV</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>    <span class="n">max_kv</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">high_voltage</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">V_TO_KV</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>    <span class="c1"># current range</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>    <span class="k">if</span> <span class="n">beam_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">:</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>        <span class="n">min_na</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">beam_current</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">min</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">A_TO_NA</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>        <span class="n">max_na</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">beam_current</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">A_TO_NA</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>    <span class="k">if</span> <span class="n">beam_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">:</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>        <span class="n">available_currents</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">beam_current</span><span class="o">.</span><span class="n">available_values</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>        <span class="n">min_na</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">available_currents</span><span class="p">)</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">A_TO_NA</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>        <span class="n">max_na</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">available_currents</span><span class="p">)</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">A_TO_NA</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>    <span class="c1"># hfw range</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>    <span class="n">min_hfw_mm</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">horizontal_field_width</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">min</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>    <span class="n">max_hfw_mm</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">horizontal_field_width</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>    <span class="c1"># working_dist range</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>    <span class="n">min_wd_mm</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">working_distance</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">min</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>    <span class="n">max_wd_mm</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">working_distance</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>    <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamLimits</span><span class="p">(</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>        <span class="n">voltage_kv</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_kv</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_kv</span><span class="p">),</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>        <span class="n">current_na</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_na</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_na</span><span class="p">),</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>        <span class="n">hfw_mm</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_hfw_mm</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_hfw_mm</span><span class="p">),</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>        <span class="n">working_distance_mm</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_wd_mm</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_wd_mm</span><span class="p">),</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>    <span class="p">)</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="k">def</span> <span class="nf">general</span><span class="p">(</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>    <span class="n">general_db</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">GeneralSettings</span><span class="p">:</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">    Convert a general settings dictionary to a built-in type and perform schema checking.</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">    This function converts a general settings dictionary from a .yml file to a `GeneralSettings` object. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="sd">    Parameters</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">    ----------</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">    general_db : dict</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">        The general settings dictionary from the .yml file.</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="sd">    Returns</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">    -------</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="sd">    tbt.GeneralSettings</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">        The general settings object.</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="sd">    Raises</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a><span class="sd">    ------</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a><span class="sd">        If the provided yml format is unsupported.</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">yml_format</span> <span class="ow">in</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">:</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Due to the complexity and number of variables, </span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a><span class="sd">        image objects should only be constructed using a yml file.&quot;&quot;&quot;</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>        <span class="p">)</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yml_format</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">):</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported yml format of </span><span class="si">{</span><span class="n">yml_format</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>    <span class="n">validate_general_settings</span><span class="p">(</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">general_db</span><span class="p">,</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>    <span class="p">)</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>        <span class="c1"># slice thickness</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="n">slice_thickness_um</span> <span class="o">=</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;slice_thickness_um&quot;</span><span class="p">]</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        <span class="c1"># max slice number</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="n">max_slice_number</span> <span class="o">=</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;max_slice_num&quot;</span><span class="p">]</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="c1"># pre tilt</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>        <span class="n">pre_tilt_deg</span> <span class="o">=</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;pre_tilt_deg&quot;</span><span class="p">]</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="c1"># sectioning axis</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>        <span class="n">sectioning_axis</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">SectioningAxis</span><span class="p">(</span><span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;sectioning_axis&quot;</span><span class="p">])</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>        <span class="c1"># stage tolerance</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>        <span class="n">stage_tolerance</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StageTolerance</span><span class="p">(</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>            <span class="n">translational_um</span><span class="o">=</span><span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;stage_translational_tol_um&quot;</span><span class="p">],</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>            <span class="n">angular_deg</span><span class="o">=</span><span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;stage_angular_tol_deg&quot;</span><span class="p">],</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>        <span class="p">)</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>        <span class="c1"># connection</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>        <span class="n">connection</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">MicroscopeConnection</span><span class="p">(</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>            <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;connection_host&quot;</span><span class="p">],</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;connection_port&quot;</span><span class="p">]</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>        <span class="p">)</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>        <span class="c1"># EBSD OEM</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>        <span class="n">ebsd_oem</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">(</span><span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;EBSD_OEM&quot;</span><span class="p">])</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>        <span class="c1"># EDS OEM</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>        <span class="n">eds_oem</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">(</span><span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;EDS_OEM&quot;</span><span class="p">])</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>        <span class="c1"># exp dir</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>        <span class="n">exp_dir</span> <span class="o">=</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;exp_dir&quot;</span><span class="p">]</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>        <span class="c1"># h5 log name</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>        <span class="n">h5_log_name</span> <span class="o">=</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;h5_log_name&quot;</span><span class="p">]</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>        <span class="c1"># remove log file extension if the user provided it</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>        <span class="n">log_extension</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">logfile_extension</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>        <span class="k">if</span> <span class="n">h5_log_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">log_extension</span><span class="p">):</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>            <span class="n">h5_log_name</span> <span class="o">=</span> <span class="n">h5_log_name</span><span class="p">[:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">log_extension</span><span class="p">)]</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>        <span class="c1"># step count</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>        <span class="n">step_count</span> <span class="o">=</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;step_count&quot;</span><span class="p">]</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>        <span class="n">yml_version</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>    <span class="n">general_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">GeneralSettings</span><span class="p">(</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>        <span class="n">yml_version</span><span class="o">=</span><span class="n">yml_version</span><span class="p">,</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>        <span class="n">slice_thickness_um</span><span class="o">=</span><span class="n">slice_thickness_um</span><span class="p">,</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>        <span class="n">max_slice_number</span><span class="o">=</span><span class="n">max_slice_number</span><span class="p">,</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>        <span class="n">pre_tilt_deg</span><span class="o">=</span><span class="n">pre_tilt_deg</span><span class="p">,</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>        <span class="n">sectioning_axis</span><span class="o">=</span><span class="n">sectioning_axis</span><span class="p">,</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="n">stage_tolerance</span><span class="o">=</span><span class="n">stage_tolerance</span><span class="p">,</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>        <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>        <span class="n">EBSD_OEM</span><span class="o">=</span><span class="n">ebsd_oem</span><span class="p">,</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        <span class="n">EDS_OEM</span><span class="o">=</span><span class="n">eds_oem</span><span class="p">,</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>        <span class="n">exp_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">exp_dir</span><span class="p">),</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>        <span class="n">h5_log_name</span><span class="o">=</span><span class="n">h5_log_name</span><span class="p">,</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>        <span class="n">step_count</span><span class="o">=</span><span class="n">step_count</span><span class="p">,</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>    <span class="p">)</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>    <span class="k">return</span> <span class="n">general_settings</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="k">def</span> <span class="nf">laser_box_pattern</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserBoxPattern</span><span class="p">:</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="sd">    Convert a dictionary of laser box pattern settings to a `LaserBoxPattern` object.</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">    This function takes a dictionary of laser box pattern settings and converts it to a `LaserBoxPattern` object.</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">    Parameters</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">    ----------</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">    settings : dict</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">        The dictionary containing laser box pattern settings.</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">    Returns</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">    -------</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">    tbt.LaserBoxPattern</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="sd">        The laser box pattern object.</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>    <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserBoxPattern</span><span class="p">(</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>        <span class="n">passes</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;passes&quot;</span><span class="p">],</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>        <span class="n">size_x_um</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;size_x_um&quot;</span><span class="p">],</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>        <span class="n">size_y_um</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;size_y_um&quot;</span><span class="p">],</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>        <span class="n">pitch_x_um</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pitch_x_um&quot;</span><span class="p">],</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>        <span class="n">pitch_y_um</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pitch_y_um&quot;</span><span class="p">],</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>        <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;scan_type&quot;</span><span class="p">]),</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>        <span class="n">coordinate_ref</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;coordinate_ref&quot;</span><span class="p">]),</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>    <span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a><span class="k">def</span> <span class="nf">laser_line_pattern</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserBoxPattern</span><span class="p">:</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="sd">    Convert a dictionary of laser line pattern settings to a `LaserLinePattern` object.</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a><span class="sd">    This function takes a dictionary of laser line pattern settings and converts it to a `LaserLinePattern` object.</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a><span class="sd">    Parameters</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a><span class="sd">    ----------</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a><span class="sd">    settings : dict</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="sd">        The dictionary containing laser line pattern settings.</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">    Returns</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="sd">    -------</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">    tbt.LaserLinePattern</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">        The laser line pattern object.</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>    <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserLinePattern</span><span class="p">(</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>        <span class="n">passes</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;passes&quot;</span><span class="p">],</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>        <span class="n">size_um</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;size_um&quot;</span><span class="p">],</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>        <span class="n">pitch_um</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pitch_um&quot;</span><span class="p">],</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>        <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;scan_type&quot;</span><span class="p">]),</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>    <span class="p">)</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a><span class="k">def</span> <span class="nf">laser</span><span class="p">(</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserSettings</span><span class="p">:</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="sd">    Convert a laser step from a .yml file to microscope settings for performing laser milling.</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="sd">    This function converts a laser step from a .yml file to `LaserSettings` for the microscope. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="sd">    Parameters</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="sd">    ----------</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a><span class="sd">        The microscope object for which to set the laser settings.</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="sd">    step_settings : dict</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a><span class="sd">        The dictionary containing the laser step settings from the .yml file.</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="sd">    step_name : str</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="sd">    Returns</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="sd">    -------</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">    tbt.LaserSettings</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">        The laser settings object.</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="sd">    Raises</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="sd">    ------</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">    KeyError</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">        If required settings are missing from the .yml file.</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>        <span class="c1"># pulse settings</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>        <span class="n">pulse_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pulse&quot;</span><span class="p">)</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>        <span class="k">if</span> <span class="n">pulse_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;pulse&#39; settings found in &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>            <span class="p">)</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>        <span class="c1"># laser optics settings</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>        <span class="n">optics_set_db</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>            <span class="s2">&quot;objective_position_mm&quot;</span><span class="p">:</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;objective_position_mm&quot;</span><span class="p">),</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>            <span class="s2">&quot;beam_shift_um_x&quot;</span><span class="p">:</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;beam_shift&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x_um&quot;</span><span class="p">),</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>            <span class="s2">&quot;beam_shift_um_y&quot;</span><span class="p">:</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;beam_shift&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y_um&quot;</span><span class="p">),</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        <span class="p">}</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="c1"># pattern settings</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>        <span class="n">pattern_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pattern&quot;</span><span class="p">)</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>        <span class="k">if</span> <span class="n">pattern_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;pattern&#39; settings found in &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>            <span class="p">)</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="n">line_pattern_db</span> <span class="o">=</span> <span class="n">pattern_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">)</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>        <span class="n">box_pattern_db</span> <span class="o">=</span> <span class="n">pattern_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>    <span class="n">validate_pulse_settings</span><span class="p">(</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">pulse_set_db</span><span class="p">,</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>    <span class="p">)</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>    <span class="n">pulse</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPulse</span><span class="p">(</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="n">wavelength_nm</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserWavelength</span><span class="p">(</span><span class="n">pulse_set_db</span><span class="p">[</span><span class="s2">&quot;wavelength_nm&quot;</span><span class="p">]),</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>        <span class="n">divider</span><span class="o">=</span><span class="n">pulse_set_db</span><span class="p">[</span><span class="s2">&quot;divider&quot;</span><span class="p">],</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>        <span class="n">energy_uj</span><span class="o">=</span><span class="n">pulse_set_db</span><span class="p">[</span><span class="s2">&quot;energy_uj&quot;</span><span class="p">],</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>        <span class="n">polarization</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPolarization</span><span class="p">(</span><span class="n">pulse_set_db</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]),</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>    <span class="p">)</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>    <span class="n">validate_laser_optics_settings</span><span class="p">(</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">optics_set_db</span><span class="p">,</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>    <span class="p">)</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>    <span class="n">pattern_type</span> <span class="o">=</span> <span class="n">validate_laser_pattern_settings</span><span class="p">(</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">pattern_set_db</span><span class="p">,</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>    <span class="p">)</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>    <span class="k">if</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="o">.</span><span class="n">BOX</span><span class="p">:</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="n">laser_box_pattern</span><span class="p">(</span><span class="n">box_pattern_db</span><span class="p">)</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>    <span class="k">if</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="o">.</span><span class="n">LINE</span><span class="p">:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="n">laser_line_pattern</span><span class="p">(</span><span class="n">line_pattern_db</span><span class="p">)</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>    <span class="n">pattern</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPattern</span><span class="p">(</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>        <span class="n">mode</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternMode</span><span class="p">(</span><span class="n">pattern_set_db</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]),</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>        <span class="n">rotation_deg</span><span class="o">=</span><span class="n">pattern_set_db</span><span class="p">[</span><span class="s2">&quot;rotation_deg&quot;</span><span class="p">],</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>        <span class="n">pulses_per_pixel</span><span class="o">=</span><span class="n">pattern_set_db</span><span class="p">[</span><span class="s2">&quot;pulses_per_pixel&quot;</span><span class="p">],</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>        <span class="n">pixel_dwell_ms</span><span class="o">=</span><span class="n">pattern_set_db</span><span class="p">[</span><span class="s2">&quot;pixel_dwell_ms&quot;</span><span class="p">],</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>        <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>    <span class="p">)</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>    <span class="n">laser_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserSettings</span><span class="p">(</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>        <span class="n">pulse</span><span class="o">=</span><span class="n">pulse</span><span class="p">,</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>        <span class="n">objective_position_mm</span><span class="o">=</span><span class="n">optics_set_db</span><span class="p">[</span><span class="s2">&quot;objective_position_mm&quot;</span><span class="p">],</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>        <span class="n">beam_shift_um</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>            <span class="n">x</span><span class="o">=</span><span class="n">optics_set_db</span><span class="p">[</span><span class="s2">&quot;beam_shift_um_x&quot;</span><span class="p">],</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>            <span class="n">y</span><span class="o">=</span><span class="n">optics_set_db</span><span class="p">[</span><span class="s2">&quot;beam_shift_um_y&quot;</span><span class="p">],</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="p">),</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>    <span class="p">)</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>    <span class="k">return</span> <span class="n">laser_settings</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a><span class="k">def</span> <span class="nf">image</span><span class="p">(</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ImageSettings</span><span class="p">:</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a><span class="sd">    Convert an image step from a .yml file to microscope settings for capturing an image.</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="sd">    This function converts an image step from a .yml file to `ImageSettings` for the microscope. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">    Parameters</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="sd">    ----------</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="sd">        The microscope object for which to set the image settings.</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">    step_settings : dict</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="sd">        The dictionary containing the image step settings from the .yml file.</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="sd">    step_name : str</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="sd">    Returns</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="sd">    -------</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">    tbt.ImageSettings</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">        The image settings object.</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="sd">    Raises</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="sd">    ------</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a><span class="sd">    KeyError</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="sd">        If required settings are missing from the .yml file.</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a><span class="sd">        If the provided beam type is unsupported.</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="sd">    ValueError</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="sd">        If invalid scan rotation is requested with dynamic focus or tilt correction, or if the bit depth is unsupported.</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>        <span class="n">step_general</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_general_key</span><span class="p">)</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>        <span class="k">if</span> <span class="n">step_general</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;step_general&#39; settings found in step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>            <span class="p">)</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>        <span class="n">step_type</span> <span class="o">=</span> <span class="n">step_general</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_type_key</span><span class="p">)</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>        <span class="k">if</span> <span class="n">step_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;step_type&#39; settings found in step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>            <span class="p">)</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>        <span class="c1"># beam settings</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>        <span class="n">beam_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;beam&quot;</span><span class="p">)</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>        <span class="k">if</span> <span class="n">beam_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;beam&#39; settings found in &#39;</span><span class="si">{</span><span class="n">step_type</span><span class="si">}</span><span class="s2">&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>            <span class="p">)</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>        <span class="n">beam_type_value</span> <span class="o">=</span> <span class="n">beam_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">beam_type_value</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">):</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>                <span class="sa">f</span><span class="s2">&quot;Unsupported beam type of &#39;</span><span class="si">{</span><span class="n">beam_type_value</span><span class="si">}</span><span class="s2">&#39;, supported beam types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>            <span class="p">)</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>        <span class="n">beam_type</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">(</span><span class="n">beam_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">))</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>        <span class="c1"># detector settings</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>        <span class="n">detector_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;detector&quot;</span><span class="p">)</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="k">if</span> <span class="n">detector_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;detector&#39; settings found in &#39;</span><span class="si">{</span><span class="n">step_type</span><span class="si">}</span><span class="s2">&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>            <span class="p">)</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>        <span class="n">auto_cb_set_db</span> <span class="o">=</span> <span class="n">detector_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;auto_cb&quot;</span><span class="p">)</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>        <span class="c1"># scan settings</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="n">scan_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">)</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>        <span class="k">if</span> <span class="n">scan_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;scan&#39; settings found in &#39;</span><span class="si">{</span><span class="n">step_type</span><span class="si">}</span><span class="s2">&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>            <span class="p">)</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>        <span class="n">scan_res</span> <span class="o">=</span> <span class="n">string_to_res</span><span class="p">(</span><span class="n">scan_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resolution&quot;</span><span class="p">))</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>        <span class="c1"># misc settings</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>        <span class="n">bit_depth</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bit_depth&quot;</span><span class="p">)</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>    <span class="c1"># TODO incorporate tile settings</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.1</span><span class="p">:</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>        <span class="c1"># tile settings</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>        <span class="n">tile_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tile_settings&quot;</span><span class="p">)</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>    <span class="n">validate_beam_settings</span><span class="p">(</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>        <span class="n">beam_type</span><span class="o">=</span><span class="n">beam_type</span><span class="p">,</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">,</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>    <span class="p">)</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>    <span class="n">beam_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">(</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>        <span class="n">voltage_kv</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;voltage_kv&quot;</span><span class="p">],</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>        <span class="n">voltage_tol_kv</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;voltage_tol_kv&quot;</span><span class="p">],</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="n">current_na</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;current_na&quot;</span><span class="p">],</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>        <span class="n">current_tol_na</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;current_tol_na&quot;</span><span class="p">],</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>        <span class="n">hfw_mm</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;hfw_mm&quot;</span><span class="p">],</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>        <span class="n">working_dist_mm</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;working_dist_mm&quot;</span><span class="p">],</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>        <span class="n">dynamic_focus</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;dynamic_focus&quot;</span><span class="p">],</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>        <span class="n">tilt_correction</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;tilt_correction&quot;</span><span class="p">],</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>    <span class="p">)</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>    <span class="n">validate_auto_cb_settings</span><span class="p">(</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">auto_cb_set_db</span><span class="p">,</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>    <span class="p">)</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>    <span class="n">auto_cb_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ScanArea</span><span class="p">(</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>        <span class="n">left</span><span class="o">=</span><span class="n">auto_cb_set_db</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">],</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>        <span class="n">top</span><span class="o">=</span><span class="n">auto_cb_set_db</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">],</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>        <span class="n">width</span><span class="o">=</span><span class="n">auto_cb_set_db</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>        <span class="n">height</span><span class="o">=</span><span class="n">auto_cb_set_db</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>    <span class="p">)</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>    <span class="n">validate_detector_settings</span><span class="p">(</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>        <span class="n">beam_type</span><span class="o">=</span><span class="n">beam_type</span><span class="p">,</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">detector_set_db</span><span class="p">,</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>    <span class="p">)</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>    <span class="n">detector_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Detector</span><span class="p">(</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">DetectorType</span><span class="p">(</span><span class="n">detector_set_db</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]),</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>        <span class="n">mode</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">DetectorMode</span><span class="p">(</span><span class="n">detector_set_db</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]),</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>        <span class="n">brightness</span><span class="o">=</span><span class="n">detector_set_db</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">],</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>        <span class="n">contrast</span><span class="o">=</span><span class="n">detector_set_db</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>        <span class="n">auto_cb_settings</span><span class="o">=</span><span class="n">auto_cb_settings</span><span class="p">,</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>        <span class="c1"># custom_settings=None,</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>    <span class="p">)</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>    <span class="n">validate_scan_settings</span><span class="p">(</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>        <span class="n">beam_type</span><span class="o">=</span><span class="n">beam_type</span><span class="p">,</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">scan_set_db</span><span class="p">,</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>    <span class="p">)</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>    <span class="c1"># cast resolution to preset if applicable</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">scan_res</span><span class="p">,</span> <span class="n">check_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">PresetResolution</span><span class="p">):</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>        <span class="n">scan_res</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">PresetResolution</span><span class="p">(</span><span class="n">scan_res</span><span class="p">)</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>    <span class="n">scan_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Scan</span><span class="p">(</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>        <span class="n">rotation_deg</span><span class="o">=</span><span class="n">scan_set_db</span><span class="p">[</span><span class="s2">&quot;rotation_deg&quot;</span><span class="p">],</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>        <span class="n">dwell_time_us</span><span class="o">=</span><span class="n">scan_set_db</span><span class="p">[</span><span class="s2">&quot;dwell_time_us&quot;</span><span class="p">],</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>        <span class="n">resolution</span><span class="o">=</span><span class="n">scan_res</span><span class="p">,</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>        <span class="c1"># mode=tbt.ScanMode(scan_set_db[&quot;mode&quot;]),</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>    <span class="p">)</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>    <span class="c1"># make sure Scan rotation is 0 if dynamic focus or tilt correction is on (using auto mode only for angular correction)</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>    <span class="k">if</span> <span class="n">beam_settings</span><span class="o">.</span><span class="n">dynamic_focus</span> <span class="ow">or</span> <span class="n">beam_settings</span><span class="o">.</span><span class="n">tilt_correction</span><span class="p">:</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">scan_settings</span><span class="o">.</span><span class="n">rotation_deg</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. Scan rotation of &#39;</span><span class="si">{</span><span class="n">scan_settings</span><span class="o">.</span><span class="n">rotation_deg</span><span class="si">}</span><span class="s2">&#39; degrees requested with tilt_correction and/or dynamic focus set to &#39;True&#39;. Cannot use dynamic focus or tilt correction for non-zero scan rotation.&quot;</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>            <span class="p">)</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>    <span class="c1"># validate bit_depth</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">bit_depth</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ColorDepth</span><span class="p">):</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>        <span class="n">valid_bit_depths</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ColorDepth</span><span class="p">]</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported bit depth of </span><span class="si">{</span><span class="n">bit_depth</span><span class="si">}</span><span class="s2">, available depths are </span><span class="si">{</span><span class="n">valid_bit_depths</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>        <span class="p">)</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>    <span class="n">image_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ImageSettings</span><span class="p">(</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>        <span class="n">beam</span><span class="o">=</span><span class="n">beam_object_type</span><span class="p">(</span><span class="n">beam_type</span><span class="p">)(</span><span class="n">settings</span><span class="o">=</span><span class="n">beam_settings</span><span class="p">),</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>        <span class="n">detector</span><span class="o">=</span><span class="n">detector_settings</span><span class="p">,</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>        <span class="n">scan</span><span class="o">=</span><span class="n">scan_settings</span><span class="p">,</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>        <span class="n">bit_depth</span><span class="o">=</span><span class="n">bit_depth</span><span class="p">,</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>    <span class="p">)</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>    <span class="k">return</span> <span class="n">image_settings</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBSettings</span><span class="p">:</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">    Convert a FIB step from a .yml file to microscope settings for performing a FIB operation.</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a><span class="sd">    This function converts a FIB step from a .yml file to `FIBSettings` for the microscope. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a><span class="sd">    Parameters</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">    ----------</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">        The microscope object for which to set the FIB settings.</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">    step_settings : dict</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="sd">        The dictionary containing the FIB step settings from the .yml file.</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">    step_name : str</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a><span class="sd">    Returns</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a><span class="sd">    -------</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a><span class="sd">    tbt.FIBSettings</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="sd">        The FIB settings object.</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a><span class="sd">    Raises</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a><span class="sd">    ------</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a><span class="sd">    KeyError</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a><span class="sd">        If required settings are missing from the .yml file.</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a><span class="sd">    ValueError</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="sd">        If invalid beam type is requested.</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>    <span class="c1">## create image_step_settings from this</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>        <span class="n">image_step_settings</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>        <span class="n">image_step_settings</span><span class="p">[</span><span class="s2">&quot;step_general&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;step_general&quot;</span><span class="p">)</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>        <span class="n">mill_step_settings</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mill&quot;</span><span class="p">)</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>        <span class="n">mill_beam_db</span> <span class="o">=</span> <span class="n">mill_step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;beam&quot;</span><span class="p">)</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>        <span class="n">mill_pattern_db</span> <span class="o">=</span> <span class="n">mill_step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pattern&quot;</span><span class="p">)</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>    <span class="c1"># ensure image is with an ion beam</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>    <span class="n">enforce_beam_type</span><span class="p">(</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>        <span class="n">tbt</span><span class="o">.</span><span class="n">IonBeam</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">image_step_settings</span><span class="p">,</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>    <span class="p">)</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>    <span class="n">image_settings</span> <span class="o">=</span> <span class="n">image</span><span class="p">(</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">image_step_settings</span><span class="p">,</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>    <span class="p">)</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>    <span class="c1">## fib mill settings</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>    <span class="c1"># ensure milling is with an ion beam</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>    <span class="n">enforce_beam_type</span><span class="p">(</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>        <span class="n">tbt</span><span class="o">.</span><span class="n">IonBeam</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">mill_step_settings</span><span class="p">,</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>    <span class="p">)</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>    <span class="n">beam_type</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">(</span><span class="n">mill_beam_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">))</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>    <span class="c1"># mill beam</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>    <span class="n">validate_beam_settings</span><span class="p">(</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>        <span class="n">beam_type</span><span class="o">=</span><span class="n">beam_type</span><span class="p">,</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">,</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>    <span class="p">)</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>    <span class="n">mill_beam</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">IonBeam</span><span class="p">(</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">(</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>            <span class="n">voltage_kv</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;voltage_kv&quot;</span><span class="p">],</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>            <span class="n">voltage_tol_kv</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;voltage_tol_kv&quot;</span><span class="p">],</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>            <span class="n">current_na</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;current_na&quot;</span><span class="p">],</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>            <span class="n">current_tol_na</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;current_tol_na&quot;</span><span class="p">],</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>            <span class="n">hfw_mm</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;hfw_mm&quot;</span><span class="p">],</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>            <span class="n">working_dist_mm</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;working_dist_mm&quot;</span><span class="p">],</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>            <span class="n">dynamic_focus</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;dynamic_focus&quot;</span><span class="p">],</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>            <span class="n">tilt_correction</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;tilt_correction&quot;</span><span class="p">],</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>        <span class="p">)</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>    <span class="p">)</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>    <span class="c1"># fib pattern settings</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>    <span class="n">pattern</span> <span class="o">=</span> <span class="n">validate_fib_pattern_settings</span><span class="p">(</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">mill_pattern_db</span><span class="p">,</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>    <span class="p">)</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>    <span class="n">fib_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBSettings</span><span class="p">(</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>        <span class="n">image</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>        <span class="n">mill_beam</span><span class="o">=</span><span class="n">mill_beam</span><span class="p">,</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>        <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>    <span class="p">)</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>    <span class="k">return</span> <span class="n">fib_settings</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a><span class="nd">@singledispatch</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a><span class="k">def</span> <span class="nf">enforce_beam_type</span><span class="p">(</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>    <span class="n">beam_type</span><span class="p">,</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">    Enforce a specific beam type is used for an operation based on a dictionary.</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a><span class="sd">    This function ensures that the specified beam type is used for an operation based on the provided settings dictionary. The dictionary must contain a sub-dictionary with the key &#39;beam&#39;.</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="sd">    Parameters</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a><span class="sd">    ----------</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a><span class="sd">    beam_type : Any</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="sd">        The beam type to enforce.</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a><span class="sd">    step_settings : dict</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a><span class="sd">        The dictionary containing the step settings.</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a><span class="sd">    step_name : str</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a><span class="sd">    Returns</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a><span class="sd">    -------</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a><span class="sd">    bool</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a><span class="sd">        True if the beam type is enforced successfully.</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a><span class="sd">    Raises</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a><span class="sd">    ------</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a><span class="sd">        If no handler is available for the provided type.</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>    <span class="n">_</span> <span class="o">=</span> <span class="n">beam_type</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>    <span class="n">__</span> <span class="o">=</span> <span class="n">step_settings</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>    <span class="n">___</span> <span class="o">=</span> <span class="n">step_name</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>    <span class="n">____</span> <span class="o">=</span> <span class="n">yml_format</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No handler for type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">step_settings</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a><span class="nd">@enforce_beam_type</span><span class="o">.</span><span class="n">register</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a><span class="k">def</span> <span class="nf">_</span><span class="p">(</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>    <span class="n">beam_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ElectronBeam</span><span class="p">,</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a><span class="sd">    Enforce that an electron beam is used for an operation based on a dictionary.</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a><span class="sd">    This function ensures that an electron beam is used for an operation based on the provided settings dictionary.</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a><span class="sd">    Parameters</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a><span class="sd">    ----------</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a><span class="sd">    beam_type : tbt.ElectronBeam</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a><span class="sd">        The electron beam type to enforce.</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a><span class="sd">    step_settings : dict</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a><span class="sd">        The dictionary containing the step settings.</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a><span class="sd">    step_name : str</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a><span class="sd">    Returns</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a><span class="sd">    -------</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a><span class="sd">    bool</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a><span class="sd">        True if the electron beam type is enforced successfully.</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a><span class="sd">    Raises</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a><span class="sd">    ------</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a><span class="sd">    KeyError</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a><span class="sd">        If the &#39;beam&#39; settings are missing from the .yml file.</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a><span class="sd">        If the beam type is unsupported or not an electron beam.</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>    <span class="c1"># beam must be electron</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>        <span class="n">beam_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;beam&quot;</span><span class="p">)</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>        <span class="k">if</span> <span class="n">beam_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;beam&#39; settings found in step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>            <span class="p">)</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>        <span class="n">beam_type_value</span> <span class="o">=</span> <span class="n">beam_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>        <span class="n">electron_beam_error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unsupported beam type of &#39;</span><span class="si">{</span><span class="n">beam_type_value</span><span class="si">}</span><span class="s2">&#39; in step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. &#39;</span><span class="si">{</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; beam type must be used.&quot;</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">beam_type_value</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">):</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">electron_beam_error_message</span><span class="p">)</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">(</span><span class="n">beam_type_value</span><span class="p">)</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">:</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">electron_beam_error_message</span><span class="p">)</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a><span class="nd">@enforce_beam_type</span><span class="o">.</span><span class="n">register</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a><span class="k">def</span> <span class="nf">_</span><span class="p">(</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>    <span class="n">beam_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">IonBeam</span><span class="p">,</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a><span class="sd">    Enforce that an ion beam is used for an operation based on a dictionary.</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a><span class="sd">    This function ensures that an ion beam is used for an operation based on the provided settings dictionary.</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a><span class="sd">    Parameters</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a><span class="sd">    ----------</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a><span class="sd">    beam_type : tbt.IonBeam</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a><span class="sd">        The ion beam type to enforce.</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a><span class="sd">    step_settings : dict</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a><span class="sd">        The dictionary containing the step settings.</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a><span class="sd">    step_name : str</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a><span class="sd">    Returns</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a><span class="sd">    -------</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a><span class="sd">    bool</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a><span class="sd">        True if the ion beam type is enforced successfully.</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a><span class="sd">    Raises</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a><span class="sd">    ------</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a><span class="sd">    KeyError</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a><span class="sd">        If the &#39;beam&#39; settings are missing from the .yml file.</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a><span class="sd">        If the beam type is unsupported or not an ion beam.</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>    <span class="c1"># beam must be ion</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>        <span class="n">beam_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;beam&quot;</span><span class="p">)</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>        <span class="k">if</span> <span class="n">beam_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;beam&#39; settings found in step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>            <span class="p">)</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>        <span class="n">beam_type_value</span> <span class="o">=</span> <span class="n">beam_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>        <span class="n">ion_beam_error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unsupported beam type of &#39;</span><span class="si">{</span><span class="n">beam_type_value</span><span class="si">}</span><span class="s2">&#39; for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. &#39;</span><span class="si">{</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; beam type must be used.&quot;</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">beam_type_value</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">):</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">ion_beam_error_message</span><span class="p">)</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">(</span><span class="n">beam_type_value</span><span class="p">)</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">:</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">ion_beam_error_message</span><span class="p">)</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a><span class="k">def</span> <span class="nf">ebsd</span><span class="p">(</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">EBSDSettings</span><span class="p">:</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a><span class="sd">    Convert an EBSD step from a .yml file to microscope settings for performing an EBSD operation.</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a><span class="sd">    This function converts an EBSD step from a .yml file to `EBSDSettings` for the microscope. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a><span class="sd">    Parameters</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a><span class="sd">    ----------</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a><span class="sd">        The microscope object for which to set the EBSD settings.</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a><span class="sd">    step_settings : dict</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a><span class="sd">        The dictionary containing the EBSD step settings from the .yml file.</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a><span class="sd">    step_name : str</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="sd">    Returns</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a><span class="sd">    -------</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a><span class="sd">    tbt.EBSDSettings</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a><span class="sd">        The EBSD settings object.</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a><span class="sd">    Raises</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a><span class="sd">    ------</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a><span class="sd">    KeyError</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a><span class="sd">        If required settings are missing from the .yml file or if the &#39;concurrent_EDS&#39; key is invalid.</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>    <span class="n">enforce_beam_type</span><span class="p">(</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a>        <span class="n">tbt</span><span class="o">.</span><span class="n">ElectronBeam</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>    <span class="p">)</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>    <span class="n">image_settings</span> <span class="o">=</span> <span class="n">image</span><span class="p">(</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>    <span class="p">)</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>    <span class="n">concurrent_EDS</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;concurrent_EDS&quot;</span><span class="p">)</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">concurrent_EDS</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">concurrent_EDS</span><span class="p">):</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>        <span class="n">enable_eds</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>    <span class="k">elif</span> <span class="n">concurrent_EDS</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>        <span class="n">enable_eds</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>            <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, an EBSD type step. &#39;concurrent_EDS&#39; key is &#39;</span><span class="si">{</span><span class="n">concurrent_EDS</span><span class="si">}</span><span class="s2">&#39; of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">concurrent_EDS</span><span class="p">)</span><span class="si">}</span><span class="s2"> but must be boolean (True/False) or of NoneType (null in .yml).&quot;</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>        <span class="p">)</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>    <span class="n">ebsd_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">EBSDSettings</span><span class="p">(</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>        <span class="n">image</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>        <span class="n">enable_eds</span><span class="o">=</span><span class="n">enable_eds</span><span class="p">,</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>        <span class="n">enable_ebsd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>    <span class="p">)</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>    <span class="k">return</span> <span class="n">ebsd_settings</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a><span class="k">def</span> <span class="nf">eds</span><span class="p">(</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">EDSSettings</span><span class="p">:</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a><span class="sd">    Convert an EDS step from a .yml file to microscope settings for performing an EDS operation.</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a><span class="sd">    This function converts an EDS step from a .yml file to `EDSSettings` for the microscope. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a><span class="sd">    Parameters</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a><span class="sd">    ----------</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a><span class="sd">        The microscope object for which to set the EDS settings.</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a><span class="sd">    step_settings : dict</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a><span class="sd">        The dictionary containing the EDS step settings from the .yml file.</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a><span class="sd">    step_name : str</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a><span class="sd">    Returns</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a><span class="sd">    -------</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a><span class="sd">    tbt.EDSSettings</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a><span class="sd">        The EDS settings object.</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>    <span class="n">enforce_beam_type</span><span class="p">(</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>        <span class="n">tbt</span><span class="o">.</span><span class="n">ElectronBeam</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>    <span class="p">)</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>    <span class="n">image_settings</span> <span class="o">=</span> <span class="n">image</span><span class="p">(</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a>    <span class="p">)</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>    <span class="n">eds_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">EDSSettings</span><span class="p">(</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>        <span class="n">image</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>        <span class="n">enable_eds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>    <span class="p">)</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>    <span class="k">return</span> <span class="n">eds_settings</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a><span class="k">def</span> <span class="nf">custom</span><span class="p">(</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">CustomSettings</span><span class="p">:</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a><span class="sd">    Convert a custom step from a .yml file to custom settings for the microscope.</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a><span class="sd">    This function converts a custom step from a .yml file to `CustomSettings` for the microscope. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a><span class="sd">    Parameters</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a><span class="sd">    ----------</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a><span class="sd">        The microscope object for which to set the custom settings.</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a><span class="sd">    step_settings : dict</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a><span class="sd">        The dictionary containing the custom step settings from the .yml file.</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a><span class="sd">    step_name : str</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a><span class="sd">    Returns</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a><span class="sd">    -------</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a><span class="sd">    tbt.CustomSettings</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a><span class="sd">        The custom settings object.</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a><span class="sd">    Raises</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a><span class="sd">    ------</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a><span class="sd">    KeyError</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a><span class="sd">        If required settings are missing from the .yml file.</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a><span class="sd">    ValueError</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a><span class="sd">        If the specified script or executable path does not exist.</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>        <span class="n">script_path</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;script_path&quot;</span><span class="p">)</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>        <span class="k">if</span> <span class="n">script_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;script_path&#39; found in custom step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>            <span class="p">)</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">script_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid location for script at location </span><span class="si">{</span><span class="n">script_path</span><span class="si">}</span><span class="s2">. File does not exist.&quot;</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>            <span class="p">)</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a>        <span class="n">executable_path</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;executable_path&quot;</span><span class="p">)</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a>        <span class="k">if</span> <span class="n">executable_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;executable_path&#39; found in custom step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>            <span class="p">)</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid location for executable at location </span><span class="si">{</span><span class="n">executable_path</span><span class="si">}</span><span class="s2">. File does not exist.&quot;</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>            <span class="p">)</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>    <span class="n">custom_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">CustomSettings</span><span class="p">(</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>        <span class="n">script_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">script_path</span><span class="p">),</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>        <span class="n">executable_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">executable_path</span><span class="p">),</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>    <span class="p">)</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>    <span class="k">return</span> <span class="n">custom_settings</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a><span class="c1"># def fib_pattern_type(</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a><span class="c1">#     settings: tbt.FIBSettings,</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a><span class="c1"># ) -&gt; Union[tbt.FIBBoxPattern, tbt.FIBStreamPattern]:</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a><span class="c1">#     &quot;&quot;&quot;Returns specific pattern type settings for a properly formatted FIBSettings object&quot;&quot;&quot;</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a><span class="k">def</span> <span class="nf">scan_limits</span><span class="p">(</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>    <span class="n">selected_beam</span><span class="p">:</span> <span class="nb">property</span><span class="p">,</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ScanLimits</span><span class="p">:</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a><span class="sd">    Retrieve the scan settings limits for the selected beam.</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a><span class="sd">    This function retrieves the limits for rotation and dwell time for the selected beam and returns them as a `ScanLimits` object.</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a><span class="sd">    Parameters</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a><span class="sd">    ----------</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a><span class="sd">    selected_beam : property</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a><span class="sd">        The selected beam property from which to retrieve the scan limits.</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a><span class="sd">    Returns</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a><span class="sd">    -------</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a><span class="sd">    tbt.ScanLimits</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a><span class="sd">        The scan limits for rotation (degrees) and dwell time (microseconds).</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>    <span class="c1"># rotation</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>    <span class="n">min_deg</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">rotation</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">min</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">RAD_TO_DEG</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>    <span class="n">max_deg</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">rotation</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">RAD_TO_DEG</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>    <span class="c1"># dwell_time</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>    <span class="n">min_dwell_us</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">dwell_time</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">min</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">S_TO_US</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>    <span class="n">max_dwell_us</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">dwell_time</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">S_TO_US</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>    <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ScanLimits</span><span class="p">(</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>        <span class="n">rotation_deg</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_deg</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_deg</span><span class="p">),</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>        <span class="n">dwell_us</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_dwell_us</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_dwell_us</span><span class="p">),</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>    <span class="p">)</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a><span class="k">def</span> <span class="nf">string_to_res</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Resolution</span><span class="p">:</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a><span class="sd">    Convert a string in the format &quot;{{width}}x{{height}}&quot; to a resolution object.</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a><span class="sd">    This function takes a string representing the resolution in the format &quot;WIDTHxHEIGHT&quot; and converts it to a `Resolution` object.</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a><span class="sd">    Parameters</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a><span class="sd">    ----------</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a><span class="sd">    input : str</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a><span class="sd">        The string representing the resolution in the format &quot;WIDTHxHEIGHT&quot;.</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a><span class="sd">    Returns</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a><span class="sd">    -------</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a><span class="sd">    tbt.Resolution</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a><span class="sd">        The resolution object.</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a><span class="sd">    Raises</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a><span class="sd">    ------</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a><span class="sd">    ValueError</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a><span class="sd">        If the input string is not in the expected format.</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>        <span class="n">split_res</span> <span class="o">=</span> <span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split_res</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">split_res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a>    <span class="k">except</span><span class="p">:</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Invalid string format, </span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a><span class="s2">                            expected string format of &quot;WIDTHxHEIGHT&quot;, </span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a><span class="s2">                            but received the following: &quot;</span><span class="si">{</span><span class="nb">input</span><span class="si">}</span><span class="s2">&quot;.&quot;&quot;&quot;</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a>        <span class="p">)</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>    <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Resolution</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a><span class="k">def</span> <span class="nf">valid_string_resolution</span><span class="p">(</span><span class="n">string_resolution</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a><span class="sd">    Validate a string resolution.</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a><span class="sd">    This function validates a string resolution by converting it to a `Resolution` object and checking if the width and height are within the specified limits.</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a><span class="sd">    Parameters</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a><span class="sd">    ----------</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a><span class="sd">    string_resolution : str</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a><span class="sd">        The string representing the resolution in the format &quot;WIDTHxHEIGHT&quot;.</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a><span class="sd">    Returns</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a><span class="sd">    -------</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a><span class="sd">    bool</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a><span class="sd">        True if the resolution is valid, False otherwise.</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">string_to_res</span><span class="p">(</span><span class="n">string_resolution</span><span class="p">)</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a>    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">height</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a>        <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a>            <span class="n">width</span><span class="p">,</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>            <span class="n">limit</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">scan_resolution_limit</span><span class="p">,</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>            <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a>        <span class="p">)</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>    <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>        <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a>            <span class="n">height</span><span class="p">,</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>            <span class="n">limit</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">scan_resolution_limit</span><span class="p">,</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a>            <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a>        <span class="p">)</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a>    <span class="p">)</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a><span class="k">def</span> <span class="nf">validate_auto_cb_settings</span><span class="p">(</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a><span class="sd">    Perform schema checking for auto contrast/brightness setting dictionary.</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a><span class="sd">    This function validates the auto contrast/brightness settings dictionary based on the specified yml format.</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a><span class="sd">    Parameters</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a><span class="sd">    ----------</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a><span class="sd">    settings : dict</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a><span class="sd">        The dictionary containing the auto contrast/brightness settings.</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a><span class="sd">    step_name : str</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a><span class="sd">    Returns</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a><span class="sd">    -------</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a><span class="sd">    bool</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a><span class="sd">    Raises</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a><span class="sd">    ------</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a><span class="sd">    KeyError</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a><span class="sd">        If required keys are missing from the settings dictionary.</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a><span class="sd">    ValueError</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a><span class="sd">        If the settings do not satisfy the specified schema.</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">none_value_dictionary</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>            <span class="n">missing_key</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>            <span class="n">missing_key</span> <span class="o">=</span> <span class="s2">&quot;top&quot;</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>            <span class="sa">f</span><span class="s2">&quot;Missing or no value for &#39;</span><span class="si">{</span><span class="n">missing_key</span><span class="si">}</span><span class="s2">&#39; key in &#39;auto_cb&#39; sub-dictionary in step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; All &#39;auto_cb&#39; sub-dictionary values must be declared by the user to implement this capability.&quot;</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>        <span class="p">)</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a>    <span class="n">origin_limit</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># reduced area limit for scan window</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>    <span class="n">width_limit</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">])</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>    <span class="n">height_limit</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">])</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>            <span class="p">{</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>                <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">origin_limit</span><span class="p">,</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">RIGHT_OPEN</span><span class="p">,</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>                    <span class="p">),</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested auto contrast/brightness window setting &#39;left&#39; of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;0 &lt;= left &lt; </span><span class="si">{</span><span class="n">origin_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;. Origin is in top-left corner of the field of view.&quot;</span><span class="p">,</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>                <span class="p">),</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>                <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">origin_limit</span><span class="p">,</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">RIGHT_OPEN</span><span class="p">,</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>                    <span class="p">),</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested auto contrast/brightness windows setting &#39;top&#39; of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;0.0 &lt;= top &lt; </span><span class="si">{</span><span class="n">origin_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;. Origin is in top-left corner of the field of view.&quot;</span><span class="p">,</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a>                <span class="p">),</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">width_limit</span><span class="p">,</span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">LEFT_OPEN</span><span class="p">,</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>                    <span class="p">),</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested auto contrast/brightness windows setting &#39;width&#39; of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> must satisfy &#39;0.0 &lt; width &lt;= </span><span class="si">{</span><span class="n">width_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39; with &#39;left&#39; setting of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> as total width (&#39;left&#39; + &#39;width&#39;) cannot exceed 1.0&quot;</span><span class="p">,</span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>                <span class="p">),</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">height_limit</span><span class="p">,</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">LEFT_OPEN</span><span class="p">,</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>                    <span class="p">),</span>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested auto contrast/brightness windows setting &#39;height&#39; of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> must satisfy &#39;0.0 &lt; height &lt;= </span><span class="si">{</span><span class="n">height_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39; with &#39;top&#39; setting of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> as total height (&#39;top&#39; + &#39;height&#39;) cannot exceed 1.0&quot;</span><span class="p">,</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>                <span class="p">),</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a>            <span class="p">},</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a>        <span class="p">)</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a>        <span class="p">)</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a><span class="k">def</span> <span class="nf">validate_stage_position</span><span class="p">(</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a><span class="sd">    Perform schema checking for stage position dictionary.</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a><span class="sd">    This function validates the stage position settings dictionary based on the specified yml format and the stage limits of the microscope.</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a><span class="sd">    Parameters</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a><span class="sd">    ----------</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a><span class="sd">        The microscope object for which to validate the stage position settings.</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a><span class="sd">    step_name : str</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a><span class="sd">    settings : dict</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a><span class="sd">        The dictionary containing the stage position settings.</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a><span class="sd">    Returns</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a><span class="sd">    -------</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a><span class="sd">    bool</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a><span class="sd">    Raises</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a><span class="sd">    ------</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a><span class="sd">    ValueError</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a><span class="sd">        If the yml version is unsupported.</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>    <span class="n">limits</span> <span class="o">=</span> <span class="n">stage_limits</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a>            <span class="p">{</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a>                <span class="s2">&quot;x_mm&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">x_mm</span><span class="p">,</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a>                    <span class="p">),</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested x-axis position of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;x_mm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> mm for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;</span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">x_mm</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= x_mm &lt;= </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">x_mm</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>                <span class="p">),</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a>                <span class="s2">&quot;y_mm&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">y_mm</span><span class="p">,</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>                    <span class="p">),</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested y-axis position of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;y_mm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> mm for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;</span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">y_mm</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= y_mm &lt;= </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">y_mm</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>                <span class="p">),</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a>                <span class="s2">&quot;z_mm&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">z_mm</span><span class="p">,</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>                    <span class="p">),</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested z-axis position of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;z_mm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> mm for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;</span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">z_mm</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= z_mm &lt;= </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">z_mm</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>                <span class="p">),</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>                <span class="s2">&quot;r_deg&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">r_deg</span><span class="p">,</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">RIGHT_OPEN</span><span class="p">,</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>                    <span class="p">),</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested r-axis position of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;r_deg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> degree for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;</span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">r_deg</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= r_deg &lt; </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">r_deg</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>                <span class="p">),</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>                <span class="s2">&quot;t_deg&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">t_deg</span><span class="p">,</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>                    <span class="p">),</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested r-axis position of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;t_deg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> degree for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;</span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">t_deg</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= t_deg &lt;= </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">t_deg</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a>                <span class="p">),</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>            <span class="p">},</span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>        <span class="p">)</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>        <span class="p">)</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a><span class="k">def</span> <span class="nf">validate_beam_settings</span><span class="p">(</span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a>    <span class="n">beam_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">,</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a><span class="sd">    Perform schema checking for beam setting dictionary.</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a><span class="sd">    This function validates the beam settings dictionary based on the specified yml format and the beam limits of the microscope.</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a><span class="sd">    Parameters</span>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a><span class="sd">    ----------</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a><span class="sd">        The microscope object for which to validate the beam settings.</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a><span class="sd">    beam_type : tbt.BeamType</span>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a><span class="sd">        The type of the beam (electron or ion).</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a><span class="sd">    settings : dict</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a><span class="sd">        The dictionary containing the beam settings.</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a><span class="sd">    step_name : str</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a><span class="sd">    Returns</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a><span class="sd">    -------</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a><span class="sd">    bool</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a><span class="sd">    Raises</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a><span class="sd">    ------</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a><span class="sd">    ValueError</span>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a>    <span class="n">specified_beam</span> <span class="o">=</span> <span class="n">beam_object_type</span><span class="p">(</span><span class="n">beam_type</span><span class="p">)(</span><span class="n">settings</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">())</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a>    <span class="n">selected_beam</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">beam_type</span><span class="p">(</span><span class="n">specified_beam</span><span class="p">,</span> <span class="n">microscope</span><span class="p">)</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>    <span class="n">limits</span> <span class="o">=</span> <span class="n">beam_limits</span><span class="p">(</span><span class="n">selected_beam</span><span class="p">,</span> <span class="n">beam_type</span><span class="p">)</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>            <span class="p">{</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>                <span class="s2">&quot;voltage_kv&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">voltage_kv</span><span class="p">,</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>                    <span class="p">),</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested voltage of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;voltage_kv&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; kV not within limits of </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">voltage_kv</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> kV and </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">voltage_kv</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2"> kV.&quot;</span><span class="p">,</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>                <span class="p">),</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>                <span class="s2">&quot;voltage_tol_kv&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested voltage tolerance of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;voltage_tol_kv&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; kV must be a positive float (greater than 0).&quot;</span><span class="p">,</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a>                <span class="p">),</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a>                <span class="s2">&quot;current_na&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">current_na</span><span class="p">,</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>                    <span class="p">),</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested voltage of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;current_na&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; nA not within limits of </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">current_na</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> nA and </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">current_na</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2"> nA&quot;</span><span class="p">,</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a>                <span class="p">),</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a>                <span class="s2">&quot;current_tol_na&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;current_tol_na&#39; must be a positive float (greater than 0)&quot;</span><span class="p">,</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a>                <span class="p">),</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a>                <span class="s2">&quot;hfw_mm&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>                        <span class="n">limits</span><span class="o">.</span><span class="n">hfw_mm</span><span class="p">,</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>                    <span class="p">),</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested horizontal field width of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;hfw_mm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm not within limits of </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">hfw_mm</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> mm and </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">hfw_mm</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2"> mm&quot;</span><span class="p">,</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>                <span class="p">),</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>                <span class="s2">&quot;working_dist_mm&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">working_distance_mm</span><span class="p">,</span>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>                    <span class="p">),</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested working distance of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;working_dist_mm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm not within limits of </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">working_distance_mm</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> mm and </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">working_distance_mm</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2"> mm&quot;</span><span class="p">,</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a>                <span class="p">),</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a>            <span class="p">},</span>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>        <span class="p">)</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>        <span class="n">e_beam_schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>            <span class="p">{</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a>                <span class="s2">&quot;dynamic_focus&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a>                    <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; with &#39;electron&#39; beam imaging, &#39;dynamic_focus&#39; must be a boolean value but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dynamic_focus&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dynamic_focus&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> was requested.&quot;</span><span class="p">,</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a>                <span class="p">),</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a>                <span class="s2">&quot;tilt_correction&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>                    <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; with &#39;electron&#39; beam imaging, &#39;tilt_correction&#39; must be a boolean value but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;tilt_correction&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;tilt_correction&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> was requested.&quot;</span><span class="p">,</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>                <span class="p">),</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>            <span class="p">},</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>        <span class="p">)</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>        <span class="n">i_beam_schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>            <span class="p">{</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>                <span class="s2">&quot;dynamic_focus&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a>                    <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; with &#39;ion&#39; beam imaging, &#39;dynamic_focus&#39; must be &#39;False&#39; or &#39;None&#39; but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dynamic_focus&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dynamic_focus&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> was requested.&quot;</span><span class="p">,</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>                <span class="p">),</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>                <span class="s2">&quot;tilt_correction&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>                    <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; with &#39;ion&#39; beam imaging, &#39;tilt_correction&#39; must be &#39;False&#39; or &#39;None&#39; but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;tilt_correction&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;tilt_correction&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> was requested.&quot;</span><span class="p">,</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>                <span class="p">),</span>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a>            <span class="p">},</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a>        <span class="p">)</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>        <span class="k">if</span> <span class="n">specified_beam</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">:</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>            <span class="n">e_beam_schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a>        <span class="k">if</span> <span class="n">specified_beam</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">:</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a>            <span class="n">i_beam_schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>        <span class="p">)</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a><span class="k">def</span> <span class="nf">validate_detector_settings</span><span class="p">(</span>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a>    <span class="n">beam_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">,</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a><span class="sd">    Perform schema checking for detector setting dictionary.</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a><span class="sd">    This function validates the detector settings dictionary based on the specified yml format and the detector capabilities of the microscope.</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a><span class="sd">    Parameters</span>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a><span class="sd">    ----------</span>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a><span class="sd">        The microscope object for which to validate the detector settings.</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a><span class="sd">    beam_type : tbt.BeamType</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a><span class="sd">        The type of the beam (electron or ion).</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a><span class="sd">    settings : dict</span>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a><span class="sd">        The dictionary containing the detector settings.</span>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a><span class="sd">    step_name : str</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a><span class="sd">    Returns</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a><span class="sd">    -------</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a><span class="sd">    bool</span>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a><span class="sd">    Raises</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a><span class="sd">    ------</span>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a><span class="sd">    KeyError</span>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a><span class="sd">        If auto contrast/brightness settings conflict with fixed brightness/contrast values.</span>
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a><span class="sd">    ValueError</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a><span class="sd">        If the yml version is unsupported, or if the settings do not satisfy the specified schema, or if the detector type or mode is unsupported.</span>
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a>    <span class="c1"># switch to top left quad, enable e-beam</span>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a>    <span class="n">devices</span><span class="o">.</span><span class="n">device_access</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a>
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a>    <span class="c1"># set specified beam to active imaging device</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a>    <span class="n">specified_beam</span> <span class="o">=</span> <span class="n">beam_object_type</span><span class="p">(</span><span class="n">beam_type</span><span class="p">)(</span><span class="n">settings</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">())</span>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a>    <span class="n">img</span><span class="o">.</span><span class="n">set_beam_device</span><span class="p">(</span>
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a>        <span class="n">device</span><span class="o">=</span><span class="n">specified_beam</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a>    <span class="p">)</span>
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a>    <span class="n">auto_cb_db</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;auto_cb&quot;</span><span class="p">)</span>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a>    <span class="n">use_auto_cb</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">none_value_dictionary</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;auto_cb&quot;</span><span class="p">))</span>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a>    <span class="k">if</span> <span class="n">use_auto_cb</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a>        <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;brightness&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contrast&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a>    <span class="p">):</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a>            <span class="sa">f</span><span class="s2">&quot;Auto contrast/brightness settings of </span><span class="si">{</span><span class="n">auto_cb_db</span><span class="si">}</span><span class="s2"> provided while settings of fixed brightness of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brightness&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; and fixed contrast of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;contrast&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; were also provided. Users may use either fixed brightness/contrast values or auto contrast/brightness settings, but not both.&quot;</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a>        <span class="p">)</span>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a>        <span class="n">detector</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a>        <span class="n">mode</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a>        <span class="n">cb_limit</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a>            <span class="p">{</span>
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a>                <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a>                    <span class="n">And</span><span class="p">(</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a>                        <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a>                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a>                            <span class="n">x</span><span class="p">,</span>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a>                            <span class="n">limit</span><span class="o">=</span><span class="n">cb_limit</span><span class="p">,</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a>                            <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">LEFT_OPEN</span><span class="p">,</span>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a>                        <span class="p">),</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a>                    <span class="p">),</span>
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested fixed brightness of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;brightness&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;. This is not within limits of &#39;&gt;</span><span class="si">{</span><span class="n">cb_limit</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&#39; and &#39;&lt;=</span><span class="si">{</span><span class="n">cb_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a>                <span class="p">),</span>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a>                <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a>                    <span class="n">And</span><span class="p">(</span>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a>                        <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2094"><a href="#L-2094"><span class="linenos">2094</span></a>                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-2095"><a href="#L-2095"><span class="linenos">2095</span></a>                            <span class="n">x</span><span class="p">,</span>
</span><span id="L-2096"><a href="#L-2096"><span class="linenos">2096</span></a>                            <span class="n">limit</span><span class="o">=</span><span class="n">cb_limit</span><span class="p">,</span>
</span><span id="L-2097"><a href="#L-2097"><span class="linenos">2097</span></a>                            <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">LEFT_OPEN</span><span class="p">,</span>
</span><span id="L-2098"><a href="#L-2098"><span class="linenos">2098</span></a>                        <span class="p">),</span>
</span><span id="L-2099"><a href="#L-2099"><span class="linenos">2099</span></a>                    <span class="p">),</span>
</span><span id="L-2100"><a href="#L-2100"><span class="linenos">2100</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested fixed contrast of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;contrast&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;. This is either not within limits of &#39;&gt;</span><span class="si">{</span><span class="n">cb_limit</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&#39; and &#39;&lt;=</span><span class="si">{</span><span class="n">cb_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
</span><span id="L-2101"><a href="#L-2101"><span class="linenos">2101</span></a>                <span class="p">),</span>
</span><span id="L-2102"><a href="#L-2102"><span class="linenos">2102</span></a>            <span class="p">},</span>
</span><span id="L-2103"><a href="#L-2103"><span class="linenos">2103</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2104"><a href="#L-2104"><span class="linenos">2104</span></a>        <span class="p">)</span>
</span><span id="L-2105"><a href="#L-2105"><span class="linenos">2105</span></a>
</span><span id="L-2106"><a href="#L-2106"><span class="linenos">2106</span></a>    <span class="c1"># check detector type</span>
</span><span id="L-2107"><a href="#L-2107"><span class="linenos">2107</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">detector</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">DetectorType</span><span class="p">):</span>
</span><span id="L-2108"><a href="#L-2108"><span class="linenos">2108</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2109"><a href="#L-2109"><span class="linenos">2109</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported detector type of &#39;</span><span class="si">{</span><span class="n">detector</span><span class="si">}</span><span class="s2">&#39; on step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-2110"><a href="#L-2110"><span class="linenos">2110</span></a>        <span class="p">)</span>
</span><span id="L-2111"><a href="#L-2111"><span class="linenos">2111</span></a>    <span class="n">detector_type</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">DetectorType</span><span class="p">(</span><span class="n">detector</span><span class="p">)</span>
</span><span id="L-2112"><a href="#L-2112"><span class="linenos">2112</span></a>    <span class="n">microscope_detector_types</span> <span class="o">=</span> <span class="n">available_detector_types</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="L-2113"><a href="#L-2113"><span class="linenos">2113</span></a>    <span class="k">if</span> <span class="n">detector_type</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">microscope_detector_types</span><span class="p">:</span>
</span><span id="L-2114"><a href="#L-2114"><span class="linenos">2114</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2115"><a href="#L-2115"><span class="linenos">2115</span></a>            <span class="sa">f</span><span class="s2">&quot;Requested detector of </span><span class="si">{</span><span class="n">detector_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> is unavailable on this tool. Available detectors are: </span><span class="si">{</span><span class="n">microscope_detector_types</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2116"><a href="#L-2116"><span class="linenos">2116</span></a>        <span class="p">)</span>
</span><span id="L-2117"><a href="#L-2117"><span class="linenos">2117</span></a>    <span class="c1"># make sure to set this detector as the active one to access modes</span>
</span><span id="L-2118"><a href="#L-2118"><span class="linenos">2118</span></a>    <span class="n">img</span><span class="o">.</span><span class="n">detector_type</span><span class="p">(</span>
</span><span id="L-2119"><a href="#L-2119"><span class="linenos">2119</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-2120"><a href="#L-2120"><span class="linenos">2120</span></a>        <span class="n">detector</span><span class="o">=</span><span class="n">detector_type</span><span class="p">,</span>
</span><span id="L-2121"><a href="#L-2121"><span class="linenos">2121</span></a>    <span class="p">)</span>
</span><span id="L-2122"><a href="#L-2122"><span class="linenos">2122</span></a>
</span><span id="L-2123"><a href="#L-2123"><span class="linenos">2123</span></a>    <span class="c1"># check detector mode</span>
</span><span id="L-2124"><a href="#L-2124"><span class="linenos">2124</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">DetectorMode</span><span class="p">):</span>
</span><span id="L-2125"><a href="#L-2125"><span class="linenos">2125</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2126"><a href="#L-2126"><span class="linenos">2126</span></a>            <span class="sa">f</span><span class="s1">&#39;Unsupported detector mode of &quot;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&quot; for &quot;</span><span class="si">{</span><span class="n">detector</span><span class="si">}</span><span class="s1">&quot; detector&#39;</span>
</span><span id="L-2127"><a href="#L-2127"><span class="linenos">2127</span></a>        <span class="p">)</span>
</span><span id="L-2128"><a href="#L-2128"><span class="linenos">2128</span></a>    <span class="n">detector_mode</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">DetectorMode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="L-2129"><a href="#L-2129"><span class="linenos">2129</span></a>    <span class="n">microscope_detector_modes</span> <span class="o">=</span> <span class="n">available_detector_modes</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="L-2130"><a href="#L-2130"><span class="linenos">2130</span></a>    <span class="k">if</span> <span class="n">detector_mode</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">microscope_detector_modes</span><span class="p">:</span>
</span><span id="L-2131"><a href="#L-2131"><span class="linenos">2131</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2132"><a href="#L-2132"><span class="linenos">2132</span></a>            <span class="sa">f</span><span class="s2">&quot;Requested mode of </span><span class="si">{</span><span class="n">detector_mode</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">detector_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> detector is invalid. Valid mode types are: </span><span class="si">{</span><span class="n">microscope_detector_modes</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2133"><a href="#L-2133"><span class="linenos">2133</span></a>        <span class="p">)</span>
</span><span id="L-2134"><a href="#L-2134"><span class="linenos">2134</span></a>
</span><span id="L-2135"><a href="#L-2135"><span class="linenos">2135</span></a>    <span class="c1"># check detector settings</span>
</span><span id="L-2136"><a href="#L-2136"><span class="linenos">2136</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-2137"><a href="#L-2137"><span class="linenos">2137</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-2138"><a href="#L-2138"><span class="linenos">2138</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="L-2139"><a href="#L-2139"><span class="linenos">2139</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2140"><a href="#L-2140"><span class="linenos">2140</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="L-2141"><a href="#L-2141"><span class="linenos">2141</span></a>        <span class="p">)</span>
</span><span id="L-2142"><a href="#L-2142"><span class="linenos">2142</span></a>
</span><span id="L-2143"><a href="#L-2143"><span class="linenos">2143</span></a>
</span><span id="L-2144"><a href="#L-2144"><span class="linenos">2144</span></a><span class="k">def</span> <span class="nf">validate_EBSD_EDS_settings</span><span class="p">(</span>
</span><span id="L-2145"><a href="#L-2145"><span class="linenos">2145</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-2146"><a href="#L-2146"><span class="linenos">2146</span></a>    <span class="n">connection_host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2147"><a href="#L-2147"><span class="linenos">2147</span></a>    <span class="n">connection_port</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2148"><a href="#L-2148"><span class="linenos">2148</span></a>    <span class="n">ebsd_oem</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2149"><a href="#L-2149"><span class="linenos">2149</span></a>    <span class="n">eds_oem</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2150"><a href="#L-2150"><span class="linenos">2150</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-2151"><a href="#L-2151"><span class="linenos">2151</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2152"><a href="#L-2152"><span class="linenos">2152</span></a><span class="sd">    Check EBSD and EDS OEM and connection for supported OEMs.</span>
</span><span id="L-2153"><a href="#L-2153"><span class="linenos">2153</span></a>
</span><span id="L-2154"><a href="#L-2154"><span class="linenos">2154</span></a><span class="sd">    This function ensures that the specified EBSD and EDS OEMs are supported and that the connection settings are valid.</span>
</span><span id="L-2155"><a href="#L-2155"><span class="linenos">2155</span></a>
</span><span id="L-2156"><a href="#L-2156"><span class="linenos">2156</span></a><span class="sd">    Parameters</span>
</span><span id="L-2157"><a href="#L-2157"><span class="linenos">2157</span></a><span class="sd">    ----------</span>
</span><span id="L-2158"><a href="#L-2158"><span class="linenos">2158</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-2159"><a href="#L-2159"><span class="linenos">2159</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-2160"><a href="#L-2160"><span class="linenos">2160</span></a><span class="sd">    connection_host : str</span>
</span><span id="L-2161"><a href="#L-2161"><span class="linenos">2161</span></a><span class="sd">        The host for the microscope connection.</span>
</span><span id="L-2162"><a href="#L-2162"><span class="linenos">2162</span></a><span class="sd">    connection_port : str</span>
</span><span id="L-2163"><a href="#L-2163"><span class="linenos">2163</span></a><span class="sd">        The port for the microscope connection.</span>
</span><span id="L-2164"><a href="#L-2164"><span class="linenos">2164</span></a><span class="sd">    ebsd_oem : str</span>
</span><span id="L-2165"><a href="#L-2165"><span class="linenos">2165</span></a><span class="sd">        The OEM for the EBSD device.</span>
</span><span id="L-2166"><a href="#L-2166"><span class="linenos">2166</span></a><span class="sd">    eds_oem : str</span>
</span><span id="L-2167"><a href="#L-2167"><span class="linenos">2167</span></a><span class="sd">        The OEM for the EDS device.</span>
</span><span id="L-2168"><a href="#L-2168"><span class="linenos">2168</span></a>
</span><span id="L-2169"><a href="#L-2169"><span class="linenos">2169</span></a><span class="sd">    Returns</span>
</span><span id="L-2170"><a href="#L-2170"><span class="linenos">2170</span></a><span class="sd">    -------</span>
</span><span id="L-2171"><a href="#L-2171"><span class="linenos">2171</span></a><span class="sd">    bool</span>
</span><span id="L-2172"><a href="#L-2172"><span class="linenos">2172</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-2173"><a href="#L-2173"><span class="linenos">2173</span></a>
</span><span id="L-2174"><a href="#L-2174"><span class="linenos">2174</span></a><span class="sd">    Raises</span>
</span><span id="L-2175"><a href="#L-2175"><span class="linenos">2175</span></a><span class="sd">    ------</span>
</span><span id="L-2176"><a href="#L-2176"><span class="linenos">2176</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-2177"><a href="#L-2177"><span class="linenos">2177</span></a><span class="sd">        If differing EBSD and EDS OEMs are requested.</span>
</span><span id="L-2178"><a href="#L-2178"><span class="linenos">2178</span></a><span class="sd">    ValueError</span>
</span><span id="L-2179"><a href="#L-2179"><span class="linenos">2179</span></a><span class="sd">        If the EBSD or EDS OEM is unsupported.</span>
</span><span id="L-2180"><a href="#L-2180"><span class="linenos">2180</span></a><span class="sd">    SystemError</span>
</span><span id="L-2181"><a href="#L-2181"><span class="linenos">2181</span></a><span class="sd">        If the Laser API is not accessible.</span>
</span><span id="L-2182"><a href="#L-2182"><span class="linenos">2182</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2183"><a href="#L-2183"><span class="linenos">2183</span></a>    <span class="c1"># ensure same manufacturer for both EBSD and EDS</span>
</span><span id="L-2184"><a href="#L-2184"><span class="linenos">2184</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ebsd_oem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">eds_oem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ebsd_oem</span> <span class="o">!=</span> <span class="n">eds_oem</span><span class="p">):</span>
</span><span id="L-2185"><a href="#L-2185"><span class="linenos">2185</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="L-2186"><a href="#L-2186"><span class="linenos">2186</span></a>            <span class="sa">f</span><span class="s2">&quot;Differing EBSD and EDS OEMs are not supported. Requested EBSD OEM of &#39;</span><span class="si">{</span><span class="n">ebsd_oem</span><span class="si">}</span><span class="s2">&#39; and EDS OEM of &#39;</span><span class="si">{</span><span class="n">eds_oem</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-2187"><a href="#L-2187"><span class="linenos">2187</span></a>        <span class="p">)</span>
</span><span id="L-2188"><a href="#L-2188"><span class="linenos">2188</span></a>
</span><span id="L-2189"><a href="#L-2189"><span class="linenos">2189</span></a>    <span class="c1"># Check EBSD OEM</span>
</span><span id="L-2190"><a href="#L-2190"><span class="linenos">2190</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">ebsd_oem</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">):</span>
</span><span id="L-2191"><a href="#L-2191"><span class="linenos">2191</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2192"><a href="#L-2192"><span class="linenos">2192</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported EBSD OEM of &#39;</span><span class="si">{</span><span class="n">ebsd_oem</span><span class="si">}</span><span class="s2">&#39;. Supported OEM types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2193"><a href="#L-2193"><span class="linenos">2193</span></a>        <span class="p">)</span>
</span><span id="L-2194"><a href="#L-2194"><span class="linenos">2194</span></a>    <span class="n">ebsd_device</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">(</span><span class="n">ebsd_oem</span><span class="p">)</span>
</span><span id="L-2195"><a href="#L-2195"><span class="linenos">2195</span></a>    <span class="c1"># Check EDS OEM</span>
</span><span id="L-2196"><a href="#L-2196"><span class="linenos">2196</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">eds_oem</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">):</span>
</span><span id="L-2197"><a href="#L-2197"><span class="linenos">2197</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2198"><a href="#L-2198"><span class="linenos">2198</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported EDS OEM of &#39;</span><span class="si">{</span><span class="n">eds_oem</span><span class="si">}</span><span class="s2">&#39;. Supported OEM types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2199"><a href="#L-2199"><span class="linenos">2199</span></a>        <span class="p">)</span>
</span><span id="L-2200"><a href="#L-2200"><span class="linenos">2200</span></a>    <span class="n">eds_device</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">(</span><span class="n">eds_oem</span><span class="p">)</span>
</span><span id="L-2201"><a href="#L-2201"><span class="linenos">2201</span></a>
</span><span id="L-2202"><a href="#L-2202"><span class="linenos">2202</span></a>    <span class="c1"># exit if both devices are none, no need for laser control</span>
</span><span id="L-2203"><a href="#L-2203"><span class="linenos">2203</span></a>    <span class="k">if</span> <span class="n">ebsd_device</span> <span class="o">==</span> <span class="n">eds_device</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
</span><span id="L-2204"><a href="#L-2204"><span class="linenos">2204</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-2205"><a href="#L-2205"><span class="linenos">2205</span></a>
</span><span id="L-2206"><a href="#L-2206"><span class="linenos">2206</span></a>    <span class="c1"># check EBSD and EDS connection</span>
</span><span id="L-2207"><a href="#L-2207"><span class="linenos">2207</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-2208"><a href="#L-2208"><span class="linenos">2208</span></a>        <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span>
</span><span id="L-2209"><a href="#L-2209"><span class="linenos">2209</span></a>    <span class="k">except</span><span class="p">:</span>
</span><span id="L-2210"><a href="#L-2210"><span class="linenos">2210</span></a>        <span class="k">raise</span> <span class="ne">SystemError</span><span class="p">(</span>
</span><span id="L-2211"><a href="#L-2211"><span class="linenos">2211</span></a>            <span class="s2">&quot;EBSD and/or EDS control requested, but Laser API not accessible, so cannot use EBSD and EDS control. Please restart Laser API, or if not installed, change OEM to &#39;null&#39;, or leave blank in settings file.&quot;</span>
</span><span id="L-2212"><a href="#L-2212"><span class="linenos">2212</span></a>        <span class="p">)</span>
</span><span id="L-2213"><a href="#L-2213"><span class="linenos">2213</span></a>    <span class="n">microscope</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">()</span>
</span><span id="L-2214"><a href="#L-2214"><span class="linenos">2214</span></a>    <span class="n">ut</span><span class="o">.</span><span class="n">connect_microscope</span><span class="p">(</span>
</span><span id="L-2215"><a href="#L-2215"><span class="linenos">2215</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-2216"><a href="#L-2216"><span class="linenos">2216</span></a>        <span class="n">quiet_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2217"><a href="#L-2217"><span class="linenos">2217</span></a>        <span class="n">connection_host</span><span class="o">=</span><span class="n">connection_host</span><span class="p">,</span>
</span><span id="L-2218"><a href="#L-2218"><span class="linenos">2218</span></a>        <span class="n">connection_port</span><span class="o">=</span><span class="n">connection_port</span><span class="p">,</span>
</span><span id="L-2219"><a href="#L-2219"><span class="linenos">2219</span></a>    <span class="p">)</span>
</span><span id="L-2220"><a href="#L-2220"><span class="linenos">2220</span></a>    <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">(</span><span class="n">eds_oem</span><span class="p">)</span> <span class="o">!=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
</span><span id="L-2221"><a href="#L-2221"><span class="linenos">2221</span></a>        <span class="n">devices</span><span class="o">.</span><span class="n">retract_EDS</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="L-2222"><a href="#L-2222"><span class="linenos">2222</span></a>    <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">(</span><span class="n">ebsd_oem</span><span class="p">)</span> <span class="o">!=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
</span><span id="L-2223"><a href="#L-2223"><span class="linenos">2223</span></a>        <span class="n">devices</span><span class="o">.</span><span class="n">retract_EBSD</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="L-2224"><a href="#L-2224"><span class="linenos">2224</span></a>    <span class="n">ut</span><span class="o">.</span><span class="n">disconnect_microscope</span><span class="p">(</span>
</span><span id="L-2225"><a href="#L-2225"><span class="linenos">2225</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-2226"><a href="#L-2226"><span class="linenos">2226</span></a>        <span class="n">quiet_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2227"><a href="#L-2227"><span class="linenos">2227</span></a>    <span class="p">)</span>
</span><span id="L-2228"><a href="#L-2228"><span class="linenos">2228</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-2229"><a href="#L-2229"><span class="linenos">2229</span></a>
</span><span id="L-2230"><a href="#L-2230"><span class="linenos">2230</span></a>
</span><span id="L-2231"><a href="#L-2231"><span class="linenos">2231</span></a><span class="k">def</span> <span class="nf">validate_general_settings</span><span class="p">(</span>
</span><span id="L-2232"><a href="#L-2232"><span class="linenos">2232</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-2233"><a href="#L-2233"><span class="linenos">2233</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-2234"><a href="#L-2234"><span class="linenos">2234</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-2235"><a href="#L-2235"><span class="linenos">2235</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2236"><a href="#L-2236"><span class="linenos">2236</span></a><span class="sd">    Perform schema checking for general setting dictionary.</span>
</span><span id="L-2237"><a href="#L-2237"><span class="linenos">2237</span></a>
</span><span id="L-2238"><a href="#L-2238"><span class="linenos">2238</span></a><span class="sd">    This function validates the general settings dictionary based on the specified yml format. It checks the microscope connection and EBSD/EDS connection if valid OEMs are specified.</span>
</span><span id="L-2239"><a href="#L-2239"><span class="linenos">2239</span></a>
</span><span id="L-2240"><a href="#L-2240"><span class="linenos">2240</span></a><span class="sd">    Parameters</span>
</span><span id="L-2241"><a href="#L-2241"><span class="linenos">2241</span></a><span class="sd">    ----------</span>
</span><span id="L-2242"><a href="#L-2242"><span class="linenos">2242</span></a><span class="sd">    settings : dict</span>
</span><span id="L-2243"><a href="#L-2243"><span class="linenos">2243</span></a><span class="sd">        The dictionary containing the general settings.</span>
</span><span id="L-2244"><a href="#L-2244"><span class="linenos">2244</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-2245"><a href="#L-2245"><span class="linenos">2245</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-2246"><a href="#L-2246"><span class="linenos">2246</span></a>
</span><span id="L-2247"><a href="#L-2247"><span class="linenos">2247</span></a><span class="sd">    Returns</span>
</span><span id="L-2248"><a href="#L-2248"><span class="linenos">2248</span></a><span class="sd">    -------</span>
</span><span id="L-2249"><a href="#L-2249"><span class="linenos">2249</span></a><span class="sd">    bool</span>
</span><span id="L-2250"><a href="#L-2250"><span class="linenos">2250</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-2251"><a href="#L-2251"><span class="linenos">2251</span></a>
</span><span id="L-2252"><a href="#L-2252"><span class="linenos">2252</span></a><span class="sd">    Raises</span>
</span><span id="L-2253"><a href="#L-2253"><span class="linenos">2253</span></a><span class="sd">    ------</span>
</span><span id="L-2254"><a href="#L-2254"><span class="linenos">2254</span></a><span class="sd">    ValueError</span>
</span><span id="L-2255"><a href="#L-2255"><span class="linenos">2255</span></a><span class="sd">        If the general settings dictionary is empty, or if the settings do not satisfy the specified schema, or if the connection is invalid.</span>
</span><span id="L-2256"><a href="#L-2256"><span class="linenos">2256</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-2257"><a href="#L-2257"><span class="linenos">2257</span></a><span class="sd">        If the sectioning axis is unsupported.</span>
</span><span id="L-2258"><a href="#L-2258"><span class="linenos">2258</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2259"><a href="#L-2259"><span class="linenos">2259</span></a>
</span><span id="L-2260"><a href="#L-2260"><span class="linenos">2260</span></a>    <span class="k">if</span> <span class="n">settings</span> <span class="o">==</span> <span class="p">{}:</span>
</span><span id="L-2261"><a href="#L-2261"><span class="linenos">2261</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;General settings dictionary is empty.&quot;</span><span class="p">)</span>
</span><span id="L-2262"><a href="#L-2262"><span class="linenos">2262</span></a>
</span><span id="L-2263"><a href="#L-2263"><span class="linenos">2263</span></a>    <span class="n">slice_thickness_limit_um</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">slice_thickness_limit_um</span>
</span><span id="L-2264"><a href="#L-2264"><span class="linenos">2264</span></a>    <span class="n">pre_tilt_limit_deg</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">pre_tilt_limit_deg_generic</span>
</span><span id="L-2265"><a href="#L-2265"><span class="linenos">2265</span></a>
</span><span id="L-2266"><a href="#L-2266"><span class="linenos">2266</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-2267"><a href="#L-2267"><span class="linenos">2267</span></a>        <span class="n">sectioning_axis</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sectioning_axis&quot;</span><span class="p">)</span>
</span><span id="L-2268"><a href="#L-2268"><span class="linenos">2268</span></a>        <span class="n">connection_host</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;connection_host&quot;</span><span class="p">)</span>
</span><span id="L-2269"><a href="#L-2269"><span class="linenos">2269</span></a>        <span class="n">connection_port</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;connection_port&quot;</span><span class="p">)</span>
</span><span id="L-2270"><a href="#L-2270"><span class="linenos">2270</span></a>        <span class="n">ebsd_oem</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;EBSD_OEM&quot;</span><span class="p">)</span>
</span><span id="L-2271"><a href="#L-2271"><span class="linenos">2271</span></a>        <span class="n">eds_oem</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;EDS_OEM&quot;</span><span class="p">)</span>
</span><span id="L-2272"><a href="#L-2272"><span class="linenos">2272</span></a>        <span class="n">exp_dir</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exp_dir&quot;</span><span class="p">)</span>
</span><span id="L-2273"><a href="#L-2273"><span class="linenos">2273</span></a>        <span class="n">h5_log_name</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;h5_log_name&quot;</span><span class="p">)</span>
</span><span id="L-2274"><a href="#L-2274"><span class="linenos">2274</span></a>
</span><span id="L-2275"><a href="#L-2275"><span class="linenos">2275</span></a>    <span class="c1"># Validate the non-numeric values</span>
</span><span id="L-2276"><a href="#L-2276"><span class="linenos">2276</span></a>    <span class="c1"># Check sectioning axis</span>
</span><span id="L-2277"><a href="#L-2277"><span class="linenos">2277</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">sectioning_axis</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">SectioningAxis</span><span class="p">):</span>
</span><span id="L-2278"><a href="#L-2278"><span class="linenos">2278</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported sectioning axis of </span><span class="si">{</span><span class="n">sectioning_axis</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="L-2279"><a href="#L-2279"><span class="linenos">2279</span></a>    <span class="c1"># TODO</span>
</span><span id="L-2280"><a href="#L-2280"><span class="linenos">2280</span></a>    <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">SectioningAxis</span><span class="p">(</span><span class="n">sectioning_axis</span><span class="p">)</span> <span class="o">!=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">SectioningAxis</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
</span><span id="L-2281"><a href="#L-2281"><span class="linenos">2281</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Currently only Z-axis sectioning is supported.&quot;</span><span class="p">)</span>
</span><span id="L-2282"><a href="#L-2282"><span class="linenos">2282</span></a>    <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">SectioningAxis</span><span class="p">(</span><span class="n">sectioning_axis</span><span class="p">)</span> <span class="o">!=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">SectioningAxis</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
</span><span id="L-2283"><a href="#L-2283"><span class="linenos">2283</span></a>        <span class="n">pre_tilt_limit_deg</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">pre_tilt_limit_deg_non_Z_sectioning</span>  <span class="c1"># overwrite</span>
</span><span id="L-2284"><a href="#L-2284"><span class="linenos">2284</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-2285"><a href="#L-2285"><span class="linenos">2285</span></a>            <span class="s2">&quot;Pre-tilt value must be zero (0.0) degrees when using a sectioning axis other than &#39;Z&#39;&quot;</span>
</span><span id="L-2286"><a href="#L-2286"><span class="linenos">2286</span></a>        <span class="p">)</span>
</span><span id="L-2287"><a href="#L-2287"><span class="linenos">2287</span></a>    <span class="c1"># Check connection host and port</span>
</span><span id="L-2288"><a href="#L-2288"><span class="linenos">2288</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_microscope_connection</span><span class="p">(</span>
</span><span id="L-2289"><a href="#L-2289"><span class="linenos">2289</span></a>        <span class="n">host</span><span class="o">=</span><span class="n">connection_host</span><span class="p">,</span>
</span><span id="L-2290"><a href="#L-2290"><span class="linenos">2290</span></a>        <span class="n">port</span><span class="o">=</span><span class="n">connection_port</span><span class="p">,</span>
</span><span id="L-2291"><a href="#L-2291"><span class="linenos">2291</span></a>    <span class="p">):</span>
</span><span id="L-2292"><a href="#L-2292"><span class="linenos">2292</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2293"><a href="#L-2293"><span class="linenos">2293</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported connection with host of </span><span class="si">{</span><span class="n">connection_host</span><span class="si">}</span><span class="s2"> and port of </span><span class="si">{</span><span class="n">connection_port</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-2294"><a href="#L-2294"><span class="linenos">2294</span></a>        <span class="p">)</span>
</span><span id="L-2295"><a href="#L-2295"><span class="linenos">2295</span></a>
</span><span id="L-2296"><a href="#L-2296"><span class="linenos">2296</span></a>    <span class="c1"># check EBSD and EDS</span>
</span><span id="L-2297"><a href="#L-2297"><span class="linenos">2297</span></a>    <span class="n">validate_EBSD_EDS_settings</span><span class="p">(</span>
</span><span id="L-2298"><a href="#L-2298"><span class="linenos">2298</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-2299"><a href="#L-2299"><span class="linenos">2299</span></a>        <span class="n">connection_host</span><span class="o">=</span><span class="n">connection_host</span><span class="p">,</span>
</span><span id="L-2300"><a href="#L-2300"><span class="linenos">2300</span></a>        <span class="n">connection_port</span><span class="o">=</span><span class="n">connection_port</span><span class="p">,</span>
</span><span id="L-2301"><a href="#L-2301"><span class="linenos">2301</span></a>        <span class="n">ebsd_oem</span><span class="o">=</span><span class="n">ebsd_oem</span><span class="p">,</span>
</span><span id="L-2302"><a href="#L-2302"><span class="linenos">2302</span></a>        <span class="n">eds_oem</span><span class="o">=</span><span class="n">eds_oem</span><span class="p">,</span>
</span><span id="L-2303"><a href="#L-2303"><span class="linenos">2303</span></a>    <span class="p">)</span>
</span><span id="L-2304"><a href="#L-2304"><span class="linenos">2304</span></a>
</span><span id="L-2305"><a href="#L-2305"><span class="linenos">2305</span></a>    <span class="c1"># Check exp dir</span>
</span><span id="L-2306"><a href="#L-2306"><span class="linenos">2306</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-2307"><a href="#L-2307"><span class="linenos">2307</span></a>        <span class="n">Path</span><span class="p">(</span><span class="n">exp_dir</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="L-2308"><a href="#L-2308"><span class="linenos">2308</span></a>            <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2309"><a href="#L-2309"><span class="linenos">2309</span></a>            <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2310"><a href="#L-2310"><span class="linenos">2310</span></a>        <span class="p">)</span>
</span><span id="L-2311"><a href="#L-2311"><span class="linenos">2311</span></a>    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="L-2312"><a href="#L-2312"><span class="linenos">2312</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2313"><a href="#L-2313"><span class="linenos">2313</span></a>            <span class="sa">f</span><span class="s1">&#39;Requested experimental directory of &quot;</span><span class="si">{</span><span class="n">exp_dir</span><span class="si">}</span><span class="s1">&quot;, which is not a valid path.&#39;</span>
</span><span id="L-2314"><a href="#L-2314"><span class="linenos">2314</span></a>        <span class="p">)</span>
</span><span id="L-2315"><a href="#L-2315"><span class="linenos">2315</span></a>    <span class="c1"># Check h5 log name</span>
</span><span id="L-2316"><a href="#L-2316"><span class="linenos">2316</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5_log_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-2317"><a href="#L-2317"><span class="linenos">2317</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unsupported h5 log name of &quot;</span><span class="si">{</span><span class="n">h5_log_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
</span><span id="L-2318"><a href="#L-2318"><span class="linenos">2318</span></a>
</span><span id="L-2319"><a href="#L-2319"><span class="linenos">2319</span></a>    <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-2320"><a href="#L-2320"><span class="linenos">2320</span></a>        <span class="p">{</span>
</span><span id="L-2321"><a href="#L-2321"><span class="linenos">2321</span></a>            <span class="s2">&quot;slice_thickness_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2322"><a href="#L-2322"><span class="linenos">2322</span></a>                <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2323"><a href="#L-2323"><span class="linenos">2323</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-2324"><a href="#L-2324"><span class="linenos">2324</span></a>                    <span class="n">x</span><span class="p">,</span>
</span><span id="L-2325"><a href="#L-2325"><span class="linenos">2325</span></a>                    <span class="n">limit</span><span class="o">=</span><span class="n">slice_thickness_limit_um</span><span class="p">,</span>
</span><span id="L-2326"><a href="#L-2326"><span class="linenos">2326</span></a>                    <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-2327"><a href="#L-2327"><span class="linenos">2327</span></a>                <span class="p">),</span>
</span><span id="L-2328"><a href="#L-2328"><span class="linenos">2328</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested slice thickness of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;slice_thickness_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> um must satisfy &#39;</span><span class="si">{</span><span class="n">slice_thickness_limit_um</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= slice_thickness_um &lt;= </span><span class="si">{</span><span class="n">slice_thickness_limit_um</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="L-2329"><a href="#L-2329"><span class="linenos">2329</span></a>            <span class="p">),</span>
</span><span id="L-2330"><a href="#L-2330"><span class="linenos">2330</span></a>            <span class="s2">&quot;max_slice_num&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2331"><a href="#L-2331"><span class="linenos">2331</span></a>                <span class="nb">int</span><span class="p">,</span>
</span><span id="L-2332"><a href="#L-2332"><span class="linenos">2332</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2333"><a href="#L-2333"><span class="linenos">2333</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested max slice number of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;max_slice_num&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> must satisfy &#39;0 &lt; max_slice_number&#39;&quot;</span><span class="p">,</span>
</span><span id="L-2334"><a href="#L-2334"><span class="linenos">2334</span></a>            <span class="p">),</span>
</span><span id="L-2335"><a href="#L-2335"><span class="linenos">2335</span></a>            <span class="s2">&quot;pre_tilt_deg&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2336"><a href="#L-2336"><span class="linenos">2336</span></a>                <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2337"><a href="#L-2337"><span class="linenos">2337</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-2338"><a href="#L-2338"><span class="linenos">2338</span></a>                    <span class="n">x</span><span class="p">,</span>
</span><span id="L-2339"><a href="#L-2339"><span class="linenos">2339</span></a>                    <span class="n">limit</span><span class="o">=</span><span class="n">pre_tilt_limit_deg</span><span class="p">,</span>
</span><span id="L-2340"><a href="#L-2340"><span class="linenos">2340</span></a>                    <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-2341"><a href="#L-2341"><span class="linenos">2341</span></a>                <span class="p">),</span>
</span><span id="L-2342"><a href="#L-2342"><span class="linenos">2342</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested pre tilt of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pre_tilt_deg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> degrees must satisfy &#39;</span><span class="si">{</span><span class="n">pre_tilt_limit_deg</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= pre_tilt_deg &lt;= </span><span class="si">{</span><span class="n">pre_tilt_limit_deg</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="L-2343"><a href="#L-2343"><span class="linenos">2343</span></a>            <span class="p">),</span>
</span><span id="L-2344"><a href="#L-2344"><span class="linenos">2344</span></a>            <span class="s2">&quot;stage_translational_tol_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2345"><a href="#L-2345"><span class="linenos">2345</span></a>                <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2346"><a href="#L-2346"><span class="linenos">2346</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2347"><a href="#L-2347"><span class="linenos">2347</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested stage translational tolerance of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;stage_translational_tol_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> um must be a positive float (greater than 0)&quot;</span><span class="p">,</span>
</span><span id="L-2348"><a href="#L-2348"><span class="linenos">2348</span></a>            <span class="p">),</span>
</span><span id="L-2349"><a href="#L-2349"><span class="linenos">2349</span></a>            <span class="s2">&quot;stage_angular_tol_deg&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2350"><a href="#L-2350"><span class="linenos">2350</span></a>                <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2351"><a href="#L-2351"><span class="linenos">2351</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2352"><a href="#L-2352"><span class="linenos">2352</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested stage angular tolerance of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;stage_angular_tol_deg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> degrees must be a positive float (greater than 0)&quot;</span><span class="p">,</span>
</span><span id="L-2353"><a href="#L-2353"><span class="linenos">2353</span></a>            <span class="p">),</span>
</span><span id="L-2354"><a href="#L-2354"><span class="linenos">2354</span></a>            <span class="s2">&quot;step_count&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2355"><a href="#L-2355"><span class="linenos">2355</span></a>                <span class="nb">int</span><span class="p">,</span>
</span><span id="L-2356"><a href="#L-2356"><span class="linenos">2356</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2357"><a href="#L-2357"><span class="linenos">2357</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested step count of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;step_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> must be a positive int (greater than 0)&quot;</span><span class="p">,</span>
</span><span id="L-2358"><a href="#L-2358"><span class="linenos">2358</span></a>            <span class="p">),</span>
</span><span id="L-2359"><a href="#L-2359"><span class="linenos">2359</span></a>        <span class="p">},</span>
</span><span id="L-2360"><a href="#L-2360"><span class="linenos">2360</span></a>        <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2361"><a href="#L-2361"><span class="linenos">2361</span></a>    <span class="p">)</span>
</span><span id="L-2362"><a href="#L-2362"><span class="linenos">2362</span></a>
</span><span id="L-2363"><a href="#L-2363"><span class="linenos">2363</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-2364"><a href="#L-2364"><span class="linenos">2364</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-2365"><a href="#L-2365"><span class="linenos">2365</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="L-2366"><a href="#L-2366"><span class="linenos">2366</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2367"><a href="#L-2367"><span class="linenos">2367</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="L-2368"><a href="#L-2368"><span class="linenos">2368</span></a>        <span class="p">)</span>
</span><span id="L-2369"><a href="#L-2369"><span class="linenos">2369</span></a>
</span><span id="L-2370"><a href="#L-2370"><span class="linenos">2370</span></a>
</span><span id="L-2371"><a href="#L-2371"><span class="linenos">2371</span></a><span class="k">def</span> <span class="nf">validate_scan_settings</span><span class="p">(</span>
</span><span id="L-2372"><a href="#L-2372"><span class="linenos">2372</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-2373"><a href="#L-2373"><span class="linenos">2373</span></a>    <span class="n">beam_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">,</span>
</span><span id="L-2374"><a href="#L-2374"><span class="linenos">2374</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-2375"><a href="#L-2375"><span class="linenos">2375</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-2376"><a href="#L-2376"><span class="linenos">2376</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2377"><a href="#L-2377"><span class="linenos">2377</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-2378"><a href="#L-2378"><span class="linenos">2378</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2379"><a href="#L-2379"><span class="linenos">2379</span></a><span class="sd">    Perform schema checking for scan setting dictionary.</span>
</span><span id="L-2380"><a href="#L-2380"><span class="linenos">2380</span></a>
</span><span id="L-2381"><a href="#L-2381"><span class="linenos">2381</span></a><span class="sd">    This function validates the scan settings dictionary based on the specified yml format and the scan limits of the microscope.</span>
</span><span id="L-2382"><a href="#L-2382"><span class="linenos">2382</span></a>
</span><span id="L-2383"><a href="#L-2383"><span class="linenos">2383</span></a><span class="sd">    Parameters</span>
</span><span id="L-2384"><a href="#L-2384"><span class="linenos">2384</span></a><span class="sd">    ----------</span>
</span><span id="L-2385"><a href="#L-2385"><span class="linenos">2385</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-2386"><a href="#L-2386"><span class="linenos">2386</span></a><span class="sd">        The microscope object for which to validate the scan settings.</span>
</span><span id="L-2387"><a href="#L-2387"><span class="linenos">2387</span></a><span class="sd">    beam_type : tbt.BeamType</span>
</span><span id="L-2388"><a href="#L-2388"><span class="linenos">2388</span></a><span class="sd">        The type of the beam (electron or ion).</span>
</span><span id="L-2389"><a href="#L-2389"><span class="linenos">2389</span></a><span class="sd">    settings : dict</span>
</span><span id="L-2390"><a href="#L-2390"><span class="linenos">2390</span></a><span class="sd">        The dictionary containing the scan settings.</span>
</span><span id="L-2391"><a href="#L-2391"><span class="linenos">2391</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-2392"><a href="#L-2392"><span class="linenos">2392</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-2393"><a href="#L-2393"><span class="linenos">2393</span></a><span class="sd">    step_name : str</span>
</span><span id="L-2394"><a href="#L-2394"><span class="linenos">2394</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-2395"><a href="#L-2395"><span class="linenos">2395</span></a>
</span><span id="L-2396"><a href="#L-2396"><span class="linenos">2396</span></a><span class="sd">    Returns</span>
</span><span id="L-2397"><a href="#L-2397"><span class="linenos">2397</span></a><span class="sd">    -------</span>
</span><span id="L-2398"><a href="#L-2398"><span class="linenos">2398</span></a><span class="sd">    bool</span>
</span><span id="L-2399"><a href="#L-2399"><span class="linenos">2399</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-2400"><a href="#L-2400"><span class="linenos">2400</span></a>
</span><span id="L-2401"><a href="#L-2401"><span class="linenos">2401</span></a><span class="sd">    Raises</span>
</span><span id="L-2402"><a href="#L-2402"><span class="linenos">2402</span></a><span class="sd">    ------</span>
</span><span id="L-2403"><a href="#L-2403"><span class="linenos">2403</span></a><span class="sd">    ValueError</span>
</span><span id="L-2404"><a href="#L-2404"><span class="linenos">2404</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="L-2405"><a href="#L-2405"><span class="linenos">2405</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2406"><a href="#L-2406"><span class="linenos">2406</span></a>    <span class="n">specified_beam</span> <span class="o">=</span> <span class="n">beam_object_type</span><span class="p">(</span><span class="n">beam_type</span><span class="p">)(</span><span class="n">settings</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">())</span>
</span><span id="L-2407"><a href="#L-2407"><span class="linenos">2407</span></a>    <span class="n">selected_beam</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">beam_type</span><span class="p">(</span><span class="n">specified_beam</span><span class="p">,</span> <span class="n">microscope</span><span class="p">)</span>
</span><span id="L-2408"><a href="#L-2408"><span class="linenos">2408</span></a>
</span><span id="L-2409"><a href="#L-2409"><span class="linenos">2409</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Schema checking for scan setting dictionary, format specified by yml_format&quot;&quot;&quot;</span>
</span><span id="L-2410"><a href="#L-2410"><span class="linenos">2410</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-2411"><a href="#L-2411"><span class="linenos">2411</span></a>        <span class="n">limits</span> <span class="o">=</span> <span class="n">scan_limits</span><span class="p">(</span><span class="n">selected_beam</span><span class="p">)</span>
</span><span id="L-2412"><a href="#L-2412"><span class="linenos">2412</span></a>        <span class="n">resolution</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
</span><span id="L-2413"><a href="#L-2413"><span class="linenos">2413</span></a>        <span class="n">rotation_limit</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">rotation_deg</span>
</span><span id="L-2414"><a href="#L-2414"><span class="linenos">2414</span></a>        <span class="n">dwell_limit</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">dwell_us</span>
</span><span id="L-2415"><a href="#L-2415"><span class="linenos">2415</span></a>
</span><span id="L-2416"><a href="#L-2416"><span class="linenos">2416</span></a>    <span class="c1"># check resolution</span>
</span><span id="L-2417"><a href="#L-2417"><span class="linenos">2417</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">string_to_res</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="L-2418"><a href="#L-2418"><span class="linenos">2418</span></a>
</span><span id="L-2419"><a href="#L-2419"><span class="linenos">2419</span></a>    <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-2420"><a href="#L-2420"><span class="linenos">2420</span></a>        <span class="p">{</span>
</span><span id="L-2421"><a href="#L-2421"><span class="linenos">2421</span></a>            <span class="s2">&quot;resolution&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2422"><a href="#L-2422"><span class="linenos">2422</span></a>                <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2423"><a href="#L-2423"><span class="linenos">2423</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">valid_string_resolution</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
</span><span id="L-2424"><a href="#L-2424"><span class="linenos">2424</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, resolution provided was </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, but must be an integer width and height in format &#39;[width]x[height]&#39;  with each dimension satisfying &#39;</span><span class="si">{</span><span class="n">Constants</span><span class="o">.</span><span class="n">scan_resolution_limit</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= [value] &lt;=  </span><span class="si">{</span><span class="n">Constants</span><span class="o">.</span><span class="n">scan_resolution_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-2425"><a href="#L-2425"><span class="linenos">2425</span></a>            <span class="p">),</span>
</span><span id="L-2426"><a href="#L-2426"><span class="linenos">2426</span></a>            <span class="s2">&quot;rotation_deg&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2427"><a href="#L-2427"><span class="linenos">2427</span></a>                <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2428"><a href="#L-2428"><span class="linenos">2428</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-2429"><a href="#L-2429"><span class="linenos">2429</span></a>                    <span class="n">x</span><span class="p">,</span>
</span><span id="L-2430"><a href="#L-2430"><span class="linenos">2430</span></a>                    <span class="n">limit</span><span class="o">=</span><span class="n">rotation_limit</span><span class="p">,</span>
</span><span id="L-2431"><a href="#L-2431"><span class="linenos">2431</span></a>                    <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-2432"><a href="#L-2432"><span class="linenos">2432</span></a>                <span class="p">),</span>
</span><span id="L-2433"><a href="#L-2433"><span class="linenos">2433</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested fixed rotation of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;rotation_deg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; degrees. This is not a float or not within limits of &#39;&gt;=</span><span class="si">{</span><span class="n">rotation_limit</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&#39; and &#39;&lt;=</span><span class="si">{</span><span class="n">rotation_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39; degrees. Setting is of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;rotation_deg&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="L-2434"><a href="#L-2434"><span class="linenos">2434</span></a>            <span class="p">),</span>
</span><span id="L-2435"><a href="#L-2435"><span class="linenos">2435</span></a>            <span class="s2">&quot;dwell_time_us&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2436"><a href="#L-2436"><span class="linenos">2436</span></a>                <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2437"><a href="#L-2437"><span class="linenos">2437</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-2438"><a href="#L-2438"><span class="linenos">2438</span></a>                    <span class="n">x</span><span class="p">,</span>
</span><span id="L-2439"><a href="#L-2439"><span class="linenos">2439</span></a>                    <span class="n">limit</span><span class="o">=</span><span class="n">dwell_limit</span><span class="p">,</span>
</span><span id="L-2440"><a href="#L-2440"><span class="linenos">2440</span></a>                    <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-2441"><a href="#L-2441"><span class="linenos">2441</span></a>                <span class="p">),</span>
</span><span id="L-2442"><a href="#L-2442"><span class="linenos">2442</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested fixed dwell_time of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dwell_time_us&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; microseconds. This is a float or not within limits of &#39;&gt;=</span><span class="si">{</span><span class="n">dwell_limit</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&#39; and &#39;&lt;=</span><span class="si">{</span><span class="n">dwell_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39; microseconds. Settting is of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dwell_time_us&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="L-2443"><a href="#L-2443"><span class="linenos">2443</span></a>            <span class="p">),</span>
</span><span id="L-2444"><a href="#L-2444"><span class="linenos">2444</span></a>        <span class="p">},</span>
</span><span id="L-2445"><a href="#L-2445"><span class="linenos">2445</span></a>        <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2446"><a href="#L-2446"><span class="linenos">2446</span></a>    <span class="p">)</span>
</span><span id="L-2447"><a href="#L-2447"><span class="linenos">2447</span></a>
</span><span id="L-2448"><a href="#L-2448"><span class="linenos">2448</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-2449"><a href="#L-2449"><span class="linenos">2449</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-2450"><a href="#L-2450"><span class="linenos">2450</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="L-2451"><a href="#L-2451"><span class="linenos">2451</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2452"><a href="#L-2452"><span class="linenos">2452</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="L-2453"><a href="#L-2453"><span class="linenos">2453</span></a>        <span class="p">)</span>
</span><span id="L-2454"><a href="#L-2454"><span class="linenos">2454</span></a>
</span><span id="L-2455"><a href="#L-2455"><span class="linenos">2455</span></a>
</span><span id="L-2456"><a href="#L-2456"><span class="linenos">2456</span></a><span class="k">def</span> <span class="nf">stage_position_settings</span><span class="p">(</span>
</span><span id="L-2457"><a href="#L-2457"><span class="linenos">2457</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-2458"><a href="#L-2458"><span class="linenos">2458</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2459"><a href="#L-2459"><span class="linenos">2459</span></a>    <span class="n">general_settings</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">GeneralSettings</span><span class="p">,</span>
</span><span id="L-2460"><a href="#L-2460"><span class="linenos">2460</span></a>    <span class="n">step_stage_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-2461"><a href="#L-2461"><span class="linenos">2461</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-2462"><a href="#L-2462"><span class="linenos">2462</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StageSettings</span><span class="p">:</span>
</span><span id="L-2463"><a href="#L-2463"><span class="linenos">2463</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2464"><a href="#L-2464"><span class="linenos">2464</span></a><span class="sd">    Create a StagePositionUser object from settings, including validation.</span>
</span><span id="L-2465"><a href="#L-2465"><span class="linenos">2465</span></a>
</span><span id="L-2466"><a href="#L-2466"><span class="linenos">2466</span></a><span class="sd">    This function creates a `StagePositionUser` object from the provided settings and performs validation.</span>
</span><span id="L-2467"><a href="#L-2467"><span class="linenos">2467</span></a>
</span><span id="L-2468"><a href="#L-2468"><span class="linenos">2468</span></a><span class="sd">    Parameters</span>
</span><span id="L-2469"><a href="#L-2469"><span class="linenos">2469</span></a><span class="sd">    ----------</span>
</span><span id="L-2470"><a href="#L-2470"><span class="linenos">2470</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-2471"><a href="#L-2471"><span class="linenos">2471</span></a><span class="sd">        The microscope object for which to set the stage position.</span>
</span><span id="L-2472"><a href="#L-2472"><span class="linenos">2472</span></a><span class="sd">    step_name : str</span>
</span><span id="L-2473"><a href="#L-2473"><span class="linenos">2473</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-2474"><a href="#L-2474"><span class="linenos">2474</span></a><span class="sd">    general_settings : tbt.GeneralSettings</span>
</span><span id="L-2475"><a href="#L-2475"><span class="linenos">2475</span></a><span class="sd">        The general settings object.</span>
</span><span id="L-2476"><a href="#L-2476"><span class="linenos">2476</span></a><span class="sd">    step_stage_settings : dict</span>
</span><span id="L-2477"><a href="#L-2477"><span class="linenos">2477</span></a><span class="sd">        The dictionary containing the stage position settings for the step.</span>
</span><span id="L-2478"><a href="#L-2478"><span class="linenos">2478</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-2479"><a href="#L-2479"><span class="linenos">2479</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-2480"><a href="#L-2480"><span class="linenos">2480</span></a>
</span><span id="L-2481"><a href="#L-2481"><span class="linenos">2481</span></a><span class="sd">    Returns</span>
</span><span id="L-2482"><a href="#L-2482"><span class="linenos">2482</span></a><span class="sd">    -------</span>
</span><span id="L-2483"><a href="#L-2483"><span class="linenos">2483</span></a><span class="sd">    tbt.StageSettings</span>
</span><span id="L-2484"><a href="#L-2484"><span class="linenos">2484</span></a><span class="sd">        The stage settings object.</span>
</span><span id="L-2485"><a href="#L-2485"><span class="linenos">2485</span></a>
</span><span id="L-2486"><a href="#L-2486"><span class="linenos">2486</span></a><span class="sd">    Raises</span>
</span><span id="L-2487"><a href="#L-2487"><span class="linenos">2487</span></a><span class="sd">    ------</span>
</span><span id="L-2488"><a href="#L-2488"><span class="linenos">2488</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-2489"><a href="#L-2489"><span class="linenos">2489</span></a><span class="sd">        If the rotation side value is unsupported.</span>
</span><span id="L-2490"><a href="#L-2490"><span class="linenos">2490</span></a><span class="sd">    ValueError</span>
</span><span id="L-2491"><a href="#L-2491"><span class="linenos">2491</span></a><span class="sd">        If the stage position settings do not satisfy the specified schema.</span>
</span><span id="L-2492"><a href="#L-2492"><span class="linenos">2492</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2493"><a href="#L-2493"><span class="linenos">2493</span></a>
</span><span id="L-2494"><a href="#L-2494"><span class="linenos">2494</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-2495"><a href="#L-2495"><span class="linenos">2495</span></a>        <span class="n">pos_db</span> <span class="o">=</span> <span class="n">step_stage_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;initial_position&quot;</span><span class="p">)</span>
</span><span id="L-2496"><a href="#L-2496"><span class="linenos">2496</span></a>
</span><span id="L-2497"><a href="#L-2497"><span class="linenos">2497</span></a>        <span class="n">rotation_side</span> <span class="o">=</span> <span class="n">step_stage_settings</span><span class="p">[</span><span class="s2">&quot;rotation_side&quot;</span><span class="p">]</span>
</span><span id="L-2498"><a href="#L-2498"><span class="linenos">2498</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">rotation_side</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">RotationSide</span><span class="p">):</span>
</span><span id="L-2499"><a href="#L-2499"><span class="linenos">2499</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="L-2500"><a href="#L-2500"><span class="linenos">2500</span></a>                <span class="sa">f</span><span class="s2">&quot;Unsupported rotation_side value of &#39;</span><span class="si">{</span><span class="n">rotation_side</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rotation_side</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; in step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, supported rotation_side values are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">RotationSide</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-2501"><a href="#L-2501"><span class="linenos">2501</span></a>            <span class="p">)</span>
</span><span id="L-2502"><a href="#L-2502"><span class="linenos">2502</span></a>
</span><span id="L-2503"><a href="#L-2503"><span class="linenos">2503</span></a>    <span class="n">validate_stage_position</span><span class="p">(</span>
</span><span id="L-2504"><a href="#L-2504"><span class="linenos">2504</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-2505"><a href="#L-2505"><span class="linenos">2505</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-2506"><a href="#L-2506"><span class="linenos">2506</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">pos_db</span><span class="p">,</span>
</span><span id="L-2507"><a href="#L-2507"><span class="linenos">2507</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-2508"><a href="#L-2508"><span class="linenos">2508</span></a>    <span class="p">)</span>
</span><span id="L-2509"><a href="#L-2509"><span class="linenos">2509</span></a>
</span><span id="L-2510"><a href="#L-2510"><span class="linenos">2510</span></a>    <span class="n">initial_position</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StagePositionUser</span><span class="p">(</span>
</span><span id="L-2511"><a href="#L-2511"><span class="linenos">2511</span></a>        <span class="n">x_mm</span><span class="o">=</span><span class="n">pos_db</span><span class="p">[</span><span class="s2">&quot;x_mm&quot;</span><span class="p">],</span>
</span><span id="L-2512"><a href="#L-2512"><span class="linenos">2512</span></a>        <span class="n">y_mm</span><span class="o">=</span><span class="n">pos_db</span><span class="p">[</span><span class="s2">&quot;y_mm&quot;</span><span class="p">],</span>
</span><span id="L-2513"><a href="#L-2513"><span class="linenos">2513</span></a>        <span class="n">z_mm</span><span class="o">=</span><span class="n">pos_db</span><span class="p">[</span><span class="s2">&quot;z_mm&quot;</span><span class="p">],</span>
</span><span id="L-2514"><a href="#L-2514"><span class="linenos">2514</span></a>        <span class="n">r_deg</span><span class="o">=</span><span class="n">pos_db</span><span class="p">[</span><span class="s2">&quot;r_deg&quot;</span><span class="p">],</span>
</span><span id="L-2515"><a href="#L-2515"><span class="linenos">2515</span></a>        <span class="n">t_deg</span><span class="o">=</span><span class="n">pos_db</span><span class="p">[</span><span class="s2">&quot;t_deg&quot;</span><span class="p">],</span>
</span><span id="L-2516"><a href="#L-2516"><span class="linenos">2516</span></a>    <span class="p">)</span>
</span><span id="L-2517"><a href="#L-2517"><span class="linenos">2517</span></a>
</span><span id="L-2518"><a href="#L-2518"><span class="linenos">2518</span></a>    <span class="n">pretilt_angle_deg</span> <span class="o">=</span> <span class="n">general_settings</span><span class="o">.</span><span class="n">pre_tilt_deg</span>
</span><span id="L-2519"><a href="#L-2519"><span class="linenos">2519</span></a>    <span class="n">sectioning_axis</span> <span class="o">=</span> <span class="n">general_settings</span><span class="o">.</span><span class="n">sectioning_axis</span>
</span><span id="L-2520"><a href="#L-2520"><span class="linenos">2520</span></a>
</span><span id="L-2521"><a href="#L-2521"><span class="linenos">2521</span></a>    <span class="n">stage_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StageSettings</span><span class="p">(</span>
</span><span id="L-2522"><a href="#L-2522"><span class="linenos">2522</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-2523"><a href="#L-2523"><span class="linenos">2523</span></a>        <span class="n">initial_position</span><span class="o">=</span><span class="n">initial_position</span><span class="p">,</span>
</span><span id="L-2524"><a href="#L-2524"><span class="linenos">2524</span></a>        <span class="n">pretilt_angle_deg</span><span class="o">=</span><span class="n">pretilt_angle_deg</span><span class="p">,</span>
</span><span id="L-2525"><a href="#L-2525"><span class="linenos">2525</span></a>        <span class="n">sectioning_axis</span><span class="o">=</span><span class="n">sectioning_axis</span><span class="p">,</span>
</span><span id="L-2526"><a href="#L-2526"><span class="linenos">2526</span></a>        <span class="n">rotation_side</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">RotationSide</span><span class="p">(</span><span class="n">rotation_side</span><span class="p">),</span>
</span><span id="L-2527"><a href="#L-2527"><span class="linenos">2527</span></a>        <span class="c1"># movement_mode=tbt.StageMovementMode.OUT_OF_PLANE,</span>
</span><span id="L-2528"><a href="#L-2528"><span class="linenos">2528</span></a>    <span class="p">)</span>
</span><span id="L-2529"><a href="#L-2529"><span class="linenos">2529</span></a>
</span><span id="L-2530"><a href="#L-2530"><span class="linenos">2530</span></a>    <span class="k">return</span> <span class="n">stage_settings</span>
</span><span id="L-2531"><a href="#L-2531"><span class="linenos">2531</span></a>
</span><span id="L-2532"><a href="#L-2532"><span class="linenos">2532</span></a>
</span><span id="L-2533"><a href="#L-2533"><span class="linenos">2533</span></a><span class="k">def</span> <span class="nf">validate_pulse_settings</span><span class="p">(</span>
</span><span id="L-2534"><a href="#L-2534"><span class="linenos">2534</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-2535"><a href="#L-2535"><span class="linenos">2535</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-2536"><a href="#L-2536"><span class="linenos">2536</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2537"><a href="#L-2537"><span class="linenos">2537</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-2538"><a href="#L-2538"><span class="linenos">2538</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2539"><a href="#L-2539"><span class="linenos">2539</span></a><span class="sd">    Perform schema checking for pulse setting dictionary.</span>
</span><span id="L-2540"><a href="#L-2540"><span class="linenos">2540</span></a>
</span><span id="L-2541"><a href="#L-2541"><span class="linenos">2541</span></a><span class="sd">    This function validates the pulse settings dictionary based on the specified yml format.</span>
</span><span id="L-2542"><a href="#L-2542"><span class="linenos">2542</span></a>
</span><span id="L-2543"><a href="#L-2543"><span class="linenos">2543</span></a><span class="sd">    Parameters</span>
</span><span id="L-2544"><a href="#L-2544"><span class="linenos">2544</span></a><span class="sd">    ----------</span>
</span><span id="L-2545"><a href="#L-2545"><span class="linenos">2545</span></a><span class="sd">    settings : dict</span>
</span><span id="L-2546"><a href="#L-2546"><span class="linenos">2546</span></a><span class="sd">        The dictionary containing the pulse settings.</span>
</span><span id="L-2547"><a href="#L-2547"><span class="linenos">2547</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-2548"><a href="#L-2548"><span class="linenos">2548</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-2549"><a href="#L-2549"><span class="linenos">2549</span></a><span class="sd">    step_name : str</span>
</span><span id="L-2550"><a href="#L-2550"><span class="linenos">2550</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-2551"><a href="#L-2551"><span class="linenos">2551</span></a>
</span><span id="L-2552"><a href="#L-2552"><span class="linenos">2552</span></a><span class="sd">    Returns</span>
</span><span id="L-2553"><a href="#L-2553"><span class="linenos">2553</span></a><span class="sd">    -------</span>
</span><span id="L-2554"><a href="#L-2554"><span class="linenos">2554</span></a><span class="sd">    bool</span>
</span><span id="L-2555"><a href="#L-2555"><span class="linenos">2555</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-2556"><a href="#L-2556"><span class="linenos">2556</span></a>
</span><span id="L-2557"><a href="#L-2557"><span class="linenos">2557</span></a><span class="sd">    Raises</span>
</span><span id="L-2558"><a href="#L-2558"><span class="linenos">2558</span></a><span class="sd">    ------</span>
</span><span id="L-2559"><a href="#L-2559"><span class="linenos">2559</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-2560"><a href="#L-2560"><span class="linenos">2560</span></a><span class="sd">        If the wavelength or polarization value is unsupported.</span>
</span><span id="L-2561"><a href="#L-2561"><span class="linenos">2561</span></a><span class="sd">    ValueError</span>
</span><span id="L-2562"><a href="#L-2562"><span class="linenos">2562</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="L-2563"><a href="#L-2563"><span class="linenos">2563</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2564"><a href="#L-2564"><span class="linenos">2564</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-2565"><a href="#L-2565"><span class="linenos">2565</span></a>        <span class="n">wavelength_nm</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;wavelength_nm&quot;</span><span class="p">)</span>
</span><span id="L-2566"><a href="#L-2566"><span class="linenos">2566</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">wavelength_nm</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserWavelength</span><span class="p">):</span>
</span><span id="L-2567"><a href="#L-2567"><span class="linenos">2567</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="L-2568"><a href="#L-2568"><span class="linenos">2568</span></a>                <span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, unsupported wavelength of &#39;</span><span class="si">{</span><span class="n">wavelength_nm</span><span class="si">}</span><span class="s2">&#39; nm (data type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">wavelength_nm</span><span class="p">)</span><span class="si">}</span><span class="s2">), supported wavelengths are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserWavelength</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-2569"><a href="#L-2569"><span class="linenos">2569</span></a>            <span class="p">)</span>
</span><span id="L-2570"><a href="#L-2570"><span class="linenos">2570</span></a>        <span class="n">polarization</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;polarization&quot;</span><span class="p">)</span>
</span><span id="L-2571"><a href="#L-2571"><span class="linenos">2571</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">polarization</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPolarization</span><span class="p">):</span>
</span><span id="L-2572"><a href="#L-2572"><span class="linenos">2572</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="L-2573"><a href="#L-2573"><span class="linenos">2573</span></a>                <span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, unsupported laser polarization of &#39;</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&#39;, supported values are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPolarization</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-2574"><a href="#L-2574"><span class="linenos">2574</span></a>            <span class="p">)</span>
</span><span id="L-2575"><a href="#L-2575"><span class="linenos">2575</span></a>
</span><span id="L-2576"><a href="#L-2576"><span class="linenos">2576</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-2577"><a href="#L-2577"><span class="linenos">2577</span></a>            <span class="p">{</span>
</span><span id="L-2578"><a href="#L-2578"><span class="linenos">2578</span></a>                <span class="s2">&quot;divider&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2579"><a href="#L-2579"><span class="linenos">2579</span></a>                    <span class="nb">int</span><span class="p">,</span>
</span><span id="L-2580"><a href="#L-2580"><span class="linenos">2580</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2581"><a href="#L-2581"><span class="linenos">2581</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;divider&#39; parameter must be a positive integer greater than 0 but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;divider&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2582"><a href="#L-2582"><span class="linenos">2582</span></a>                <span class="p">),</span>
</span><span id="L-2583"><a href="#L-2583"><span class="linenos">2583</span></a>                <span class="s2">&quot;energy_uj&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2584"><a href="#L-2584"><span class="linenos">2584</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2585"><a href="#L-2585"><span class="linenos">2585</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2586"><a href="#L-2586"><span class="linenos">2586</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;energy_uj&#39; parameter must be a positive float greater than 0 but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;energy_uj&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2587"><a href="#L-2587"><span class="linenos">2587</span></a>                <span class="p">),</span>
</span><span id="L-2588"><a href="#L-2588"><span class="linenos">2588</span></a>            <span class="p">},</span>
</span><span id="L-2589"><a href="#L-2589"><span class="linenos">2589</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2590"><a href="#L-2590"><span class="linenos">2590</span></a>        <span class="p">)</span>
</span><span id="L-2591"><a href="#L-2591"><span class="linenos">2591</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-2592"><a href="#L-2592"><span class="linenos">2592</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-2593"><a href="#L-2593"><span class="linenos">2593</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="L-2594"><a href="#L-2594"><span class="linenos">2594</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2595"><a href="#L-2595"><span class="linenos">2595</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="L-2596"><a href="#L-2596"><span class="linenos">2596</span></a>        <span class="p">)</span>
</span><span id="L-2597"><a href="#L-2597"><span class="linenos">2597</span></a>
</span><span id="L-2598"><a href="#L-2598"><span class="linenos">2598</span></a>
</span><span id="L-2599"><a href="#L-2599"><span class="linenos">2599</span></a><span class="k">def</span> <span class="nf">validate_laser_optics_settings</span><span class="p">(</span>
</span><span id="L-2600"><a href="#L-2600"><span class="linenos">2600</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-2601"><a href="#L-2601"><span class="linenos">2601</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-2602"><a href="#L-2602"><span class="linenos">2602</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2603"><a href="#L-2603"><span class="linenos">2603</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-2604"><a href="#L-2604"><span class="linenos">2604</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2605"><a href="#L-2605"><span class="linenos">2605</span></a><span class="sd">    Perform schema checking for laser optics setting dictionary.</span>
</span><span id="L-2606"><a href="#L-2606"><span class="linenos">2606</span></a>
</span><span id="L-2607"><a href="#L-2607"><span class="linenos">2607</span></a><span class="sd">    This function validates the laser optics settings dictionary based on the specified yml format.</span>
</span><span id="L-2608"><a href="#L-2608"><span class="linenos">2608</span></a>
</span><span id="L-2609"><a href="#L-2609"><span class="linenos">2609</span></a><span class="sd">    Parameters</span>
</span><span id="L-2610"><a href="#L-2610"><span class="linenos">2610</span></a><span class="sd">    ----------</span>
</span><span id="L-2611"><a href="#L-2611"><span class="linenos">2611</span></a><span class="sd">    settings : dict</span>
</span><span id="L-2612"><a href="#L-2612"><span class="linenos">2612</span></a><span class="sd">        The dictionary containing the laser optics settings.</span>
</span><span id="L-2613"><a href="#L-2613"><span class="linenos">2613</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-2614"><a href="#L-2614"><span class="linenos">2614</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-2615"><a href="#L-2615"><span class="linenos">2615</span></a><span class="sd">    step_name : str</span>
</span><span id="L-2616"><a href="#L-2616"><span class="linenos">2616</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-2617"><a href="#L-2617"><span class="linenos">2617</span></a>
</span><span id="L-2618"><a href="#L-2618"><span class="linenos">2618</span></a><span class="sd">    Returns</span>
</span><span id="L-2619"><a href="#L-2619"><span class="linenos">2619</span></a><span class="sd">    -------</span>
</span><span id="L-2620"><a href="#L-2620"><span class="linenos">2620</span></a><span class="sd">    bool</span>
</span><span id="L-2621"><a href="#L-2621"><span class="linenos">2621</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-2622"><a href="#L-2622"><span class="linenos">2622</span></a>
</span><span id="L-2623"><a href="#L-2623"><span class="linenos">2623</span></a><span class="sd">    Raises</span>
</span><span id="L-2624"><a href="#L-2624"><span class="linenos">2624</span></a><span class="sd">    ------</span>
</span><span id="L-2625"><a href="#L-2625"><span class="linenos">2625</span></a><span class="sd">    ValueError</span>
</span><span id="L-2626"><a href="#L-2626"><span class="linenos">2626</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="L-2627"><a href="#L-2627"><span class="linenos">2627</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2628"><a href="#L-2628"><span class="linenos">2628</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-2629"><a href="#L-2629"><span class="linenos">2629</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-2630"><a href="#L-2630"><span class="linenos">2630</span></a>            <span class="p">{</span>
</span><span id="L-2631"><a href="#L-2631"><span class="linenos">2631</span></a>                <span class="s2">&quot;objective_position_mm&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2632"><a href="#L-2632"><span class="linenos">2632</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2633"><a href="#L-2633"><span class="linenos">2633</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="L-2634"><a href="#L-2634"><span class="linenos">2634</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="L-2635"><a href="#L-2635"><span class="linenos">2635</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">laser_objective_limit_mm</span><span class="p">,</span>
</span><span id="L-2636"><a href="#L-2636"><span class="linenos">2636</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="L-2637"><a href="#L-2637"><span class="linenos">2637</span></a>                    <span class="p">),</span>
</span><span id="L-2638"><a href="#L-2638"><span class="linenos">2638</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;objective_position_mm&#39; parameter must be a float satisfying the following: </span><span class="si">{</span><span class="n">Constants</span><span class="o">.</span><span class="n">laser_objective_limit_mm</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> mm &lt;= value &lt;= </span><span class="si">{</span><span class="n">Constants</span><span class="o">.</span><span class="n">laser_objective_limit_mm</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2"> mm. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;objective_position_mm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;objective_position_mm&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2639"><a href="#L-2639"><span class="linenos">2639</span></a>                <span class="p">),</span>
</span><span id="L-2640"><a href="#L-2640"><span class="linenos">2640</span></a>                <span class="s2">&quot;beam_shift_um_x&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2641"><a href="#L-2641"><span class="linenos">2641</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2642"><a href="#L-2642"><span class="linenos">2642</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;x&#39; parameter for &#39;beam_shift_um&#39; sub-dictioanry must be a float but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;beam_shift_um_x&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;beam_shift_um_x&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2643"><a href="#L-2643"><span class="linenos">2643</span></a>                <span class="p">),</span>
</span><span id="L-2644"><a href="#L-2644"><span class="linenos">2644</span></a>                <span class="s2">&quot;beam_shift_um_y&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2645"><a href="#L-2645"><span class="linenos">2645</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2646"><a href="#L-2646"><span class="linenos">2646</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;y&#39; parameter for &#39;beam_shift_um&#39; sub-dictioanry must be a float but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;beam_shift_um_y&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;beam_shift_um_y&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2647"><a href="#L-2647"><span class="linenos">2647</span></a>                <span class="p">),</span>
</span><span id="L-2648"><a href="#L-2648"><span class="linenos">2648</span></a>            <span class="p">},</span>
</span><span id="L-2649"><a href="#L-2649"><span class="linenos">2649</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2650"><a href="#L-2650"><span class="linenos">2650</span></a>        <span class="p">)</span>
</span><span id="L-2651"><a href="#L-2651"><span class="linenos">2651</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-2652"><a href="#L-2652"><span class="linenos">2652</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-2653"><a href="#L-2653"><span class="linenos">2653</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="L-2654"><a href="#L-2654"><span class="linenos">2654</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2655"><a href="#L-2655"><span class="linenos">2655</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="L-2656"><a href="#L-2656"><span class="linenos">2656</span></a>        <span class="p">)</span>
</span><span id="L-2657"><a href="#L-2657"><span class="linenos">2657</span></a>
</span><span id="L-2658"><a href="#L-2658"><span class="linenos">2658</span></a>
</span><span id="L-2659"><a href="#L-2659"><span class="linenos">2659</span></a><span class="k">def</span> <span class="nf">validate_laser_box_settings</span><span class="p">(</span>
</span><span id="L-2660"><a href="#L-2660"><span class="linenos">2660</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-2661"><a href="#L-2661"><span class="linenos">2661</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-2662"><a href="#L-2662"><span class="linenos">2662</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2663"><a href="#L-2663"><span class="linenos">2663</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-2664"><a href="#L-2664"><span class="linenos">2664</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2665"><a href="#L-2665"><span class="linenos">2665</span></a><span class="sd">    Perform schema checking for laser box pattern setting dictionary.</span>
</span><span id="L-2666"><a href="#L-2666"><span class="linenos">2666</span></a>
</span><span id="L-2667"><a href="#L-2667"><span class="linenos">2667</span></a><span class="sd">    This function validates the laser box pattern settings dictionary based on the specified yml format.</span>
</span><span id="L-2668"><a href="#L-2668"><span class="linenos">2668</span></a>
</span><span id="L-2669"><a href="#L-2669"><span class="linenos">2669</span></a><span class="sd">    Parameters</span>
</span><span id="L-2670"><a href="#L-2670"><span class="linenos">2670</span></a><span class="sd">    ----------</span>
</span><span id="L-2671"><a href="#L-2671"><span class="linenos">2671</span></a><span class="sd">    settings : dict</span>
</span><span id="L-2672"><a href="#L-2672"><span class="linenos">2672</span></a><span class="sd">        The dictionary containing the laser box pattern settings.</span>
</span><span id="L-2673"><a href="#L-2673"><span class="linenos">2673</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-2674"><a href="#L-2674"><span class="linenos">2674</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-2675"><a href="#L-2675"><span class="linenos">2675</span></a><span class="sd">    step_name : str</span>
</span><span id="L-2676"><a href="#L-2676"><span class="linenos">2676</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-2677"><a href="#L-2677"><span class="linenos">2677</span></a>
</span><span id="L-2678"><a href="#L-2678"><span class="linenos">2678</span></a><span class="sd">    Returns</span>
</span><span id="L-2679"><a href="#L-2679"><span class="linenos">2679</span></a><span class="sd">    -------</span>
</span><span id="L-2680"><a href="#L-2680"><span class="linenos">2680</span></a><span class="sd">    bool</span>
</span><span id="L-2681"><a href="#L-2681"><span class="linenos">2681</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-2682"><a href="#L-2682"><span class="linenos">2682</span></a>
</span><span id="L-2683"><a href="#L-2683"><span class="linenos">2683</span></a><span class="sd">    Raises</span>
</span><span id="L-2684"><a href="#L-2684"><span class="linenos">2684</span></a><span class="sd">    ------</span>
</span><span id="L-2685"><a href="#L-2685"><span class="linenos">2685</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-2686"><a href="#L-2686"><span class="linenos">2686</span></a><span class="sd">        If the scan type or coordinate reference value is unsupported.</span>
</span><span id="L-2687"><a href="#L-2687"><span class="linenos">2687</span></a><span class="sd">    ValueError</span>
</span><span id="L-2688"><a href="#L-2688"><span class="linenos">2688</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="L-2689"><a href="#L-2689"><span class="linenos">2689</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2690"><a href="#L-2690"><span class="linenos">2690</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-2691"><a href="#L-2691"><span class="linenos">2691</span></a>        <span class="c1"># scan type</span>
</span><span id="L-2692"><a href="#L-2692"><span class="linenos">2692</span></a>        <span class="n">scan_type</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_type&quot;</span><span class="p">)</span>
</span><span id="L-2693"><a href="#L-2693"><span class="linenos">2693</span></a>        <span class="n">scan_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2694"><a href="#L-2694"><span class="linenos">2694</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="o">.</span><span class="n">RASTER</span><span class="p">,</span>
</span><span id="L-2695"><a href="#L-2695"><span class="linenos">2695</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="o">.</span><span class="n">SERPENTINE</span><span class="p">,</span>
</span><span id="L-2696"><a href="#L-2696"><span class="linenos">2696</span></a>        <span class="p">]</span>
</span><span id="L-2697"><a href="#L-2697"><span class="linenos">2697</span></a>        <span class="n">scan_type_error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, unsupported scan type of &#39;</span><span class="si">{</span><span class="n">scan_type</span><span class="si">}</span><span class="s2">&#39; for box pattern, supported scan types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">scan_types</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-2698"><a href="#L-2698"><span class="linenos">2698</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">scan_type</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">):</span>
</span><span id="L-2699"><a href="#L-2699"><span class="linenos">2699</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">scan_type_error_msg</span><span class="p">)</span>
</span><span id="L-2700"><a href="#L-2700"><span class="linenos">2700</span></a>        <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">(</span><span class="n">scan_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">scan_types</span><span class="p">:</span>
</span><span id="L-2701"><a href="#L-2701"><span class="linenos">2701</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">scan_type_error_msg</span><span class="p">)</span>
</span><span id="L-2702"><a href="#L-2702"><span class="linenos">2702</span></a>
</span><span id="L-2703"><a href="#L-2703"><span class="linenos">2703</span></a>        <span class="c1"># coordinate reference</span>
</span><span id="L-2704"><a href="#L-2704"><span class="linenos">2704</span></a>        <span class="n">coordinate_ref</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;coordinate_ref&quot;</span><span class="p">)</span>
</span><span id="L-2705"><a href="#L-2705"><span class="linenos">2705</span></a>        <span class="n">coord_refs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2706"><a href="#L-2706"><span class="linenos">2706</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="o">.</span><span class="n">CENTER</span><span class="p">,</span>
</span><span id="L-2707"><a href="#L-2707"><span class="linenos">2707</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="o">.</span><span class="n">UPPER_CENTER</span><span class="p">,</span>
</span><span id="L-2708"><a href="#L-2708"><span class="linenos">2708</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="o">.</span><span class="n">UPPER_LEFT</span><span class="p">,</span>
</span><span id="L-2709"><a href="#L-2709"><span class="linenos">2709</span></a>        <span class="p">]</span>
</span><span id="L-2710"><a href="#L-2710"><span class="linenos">2710</span></a>        <span class="n">coord_error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, unsupported coordinate reference of &#39;</span><span class="si">{</span><span class="n">coordinate_ref</span><span class="si">}</span><span class="s2">&#39; for box pattern, supported coordinate references are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">coord_refs</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-2711"><a href="#L-2711"><span class="linenos">2711</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">coordinate_ref</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="p">):</span>
</span><span id="L-2712"><a href="#L-2712"><span class="linenos">2712</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">coord_error_msg</span><span class="p">)</span>
</span><span id="L-2713"><a href="#L-2713"><span class="linenos">2713</span></a>        <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="p">(</span><span class="n">coordinate_ref</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coord_refs</span><span class="p">:</span>
</span><span id="L-2714"><a href="#L-2714"><span class="linenos">2714</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">coord_error_msg</span><span class="p">)</span>
</span><span id="L-2715"><a href="#L-2715"><span class="linenos">2715</span></a>
</span><span id="L-2716"><a href="#L-2716"><span class="linenos">2716</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-2717"><a href="#L-2717"><span class="linenos">2717</span></a>            <span class="p">{</span>
</span><span id="L-2718"><a href="#L-2718"><span class="linenos">2718</span></a>                <span class="s2">&quot;passes&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2719"><a href="#L-2719"><span class="linenos">2719</span></a>                    <span class="nb">int</span><span class="p">,</span>
</span><span id="L-2720"><a href="#L-2720"><span class="linenos">2720</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2721"><a href="#L-2721"><span class="linenos">2721</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;passes&#39; parameter in &#39;box&#39; type pattern must be a positive integer. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;passes&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;passes&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2722"><a href="#L-2722"><span class="linenos">2722</span></a>                <span class="p">),</span>
</span><span id="L-2723"><a href="#L-2723"><span class="linenos">2723</span></a>                <span class="s2">&quot;size_x_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2724"><a href="#L-2724"><span class="linenos">2724</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2725"><a href="#L-2725"><span class="linenos">2725</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2726"><a href="#L-2726"><span class="linenos">2726</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;size_x_um&#39; parameter in &#39;box&#39; type pattern must be a positive float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;size_x_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;size_x_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2727"><a href="#L-2727"><span class="linenos">2727</span></a>                <span class="p">),</span>
</span><span id="L-2728"><a href="#L-2728"><span class="linenos">2728</span></a>                <span class="s2">&quot;size_y_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2729"><a href="#L-2729"><span class="linenos">2729</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2730"><a href="#L-2730"><span class="linenos">2730</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2731"><a href="#L-2731"><span class="linenos">2731</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;size_y_um&#39; parameter in &#39;box&#39; type pattern must be a positive float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;size_y_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;size_y_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2732"><a href="#L-2732"><span class="linenos">2732</span></a>                <span class="p">),</span>
</span><span id="L-2733"><a href="#L-2733"><span class="linenos">2733</span></a>                <span class="s2">&quot;pitch_x_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2734"><a href="#L-2734"><span class="linenos">2734</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2735"><a href="#L-2735"><span class="linenos">2735</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2736"><a href="#L-2736"><span class="linenos">2736</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pitch_x_um&#39; parameter in &#39;box&#39; type pattern must be a positive float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pitch_x_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pitch_x_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2737"><a href="#L-2737"><span class="linenos">2737</span></a>                <span class="p">),</span>
</span><span id="L-2738"><a href="#L-2738"><span class="linenos">2738</span></a>                <span class="s2">&quot;pitch_y_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2739"><a href="#L-2739"><span class="linenos">2739</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2740"><a href="#L-2740"><span class="linenos">2740</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2741"><a href="#L-2741"><span class="linenos">2741</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pitch_y_um&#39; parameter in &#39;box&#39; type pattern must be a positive float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pitch_y_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pitch_y_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2742"><a href="#L-2742"><span class="linenos">2742</span></a>                <span class="p">),</span>
</span><span id="L-2743"><a href="#L-2743"><span class="linenos">2743</span></a>            <span class="p">},</span>
</span><span id="L-2744"><a href="#L-2744"><span class="linenos">2744</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2745"><a href="#L-2745"><span class="linenos">2745</span></a>        <span class="p">)</span>
</span><span id="L-2746"><a href="#L-2746"><span class="linenos">2746</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-2747"><a href="#L-2747"><span class="linenos">2747</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-2748"><a href="#L-2748"><span class="linenos">2748</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="L-2749"><a href="#L-2749"><span class="linenos">2749</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2750"><a href="#L-2750"><span class="linenos">2750</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="L-2751"><a href="#L-2751"><span class="linenos">2751</span></a>        <span class="p">)</span>
</span><span id="L-2752"><a href="#L-2752"><span class="linenos">2752</span></a>
</span><span id="L-2753"><a href="#L-2753"><span class="linenos">2753</span></a>
</span><span id="L-2754"><a href="#L-2754"><span class="linenos">2754</span></a><span class="k">def</span> <span class="nf">validate_laser_line_settings</span><span class="p">(</span>
</span><span id="L-2755"><a href="#L-2755"><span class="linenos">2755</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-2756"><a href="#L-2756"><span class="linenos">2756</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-2757"><a href="#L-2757"><span class="linenos">2757</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2758"><a href="#L-2758"><span class="linenos">2758</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-2759"><a href="#L-2759"><span class="linenos">2759</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2760"><a href="#L-2760"><span class="linenos">2760</span></a><span class="sd">    Perform schema checking for laser line pattern setting dictionary.</span>
</span><span id="L-2761"><a href="#L-2761"><span class="linenos">2761</span></a>
</span><span id="L-2762"><a href="#L-2762"><span class="linenos">2762</span></a><span class="sd">    This function validates the laser line pattern settings dictionary based on the specified yml format.</span>
</span><span id="L-2763"><a href="#L-2763"><span class="linenos">2763</span></a>
</span><span id="L-2764"><a href="#L-2764"><span class="linenos">2764</span></a><span class="sd">    Parameters</span>
</span><span id="L-2765"><a href="#L-2765"><span class="linenos">2765</span></a><span class="sd">    ----------</span>
</span><span id="L-2766"><a href="#L-2766"><span class="linenos">2766</span></a><span class="sd">    settings : dict</span>
</span><span id="L-2767"><a href="#L-2767"><span class="linenos">2767</span></a><span class="sd">        The dictionary containing the laser line pattern settings.</span>
</span><span id="L-2768"><a href="#L-2768"><span class="linenos">2768</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-2769"><a href="#L-2769"><span class="linenos">2769</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-2770"><a href="#L-2770"><span class="linenos">2770</span></a><span class="sd">    step_name : str</span>
</span><span id="L-2771"><a href="#L-2771"><span class="linenos">2771</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-2772"><a href="#L-2772"><span class="linenos">2772</span></a>
</span><span id="L-2773"><a href="#L-2773"><span class="linenos">2773</span></a><span class="sd">    Returns</span>
</span><span id="L-2774"><a href="#L-2774"><span class="linenos">2774</span></a><span class="sd">    -------</span>
</span><span id="L-2775"><a href="#L-2775"><span class="linenos">2775</span></a><span class="sd">    bool</span>
</span><span id="L-2776"><a href="#L-2776"><span class="linenos">2776</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-2777"><a href="#L-2777"><span class="linenos">2777</span></a>
</span><span id="L-2778"><a href="#L-2778"><span class="linenos">2778</span></a><span class="sd">    Raises</span>
</span><span id="L-2779"><a href="#L-2779"><span class="linenos">2779</span></a><span class="sd">    ------</span>
</span><span id="L-2780"><a href="#L-2780"><span class="linenos">2780</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-2781"><a href="#L-2781"><span class="linenos">2781</span></a><span class="sd">        If the scan type value is unsupported.</span>
</span><span id="L-2782"><a href="#L-2782"><span class="linenos">2782</span></a><span class="sd">    ValueError</span>
</span><span id="L-2783"><a href="#L-2783"><span class="linenos">2783</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="L-2784"><a href="#L-2784"><span class="linenos">2784</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2785"><a href="#L-2785"><span class="linenos">2785</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-2786"><a href="#L-2786"><span class="linenos">2786</span></a>        <span class="c1"># scan type</span>
</span><span id="L-2787"><a href="#L-2787"><span class="linenos">2787</span></a>        <span class="n">scan_type</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_type&quot;</span><span class="p">)</span>
</span><span id="L-2788"><a href="#L-2788"><span class="linenos">2788</span></a>        <span class="n">scan_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2789"><a href="#L-2789"><span class="linenos">2789</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="o">.</span><span class="n">SINGLE</span><span class="p">,</span>
</span><span id="L-2790"><a href="#L-2790"><span class="linenos">2790</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="o">.</span><span class="n">LAP</span><span class="p">,</span>
</span><span id="L-2791"><a href="#L-2791"><span class="linenos">2791</span></a>        <span class="p">]</span>
</span><span id="L-2792"><a href="#L-2792"><span class="linenos">2792</span></a>        <span class="n">scan_type_error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, unsupported scan type of &#39;</span><span class="si">{</span><span class="n">scan_type</span><span class="si">}</span><span class="s2">&#39; for line pattern, supported scan types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">scan_types</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-2793"><a href="#L-2793"><span class="linenos">2793</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">scan_type</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">):</span>
</span><span id="L-2794"><a href="#L-2794"><span class="linenos">2794</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">scan_type_error_msg</span><span class="p">)</span>
</span><span id="L-2795"><a href="#L-2795"><span class="linenos">2795</span></a>        <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">(</span><span class="n">scan_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">scan_types</span><span class="p">:</span>
</span><span id="L-2796"><a href="#L-2796"><span class="linenos">2796</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">scan_type_error_msg</span><span class="p">)</span>
</span><span id="L-2797"><a href="#L-2797"><span class="linenos">2797</span></a>
</span><span id="L-2798"><a href="#L-2798"><span class="linenos">2798</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-2799"><a href="#L-2799"><span class="linenos">2799</span></a>            <span class="p">{</span>
</span><span id="L-2800"><a href="#L-2800"><span class="linenos">2800</span></a>                <span class="s2">&quot;passes&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2801"><a href="#L-2801"><span class="linenos">2801</span></a>                    <span class="nb">int</span><span class="p">,</span>
</span><span id="L-2802"><a href="#L-2802"><span class="linenos">2802</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2803"><a href="#L-2803"><span class="linenos">2803</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;passes&#39; parameter in &#39;line&#39; type pattern must be a positive integer. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;passes&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;passes&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2804"><a href="#L-2804"><span class="linenos">2804</span></a>                <span class="p">),</span>
</span><span id="L-2805"><a href="#L-2805"><span class="linenos">2805</span></a>                <span class="s2">&quot;size_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2806"><a href="#L-2806"><span class="linenos">2806</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2807"><a href="#L-2807"><span class="linenos">2807</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2808"><a href="#L-2808"><span class="linenos">2808</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;size_um&#39; parameter in &#39;line&#39; type pattern must be a positive float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;size_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;size_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2809"><a href="#L-2809"><span class="linenos">2809</span></a>                <span class="p">),</span>
</span><span id="L-2810"><a href="#L-2810"><span class="linenos">2810</span></a>                <span class="s2">&quot;pitch_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2811"><a href="#L-2811"><span class="linenos">2811</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2812"><a href="#L-2812"><span class="linenos">2812</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2813"><a href="#L-2813"><span class="linenos">2813</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pitch_um&#39; parameter in &#39;line&#39; type pattern must be a positive float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pitch_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pitch_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2814"><a href="#L-2814"><span class="linenos">2814</span></a>                <span class="p">),</span>
</span><span id="L-2815"><a href="#L-2815"><span class="linenos">2815</span></a>            <span class="p">},</span>
</span><span id="L-2816"><a href="#L-2816"><span class="linenos">2816</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2817"><a href="#L-2817"><span class="linenos">2817</span></a>        <span class="p">)</span>
</span><span id="L-2818"><a href="#L-2818"><span class="linenos">2818</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-2819"><a href="#L-2819"><span class="linenos">2819</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-2820"><a href="#L-2820"><span class="linenos">2820</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="L-2821"><a href="#L-2821"><span class="linenos">2821</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2822"><a href="#L-2822"><span class="linenos">2822</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="L-2823"><a href="#L-2823"><span class="linenos">2823</span></a>        <span class="p">)</span>
</span><span id="L-2824"><a href="#L-2824"><span class="linenos">2824</span></a>
</span><span id="L-2825"><a href="#L-2825"><span class="linenos">2825</span></a>
</span><span id="L-2826"><a href="#L-2826"><span class="linenos">2826</span></a><span class="k">def</span> <span class="nf">validate_laser_mode_settings</span><span class="p">(</span>
</span><span id="L-2827"><a href="#L-2827"><span class="linenos">2827</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-2828"><a href="#L-2828"><span class="linenos">2828</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-2829"><a href="#L-2829"><span class="linenos">2829</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2830"><a href="#L-2830"><span class="linenos">2830</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-2831"><a href="#L-2831"><span class="linenos">2831</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2832"><a href="#L-2832"><span class="linenos">2832</span></a><span class="sd">    Perform schema checking for laser mode setting dictionary.</span>
</span><span id="L-2833"><a href="#L-2833"><span class="linenos">2833</span></a>
</span><span id="L-2834"><a href="#L-2834"><span class="linenos">2834</span></a><span class="sd">    This function validates the laser mode settings dictionary based on the specified yml format.</span>
</span><span id="L-2835"><a href="#L-2835"><span class="linenos">2835</span></a>
</span><span id="L-2836"><a href="#L-2836"><span class="linenos">2836</span></a><span class="sd">    Parameters</span>
</span><span id="L-2837"><a href="#L-2837"><span class="linenos">2837</span></a><span class="sd">    ----------</span>
</span><span id="L-2838"><a href="#L-2838"><span class="linenos">2838</span></a><span class="sd">    settings : dict</span>
</span><span id="L-2839"><a href="#L-2839"><span class="linenos">2839</span></a><span class="sd">        The dictionary containing the laser mode settings.</span>
</span><span id="L-2840"><a href="#L-2840"><span class="linenos">2840</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-2841"><a href="#L-2841"><span class="linenos">2841</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-2842"><a href="#L-2842"><span class="linenos">2842</span></a><span class="sd">    step_name : str</span>
</span><span id="L-2843"><a href="#L-2843"><span class="linenos">2843</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-2844"><a href="#L-2844"><span class="linenos">2844</span></a>
</span><span id="L-2845"><a href="#L-2845"><span class="linenos">2845</span></a><span class="sd">    Returns</span>
</span><span id="L-2846"><a href="#L-2846"><span class="linenos">2846</span></a><span class="sd">    -------</span>
</span><span id="L-2847"><a href="#L-2847"><span class="linenos">2847</span></a><span class="sd">    bool</span>
</span><span id="L-2848"><a href="#L-2848"><span class="linenos">2848</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-2849"><a href="#L-2849"><span class="linenos">2849</span></a>
</span><span id="L-2850"><a href="#L-2850"><span class="linenos">2850</span></a><span class="sd">    Raises</span>
</span><span id="L-2851"><a href="#L-2851"><span class="linenos">2851</span></a><span class="sd">    ------</span>
</span><span id="L-2852"><a href="#L-2852"><span class="linenos">2852</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-2853"><a href="#L-2853"><span class="linenos">2853</span></a><span class="sd">        If the laser pattern mode value is unsupported.</span>
</span><span id="L-2854"><a href="#L-2854"><span class="linenos">2854</span></a><span class="sd">    ValueError</span>
</span><span id="L-2855"><a href="#L-2855"><span class="linenos">2855</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="L-2856"><a href="#L-2856"><span class="linenos">2856</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2857"><a href="#L-2857"><span class="linenos">2857</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-2858"><a href="#L-2858"><span class="linenos">2858</span></a>        <span class="n">mode</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>
</span><span id="L-2859"><a href="#L-2859"><span class="linenos">2859</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternMode</span><span class="p">):</span>
</span><span id="L-2860"><a href="#L-2860"><span class="linenos">2860</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="L-2861"><a href="#L-2861"><span class="linenos">2861</span></a>                <span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, unsupported laser pattern mode of &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;, supported values are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternMode</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-2862"><a href="#L-2862"><span class="linenos">2862</span></a>            <span class="p">)</span>
</span><span id="L-2863"><a href="#L-2863"><span class="linenos">2863</span></a>
</span><span id="L-2864"><a href="#L-2864"><span class="linenos">2864</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-2865"><a href="#L-2865"><span class="linenos">2865</span></a>            <span class="p">{</span>
</span><span id="L-2866"><a href="#L-2866"><span class="linenos">2866</span></a>                <span class="s2">&quot;rotation_deg&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2867"><a href="#L-2867"><span class="linenos">2867</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2868"><a href="#L-2868"><span class="linenos">2868</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;rotation_deg&#39; parameter must be a float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;rotation_deg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; degrees (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;rotation_deg&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2869"><a href="#L-2869"><span class="linenos">2869</span></a>                <span class="p">),</span>
</span><span id="L-2870"><a href="#L-2870"><span class="linenos">2870</span></a>            <span class="p">},</span>
</span><span id="L-2871"><a href="#L-2871"><span class="linenos">2871</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2872"><a href="#L-2872"><span class="linenos">2872</span></a>        <span class="p">)</span>
</span><span id="L-2873"><a href="#L-2873"><span class="linenos">2873</span></a>        <span class="n">schema_fine</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-2874"><a href="#L-2874"><span class="linenos">2874</span></a>            <span class="p">{</span>
</span><span id="L-2875"><a href="#L-2875"><span class="linenos">2875</span></a>                <span class="s2">&quot;pixel_dwell_ms&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="L-2876"><a href="#L-2876"><span class="linenos">2876</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2877"><a href="#L-2877"><span class="linenos">2877</span></a>                    <span class="s2">&quot;null&quot;</span><span class="p">,</span>
</span><span id="L-2878"><a href="#L-2878"><span class="linenos">2878</span></a>                    <span class="s2">&quot;None&quot;</span><span class="p">,</span>
</span><span id="L-2879"><a href="#L-2879"><span class="linenos">2879</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pixel_dwell_ms&#39; parameter does not apply to the selected &#39;fine&#39; milling mode. Set &#39;pixel_dwell_ms&#39; to &#39;null&#39; &#39;None&#39; or leave the entry blank to continue.&quot;</span><span class="p">,</span>
</span><span id="L-2880"><a href="#L-2880"><span class="linenos">2880</span></a>                <span class="p">),</span>
</span><span id="L-2881"><a href="#L-2881"><span class="linenos">2881</span></a>                <span class="s2">&quot;pulses_per_pixel&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2882"><a href="#L-2882"><span class="linenos">2882</span></a>                    <span class="nb">int</span><span class="p">,</span>
</span><span id="L-2883"><a href="#L-2883"><span class="linenos">2883</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2884"><a href="#L-2884"><span class="linenos">2884</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pulses_per_pixel&#39; parameter is required for pattern type of &#39;fine&#39;. &#39;pulses_per_pixel&#39; must be a positive integer greater than 0. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pulses_per_pixel&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pulses_per_pixel&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2885"><a href="#L-2885"><span class="linenos">2885</span></a>                <span class="p">),</span>
</span><span id="L-2886"><a href="#L-2886"><span class="linenos">2886</span></a>            <span class="p">},</span>
</span><span id="L-2887"><a href="#L-2887"><span class="linenos">2887</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2888"><a href="#L-2888"><span class="linenos">2888</span></a>        <span class="p">)</span>
</span><span id="L-2889"><a href="#L-2889"><span class="linenos">2889</span></a>        <span class="n">schema_coarse</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-2890"><a href="#L-2890"><span class="linenos">2890</span></a>            <span class="p">{</span>
</span><span id="L-2891"><a href="#L-2891"><span class="linenos">2891</span></a>                <span class="s2">&quot;pixel_dwell_ms&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-2892"><a href="#L-2892"><span class="linenos">2892</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2893"><a href="#L-2893"><span class="linenos">2893</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-2894"><a href="#L-2894"><span class="linenos">2894</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pixel_dwell_ms&#39; parameter is required for pattern type of &#39;coarse&#39;. &#39;pixel_dwell_ms&#39; must be a positive float greater than 0. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pixel_dwell_ms&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pixel_dwell_ms&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="L-2895"><a href="#L-2895"><span class="linenos">2895</span></a>                <span class="p">),</span>
</span><span id="L-2896"><a href="#L-2896"><span class="linenos">2896</span></a>                <span class="s2">&quot;pulses_per_pixel&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="L-2897"><a href="#L-2897"><span class="linenos">2897</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2898"><a href="#L-2898"><span class="linenos">2898</span></a>                    <span class="s2">&quot;null&quot;</span><span class="p">,</span>
</span><span id="L-2899"><a href="#L-2899"><span class="linenos">2899</span></a>                    <span class="s2">&quot;None&quot;</span><span class="p">,</span>
</span><span id="L-2900"><a href="#L-2900"><span class="linenos">2900</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pulses_per_pixel&#39; parameter does not apply to the selected &#39;coarse&#39; milling mode. Set &#39;pulses_per_pixel&#39; to &#39;null&#39; &#39;None&#39; or leave the entry blank to continue.&quot;</span><span class="p">,</span>
</span><span id="L-2901"><a href="#L-2901"><span class="linenos">2901</span></a>                <span class="p">),</span>
</span><span id="L-2902"><a href="#L-2902"><span class="linenos">2902</span></a>            <span class="p">},</span>
</span><span id="L-2903"><a href="#L-2903"><span class="linenos">2903</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2904"><a href="#L-2904"><span class="linenos">2904</span></a>        <span class="p">)</span>
</span><span id="L-2905"><a href="#L-2905"><span class="linenos">2905</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-2906"><a href="#L-2906"><span class="linenos">2906</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-2907"><a href="#L-2907"><span class="linenos">2907</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;fine&quot;</span><span class="p">:</span>
</span><span id="L-2908"><a href="#L-2908"><span class="linenos">2908</span></a>            <span class="n">schema_fine</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-2909"><a href="#L-2909"><span class="linenos">2909</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;coarse&quot;</span><span class="p">:</span>
</span><span id="L-2910"><a href="#L-2910"><span class="linenos">2910</span></a>            <span class="n">schema_coarse</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-2911"><a href="#L-2911"><span class="linenos">2911</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="L-2912"><a href="#L-2912"><span class="linenos">2912</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2913"><a href="#L-2913"><span class="linenos">2913</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="L-2914"><a href="#L-2914"><span class="linenos">2914</span></a>        <span class="p">)</span>
</span><span id="L-2915"><a href="#L-2915"><span class="linenos">2915</span></a>
</span><span id="L-2916"><a href="#L-2916"><span class="linenos">2916</span></a>
</span><span id="L-2917"><a href="#L-2917"><span class="linenos">2917</span></a><span class="k">def</span> <span class="nf">validate_laser_pattern_settings</span><span class="p">(</span>
</span><span id="L-2918"><a href="#L-2918"><span class="linenos">2918</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-2919"><a href="#L-2919"><span class="linenos">2919</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-2920"><a href="#L-2920"><span class="linenos">2920</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2921"><a href="#L-2921"><span class="linenos">2921</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="p">:</span>
</span><span id="L-2922"><a href="#L-2922"><span class="linenos">2922</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2923"><a href="#L-2923"><span class="linenos">2923</span></a><span class="sd">    Perform schema checking for laser pattern setting dictionary.</span>
</span><span id="L-2924"><a href="#L-2924"><span class="linenos">2924</span></a>
</span><span id="L-2925"><a href="#L-2925"><span class="linenos">2925</span></a><span class="sd">    This function validates the laser pattern settings dictionary based on the specified yml format and determines the type of pattern (box or line).</span>
</span><span id="L-2926"><a href="#L-2926"><span class="linenos">2926</span></a>
</span><span id="L-2927"><a href="#L-2927"><span class="linenos">2927</span></a><span class="sd">    Parameters</span>
</span><span id="L-2928"><a href="#L-2928"><span class="linenos">2928</span></a><span class="sd">    ----------</span>
</span><span id="L-2929"><a href="#L-2929"><span class="linenos">2929</span></a><span class="sd">    settings : dict</span>
</span><span id="L-2930"><a href="#L-2930"><span class="linenos">2930</span></a><span class="sd">        The dictionary containing the laser pattern settings.</span>
</span><span id="L-2931"><a href="#L-2931"><span class="linenos">2931</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-2932"><a href="#L-2932"><span class="linenos">2932</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-2933"><a href="#L-2933"><span class="linenos">2933</span></a><span class="sd">    step_name : str</span>
</span><span id="L-2934"><a href="#L-2934"><span class="linenos">2934</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-2935"><a href="#L-2935"><span class="linenos">2935</span></a>
</span><span id="L-2936"><a href="#L-2936"><span class="linenos">2936</span></a><span class="sd">    Returns</span>
</span><span id="L-2937"><a href="#L-2937"><span class="linenos">2937</span></a><span class="sd">    -------</span>
</span><span id="L-2938"><a href="#L-2938"><span class="linenos">2938</span></a><span class="sd">    tbt.LaserPatternType</span>
</span><span id="L-2939"><a href="#L-2939"><span class="linenos">2939</span></a><span class="sd">        The type of the laser pattern (box or line).</span>
</span><span id="L-2940"><a href="#L-2940"><span class="linenos">2940</span></a>
</span><span id="L-2941"><a href="#L-2941"><span class="linenos">2941</span></a><span class="sd">    Raises</span>
</span><span id="L-2942"><a href="#L-2942"><span class="linenos">2942</span></a><span class="sd">    ------</span>
</span><span id="L-2943"><a href="#L-2943"><span class="linenos">2943</span></a><span class="sd">    KeyError</span>
</span><span id="L-2944"><a href="#L-2944"><span class="linenos">2944</span></a><span class="sd">        If required settings are missing from the .yml file or if multiple pattern types are specified.</span>
</span><span id="L-2945"><a href="#L-2945"><span class="linenos">2945</span></a><span class="sd">    ValueError</span>
</span><span id="L-2946"><a href="#L-2946"><span class="linenos">2946</span></a><span class="sd">        If the laser pattern settings are invalid.</span>
</span><span id="L-2947"><a href="#L-2947"><span class="linenos">2947</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2948"><a href="#L-2948"><span class="linenos">2948</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-2949"><a href="#L-2949"><span class="linenos">2949</span></a>        <span class="c1"># determine type of pattern (only one allowed)</span>
</span><span id="L-2950"><a href="#L-2950"><span class="linenos">2950</span></a>        <span class="n">type_set_db</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="L-2951"><a href="#L-2951"><span class="linenos">2951</span></a>        <span class="k">if</span> <span class="n">type_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2952"><a href="#L-2952"><span class="linenos">2952</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-2953"><a href="#L-2953"><span class="linenos">2953</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;type&#39; settings sub-dictionary found in &#39;pattern&#39; settings in &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-2954"><a href="#L-2954"><span class="linenos">2954</span></a>            <span class="p">)</span>
</span><span id="L-2955"><a href="#L-2955"><span class="linenos">2955</span></a>
</span><span id="L-2956"><a href="#L-2956"><span class="linenos">2956</span></a>        <span class="n">box_settings</span> <span class="o">=</span> <span class="n">type_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
</span><span id="L-2957"><a href="#L-2957"><span class="linenos">2957</span></a>        <span class="n">line_settings</span> <span class="o">=</span> <span class="n">type_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">)</span>
</span><span id="L-2958"><a href="#L-2958"><span class="linenos">2958</span></a>        <span class="k">if</span> <span class="n">box_settings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2959"><a href="#L-2959"><span class="linenos">2959</span></a>            <span class="n">box_pattern</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2960"><a href="#L-2960"><span class="linenos">2960</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2961"><a href="#L-2961"><span class="linenos">2961</span></a>            <span class="n">box_pattern</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">none_value_dictionary</span><span class="p">(</span><span class="n">box_settings</span><span class="p">)</span>
</span><span id="L-2962"><a href="#L-2962"><span class="linenos">2962</span></a>        <span class="k">if</span> <span class="n">line_settings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2963"><a href="#L-2963"><span class="linenos">2963</span></a>            <span class="n">line_pattern</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2964"><a href="#L-2964"><span class="linenos">2964</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2965"><a href="#L-2965"><span class="linenos">2965</span></a>            <span class="n">line_pattern</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">none_value_dictionary</span><span class="p">(</span><span class="n">line_settings</span><span class="p">)</span>
</span><span id="L-2966"><a href="#L-2966"><span class="linenos">2966</span></a>        <span class="k">if</span> <span class="n">box_pattern</span> <span class="o">==</span> <span class="n">line_pattern</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-2967"><a href="#L-2967"><span class="linenos">2967</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-2968"><a href="#L-2968"><span class="linenos">2968</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file in &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. No pattern type settings found.&quot;</span>
</span><span id="L-2969"><a href="#L-2969"><span class="linenos">2969</span></a>            <span class="p">)</span>
</span><span id="L-2970"><a href="#L-2970"><span class="linenos">2970</span></a>        <span class="k">if</span> <span class="n">box_pattern</span> <span class="o">==</span> <span class="n">line_pattern</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-2971"><a href="#L-2971"><span class="linenos">2971</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-2972"><a href="#L-2972"><span class="linenos">2972</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file in &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. Pattern settings for one and only one type are allowed. Type settings found for both &#39;box&#39; and &#39;line&#39; type. Please leave one set of type settings completely blank, enter &#39;null&#39; for each parameter, or remove the unused subdictionary completely from the .yml file.&quot;</span>
</span><span id="L-2973"><a href="#L-2973"><span class="linenos">2973</span></a>            <span class="p">)</span>
</span><span id="L-2974"><a href="#L-2974"><span class="linenos">2974</span></a>        <span class="n">validate_laser_mode_settings</span><span class="p">(</span>
</span><span id="L-2975"><a href="#L-2975"><span class="linenos">2975</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
</span><span id="L-2976"><a href="#L-2976"><span class="linenos">2976</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-2977"><a href="#L-2977"><span class="linenos">2977</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-2978"><a href="#L-2978"><span class="linenos">2978</span></a>        <span class="p">)</span>
</span><span id="L-2979"><a href="#L-2979"><span class="linenos">2979</span></a>
</span><span id="L-2980"><a href="#L-2980"><span class="linenos">2980</span></a>        <span class="k">if</span> <span class="n">box_pattern</span><span class="p">:</span>
</span><span id="L-2981"><a href="#L-2981"><span class="linenos">2981</span></a>            <span class="n">validate_laser_box_settings</span><span class="p">(</span>
</span><span id="L-2982"><a href="#L-2982"><span class="linenos">2982</span></a>                <span class="n">settings</span><span class="o">=</span><span class="n">box_settings</span><span class="p">,</span>
</span><span id="L-2983"><a href="#L-2983"><span class="linenos">2983</span></a>                <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-2984"><a href="#L-2984"><span class="linenos">2984</span></a>                <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-2985"><a href="#L-2985"><span class="linenos">2985</span></a>            <span class="p">)</span>
</span><span id="L-2986"><a href="#L-2986"><span class="linenos">2986</span></a>            <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="o">.</span><span class="n">BOX</span>
</span><span id="L-2987"><a href="#L-2987"><span class="linenos">2987</span></a>        <span class="k">elif</span> <span class="n">line_pattern</span><span class="p">:</span>
</span><span id="L-2988"><a href="#L-2988"><span class="linenos">2988</span></a>            <span class="n">validate_laser_line_settings</span><span class="p">(</span>
</span><span id="L-2989"><a href="#L-2989"><span class="linenos">2989</span></a>                <span class="n">settings</span><span class="o">=</span><span class="n">line_settings</span><span class="p">,</span>
</span><span id="L-2990"><a href="#L-2990"><span class="linenos">2990</span></a>                <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-2991"><a href="#L-2991"><span class="linenos">2991</span></a>                <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-2992"><a href="#L-2992"><span class="linenos">2992</span></a>            <span class="p">)</span>
</span><span id="L-2993"><a href="#L-2993"><span class="linenos">2993</span></a>            <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="o">.</span><span class="n">LINE</span>
</span><span id="L-2994"><a href="#L-2994"><span class="linenos">2994</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2995"><a href="#L-2995"><span class="linenos">2995</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2996"><a href="#L-2996"><span class="linenos">2996</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid laser pattern settings for step </span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">. Supported types are </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2997"><a href="#L-2997"><span class="linenos">2997</span></a>            <span class="p">)</span>
</span><span id="L-2998"><a href="#L-2998"><span class="linenos">2998</span></a>
</span><span id="L-2999"><a href="#L-2999"><span class="linenos">2999</span></a>
</span><span id="L-3000"><a href="#L-3000"><span class="linenos">3000</span></a><span class="k">def</span> <span class="nf">validate_fib_pattern_settings</span><span class="p">(</span>
</span><span id="L-3001"><a href="#L-3001"><span class="linenos">3001</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-3002"><a href="#L-3002"><span class="linenos">3002</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-3003"><a href="#L-3003"><span class="linenos">3003</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-3004"><a href="#L-3004"><span class="linenos">3004</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3005"><a href="#L-3005"><span class="linenos">3005</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="L-3006"><a href="#L-3006"><span class="linenos">3006</span></a>    <span class="n">tbt</span><span class="o">.</span><span class="n">FIBRectanglePattern</span><span class="p">,</span>
</span><span id="L-3007"><a href="#L-3007"><span class="linenos">3007</span></a>    <span class="n">tbt</span><span class="o">.</span><span class="n">FIBRegularCrossSection</span><span class="p">,</span>
</span><span id="L-3008"><a href="#L-3008"><span class="linenos">3008</span></a>    <span class="n">tbt</span><span class="o">.</span><span class="n">FIBCleaningCrossSection</span><span class="p">,</span>
</span><span id="L-3009"><a href="#L-3009"><span class="linenos">3009</span></a>    <span class="n">tbt</span><span class="o">.</span><span class="n">FIBStreamPattern</span><span class="p">,</span>
</span><span id="L-3010"><a href="#L-3010"><span class="linenos">3010</span></a><span class="p">]:</span>
</span><span id="L-3011"><a href="#L-3011"><span class="linenos">3011</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3012"><a href="#L-3012"><span class="linenos">3012</span></a><span class="sd">    Perform schema checking for FIB pattern setting dictionary.</span>
</span><span id="L-3013"><a href="#L-3013"><span class="linenos">3013</span></a>
</span><span id="L-3014"><a href="#L-3014"><span class="linenos">3014</span></a><span class="sd">    This function validates the FIB pattern settings dictionary based on the specified yml format and determines the type of pattern (rectangle, regular cross section, cleaning cross section, or selected area).</span>
</span><span id="L-3015"><a href="#L-3015"><span class="linenos">3015</span></a>
</span><span id="L-3016"><a href="#L-3016"><span class="linenos">3016</span></a><span class="sd">    Parameters</span>
</span><span id="L-3017"><a href="#L-3017"><span class="linenos">3017</span></a><span class="sd">    ----------</span>
</span><span id="L-3018"><a href="#L-3018"><span class="linenos">3018</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-3019"><a href="#L-3019"><span class="linenos">3019</span></a><span class="sd">        The microscope object for which to validate the FIB pattern settings.</span>
</span><span id="L-3020"><a href="#L-3020"><span class="linenos">3020</span></a><span class="sd">    settings : dict</span>
</span><span id="L-3021"><a href="#L-3021"><span class="linenos">3021</span></a><span class="sd">        The dictionary containing the FIB pattern settings.</span>
</span><span id="L-3022"><a href="#L-3022"><span class="linenos">3022</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-3023"><a href="#L-3023"><span class="linenos">3023</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-3024"><a href="#L-3024"><span class="linenos">3024</span></a><span class="sd">    step_name : str</span>
</span><span id="L-3025"><a href="#L-3025"><span class="linenos">3025</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-3026"><a href="#L-3026"><span class="linenos">3026</span></a>
</span><span id="L-3027"><a href="#L-3027"><span class="linenos">3027</span></a><span class="sd">    Returns</span>
</span><span id="L-3028"><a href="#L-3028"><span class="linenos">3028</span></a><span class="sd">    -------</span>
</span><span id="L-3029"><a href="#L-3029"><span class="linenos">3029</span></a><span class="sd">    Union[tbt.FIBRectanglePattern, tbt.FIBRegularCrossSection, tbt.FIBCleaningCrossSection, tbt.FIBStreamPattern]</span>
</span><span id="L-3030"><a href="#L-3030"><span class="linenos">3030</span></a><span class="sd">        The validated FIB pattern object.</span>
</span><span id="L-3031"><a href="#L-3031"><span class="linenos">3031</span></a>
</span><span id="L-3032"><a href="#L-3032"><span class="linenos">3032</span></a><span class="sd">    Raises</span>
</span><span id="L-3033"><a href="#L-3033"><span class="linenos">3033</span></a><span class="sd">    ------</span>
</span><span id="L-3034"><a href="#L-3034"><span class="linenos">3034</span></a><span class="sd">    KeyError</span>
</span><span id="L-3035"><a href="#L-3035"><span class="linenos">3035</span></a><span class="sd">        If required settings are missing from the .yml file or if multiple pattern types are specified.</span>
</span><span id="L-3036"><a href="#L-3036"><span class="linenos">3036</span></a><span class="sd">    ValueError</span>
</span><span id="L-3037"><a href="#L-3037"><span class="linenos">3037</span></a><span class="sd">        If the application file is unsupported or invalid for the specified pattern type.</span>
</span><span id="L-3038"><a href="#L-3038"><span class="linenos">3038</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3039"><a href="#L-3039"><span class="linenos">3039</span></a>
</span><span id="L-3040"><a href="#L-3040"><span class="linenos">3040</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-3041"><a href="#L-3041"><span class="linenos">3041</span></a>        <span class="n">application_file</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;application_file&quot;</span><span class="p">)</span>
</span><span id="L-3042"><a href="#L-3042"><span class="linenos">3042</span></a>        <span class="c1"># determine type of pattern (only one allowed)</span>
</span><span id="L-3043"><a href="#L-3043"><span class="linenos">3043</span></a>        <span class="n">type_set_db</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="L-3044"><a href="#L-3044"><span class="linenos">3044</span></a>        <span class="k">if</span> <span class="n">type_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3045"><a href="#L-3045"><span class="linenos">3045</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-3046"><a href="#L-3046"><span class="linenos">3046</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;type&#39; settings sub-dictionary found in &#39;pattern&#39; settings in &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-3047"><a href="#L-3047"><span class="linenos">3047</span></a>            <span class="p">)</span>
</span><span id="L-3048"><a href="#L-3048"><span class="linenos">3048</span></a>        <span class="n">rectangle_settings</span> <span class="o">=</span> <span class="n">type_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rectangle&quot;</span><span class="p">)</span>
</span><span id="L-3049"><a href="#L-3049"><span class="linenos">3049</span></a>        <span class="n">regular_cross_section_settings</span> <span class="o">=</span> <span class="n">type_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;regular_cross_section&quot;</span><span class="p">)</span>
</span><span id="L-3050"><a href="#L-3050"><span class="linenos">3050</span></a>        <span class="n">cleaning_cross_section_settings</span> <span class="o">=</span> <span class="n">type_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">)</span>
</span><span id="L-3051"><a href="#L-3051"><span class="linenos">3051</span></a>        <span class="n">selected_area_settings</span> <span class="o">=</span> <span class="n">type_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selected_area&quot;</span><span class="p">)</span>
</span><span id="L-3052"><a href="#L-3052"><span class="linenos">3052</span></a>
</span><span id="L-3053"><a href="#L-3053"><span class="linenos">3053</span></a>        <span class="n">pattern_settings</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3054"><a href="#L-3054"><span class="linenos">3054</span></a>            <span class="n">rectangle_settings</span><span class="p">,</span>
</span><span id="L-3055"><a href="#L-3055"><span class="linenos">3055</span></a>            <span class="n">regular_cross_section_settings</span><span class="p">,</span>
</span><span id="L-3056"><a href="#L-3056"><span class="linenos">3056</span></a>            <span class="n">cleaning_cross_section_settings</span><span class="p">,</span>
</span><span id="L-3057"><a href="#L-3057"><span class="linenos">3057</span></a>            <span class="n">selected_area_settings</span><span class="p">,</span>
</span><span id="L-3058"><a href="#L-3058"><span class="linenos">3058</span></a>        <span class="p">]</span>
</span><span id="L-3059"><a href="#L-3059"><span class="linenos">3059</span></a>        <span class="p">(</span>
</span><span id="L-3060"><a href="#L-3060"><span class="linenos">3060</span></a>            <span class="n">rectangle_pattern</span><span class="p">,</span>
</span><span id="L-3061"><a href="#L-3061"><span class="linenos">3061</span></a>            <span class="n">regular_cross_section_pattern</span><span class="p">,</span>
</span><span id="L-3062"><a href="#L-3062"><span class="linenos">3062</span></a>            <span class="n">cleaning_cross_section_pattern</span><span class="p">,</span>
</span><span id="L-3063"><a href="#L-3063"><span class="linenos">3063</span></a>            <span class="n">selected_area_pattern</span><span class="p">,</span>
</span><span id="L-3064"><a href="#L-3064"><span class="linenos">3064</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-3065"><a href="#L-3065"><span class="linenos">3065</span></a>        <span class="c1"># pattern_names = [val.value for val in tbt.FIBPatternType]  # remembers order</span>
</span><span id="L-3066"><a href="#L-3066"><span class="linenos">3066</span></a>        <span class="c1"># assert pattern_names == [</span>
</span><span id="L-3067"><a href="#L-3067"><span class="linenos">3067</span></a>        <span class="c1">#     &quot;rectangle&quot;,</span>
</span><span id="L-3068"><a href="#L-3068"><span class="linenos">3068</span></a>        <span class="c1">#     &quot;regular_cross_section&quot;,</span>
</span><span id="L-3069"><a href="#L-3069"><span class="linenos">3069</span></a>        <span class="c1">#     &quot;cleaning_cross_section&quot;,</span>
</span><span id="L-3070"><a href="#L-3070"><span class="linenos">3070</span></a>        <span class="c1">#     &quot;selected_area&quot;,</span>
</span><span id="L-3071"><a href="#L-3071"><span class="linenos">3071</span></a>        <span class="c1"># ]</span>
</span><span id="L-3072"><a href="#L-3072"><span class="linenos">3072</span></a>        <span class="n">pattern_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3073"><a href="#L-3073"><span class="linenos">3073</span></a>            <span class="s2">&quot;rectangle&quot;</span><span class="p">,</span>
</span><span id="L-3074"><a href="#L-3074"><span class="linenos">3074</span></a>            <span class="s2">&quot;regular_cross_section&quot;</span><span class="p">,</span>
</span><span id="L-3075"><a href="#L-3075"><span class="linenos">3075</span></a>            <span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">,</span>
</span><span id="L-3076"><a href="#L-3076"><span class="linenos">3076</span></a>            <span class="s2">&quot;selected_area&quot;</span><span class="p">,</span>
</span><span id="L-3077"><a href="#L-3077"><span class="linenos">3077</span></a>        <span class="p">]</span>
</span><span id="L-3078"><a href="#L-3078"><span class="linenos">3078</span></a>        <span class="n">pattern_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3079"><a href="#L-3079"><span class="linenos">3079</span></a>            <span class="n">rectangle_pattern</span><span class="p">,</span>
</span><span id="L-3080"><a href="#L-3080"><span class="linenos">3080</span></a>            <span class="n">regular_cross_section_pattern</span><span class="p">,</span>
</span><span id="L-3081"><a href="#L-3081"><span class="linenos">3081</span></a>            <span class="n">cleaning_cross_section_pattern</span><span class="p">,</span>
</span><span id="L-3082"><a href="#L-3082"><span class="linenos">3082</span></a>            <span class="n">selected_area_pattern</span><span class="p">,</span>
</span><span id="L-3083"><a href="#L-3083"><span class="linenos">3083</span></a>        <span class="p">]</span>
</span><span id="L-3084"><a href="#L-3084"><span class="linenos">3084</span></a>
</span><span id="L-3085"><a href="#L-3085"><span class="linenos">3085</span></a>        <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pattern_settings</span><span class="p">)):</span>
</span><span id="L-3086"><a href="#L-3086"><span class="linenos">3086</span></a>            <span class="n">db</span> <span class="o">=</span> <span class="n">pattern_settings</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span>
</span><span id="L-3087"><a href="#L-3087"><span class="linenos">3087</span></a>            <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3088"><a href="#L-3088"><span class="linenos">3088</span></a>                <span class="n">pattern_types</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3089"><a href="#L-3089"><span class="linenos">3089</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3090"><a href="#L-3090"><span class="linenos">3090</span></a>                <span class="n">pattern_types</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">none_value_dictionary</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</span><span id="L-3091"><a href="#L-3091"><span class="linenos">3091</span></a>
</span><span id="L-3092"><a href="#L-3092"><span class="linenos">3092</span></a>        <span class="c1"># one and only one type of pattern can have settings</span>
</span><span id="L-3093"><a href="#L-3093"><span class="linenos">3093</span></a>        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pattern_types</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-3094"><a href="#L-3094"><span class="linenos">3094</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-3095"><a href="#L-3095"><span class="linenos">3095</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file in &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. Pattern settings for one and only one type are allowed. Please provide settings for only one of the supported pattern types: </span><span class="si">{</span><span class="p">[</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">pattern_names</span><span class="p">]</span><span class="si">}</span><span class="s2">. For unused pattern types, leave the type settings completely blank, enter &#39;null&#39; for each parameter, or remove the unused subdictionary completely from the .yml file.&quot;</span>
</span><span id="L-3096"><a href="#L-3096"><span class="linenos">3096</span></a>            <span class="p">)</span>
</span><span id="L-3097"><a href="#L-3097"><span class="linenos">3097</span></a>        <span class="n">pattern_type</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="p">(</span><span class="n">pattern_names</span><span class="p">[</span><span class="n">pattern_types</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="kc">True</span><span class="p">)])</span>
</span><span id="L-3098"><a href="#L-3098"><span class="linenos">3098</span></a>
</span><span id="L-3099"><a href="#L-3099"><span class="linenos">3099</span></a>    <span class="c1"># check application file</span>
</span><span id="L-3100"><a href="#L-3100"><span class="linenos">3100</span></a>    <span class="n">valid_applications</span> <span class="o">=</span> <span class="n">application_files</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="L-3101"><a href="#L-3101"><span class="linenos">3101</span></a>    <span class="c1"># TODO make this print out pretty</span>
</span><span id="L-3102"><a href="#L-3102"><span class="linenos">3102</span></a>    <span class="c1"># display_applications = &quot;,&quot;.join(valid_applications)</span>
</span><span id="L-3103"><a href="#L-3103"><span class="linenos">3103</span></a>    <span class="c1"># display_applications = ut.tabular_list(data=valid_applications)</span>
</span><span id="L-3104"><a href="#L-3104"><span class="linenos">3104</span></a>    <span class="k">if</span> <span class="n">application_file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_applications</span><span class="p">:</span>
</span><span id="L-3105"><a href="#L-3105"><span class="linenos">3105</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3106"><a href="#L-3106"><span class="linenos">3106</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported FIB application file of &#39;</span><span class="si">{</span><span class="n">application_file</span><span class="si">}</span><span class="s2">&#39; on step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">. Supported applications on this microscope are: </span><span class="se">\n</span><span class="si">{</span><span class="n">valid_applications</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="L-3107"><a href="#L-3107"><span class="linenos">3107</span></a>        <span class="p">)</span>
</span><span id="L-3108"><a href="#L-3108"><span class="linenos">3108</span></a>
</span><span id="L-3109"><a href="#L-3109"><span class="linenos">3109</span></a>    <span class="k">if</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="o">.</span><span class="n">RECTANGLE</span><span class="p">:</span>
</span><span id="L-3110"><a href="#L-3110"><span class="linenos">3110</span></a>        <span class="n">validate_fib_box_settings</span><span class="p">(</span>
</span><span id="L-3111"><a href="#L-3111"><span class="linenos">3111</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">rectangle_settings</span><span class="p">,</span>
</span><span id="L-3112"><a href="#L-3112"><span class="linenos">3112</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-3113"><a href="#L-3113"><span class="linenos">3113</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-3114"><a href="#L-3114"><span class="linenos">3114</span></a>            <span class="n">pattern_type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="L-3115"><a href="#L-3115"><span class="linenos">3115</span></a>        <span class="p">)</span>
</span><span id="L-3116"><a href="#L-3116"><span class="linenos">3116</span></a>
</span><span id="L-3117"><a href="#L-3117"><span class="linenos">3117</span></a>        <span class="n">pattern</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPattern</span><span class="p">(</span>
</span><span id="L-3118"><a href="#L-3118"><span class="linenos">3118</span></a>            <span class="n">application</span><span class="o">=</span><span class="n">application_file</span><span class="p">,</span>
</span><span id="L-3119"><a href="#L-3119"><span class="linenos">3119</span></a>            <span class="nb">type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="L-3120"><a href="#L-3120"><span class="linenos">3120</span></a>            <span class="n">geometry</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBRectanglePattern</span><span class="p">(</span>
</span><span id="L-3121"><a href="#L-3121"><span class="linenos">3121</span></a>                <span class="n">center_um</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span>
</span><span id="L-3122"><a href="#L-3122"><span class="linenos">3122</span></a>                    <span class="n">x</span><span class="o">=</span><span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x_um&quot;</span><span class="p">),</span>
</span><span id="L-3123"><a href="#L-3123"><span class="linenos">3123</span></a>                    <span class="n">y</span><span class="o">=</span><span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y_um&quot;</span><span class="p">),</span>
</span><span id="L-3124"><a href="#L-3124"><span class="linenos">3124</span></a>                <span class="p">),</span>
</span><span id="L-3125"><a href="#L-3125"><span class="linenos">3125</span></a>                <span class="n">width_um</span><span class="o">=</span><span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;width_um&quot;</span><span class="p">),</span>
</span><span id="L-3126"><a href="#L-3126"><span class="linenos">3126</span></a>                <span class="n">height_um</span><span class="o">=</span><span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;height_um&quot;</span><span class="p">),</span>
</span><span id="L-3127"><a href="#L-3127"><span class="linenos">3127</span></a>                <span class="n">depth_um</span><span class="o">=</span><span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;depth_um&quot;</span><span class="p">),</span>
</span><span id="L-3128"><a href="#L-3128"><span class="linenos">3128</span></a>                <span class="n">scan_direction</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanDirection</span><span class="p">(</span>
</span><span id="L-3129"><a href="#L-3129"><span class="linenos">3129</span></a>                    <span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">)</span>
</span><span id="L-3130"><a href="#L-3130"><span class="linenos">3130</span></a>                <span class="p">),</span>
</span><span id="L-3131"><a href="#L-3131"><span class="linenos">3131</span></a>                <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanType</span><span class="p">(</span><span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_type&quot;</span><span class="p">)),</span>
</span><span id="L-3132"><a href="#L-3132"><span class="linenos">3132</span></a>            <span class="p">),</span>
</span><span id="L-3133"><a href="#L-3133"><span class="linenos">3133</span></a>        <span class="p">)</span>
</span><span id="L-3134"><a href="#L-3134"><span class="linenos">3134</span></a>        <span class="c1"># make sure application file is valid for this pattern type:</span>
</span><span id="L-3135"><a href="#L-3135"><span class="linenos">3135</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3136"><a href="#L-3136"><span class="linenos">3136</span></a>            <span class="n">geometry</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">geometry</span>
</span><span id="L-3137"><a href="#L-3137"><span class="linenos">3137</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">set_default_application_file</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
</span><span id="L-3138"><a href="#L-3138"><span class="linenos">3138</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span>
</span><span id="L-3139"><a href="#L-3139"><span class="linenos">3139</span></a>                <span class="n">center_x</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">center_um</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3140"><a href="#L-3140"><span class="linenos">3140</span></a>                <span class="n">center_y</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">center_um</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3141"><a href="#L-3141"><span class="linenos">3141</span></a>                <span class="n">width</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">width_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3142"><a href="#L-3142"><span class="linenos">3142</span></a>                <span class="n">height</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">height_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3143"><a href="#L-3143"><span class="linenos">3143</span></a>                <span class="n">depth</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">depth_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3144"><a href="#L-3144"><span class="linenos">3144</span></a>            <span class="p">)</span>
</span><span id="L-3145"><a href="#L-3145"><span class="linenos">3145</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">clear_patterns</span><span class="p">()</span>
</span><span id="L-3146"><a href="#L-3146"><span class="linenos">3146</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-3147"><a href="#L-3147"><span class="linenos">3147</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3148"><a href="#L-3148"><span class="linenos">3148</span></a>                <span class="sa">f</span><span class="s1">&#39;Invalid application file of &quot;</span><span class="si">{</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="si">}</span><span class="s1">&quot; for Rectangle pattern type. Please select or create an appropriate application file.&#39;</span>
</span><span id="L-3149"><a href="#L-3149"><span class="linenos">3149</span></a>            <span class="p">)</span>
</span><span id="L-3150"><a href="#L-3150"><span class="linenos">3150</span></a>
</span><span id="L-3151"><a href="#L-3151"><span class="linenos">3151</span></a>        <span class="k">return</span> <span class="n">pattern</span>
</span><span id="L-3152"><a href="#L-3152"><span class="linenos">3152</span></a>    <span class="k">elif</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="o">.</span><span class="n">REGULAR_CROSS_SECTION</span><span class="p">:</span>
</span><span id="L-3153"><a href="#L-3153"><span class="linenos">3153</span></a>        <span class="n">validate_fib_box_settings</span><span class="p">(</span>
</span><span id="L-3154"><a href="#L-3154"><span class="linenos">3154</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">regular_cross_section_settings</span><span class="p">,</span>
</span><span id="L-3155"><a href="#L-3155"><span class="linenos">3155</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-3156"><a href="#L-3156"><span class="linenos">3156</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-3157"><a href="#L-3157"><span class="linenos">3157</span></a>            <span class="n">pattern_type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="L-3158"><a href="#L-3158"><span class="linenos">3158</span></a>        <span class="p">)</span>
</span><span id="L-3159"><a href="#L-3159"><span class="linenos">3159</span></a>        <span class="n">pattern</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPattern</span><span class="p">(</span>
</span><span id="L-3160"><a href="#L-3160"><span class="linenos">3160</span></a>            <span class="n">application</span><span class="o">=</span><span class="n">application_file</span><span class="p">,</span>
</span><span id="L-3161"><a href="#L-3161"><span class="linenos">3161</span></a>            <span class="nb">type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="L-3162"><a href="#L-3162"><span class="linenos">3162</span></a>            <span class="n">geometry</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBRegularCrossSection</span><span class="p">(</span>
</span><span id="L-3163"><a href="#L-3163"><span class="linenos">3163</span></a>                <span class="n">center_um</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span>
</span><span id="L-3164"><a href="#L-3164"><span class="linenos">3164</span></a>                    <span class="n">x</span><span class="o">=</span><span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x_um&quot;</span><span class="p">),</span>
</span><span id="L-3165"><a href="#L-3165"><span class="linenos">3165</span></a>                    <span class="n">y</span><span class="o">=</span><span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y_um&quot;</span><span class="p">),</span>
</span><span id="L-3166"><a href="#L-3166"><span class="linenos">3166</span></a>                <span class="p">),</span>
</span><span id="L-3167"><a href="#L-3167"><span class="linenos">3167</span></a>                <span class="n">width_um</span><span class="o">=</span><span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;width_um&quot;</span><span class="p">),</span>
</span><span id="L-3168"><a href="#L-3168"><span class="linenos">3168</span></a>                <span class="n">height_um</span><span class="o">=</span><span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;height_um&quot;</span><span class="p">),</span>
</span><span id="L-3169"><a href="#L-3169"><span class="linenos">3169</span></a>                <span class="n">depth_um</span><span class="o">=</span><span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;depth_um&quot;</span><span class="p">),</span>
</span><span id="L-3170"><a href="#L-3170"><span class="linenos">3170</span></a>                <span class="n">scan_direction</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanDirection</span><span class="p">(</span>
</span><span id="L-3171"><a href="#L-3171"><span class="linenos">3171</span></a>                    <span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">)</span>
</span><span id="L-3172"><a href="#L-3172"><span class="linenos">3172</span></a>                <span class="p">),</span>
</span><span id="L-3173"><a href="#L-3173"><span class="linenos">3173</span></a>                <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanType</span><span class="p">(</span>
</span><span id="L-3174"><a href="#L-3174"><span class="linenos">3174</span></a>                    <span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_type&quot;</span><span class="p">)</span>
</span><span id="L-3175"><a href="#L-3175"><span class="linenos">3175</span></a>                <span class="p">),</span>
</span><span id="L-3176"><a href="#L-3176"><span class="linenos">3176</span></a>            <span class="p">),</span>
</span><span id="L-3177"><a href="#L-3177"><span class="linenos">3177</span></a>        <span class="p">)</span>
</span><span id="L-3178"><a href="#L-3178"><span class="linenos">3178</span></a>        <span class="c1"># make sure application file is valid for this pattern type:</span>
</span><span id="L-3179"><a href="#L-3179"><span class="linenos">3179</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3180"><a href="#L-3180"><span class="linenos">3180</span></a>            <span class="n">geometry</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">geometry</span>
</span><span id="L-3181"><a href="#L-3181"><span class="linenos">3181</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">set_default_application_file</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
</span><span id="L-3182"><a href="#L-3182"><span class="linenos">3182</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">create_regular_cross_section</span><span class="p">(</span>
</span><span id="L-3183"><a href="#L-3183"><span class="linenos">3183</span></a>                <span class="n">center_x</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">center_um</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3184"><a href="#L-3184"><span class="linenos">3184</span></a>                <span class="n">center_y</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">center_um</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3185"><a href="#L-3185"><span class="linenos">3185</span></a>                <span class="n">width</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">width_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3186"><a href="#L-3186"><span class="linenos">3186</span></a>                <span class="n">height</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">height_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3187"><a href="#L-3187"><span class="linenos">3187</span></a>                <span class="n">depth</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">depth_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3188"><a href="#L-3188"><span class="linenos">3188</span></a>            <span class="p">)</span>
</span><span id="L-3189"><a href="#L-3189"><span class="linenos">3189</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">clear_patterns</span><span class="p">()</span>
</span><span id="L-3190"><a href="#L-3190"><span class="linenos">3190</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-3191"><a href="#L-3191"><span class="linenos">3191</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3192"><a href="#L-3192"><span class="linenos">3192</span></a>                <span class="sa">f</span><span class="s1">&#39;Invalid application file of &quot;</span><span class="si">{</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="si">}</span><span class="s1">&quot; for Regular Cross Section pattern type. Please select or create an appropriate application file.&#39;</span>
</span><span id="L-3193"><a href="#L-3193"><span class="linenos">3193</span></a>            <span class="p">)</span>
</span><span id="L-3194"><a href="#L-3194"><span class="linenos">3194</span></a>        <span class="k">return</span> <span class="n">pattern</span>
</span><span id="L-3195"><a href="#L-3195"><span class="linenos">3195</span></a>    <span class="k">elif</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="o">.</span><span class="n">CLEANING_CROSS_SECTION</span><span class="p">:</span>
</span><span id="L-3196"><a href="#L-3196"><span class="linenos">3196</span></a>        <span class="n">validate_fib_box_settings</span><span class="p">(</span>
</span><span id="L-3197"><a href="#L-3197"><span class="linenos">3197</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">cleaning_cross_section_settings</span><span class="p">,</span>
</span><span id="L-3198"><a href="#L-3198"><span class="linenos">3198</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-3199"><a href="#L-3199"><span class="linenos">3199</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-3200"><a href="#L-3200"><span class="linenos">3200</span></a>            <span class="n">pattern_type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="L-3201"><a href="#L-3201"><span class="linenos">3201</span></a>        <span class="p">)</span>
</span><span id="L-3202"><a href="#L-3202"><span class="linenos">3202</span></a>        <span class="n">pattern</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPattern</span><span class="p">(</span>
</span><span id="L-3203"><a href="#L-3203"><span class="linenos">3203</span></a>            <span class="n">application</span><span class="o">=</span><span class="n">application_file</span><span class="p">,</span>
</span><span id="L-3204"><a href="#L-3204"><span class="linenos">3204</span></a>            <span class="nb">type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="L-3205"><a href="#L-3205"><span class="linenos">3205</span></a>            <span class="n">geometry</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBCleaningCrossSection</span><span class="p">(</span>
</span><span id="L-3206"><a href="#L-3206"><span class="linenos">3206</span></a>                <span class="n">center_um</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span>
</span><span id="L-3207"><a href="#L-3207"><span class="linenos">3207</span></a>                    <span class="n">x</span><span class="o">=</span><span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x_um&quot;</span><span class="p">),</span>
</span><span id="L-3208"><a href="#L-3208"><span class="linenos">3208</span></a>                    <span class="n">y</span><span class="o">=</span><span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y_um&quot;</span><span class="p">),</span>
</span><span id="L-3209"><a href="#L-3209"><span class="linenos">3209</span></a>                <span class="p">),</span>
</span><span id="L-3210"><a href="#L-3210"><span class="linenos">3210</span></a>                <span class="n">width_um</span><span class="o">=</span><span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;width_um&quot;</span><span class="p">),</span>
</span><span id="L-3211"><a href="#L-3211"><span class="linenos">3211</span></a>                <span class="n">height_um</span><span class="o">=</span><span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;height_um&quot;</span><span class="p">),</span>
</span><span id="L-3212"><a href="#L-3212"><span class="linenos">3212</span></a>                <span class="n">depth_um</span><span class="o">=</span><span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;depth_um&quot;</span><span class="p">),</span>
</span><span id="L-3213"><a href="#L-3213"><span class="linenos">3213</span></a>                <span class="n">scan_direction</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanDirection</span><span class="p">(</span>
</span><span id="L-3214"><a href="#L-3214"><span class="linenos">3214</span></a>                    <span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">)</span>
</span><span id="L-3215"><a href="#L-3215"><span class="linenos">3215</span></a>                <span class="p">),</span>
</span><span id="L-3216"><a href="#L-3216"><span class="linenos">3216</span></a>                <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanType</span><span class="p">(</span>
</span><span id="L-3217"><a href="#L-3217"><span class="linenos">3217</span></a>                    <span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_type&quot;</span><span class="p">)</span>
</span><span id="L-3218"><a href="#L-3218"><span class="linenos">3218</span></a>                <span class="p">),</span>
</span><span id="L-3219"><a href="#L-3219"><span class="linenos">3219</span></a>            <span class="p">),</span>
</span><span id="L-3220"><a href="#L-3220"><span class="linenos">3220</span></a>        <span class="p">)</span>
</span><span id="L-3221"><a href="#L-3221"><span class="linenos">3221</span></a>        <span class="c1"># make sure application file is valid for this pattern type:</span>
</span><span id="L-3222"><a href="#L-3222"><span class="linenos">3222</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3223"><a href="#L-3223"><span class="linenos">3223</span></a>            <span class="n">geometry</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">geometry</span>
</span><span id="L-3224"><a href="#L-3224"><span class="linenos">3224</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">set_default_application_file</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
</span><span id="L-3225"><a href="#L-3225"><span class="linenos">3225</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">create_cleaning_cross_section</span><span class="p">(</span>
</span><span id="L-3226"><a href="#L-3226"><span class="linenos">3226</span></a>                <span class="n">center_x</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">center_um</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3227"><a href="#L-3227"><span class="linenos">3227</span></a>                <span class="n">center_y</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">center_um</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3228"><a href="#L-3228"><span class="linenos">3228</span></a>                <span class="n">width</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">width_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3229"><a href="#L-3229"><span class="linenos">3229</span></a>                <span class="n">height</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">height_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3230"><a href="#L-3230"><span class="linenos">3230</span></a>                <span class="n">depth</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">depth_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="L-3231"><a href="#L-3231"><span class="linenos">3231</span></a>            <span class="p">)</span>
</span><span id="L-3232"><a href="#L-3232"><span class="linenos">3232</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">clear_patterns</span><span class="p">()</span>
</span><span id="L-3233"><a href="#L-3233"><span class="linenos">3233</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-3234"><a href="#L-3234"><span class="linenos">3234</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3235"><a href="#L-3235"><span class="linenos">3235</span></a>                <span class="sa">f</span><span class="s1">&#39;Invalid application file of &quot;</span><span class="si">{</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="si">}</span><span class="s1">&quot; for Cleaning Cross Section pattern type. Please select or create an appropriate application file.&#39;</span>
</span><span id="L-3236"><a href="#L-3236"><span class="linenos">3236</span></a>            <span class="p">)</span>
</span><span id="L-3237"><a href="#L-3237"><span class="linenos">3237</span></a>        <span class="k">return</span> <span class="n">pattern</span>
</span><span id="L-3238"><a href="#L-3238"><span class="linenos">3238</span></a>    <span class="k">elif</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="o">.</span><span class="n">SELECTED_AREA</span><span class="p">:</span>
</span><span id="L-3239"><a href="#L-3239"><span class="linenos">3239</span></a>        <span class="n">validate_fib_selected_area_settings</span><span class="p">(</span>
</span><span id="L-3240"><a href="#L-3240"><span class="linenos">3240</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">selected_area_settings</span><span class="p">,</span>
</span><span id="L-3241"><a href="#L-3241"><span class="linenos">3241</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-3242"><a href="#L-3242"><span class="linenos">3242</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-3243"><a href="#L-3243"><span class="linenos">3243</span></a>            <span class="n">pattern_type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="L-3244"><a href="#L-3244"><span class="linenos">3244</span></a>        <span class="p">)</span>
</span><span id="L-3245"><a href="#L-3245"><span class="linenos">3245</span></a>        <span class="n">pattern</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPattern</span><span class="p">(</span>
</span><span id="L-3246"><a href="#L-3246"><span class="linenos">3246</span></a>            <span class="n">application</span><span class="o">=</span><span class="n">application_file</span><span class="p">,</span>
</span><span id="L-3247"><a href="#L-3247"><span class="linenos">3247</span></a>            <span class="nb">type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="L-3248"><a href="#L-3248"><span class="linenos">3248</span></a>            <span class="n">geometry</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBStreamPattern</span><span class="p">(</span>
</span><span id="L-3249"><a href="#L-3249"><span class="linenos">3249</span></a>                <span class="n">dwell_us</span><span class="o">=</span><span class="n">selected_area_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dwell_us&quot;</span><span class="p">),</span>
</span><span id="L-3250"><a href="#L-3250"><span class="linenos">3250</span></a>                <span class="n">repeats</span><span class="o">=</span><span class="n">selected_area_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;repeats&quot;</span><span class="p">),</span>
</span><span id="L-3251"><a href="#L-3251"><span class="linenos">3251</span></a>                <span class="n">recipe</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">selected_area_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;recipe_file&quot;</span><span class="p">)),</span>
</span><span id="L-3252"><a href="#L-3252"><span class="linenos">3252</span></a>                <span class="n">mask</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">selected_area_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mask_file&quot;</span><span class="p">)),</span>
</span><span id="L-3253"><a href="#L-3253"><span class="linenos">3253</span></a>            <span class="p">),</span>
</span><span id="L-3254"><a href="#L-3254"><span class="linenos">3254</span></a>        <span class="p">)</span>
</span><span id="L-3255"><a href="#L-3255"><span class="linenos">3255</span></a>
</span><span id="L-3256"><a href="#L-3256"><span class="linenos">3256</span></a>        <span class="c1"># make sure application file is valid for this pattern type:</span>
</span><span id="L-3257"><a href="#L-3257"><span class="linenos">3257</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3258"><a href="#L-3258"><span class="linenos">3258</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">set_default_application_file</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
</span><span id="L-3259"><a href="#L-3259"><span class="linenos">3259</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span>
</span><span id="L-3260"><a href="#L-3260"><span class="linenos">3260</span></a>                <span class="n">center_x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-3261"><a href="#L-3261"><span class="linenos">3261</span></a>                <span class="n">center_y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-3262"><a href="#L-3262"><span class="linenos">3262</span></a>                <span class="n">width</span><span class="o">=</span><span class="mf">10.0e-6</span><span class="p">,</span>
</span><span id="L-3263"><a href="#L-3263"><span class="linenos">3263</span></a>                <span class="n">height</span><span class="o">=</span><span class="mf">10.0e-6</span><span class="p">,</span>
</span><span id="L-3264"><a href="#L-3264"><span class="linenos">3264</span></a>                <span class="n">depth</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">,</span>
</span><span id="L-3265"><a href="#L-3265"><span class="linenos">3265</span></a>            <span class="p">)</span>
</span><span id="L-3266"><a href="#L-3266"><span class="linenos">3266</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">clear_patterns</span><span class="p">()</span>
</span><span id="L-3267"><a href="#L-3267"><span class="linenos">3267</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-3268"><a href="#L-3268"><span class="linenos">3268</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3269"><a href="#L-3269"><span class="linenos">3269</span></a>                <span class="sa">f</span><span class="s1">&#39;Invalid application file of &quot;</span><span class="si">{</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="si">}</span><span class="s1">&quot; for Selected Area pattern. Please use an application file for Rectangle milling.&#39;</span>
</span><span id="L-3270"><a href="#L-3270"><span class="linenos">3270</span></a>            <span class="p">)</span>
</span><span id="L-3271"><a href="#L-3271"><span class="linenos">3271</span></a>
</span><span id="L-3272"><a href="#L-3272"><span class="linenos">3272</span></a>        <span class="k">return</span> <span class="n">pattern</span>
</span><span id="L-3273"><a href="#L-3273"><span class="linenos">3273</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-3274"><a href="#L-3274"><span class="linenos">3274</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-3275"><a href="#L-3275"><span class="linenos">3275</span></a>            <span class="sa">f</span><span class="s2">&quot;Invalid pattern type of </span><span class="si">{</span><span class="n">pattern_type</span><span class="si">}</span><span class="s2">. Supported pattern types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-3276"><a href="#L-3276"><span class="linenos">3276</span></a>        <span class="p">)</span>
</span><span id="L-3277"><a href="#L-3277"><span class="linenos">3277</span></a>
</span><span id="L-3278"><a href="#L-3278"><span class="linenos">3278</span></a>
</span><span id="L-3279"><a href="#L-3279"><span class="linenos">3279</span></a><span class="k">def</span> <span class="nf">validate_fib_box_settings</span><span class="p">(</span>
</span><span id="L-3280"><a href="#L-3280"><span class="linenos">3280</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-3281"><a href="#L-3281"><span class="linenos">3281</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-3282"><a href="#L-3282"><span class="linenos">3282</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3283"><a href="#L-3283"><span class="linenos">3283</span></a>    <span class="n">pattern_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="p">,</span>
</span><span id="L-3284"><a href="#L-3284"><span class="linenos">3284</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-3285"><a href="#L-3285"><span class="linenos">3285</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3286"><a href="#L-3286"><span class="linenos">3286</span></a><span class="sd">    Perform schema checking for FIB box pattern setting dictionary.</span>
</span><span id="L-3287"><a href="#L-3287"><span class="linenos">3287</span></a>
</span><span id="L-3288"><a href="#L-3288"><span class="linenos">3288</span></a><span class="sd">    This function validates the FIB box pattern settings dictionary based on the specified yml format.</span>
</span><span id="L-3289"><a href="#L-3289"><span class="linenos">3289</span></a>
</span><span id="L-3290"><a href="#L-3290"><span class="linenos">3290</span></a><span class="sd">    Parameters</span>
</span><span id="L-3291"><a href="#L-3291"><span class="linenos">3291</span></a><span class="sd">    ----------</span>
</span><span id="L-3292"><a href="#L-3292"><span class="linenos">3292</span></a><span class="sd">    settings : dict</span>
</span><span id="L-3293"><a href="#L-3293"><span class="linenos">3293</span></a><span class="sd">        The dictionary containing the FIB box pattern settings.</span>
</span><span id="L-3294"><a href="#L-3294"><span class="linenos">3294</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-3295"><a href="#L-3295"><span class="linenos">3295</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-3296"><a href="#L-3296"><span class="linenos">3296</span></a><span class="sd">    step_name : str</span>
</span><span id="L-3297"><a href="#L-3297"><span class="linenos">3297</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-3298"><a href="#L-3298"><span class="linenos">3298</span></a><span class="sd">    pattern_type : tbt.FIBPatternType</span>
</span><span id="L-3299"><a href="#L-3299"><span class="linenos">3299</span></a><span class="sd">        The type of the FIB pattern.</span>
</span><span id="L-3300"><a href="#L-3300"><span class="linenos">3300</span></a>
</span><span id="L-3301"><a href="#L-3301"><span class="linenos">3301</span></a><span class="sd">    Returns</span>
</span><span id="L-3302"><a href="#L-3302"><span class="linenos">3302</span></a><span class="sd">    -------</span>
</span><span id="L-3303"><a href="#L-3303"><span class="linenos">3303</span></a><span class="sd">    bool</span>
</span><span id="L-3304"><a href="#L-3304"><span class="linenos">3304</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-3305"><a href="#L-3305"><span class="linenos">3305</span></a>
</span><span id="L-3306"><a href="#L-3306"><span class="linenos">3306</span></a><span class="sd">    Raises</span>
</span><span id="L-3307"><a href="#L-3307"><span class="linenos">3307</span></a><span class="sd">    ------</span>
</span><span id="L-3308"><a href="#L-3308"><span class="linenos">3308</span></a><span class="sd">    ValueError</span>
</span><span id="L-3309"><a href="#L-3309"><span class="linenos">3309</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="L-3310"><a href="#L-3310"><span class="linenos">3310</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3311"><a href="#L-3311"><span class="linenos">3311</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-3312"><a href="#L-3312"><span class="linenos">3312</span></a>        <span class="c1"># flattens nested dictionary, adding &quot;_&quot; separator</span>
</span><span id="L-3313"><a href="#L-3313"><span class="linenos">3313</span></a>        <span class="n">flat_settings</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-3314"><a href="#L-3314"><span class="linenos">3314</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-3315"><a href="#L-3315"><span class="linenos">3315</span></a>            <span class="p">{</span>
</span><span id="L-3316"><a href="#L-3316"><span class="linenos">3316</span></a>                <span class="s2">&quot;center_x_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-3317"><a href="#L-3317"><span class="linenos">3317</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-3318"><a href="#L-3318"><span class="linenos">3318</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;x_um&#39; parameter for pattern &#39;center&#39; sub-dictionary must be a float. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;center_x_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;center_x_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="L-3319"><a href="#L-3319"><span class="linenos">3319</span></a>                <span class="p">),</span>
</span><span id="L-3320"><a href="#L-3320"><span class="linenos">3320</span></a>                <span class="s2">&quot;center_y_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-3321"><a href="#L-3321"><span class="linenos">3321</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-3322"><a href="#L-3322"><span class="linenos">3322</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;y_um&#39; parameter for pattern &#39;center&#39; sub-dictionary must be a float. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;center_y_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;center_y_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="L-3323"><a href="#L-3323"><span class="linenos">3323</span></a>                <span class="p">),</span>
</span><span id="L-3324"><a href="#L-3324"><span class="linenos">3324</span></a>                <span class="s2">&quot;width_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-3325"><a href="#L-3325"><span class="linenos">3325</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-3326"><a href="#L-3326"><span class="linenos">3326</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-3327"><a href="#L-3327"><span class="linenos">3327</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;width_um&#39; parameter must be a float. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;width_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;width_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="L-3328"><a href="#L-3328"><span class="linenos">3328</span></a>                <span class="p">),</span>
</span><span id="L-3329"><a href="#L-3329"><span class="linenos">3329</span></a>                <span class="s2">&quot;height_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-3330"><a href="#L-3330"><span class="linenos">3330</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-3331"><a href="#L-3331"><span class="linenos">3331</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-3332"><a href="#L-3332"><span class="linenos">3332</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;height_um&#39; parameter must be a float. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;height_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;height_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="L-3333"><a href="#L-3333"><span class="linenos">3333</span></a>                <span class="p">),</span>
</span><span id="L-3334"><a href="#L-3334"><span class="linenos">3334</span></a>                <span class="s2">&quot;depth_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-3335"><a href="#L-3335"><span class="linenos">3335</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-3336"><a href="#L-3336"><span class="linenos">3336</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-3337"><a href="#L-3337"><span class="linenos">3337</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;depth_um&#39; parameter must be a float. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;depth_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;depth_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="L-3338"><a href="#L-3338"><span class="linenos">3338</span></a>                <span class="p">),</span>
</span><span id="L-3339"><a href="#L-3339"><span class="linenos">3339</span></a>                <span class="s2">&quot;scan_direction&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-3340"><a href="#L-3340"><span class="linenos">3340</span></a>                    <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3341"><a href="#L-3341"><span class="linenos">3341</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanDirection</span><span class="p">),</span>
</span><span id="L-3342"><a href="#L-3342"><span class="linenos">3342</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;scan_direction&#39; parameter must be a valid scan direction type. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;scan_direction&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; was requested but supported values are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanDirection</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-3343"><a href="#L-3343"><span class="linenos">3343</span></a>                <span class="p">),</span>
</span><span id="L-3344"><a href="#L-3344"><span class="linenos">3344</span></a>                <span class="s2">&quot;scan_type&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-3345"><a href="#L-3345"><span class="linenos">3345</span></a>                    <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3346"><a href="#L-3346"><span class="linenos">3346</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanType</span><span class="p">),</span>
</span><span id="L-3347"><a href="#L-3347"><span class="linenos">3347</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;scan_type&#39; parameter must be a valid scan type type. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;scan_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; was requested but supported values are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanType</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-3348"><a href="#L-3348"><span class="linenos">3348</span></a>                <span class="p">),</span>
</span><span id="L-3349"><a href="#L-3349"><span class="linenos">3349</span></a>            <span class="p">},</span>
</span><span id="L-3350"><a href="#L-3350"><span class="linenos">3350</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-3351"><a href="#L-3351"><span class="linenos">3351</span></a>        <span class="p">)</span>
</span><span id="L-3352"><a href="#L-3352"><span class="linenos">3352</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-3353"><a href="#L-3353"><span class="linenos">3353</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">flat_settings</span><span class="p">)</span>
</span><span id="L-3354"><a href="#L-3354"><span class="linenos">3354</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="L-3355"><a href="#L-3355"><span class="linenos">3355</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3356"><a href="#L-3356"><span class="linenos">3356</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="L-3357"><a href="#L-3357"><span class="linenos">3357</span></a>        <span class="p">)</span>
</span><span id="L-3358"><a href="#L-3358"><span class="linenos">3358</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-3359"><a href="#L-3359"><span class="linenos">3359</span></a>
</span><span id="L-3360"><a href="#L-3360"><span class="linenos">3360</span></a>
</span><span id="L-3361"><a href="#L-3361"><span class="linenos">3361</span></a><span class="k">def</span> <span class="nf">validate_fib_selected_area_settings</span><span class="p">(</span>
</span><span id="L-3362"><a href="#L-3362"><span class="linenos">3362</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-3363"><a href="#L-3363"><span class="linenos">3363</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-3364"><a href="#L-3364"><span class="linenos">3364</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3365"><a href="#L-3365"><span class="linenos">3365</span></a>    <span class="n">pattern_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="p">,</span>
</span><span id="L-3366"><a href="#L-3366"><span class="linenos">3366</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-3367"><a href="#L-3367"><span class="linenos">3367</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3368"><a href="#L-3368"><span class="linenos">3368</span></a><span class="sd">    Perform schema checking for FIB selected area pattern setting dictionary.</span>
</span><span id="L-3369"><a href="#L-3369"><span class="linenos">3369</span></a>
</span><span id="L-3370"><a href="#L-3370"><span class="linenos">3370</span></a><span class="sd">    This function validates the FIB selected area pattern settings dictionary based on the specified yml format.</span>
</span><span id="L-3371"><a href="#L-3371"><span class="linenos">3371</span></a>
</span><span id="L-3372"><a href="#L-3372"><span class="linenos">3372</span></a><span class="sd">    Parameters</span>
</span><span id="L-3373"><a href="#L-3373"><span class="linenos">3373</span></a><span class="sd">    ----------</span>
</span><span id="L-3374"><a href="#L-3374"><span class="linenos">3374</span></a><span class="sd">    settings : dict</span>
</span><span id="L-3375"><a href="#L-3375"><span class="linenos">3375</span></a><span class="sd">        The dictionary containing the FIB selected area pattern settings.</span>
</span><span id="L-3376"><a href="#L-3376"><span class="linenos">3376</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-3377"><a href="#L-3377"><span class="linenos">3377</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-3378"><a href="#L-3378"><span class="linenos">3378</span></a><span class="sd">    step_name : str</span>
</span><span id="L-3379"><a href="#L-3379"><span class="linenos">3379</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-3380"><a href="#L-3380"><span class="linenos">3380</span></a><span class="sd">    pattern_type : tbt.FIBPatternType</span>
</span><span id="L-3381"><a href="#L-3381"><span class="linenos">3381</span></a><span class="sd">        The type of the FIB pattern.</span>
</span><span id="L-3382"><a href="#L-3382"><span class="linenos">3382</span></a>
</span><span id="L-3383"><a href="#L-3383"><span class="linenos">3383</span></a><span class="sd">    Returns</span>
</span><span id="L-3384"><a href="#L-3384"><span class="linenos">3384</span></a><span class="sd">    -------</span>
</span><span id="L-3385"><a href="#L-3385"><span class="linenos">3385</span></a><span class="sd">    bool</span>
</span><span id="L-3386"><a href="#L-3386"><span class="linenos">3386</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="L-3387"><a href="#L-3387"><span class="linenos">3387</span></a>
</span><span id="L-3388"><a href="#L-3388"><span class="linenos">3388</span></a><span class="sd">    Raises</span>
</span><span id="L-3389"><a href="#L-3389"><span class="linenos">3389</span></a><span class="sd">    ------</span>
</span><span id="L-3390"><a href="#L-3390"><span class="linenos">3390</span></a><span class="sd">    ValueError</span>
</span><span id="L-3391"><a href="#L-3391"><span class="linenos">3391</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="L-3392"><a href="#L-3392"><span class="linenos">3392</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3393"><a href="#L-3393"><span class="linenos">3393</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-3394"><a href="#L-3394"><span class="linenos">3394</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="L-3395"><a href="#L-3395"><span class="linenos">3395</span></a>            <span class="p">{</span>
</span><span id="L-3396"><a href="#L-3396"><span class="linenos">3396</span></a>                <span class="s2">&quot;dwell_us&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-3397"><a href="#L-3397"><span class="linenos">3397</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="L-3398"><a href="#L-3398"><span class="linenos">3398</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-3399"><a href="#L-3399"><span class="linenos">3399</span></a>                    <span class="c1"># check all float error versions of modulus</span>
</span><span id="L-3400"><a href="#L-3400"><span class="linenos">3400</span></a>                    <span class="n">Or</span><span class="p">(</span>
</span><span id="L-3401"><a href="#L-3401"><span class="linenos">3401</span></a>                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
</span><span id="L-3402"><a href="#L-3402"><span class="linenos">3402</span></a>                            <span class="n">x</span> <span class="o">%</span> <span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span><span class="p">,</span>
</span><span id="L-3403"><a href="#L-3403"><span class="linenos">3403</span></a>                            <span class="mi">0</span><span class="p">,</span>
</span><span id="L-3404"><a href="#L-3404"><span class="linenos">3404</span></a>                            <span class="n">abs_tol</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span> <span class="o">/</span> <span class="mf">1e5</span><span class="p">,</span>
</span><span id="L-3405"><a href="#L-3405"><span class="linenos">3405</span></a>                        <span class="p">),</span>
</span><span id="L-3406"><a href="#L-3406"><span class="linenos">3406</span></a>                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
</span><span id="L-3407"><a href="#L-3407"><span class="linenos">3407</span></a>                            <span class="n">x</span> <span class="o">%</span> <span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span><span class="p">,</span>
</span><span id="L-3408"><a href="#L-3408"><span class="linenos">3408</span></a>                            <span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span><span class="p">,</span>
</span><span id="L-3409"><a href="#L-3409"><span class="linenos">3409</span></a>                            <span class="n">abs_tol</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span> <span class="o">/</span> <span class="mf">1e5</span><span class="p">,</span>
</span><span id="L-3410"><a href="#L-3410"><span class="linenos">3410</span></a>                        <span class="p">),</span>
</span><span id="L-3411"><a href="#L-3411"><span class="linenos">3411</span></a>                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
</span><span id="L-3412"><a href="#L-3412"><span class="linenos">3412</span></a>                            <span class="n">x</span> <span class="o">%</span> <span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span><span class="p">,</span>
</span><span id="L-3413"><a href="#L-3413"><span class="linenos">3413</span></a>                            <span class="o">-</span><span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span><span class="p">,</span>
</span><span id="L-3414"><a href="#L-3414"><span class="linenos">3414</span></a>                            <span class="n">abs_tol</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span> <span class="o">/</span> <span class="mf">1e5</span><span class="p">,</span>
</span><span id="L-3415"><a href="#L-3415"><span class="linenos">3415</span></a>                        <span class="p">),</span>
</span><span id="L-3416"><a href="#L-3416"><span class="linenos">3416</span></a>                    <span class="p">),</span>
</span><span id="L-3417"><a href="#L-3417"><span class="linenos">3417</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;dwell_us&#39; parameter must be a positive float and an integer multiple of the base dwell time, </span><span class="si">{</span><span class="w"> </span><span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Conversions</span><span class="o">.</span><span class="n">US_TO_NS</span><span class="si">}</span><span class="s2"> ns. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dwell_us&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; us of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dwell_us&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="L-3418"><a href="#L-3418"><span class="linenos">3418</span></a>                <span class="p">),</span>
</span><span id="L-3419"><a href="#L-3419"><span class="linenos">3419</span></a>                <span class="s2">&quot;repeats&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-3420"><a href="#L-3420"><span class="linenos">3420</span></a>                    <span class="nb">int</span><span class="p">,</span>
</span><span id="L-3421"><a href="#L-3421"><span class="linenos">3421</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-3422"><a href="#L-3422"><span class="linenos">3422</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;repeats&#39; parameter must be a positive integer. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;repeats&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;repeats&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="L-3423"><a href="#L-3423"><span class="linenos">3423</span></a>                <span class="p">),</span>
</span><span id="L-3424"><a href="#L-3424"><span class="linenos">3424</span></a>                <span class="s2">&quot;recipe_file&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-3425"><a href="#L-3425"><span class="linenos">3425</span></a>                    <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3426"><a href="#L-3426"><span class="linenos">3426</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">(),</span>
</span><span id="L-3427"><a href="#L-3427"><span class="linenos">3427</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.py&quot;</span><span class="p">,</span>
</span><span id="L-3428"><a href="#L-3428"><span class="linenos">3428</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;recipe_file&#39; parameter must be a valid file path string with the extension &#39;.py&#39; and must already exist. The recipe file &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;recipe_file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="L-3429"><a href="#L-3429"><span class="linenos">3429</span></a>                <span class="p">),</span>
</span><span id="L-3430"><a href="#L-3430"><span class="linenos">3430</span></a>                <span class="s2">&quot;mask_file&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="L-3431"><a href="#L-3431"><span class="linenos">3431</span></a>                    <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3432"><a href="#L-3432"><span class="linenos">3432</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.tif&quot;</span><span class="p">,</span>
</span><span id="L-3433"><a href="#L-3433"><span class="linenos">3433</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;mask&#39; parameter must be a file path string with a file extension of &#39;.tif&#39;. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;mask_file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;mask_file&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="L-3434"><a href="#L-3434"><span class="linenos">3434</span></a>                <span class="p">),</span>
</span><span id="L-3435"><a href="#L-3435"><span class="linenos">3435</span></a>            <span class="p">},</span>
</span><span id="L-3436"><a href="#L-3436"><span class="linenos">3436</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-3437"><a href="#L-3437"><span class="linenos">3437</span></a>        <span class="p">)</span>
</span><span id="L-3438"><a href="#L-3438"><span class="linenos">3438</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-3439"><a href="#L-3439"><span class="linenos">3439</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="L-3440"><a href="#L-3440"><span class="linenos">3440</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="L-3441"><a href="#L-3441"><span class="linenos">3441</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3442"><a href="#L-3442"><span class="linenos">3442</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="L-3443"><a href="#L-3443"><span class="linenos">3443</span></a>        <span class="p">)</span>
</span><span id="L-3444"><a href="#L-3444"><span class="linenos">3444</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-3445"><a href="#L-3445"><span class="linenos">3445</span></a>
</span><span id="L-3446"><a href="#L-3446"><span class="linenos">3446</span></a>
</span><span id="L-3447"><a href="#L-3447"><span class="linenos">3447</span></a><span class="k">def</span> <span class="nf">step</span><span class="p">(</span>
</span><span id="L-3448"><a href="#L-3448"><span class="linenos">3448</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="L-3449"><a href="#L-3449"><span class="linenos">3449</span></a>    <span class="c1"># slice_number: str,</span>
</span><span id="L-3450"><a href="#L-3450"><span class="linenos">3450</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3451"><a href="#L-3451"><span class="linenos">3451</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-3452"><a href="#L-3452"><span class="linenos">3452</span></a>    <span class="n">general_settings</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">GeneralSettings</span><span class="p">,</span>
</span><span id="L-3453"><a href="#L-3453"><span class="linenos">3453</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="L-3454"><a href="#L-3454"><span class="linenos">3454</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Step</span><span class="p">:</span>
</span><span id="L-3455"><a href="#L-3455"><span class="linenos">3455</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3456"><a href="#L-3456"><span class="linenos">3456</span></a><span class="sd">    Create a step object for different step types, including validation.</span>
</span><span id="L-3457"><a href="#L-3457"><span class="linenos">3457</span></a>
</span><span id="L-3458"><a href="#L-3458"><span class="linenos">3458</span></a><span class="sd">    This function creates a `Step` object for the specified step type and performs validation.</span>
</span><span id="L-3459"><a href="#L-3459"><span class="linenos">3459</span></a>
</span><span id="L-3460"><a href="#L-3460"><span class="linenos">3460</span></a><span class="sd">    Parameters</span>
</span><span id="L-3461"><a href="#L-3461"><span class="linenos">3461</span></a><span class="sd">    ----------</span>
</span><span id="L-3462"><a href="#L-3462"><span class="linenos">3462</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="L-3463"><a href="#L-3463"><span class="linenos">3463</span></a><span class="sd">        The microscope object for which to create the step.</span>
</span><span id="L-3464"><a href="#L-3464"><span class="linenos">3464</span></a><span class="sd">    step_name : str</span>
</span><span id="L-3465"><a href="#L-3465"><span class="linenos">3465</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="L-3466"><a href="#L-3466"><span class="linenos">3466</span></a><span class="sd">    step_settings : dict</span>
</span><span id="L-3467"><a href="#L-3467"><span class="linenos">3467</span></a><span class="sd">        The dictionary containing the step settings.</span>
</span><span id="L-3468"><a href="#L-3468"><span class="linenos">3468</span></a><span class="sd">    general_settings : tbt.GeneralSettings</span>
</span><span id="L-3469"><a href="#L-3469"><span class="linenos">3469</span></a><span class="sd">        The general settings object.</span>
</span><span id="L-3470"><a href="#L-3470"><span class="linenos">3470</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="L-3471"><a href="#L-3471"><span class="linenos">3471</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="L-3472"><a href="#L-3472"><span class="linenos">3472</span></a>
</span><span id="L-3473"><a href="#L-3473"><span class="linenos">3473</span></a><span class="sd">    Returns</span>
</span><span id="L-3474"><a href="#L-3474"><span class="linenos">3474</span></a><span class="sd">    -------</span>
</span><span id="L-3475"><a href="#L-3475"><span class="linenos">3475</span></a><span class="sd">    tbt.Step</span>
</span><span id="L-3476"><a href="#L-3476"><span class="linenos">3476</span></a><span class="sd">        The step object.</span>
</span><span id="L-3477"><a href="#L-3477"><span class="linenos">3477</span></a>
</span><span id="L-3478"><a href="#L-3478"><span class="linenos">3478</span></a><span class="sd">    Raises</span>
</span><span id="L-3479"><a href="#L-3479"><span class="linenos">3479</span></a><span class="sd">    ------</span>
</span><span id="L-3480"><a href="#L-3480"><span class="linenos">3480</span></a><span class="sd">    NotImplementedError</span>
</span><span id="L-3481"><a href="#L-3481"><span class="linenos">3481</span></a><span class="sd">        If the step type is unsupported.</span>
</span><span id="L-3482"><a href="#L-3482"><span class="linenos">3482</span></a><span class="sd">    KeyError</span>
</span><span id="L-3483"><a href="#L-3483"><span class="linenos">3483</span></a><span class="sd">        If required settings are missing or invalid.</span>
</span><span id="L-3484"><a href="#L-3484"><span class="linenos">3484</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3485"><a href="#L-3485"><span class="linenos">3485</span></a>
</span><span id="L-3486"><a href="#L-3486"><span class="linenos">3486</span></a>    <span class="c1"># parsing settings</span>
</span><span id="L-3487"><a href="#L-3487"><span class="linenos">3487</span></a>    <span class="n">step_type_value</span> <span class="o">=</span> <span class="n">step_settings</span><span class="p">[</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_general_key</span><span class="p">][</span>
</span><span id="L-3488"><a href="#L-3488"><span class="linenos">3488</span></a>        <span class="n">yml_format</span><span class="o">.</span><span class="n">step_type_key</span>
</span><span id="L-3489"><a href="#L-3489"><span class="linenos">3489</span></a>    <span class="p">]</span>
</span><span id="L-3490"><a href="#L-3490"><span class="linenos">3490</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">step_type_value</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="p">):</span>
</span><span id="L-3491"><a href="#L-3491"><span class="linenos">3491</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="L-3492"><a href="#L-3492"><span class="linenos">3492</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported step type of &#39;</span><span class="si">{</span><span class="n">step_type_value</span><span class="si">}</span><span class="s2">&#39;, for step name &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; supported types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-3493"><a href="#L-3493"><span class="linenos">3493</span></a>        <span class="p">)</span>
</span><span id="L-3494"><a href="#L-3494"><span class="linenos">3494</span></a>    <span class="n">step_type</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="p">(</span><span class="n">step_type_value</span><span class="p">)</span>
</span><span id="L-3495"><a href="#L-3495"><span class="linenos">3495</span></a>
</span><span id="L-3496"><a href="#L-3496"><span class="linenos">3496</span></a>    <span class="n">step_number</span> <span class="o">=</span> <span class="n">step_settings</span><span class="p">[</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_general_key</span><span class="p">][</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_number_key</span><span class="p">]</span>
</span><span id="L-3497"><a href="#L-3497"><span class="linenos">3497</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step_number</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">step_number</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-3498"><a href="#L-3498"><span class="linenos">3498</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-3499"><a href="#L-3499"><span class="linenos">3499</span></a>            <span class="sa">f</span><span class="s2">&quot;Invalid step number of &#39;</span><span class="si">{</span><span class="n">step_number</span><span class="si">}</span><span class="s2">&#39;, for step name &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. Must be a positive integer greater than 0.&quot;</span>
</span><span id="L-3500"><a href="#L-3500"><span class="linenos">3500</span></a>        <span class="p">)</span>
</span><span id="L-3501"><a href="#L-3501"><span class="linenos">3501</span></a>    <span class="n">step_frequency</span> <span class="o">=</span> <span class="n">step_settings</span><span class="p">[</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_general_key</span><span class="p">][</span>
</span><span id="L-3502"><a href="#L-3502"><span class="linenos">3502</span></a>        <span class="n">yml_format</span><span class="o">.</span><span class="n">step_frequency_key</span>
</span><span id="L-3503"><a href="#L-3503"><span class="linenos">3503</span></a>    <span class="p">]</span>
</span><span id="L-3504"><a href="#L-3504"><span class="linenos">3504</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step_frequency</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">step_frequency</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-3505"><a href="#L-3505"><span class="linenos">3505</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="L-3506"><a href="#L-3506"><span class="linenos">3506</span></a>            <span class="sa">f</span><span class="s2">&quot;Invalid step frequency of &#39;</span><span class="si">{</span><span class="n">step_frequency</span><span class="si">}</span><span class="s2">&#39;, for step name &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. Must be a positive integer greater than 0.&quot;</span>
</span><span id="L-3507"><a href="#L-3507"><span class="linenos">3507</span></a>        <span class="p">)</span>
</span><span id="L-3508"><a href="#L-3508"><span class="linenos">3508</span></a>    <span class="n">stage_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="p">[</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_general_key</span><span class="p">][</span>
</span><span id="L-3509"><a href="#L-3509"><span class="linenos">3509</span></a>        <span class="n">yml_format</span><span class="o">.</span><span class="n">step_stage_settings_key</span>
</span><span id="L-3510"><a href="#L-3510"><span class="linenos">3510</span></a>    <span class="p">]</span>
</span><span id="L-3511"><a href="#L-3511"><span class="linenos">3511</span></a>
</span><span id="L-3512"><a href="#L-3512"><span class="linenos">3512</span></a>    <span class="c1"># check and validate stage</span>
</span><span id="L-3513"><a href="#L-3513"><span class="linenos">3513</span></a>    <span class="n">stage_settings</span> <span class="o">=</span> <span class="n">stage_position_settings</span><span class="p">(</span>
</span><span id="L-3514"><a href="#L-3514"><span class="linenos">3514</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-3515"><a href="#L-3515"><span class="linenos">3515</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-3516"><a href="#L-3516"><span class="linenos">3516</span></a>        <span class="n">general_settings</span><span class="o">=</span><span class="n">general_settings</span><span class="p">,</span>
</span><span id="L-3517"><a href="#L-3517"><span class="linenos">3517</span></a>        <span class="n">step_stage_settings</span><span class="o">=</span><span class="n">stage_db</span><span class="p">,</span>
</span><span id="L-3518"><a href="#L-3518"><span class="linenos">3518</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-3519"><a href="#L-3519"><span class="linenos">3519</span></a>    <span class="p">)</span>
</span><span id="L-3520"><a href="#L-3520"><span class="linenos">3520</span></a>
</span><span id="L-3521"><a href="#L-3521"><span class="linenos">3521</span></a>    <span class="c1"># TODO</span>
</span><span id="L-3522"><a href="#L-3522"><span class="linenos">3522</span></a>    <span class="c1"># operation_settings, could use match statement in python &gt;= 3.10</span>
</span><span id="L-3523"><a href="#L-3523"><span class="linenos">3523</span></a>    <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="o">.</span><span class="n">EBSD</span><span class="p">:</span>
</span><span id="L-3524"><a href="#L-3524"><span class="linenos">3524</span></a>        <span class="n">operation_settings</span> <span class="o">=</span> <span class="n">ebsd</span><span class="p">(</span>
</span><span id="L-3525"><a href="#L-3525"><span class="linenos">3525</span></a>            <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-3526"><a href="#L-3526"><span class="linenos">3526</span></a>            <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="L-3527"><a href="#L-3527"><span class="linenos">3527</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-3528"><a href="#L-3528"><span class="linenos">3528</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-3529"><a href="#L-3529"><span class="linenos">3529</span></a>        <span class="p">)</span>
</span><span id="L-3530"><a href="#L-3530"><span class="linenos">3530</span></a>    <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="o">.</span><span class="n">EDS</span><span class="p">:</span>
</span><span id="L-3531"><a href="#L-3531"><span class="linenos">3531</span></a>        <span class="n">operation_settings</span> <span class="o">=</span> <span class="n">eds</span><span class="p">(</span>
</span><span id="L-3532"><a href="#L-3532"><span class="linenos">3532</span></a>            <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-3533"><a href="#L-3533"><span class="linenos">3533</span></a>            <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="L-3534"><a href="#L-3534"><span class="linenos">3534</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-3535"><a href="#L-3535"><span class="linenos">3535</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-3536"><a href="#L-3536"><span class="linenos">3536</span></a>        <span class="p">)</span>
</span><span id="L-3537"><a href="#L-3537"><span class="linenos">3537</span></a>    <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">:</span>
</span><span id="L-3538"><a href="#L-3538"><span class="linenos">3538</span></a>        <span class="n">operation_settings</span> <span class="o">=</span> <span class="n">image</span><span class="p">(</span>
</span><span id="L-3539"><a href="#L-3539"><span class="linenos">3539</span></a>            <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-3540"><a href="#L-3540"><span class="linenos">3540</span></a>            <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="L-3541"><a href="#L-3541"><span class="linenos">3541</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-3542"><a href="#L-3542"><span class="linenos">3542</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-3543"><a href="#L-3543"><span class="linenos">3543</span></a>        <span class="p">)</span>
</span><span id="L-3544"><a href="#L-3544"><span class="linenos">3544</span></a>    <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="o">.</span><span class="n">LASER</span><span class="p">:</span>
</span><span id="L-3545"><a href="#L-3545"><span class="linenos">3545</span></a>        <span class="n">operation_settings</span> <span class="o">=</span> <span class="n">laser</span><span class="p">(</span>
</span><span id="L-3546"><a href="#L-3546"><span class="linenos">3546</span></a>            <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-3547"><a href="#L-3547"><span class="linenos">3547</span></a>            <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="L-3548"><a href="#L-3548"><span class="linenos">3548</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-3549"><a href="#L-3549"><span class="linenos">3549</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-3550"><a href="#L-3550"><span class="linenos">3550</span></a>        <span class="p">)</span>
</span><span id="L-3551"><a href="#L-3551"><span class="linenos">3551</span></a>    <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="o">.</span><span class="n">CUSTOM</span><span class="p">:</span>
</span><span id="L-3552"><a href="#L-3552"><span class="linenos">3552</span></a>        <span class="n">operation_settings</span> <span class="o">=</span> <span class="n">custom</span><span class="p">(</span>
</span><span id="L-3553"><a href="#L-3553"><span class="linenos">3553</span></a>            <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-3554"><a href="#L-3554"><span class="linenos">3554</span></a>            <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="L-3555"><a href="#L-3555"><span class="linenos">3555</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-3556"><a href="#L-3556"><span class="linenos">3556</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-3557"><a href="#L-3557"><span class="linenos">3557</span></a>        <span class="p">)</span>
</span><span id="L-3558"><a href="#L-3558"><span class="linenos">3558</span></a>    <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="o">.</span><span class="n">FIB</span><span class="p">:</span>
</span><span id="L-3559"><a href="#L-3559"><span class="linenos">3559</span></a>        <span class="n">operation_settings</span> <span class="o">=</span> <span class="n">fib</span><span class="p">(</span>
</span><span id="L-3560"><a href="#L-3560"><span class="linenos">3560</span></a>            <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="L-3561"><a href="#L-3561"><span class="linenos">3561</span></a>            <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="L-3562"><a href="#L-3562"><span class="linenos">3562</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-3563"><a href="#L-3563"><span class="linenos">3563</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="L-3564"><a href="#L-3564"><span class="linenos">3564</span></a>        <span class="p">)</span>
</span><span id="L-3565"><a href="#L-3565"><span class="linenos">3565</span></a>
</span><span id="L-3566"><a href="#L-3566"><span class="linenos">3566</span></a>    <span class="n">step_object</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Step</span><span class="p">(</span>
</span><span id="L-3567"><a href="#L-3567"><span class="linenos">3567</span></a>        <span class="nb">type</span><span class="o">=</span><span class="n">step_type</span><span class="p">,</span>
</span><span id="L-3568"><a href="#L-3568"><span class="linenos">3568</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="L-3569"><a href="#L-3569"><span class="linenos">3569</span></a>        <span class="n">number</span><span class="o">=</span><span class="n">step_number</span><span class="p">,</span>
</span><span id="L-3570"><a href="#L-3570"><span class="linenos">3570</span></a>        <span class="n">frequency</span><span class="o">=</span><span class="n">step_frequency</span><span class="p">,</span>
</span><span id="L-3571"><a href="#L-3571"><span class="linenos">3571</span></a>        <span class="n">stage</span><span class="o">=</span><span class="n">stage_settings</span><span class="p">,</span>
</span><span id="L-3572"><a href="#L-3572"><span class="linenos">3572</span></a>        <span class="n">operation_settings</span><span class="o">=</span><span class="n">operation_settings</span><span class="p">,</span>
</span><span id="L-3573"><a href="#L-3573"><span class="linenos">3573</span></a>    <span class="p">)</span>
</span><span id="L-3574"><a href="#L-3574"><span class="linenos">3574</span></a>
</span><span id="L-3575"><a href="#L-3575"><span class="linenos">3575</span></a>    <span class="k">return</span> <span class="n">step_object</span>
</span></pre></div>


            </section>
                <section id="active_fib_applications">
                            <input id="active_fib_applications-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">active_fib_applications</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span></span><span class="return-annotation">) -> <span class="nb">list</span>:</span></span>

                <label class="view-source-button" for="active_fib_applications-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#active_fib_applications"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="active_fib_applications-176"><a href="#active_fib_applications-176"><span class="linenos">176</span></a><span class="k">def</span> <span class="nf">active_fib_applications</span><span class="p">(</span>
</span><span id="active_fib_applications-177"><a href="#active_fib_applications-177"><span class="linenos">177</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="active_fib_applications-178"><a href="#active_fib_applications-178"><span class="linenos">178</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="active_fib_applications-179"><a href="#active_fib_applications-179"><span class="linenos">179</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="active_fib_applications-180"><a href="#active_fib_applications-180"><span class="linenos">180</span></a><span class="sd">    Retrieve a list of all active FIB (Focused Ion Beam) patterning application files from the microscope.</span>
</span><span id="active_fib_applications-181"><a href="#active_fib_applications-181"><span class="linenos">181</span></a>
</span><span id="active_fib_applications-182"><a href="#active_fib_applications-182"><span class="linenos">182</span></a><span class="sd">    Parameters</span>
</span><span id="active_fib_applications-183"><a href="#active_fib_applications-183"><span class="linenos">183</span></a><span class="sd">    ----------</span>
</span><span id="active_fib_applications-184"><a href="#active_fib_applications-184"><span class="linenos">184</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="active_fib_applications-185"><a href="#active_fib_applications-185"><span class="linenos">185</span></a><span class="sd">        The microscope object from which to retrieve the application files.</span>
</span><span id="active_fib_applications-186"><a href="#active_fib_applications-186"><span class="linenos">186</span></a>
</span><span id="active_fib_applications-187"><a href="#active_fib_applications-187"><span class="linenos">187</span></a><span class="sd">    Returns</span>
</span><span id="active_fib_applications-188"><a href="#active_fib_applications-188"><span class="linenos">188</span></a><span class="sd">    -------</span>
</span><span id="active_fib_applications-189"><a href="#active_fib_applications-189"><span class="linenos">189</span></a><span class="sd">    list</span>
</span><span id="active_fib_applications-190"><a href="#active_fib_applications-190"><span class="linenos">190</span></a><span class="sd">        A list of active FIB patterning application files.</span>
</span><span id="active_fib_applications-191"><a href="#active_fib_applications-191"><span class="linenos">191</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="active_fib_applications-192"><a href="#active_fib_applications-192"><span class="linenos">192</span></a>    <span class="k">return</span> <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">list_all_application_files</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve a list of all active FIB (Focused Ion Beam) patterning application files from the microscope.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object from which to retrieve the application files.</p>

<h2 id="returns">Returns</h2>

<p>list
    A list of active FIB patterning application files.</p>
</div>


                </section>
                <section id="active_beam_with_settings">
                            <input id="active_beam_with_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">active_beam_with_settings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#Beam">pytribeam.types.Beam</a></span>:</span></span>

                <label class="view-source-button" for="active_beam_with_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#active_beam_with_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="active_beam_with_settings-195"><a href="#active_beam_with_settings-195"><span class="linenos">195</span></a><span class="k">def</span> <span class="nf">active_beam_with_settings</span><span class="p">(</span>
</span><span id="active_beam_with_settings-196"><a href="#active_beam_with_settings-196"><span class="linenos">196</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="active_beam_with_settings-197"><a href="#active_beam_with_settings-197"><span class="linenos">197</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Beam</span><span class="p">:</span>
</span><span id="active_beam_with_settings-198"><a href="#active_beam_with_settings-198"><span class="linenos">198</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="active_beam_with_settings-199"><a href="#active_beam_with_settings-199"><span class="linenos">199</span></a><span class="sd">    Retrieve the current active beam and its settings from the microscope to create a beam object.</span>
</span><span id="active_beam_with_settings-200"><a href="#active_beam_with_settings-200"><span class="linenos">200</span></a>
</span><span id="active_beam_with_settings-201"><a href="#active_beam_with_settings-201"><span class="linenos">201</span></a><span class="sd">    This function grabs the current beam and its settings on the microscope to make a beam object. These settings fully depend on the currently active beam as determined by xTUI. Tolerance values for voltage and current are auto-populated as a ratio of current values predetermined in the `Constants` class.</span>
</span><span id="active_beam_with_settings-202"><a href="#active_beam_with_settings-202"><span class="linenos">202</span></a>
</span><span id="active_beam_with_settings-203"><a href="#active_beam_with_settings-203"><span class="linenos">203</span></a><span class="sd">    Parameters</span>
</span><span id="active_beam_with_settings-204"><a href="#active_beam_with_settings-204"><span class="linenos">204</span></a><span class="sd">    ----------</span>
</span><span id="active_beam_with_settings-205"><a href="#active_beam_with_settings-205"><span class="linenos">205</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="active_beam_with_settings-206"><a href="#active_beam_with_settings-206"><span class="linenos">206</span></a><span class="sd">        The microscope object from which to retrieve the active beam and its settings.</span>
</span><span id="active_beam_with_settings-207"><a href="#active_beam_with_settings-207"><span class="linenos">207</span></a>
</span><span id="active_beam_with_settings-208"><a href="#active_beam_with_settings-208"><span class="linenos">208</span></a><span class="sd">    Returns</span>
</span><span id="active_beam_with_settings-209"><a href="#active_beam_with_settings-209"><span class="linenos">209</span></a><span class="sd">    -------</span>
</span><span id="active_beam_with_settings-210"><a href="#active_beam_with_settings-210"><span class="linenos">210</span></a><span class="sd">    tbt.Beam</span>
</span><span id="active_beam_with_settings-211"><a href="#active_beam_with_settings-211"><span class="linenos">211</span></a><span class="sd">        The active beam object with its settings.</span>
</span><span id="active_beam_with_settings-212"><a href="#active_beam_with_settings-212"><span class="linenos">212</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="active_beam_with_settings-213"><a href="#active_beam_with_settings-213"><span class="linenos">213</span></a>    <span class="n">selected_beam</span> <span class="o">=</span> <span class="n">active_imaging_device</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="active_beam_with_settings-214"><a href="#active_beam_with_settings-214"><span class="linenos">214</span></a>    <span class="n">beam</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">beam_type</span><span class="p">(</span><span class="n">selected_beam</span><span class="p">,</span> <span class="n">microscope</span><span class="p">)</span>
</span><span id="active_beam_with_settings-215"><a href="#active_beam_with_settings-215"><span class="linenos">215</span></a>
</span><span id="active_beam_with_settings-216"><a href="#active_beam_with_settings-216"><span class="linenos">216</span></a>    <span class="n">voltage_kv</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">high_voltage</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">V_TO_KV</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="active_beam_with_settings-217"><a href="#active_beam_with_settings-217"><span class="linenos">217</span></a>    <span class="n">voltage_tol_kv</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">voltage_kv</span> <span class="o">*</span> <span class="n">Constants</span><span class="o">.</span><span class="n">voltage_tol_ratio</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="active_beam_with_settings-218"><a href="#active_beam_with_settings-218"><span class="linenos">218</span></a>
</span><span id="active_beam_with_settings-219"><a href="#active_beam_with_settings-219"><span class="linenos">219</span></a>    <span class="n">current_na</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">beam_current</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">A_TO_NA</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="active_beam_with_settings-220"><a href="#active_beam_with_settings-220"><span class="linenos">220</span></a>    <span class="n">current_tol_na</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">current_na</span> <span class="o">*</span> <span class="n">Constants</span><span class="o">.</span><span class="n">current_tol_ratio</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="active_beam_with_settings-221"><a href="#active_beam_with_settings-221"><span class="linenos">221</span></a>
</span><span id="active_beam_with_settings-222"><a href="#active_beam_with_settings-222"><span class="linenos">222</span></a>    <span class="n">hfw_mm</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">horizontal_field_width</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="active_beam_with_settings-223"><a href="#active_beam_with_settings-223"><span class="linenos">223</span></a>
</span><span id="active_beam_with_settings-224"><a href="#active_beam_with_settings-224"><span class="linenos">224</span></a>    <span class="n">working_dist_mm</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">working_distance</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="active_beam_with_settings-225"><a href="#active_beam_with_settings-225"><span class="linenos">225</span></a>
</span><span id="active_beam_with_settings-226"><a href="#active_beam_with_settings-226"><span class="linenos">226</span></a>    <span class="n">active_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">(</span>
</span><span id="active_beam_with_settings-227"><a href="#active_beam_with_settings-227"><span class="linenos">227</span></a>        <span class="n">voltage_kv</span><span class="o">=</span><span class="n">voltage_kv</span><span class="p">,</span>
</span><span id="active_beam_with_settings-228"><a href="#active_beam_with_settings-228"><span class="linenos">228</span></a>        <span class="n">current_na</span><span class="o">=</span><span class="n">current_na</span><span class="p">,</span>
</span><span id="active_beam_with_settings-229"><a href="#active_beam_with_settings-229"><span class="linenos">229</span></a>        <span class="n">hfw_mm</span><span class="o">=</span><span class="n">hfw_mm</span><span class="p">,</span>
</span><span id="active_beam_with_settings-230"><a href="#active_beam_with_settings-230"><span class="linenos">230</span></a>        <span class="n">working_dist_mm</span><span class="o">=</span><span class="n">working_dist_mm</span><span class="p">,</span>
</span><span id="active_beam_with_settings-231"><a href="#active_beam_with_settings-231"><span class="linenos">231</span></a>        <span class="n">voltage_tol_kv</span><span class="o">=</span><span class="n">voltage_tol_kv</span><span class="p">,</span>
</span><span id="active_beam_with_settings-232"><a href="#active_beam_with_settings-232"><span class="linenos">232</span></a>        <span class="n">current_tol_na</span><span class="o">=</span><span class="n">current_tol_na</span><span class="p">,</span>
</span><span id="active_beam_with_settings-233"><a href="#active_beam_with_settings-233"><span class="linenos">233</span></a>    <span class="p">)</span>
</span><span id="active_beam_with_settings-234"><a href="#active_beam_with_settings-234"><span class="linenos">234</span></a>
</span><span id="active_beam_with_settings-235"><a href="#active_beam_with_settings-235"><span class="linenos">235</span></a>    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">selected_beam</span><span class="p">)(</span><span class="n">settings</span><span class="o">=</span><span class="n">active_settings</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the current active beam and its settings from the microscope to create a beam object.</p>

<p>This function grabs the current beam and its settings on the microscope to make a beam object. These settings fully depend on the currently active beam as determined by xTUI. Tolerance values for voltage and current are auto-populated as a ratio of current values predetermined in the <code>Constants</code> class.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object from which to retrieve the active beam and its settings.</p>

<h2 id="returns">Returns</h2>

<p>tbt.Beam
    The active beam object with its settings.</p>
</div>


                </section>
                <section id="active_detector_settings">
                            <input id="active_detector_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">active_detector_settings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#Detector">pytribeam.types.Detector</a></span>:</span></span>

                <label class="view-source-button" for="active_detector_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#active_detector_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="active_detector_settings-238"><a href="#active_detector_settings-238"><span class="linenos">238</span></a><span class="k">def</span> <span class="nf">active_detector_settings</span><span class="p">(</span>
</span><span id="active_detector_settings-239"><a href="#active_detector_settings-239"><span class="linenos">239</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="active_detector_settings-240"><a href="#active_detector_settings-240"><span class="linenos">240</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Detector</span><span class="p">:</span>
</span><span id="active_detector_settings-241"><a href="#active_detector_settings-241"><span class="linenos">241</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="active_detector_settings-242"><a href="#active_detector_settings-242"><span class="linenos">242</span></a><span class="sd">    Retrieve the current active detector settings from the microscope to create a detector object.</span>
</span><span id="active_detector_settings-243"><a href="#active_detector_settings-243"><span class="linenos">243</span></a>
</span><span id="active_detector_settings-244"><a href="#active_detector_settings-244"><span class="linenos">244</span></a><span class="sd">    This function grabs the current detector settings on the microscope to make a detector object. These settings fully depend on the currently active detector as determined by xTUI.</span>
</span><span id="active_detector_settings-245"><a href="#active_detector_settings-245"><span class="linenos">245</span></a>
</span><span id="active_detector_settings-246"><a href="#active_detector_settings-246"><span class="linenos">246</span></a><span class="sd">    Parameters</span>
</span><span id="active_detector_settings-247"><a href="#active_detector_settings-247"><span class="linenos">247</span></a><span class="sd">    ----------</span>
</span><span id="active_detector_settings-248"><a href="#active_detector_settings-248"><span class="linenos">248</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="active_detector_settings-249"><a href="#active_detector_settings-249"><span class="linenos">249</span></a><span class="sd">        The microscope object from which to retrieve the active detector settings.</span>
</span><span id="active_detector_settings-250"><a href="#active_detector_settings-250"><span class="linenos">250</span></a>
</span><span id="active_detector_settings-251"><a href="#active_detector_settings-251"><span class="linenos">251</span></a><span class="sd">    Returns</span>
</span><span id="active_detector_settings-252"><a href="#active_detector_settings-252"><span class="linenos">252</span></a><span class="sd">    -------</span>
</span><span id="active_detector_settings-253"><a href="#active_detector_settings-253"><span class="linenos">253</span></a><span class="sd">    tbt.Detector</span>
</span><span id="active_detector_settings-254"><a href="#active_detector_settings-254"><span class="linenos">254</span></a><span class="sd">        The active detector object with its settings.</span>
</span><span id="active_detector_settings-255"><a href="#active_detector_settings-255"><span class="linenos">255</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="active_detector_settings-256"><a href="#active_detector_settings-256"><span class="linenos">256</span></a>
</span><span id="active_detector_settings-257"><a href="#active_detector_settings-257"><span class="linenos">257</span></a>    <span class="n">detector_type</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span>
</span><span id="active_detector_settings-258"><a href="#active_detector_settings-258"><span class="linenos">258</span></a>    <span class="n">detector_mode</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">value</span>
</span><span id="active_detector_settings-259"><a href="#active_detector_settings-259"><span class="linenos">259</span></a>    <span class="n">brightness</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">brightness</span><span class="o">.</span><span class="n">value</span>
</span><span id="active_detector_settings-260"><a href="#active_detector_settings-260"><span class="linenos">260</span></a>    <span class="n">contrast</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">contrast</span><span class="o">.</span><span class="n">value</span>
</span><span id="active_detector_settings-261"><a href="#active_detector_settings-261"><span class="linenos">261</span></a>    <span class="n">auto_cb_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ScanArea</span><span class="p">(</span>
</span><span id="active_detector_settings-262"><a href="#active_detector_settings-262"><span class="linenos">262</span></a>        <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="active_detector_settings-263"><a href="#active_detector_settings-263"><span class="linenos">263</span></a>        <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="active_detector_settings-264"><a href="#active_detector_settings-264"><span class="linenos">264</span></a>        <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="active_detector_settings-265"><a href="#active_detector_settings-265"><span class="linenos">265</span></a>        <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="active_detector_settings-266"><a href="#active_detector_settings-266"><span class="linenos">266</span></a>    <span class="p">)</span>
</span><span id="active_detector_settings-267"><a href="#active_detector_settings-267"><span class="linenos">267</span></a>    <span class="n">custom_settings</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="active_detector_settings-268"><a href="#active_detector_settings-268"><span class="linenos">268</span></a>
</span><span id="active_detector_settings-269"><a href="#active_detector_settings-269"><span class="linenos">269</span></a>    <span class="n">active_detector</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Detector</span><span class="p">(</span>
</span><span id="active_detector_settings-270"><a href="#active_detector_settings-270"><span class="linenos">270</span></a>        <span class="nb">type</span><span class="o">=</span><span class="n">detector_type</span><span class="p">,</span>
</span><span id="active_detector_settings-271"><a href="#active_detector_settings-271"><span class="linenos">271</span></a>        <span class="n">mode</span><span class="o">=</span><span class="n">detector_mode</span><span class="p">,</span>
</span><span id="active_detector_settings-272"><a href="#active_detector_settings-272"><span class="linenos">272</span></a>        <span class="n">brightness</span><span class="o">=</span><span class="n">brightness</span><span class="p">,</span>
</span><span id="active_detector_settings-273"><a href="#active_detector_settings-273"><span class="linenos">273</span></a>        <span class="n">contrast</span><span class="o">=</span><span class="n">contrast</span><span class="p">,</span>
</span><span id="active_detector_settings-274"><a href="#active_detector_settings-274"><span class="linenos">274</span></a>        <span class="n">auto_cb_settings</span><span class="o">=</span><span class="n">auto_cb_settings</span><span class="p">,</span>
</span><span id="active_detector_settings-275"><a href="#active_detector_settings-275"><span class="linenos">275</span></a>        <span class="n">custom_settings</span><span class="o">=</span><span class="n">custom_settings</span><span class="p">,</span>
</span><span id="active_detector_settings-276"><a href="#active_detector_settings-276"><span class="linenos">276</span></a>    <span class="p">)</span>
</span><span id="active_detector_settings-277"><a href="#active_detector_settings-277"><span class="linenos">277</span></a>
</span><span id="active_detector_settings-278"><a href="#active_detector_settings-278"><span class="linenos">278</span></a>    <span class="k">return</span> <span class="n">active_detector</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the current active detector settings from the microscope to create a detector object.</p>

<p>This function grabs the current detector settings on the microscope to make a detector object. These settings fully depend on the currently active detector as determined by xTUI.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object from which to retrieve the active detector settings.</p>

<h2 id="returns">Returns</h2>

<p>tbt.Detector
    The active detector object with its settings.</p>
</div>


                </section>
                <section id="active_image_settings">
                            <input id="active_image_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">active_image_settings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#ImageSettings">pytribeam.types.ImageSettings</a></span>:</span></span>

                <label class="view-source-button" for="active_image_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#active_image_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="active_image_settings-281"><a href="#active_image_settings-281"><span class="linenos">281</span></a><span class="k">def</span> <span class="nf">active_image_settings</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ImageSettings</span><span class="p">:</span>
</span><span id="active_image_settings-282"><a href="#active_image_settings-282"><span class="linenos">282</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="active_image_settings-283"><a href="#active_image_settings-283"><span class="linenos">283</span></a><span class="sd">    Retrieve the current active image settings from the microscope to create an image settings object.</span>
</span><span id="active_image_settings-284"><a href="#active_image_settings-284"><span class="linenos">284</span></a>
</span><span id="active_image_settings-285"><a href="#active_image_settings-285"><span class="linenos">285</span></a><span class="sd">    This function grabs the current beam, detector, and scan settings on the microscope to make an image settings object. The bit depth is set to the default color depth defined in the `Constants` class.</span>
</span><span id="active_image_settings-286"><a href="#active_image_settings-286"><span class="linenos">286</span></a>
</span><span id="active_image_settings-287"><a href="#active_image_settings-287"><span class="linenos">287</span></a><span class="sd">    Parameters</span>
</span><span id="active_image_settings-288"><a href="#active_image_settings-288"><span class="linenos">288</span></a><span class="sd">    ----------</span>
</span><span id="active_image_settings-289"><a href="#active_image_settings-289"><span class="linenos">289</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="active_image_settings-290"><a href="#active_image_settings-290"><span class="linenos">290</span></a><span class="sd">        The microscope object from which to retrieve the active image settings.</span>
</span><span id="active_image_settings-291"><a href="#active_image_settings-291"><span class="linenos">291</span></a>
</span><span id="active_image_settings-292"><a href="#active_image_settings-292"><span class="linenos">292</span></a><span class="sd">    Returns</span>
</span><span id="active_image_settings-293"><a href="#active_image_settings-293"><span class="linenos">293</span></a><span class="sd">    -------</span>
</span><span id="active_image_settings-294"><a href="#active_image_settings-294"><span class="linenos">294</span></a><span class="sd">    tbt.ImageSettings</span>
</span><span id="active_image_settings-295"><a href="#active_image_settings-295"><span class="linenos">295</span></a><span class="sd">        The active image settings object.</span>
</span><span id="active_image_settings-296"><a href="#active_image_settings-296"><span class="linenos">296</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="active_image_settings-297"><a href="#active_image_settings-297"><span class="linenos">297</span></a>    <span class="n">beam</span> <span class="o">=</span> <span class="n">active_beam_with_settings</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="active_image_settings-298"><a href="#active_image_settings-298"><span class="linenos">298</span></a>    <span class="n">detector</span> <span class="o">=</span> <span class="n">active_detector_settings</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="active_image_settings-299"><a href="#active_image_settings-299"><span class="linenos">299</span></a>    <span class="n">scan</span> <span class="o">=</span> <span class="n">active_scan_settings</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="active_image_settings-300"><a href="#active_image_settings-300"><span class="linenos">300</span></a>    <span class="n">bit_depth</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">default_color_depth</span>
</span><span id="active_image_settings-301"><a href="#active_image_settings-301"><span class="linenos">301</span></a>
</span><span id="active_image_settings-302"><a href="#active_image_settings-302"><span class="linenos">302</span></a>    <span class="n">active_image_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ImageSettings</span><span class="p">(</span>
</span><span id="active_image_settings-303"><a href="#active_image_settings-303"><span class="linenos">303</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="active_image_settings-304"><a href="#active_image_settings-304"><span class="linenos">304</span></a>        <span class="n">beam</span><span class="o">=</span><span class="n">beam</span><span class="p">,</span>
</span><span id="active_image_settings-305"><a href="#active_image_settings-305"><span class="linenos">305</span></a>        <span class="n">detector</span><span class="o">=</span><span class="n">detector</span><span class="p">,</span>
</span><span id="active_image_settings-306"><a href="#active_image_settings-306"><span class="linenos">306</span></a>        <span class="n">scan</span><span class="o">=</span><span class="n">scan</span><span class="p">,</span>
</span><span id="active_image_settings-307"><a href="#active_image_settings-307"><span class="linenos">307</span></a>        <span class="n">bit_depth</span><span class="o">=</span><span class="n">bit_depth</span><span class="p">,</span>
</span><span id="active_image_settings-308"><a href="#active_image_settings-308"><span class="linenos">308</span></a>    <span class="p">)</span>
</span><span id="active_image_settings-309"><a href="#active_image_settings-309"><span class="linenos">309</span></a>
</span><span id="active_image_settings-310"><a href="#active_image_settings-310"><span class="linenos">310</span></a>    <span class="k">return</span> <span class="n">active_image_settings</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the current active image settings from the microscope to create an image settings object.</p>

<p>This function grabs the current beam, detector, and scan settings on the microscope to make an image settings object. The bit depth is set to the default color depth defined in the <code>Constants</code> class.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object from which to retrieve the active image settings.</p>

<h2 id="returns">Returns</h2>

<p>tbt.ImageSettings
    The active image settings object.</p>
</div>


                </section>
                <section id="active_imaging_device">
                            <input id="active_imaging_device-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">active_imaging_device</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#Beam">pytribeam.types.Beam</a></span>:</span></span>

                <label class="view-source-button" for="active_imaging_device-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#active_imaging_device"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="active_imaging_device-313"><a href="#active_imaging_device-313"><span class="linenos">313</span></a><span class="k">def</span> <span class="nf">active_imaging_device</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Beam</span><span class="p">:</span>
</span><span id="active_imaging_device-314"><a href="#active_imaging_device-314"><span class="linenos">314</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="active_imaging_device-315"><a href="#active_imaging_device-315"><span class="linenos">315</span></a><span class="sd">    Determine the active imaging device and return the corresponding internal beam type object with null beam settings.</span>
</span><span id="active_imaging_device-316"><a href="#active_imaging_device-316"><span class="linenos">316</span></a>
</span><span id="active_imaging_device-317"><a href="#active_imaging_device-317"><span class="linenos">317</span></a><span class="sd">    This function identifies the currently active imaging device on the microscope and returns the appropriate beam type object (electron or ion) with null beam settings.</span>
</span><span id="active_imaging_device-318"><a href="#active_imaging_device-318"><span class="linenos">318</span></a>
</span><span id="active_imaging_device-319"><a href="#active_imaging_device-319"><span class="linenos">319</span></a><span class="sd">    Parameters</span>
</span><span id="active_imaging_device-320"><a href="#active_imaging_device-320"><span class="linenos">320</span></a><span class="sd">    ----------</span>
</span><span id="active_imaging_device-321"><a href="#active_imaging_device-321"><span class="linenos">321</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="active_imaging_device-322"><a href="#active_imaging_device-322"><span class="linenos">322</span></a><span class="sd">        The microscope object from which to determine the active imaging device.</span>
</span><span id="active_imaging_device-323"><a href="#active_imaging_device-323"><span class="linenos">323</span></a>
</span><span id="active_imaging_device-324"><a href="#active_imaging_device-324"><span class="linenos">324</span></a><span class="sd">    Returns</span>
</span><span id="active_imaging_device-325"><a href="#active_imaging_device-325"><span class="linenos">325</span></a><span class="sd">    -------</span>
</span><span id="active_imaging_device-326"><a href="#active_imaging_device-326"><span class="linenos">326</span></a><span class="sd">    tbt.Beam</span>
</span><span id="active_imaging_device-327"><a href="#active_imaging_device-327"><span class="linenos">327</span></a><span class="sd">        The active beam object with null beam settings.</span>
</span><span id="active_imaging_device-328"><a href="#active_imaging_device-328"><span class="linenos">328</span></a>
</span><span id="active_imaging_device-329"><a href="#active_imaging_device-329"><span class="linenos">329</span></a><span class="sd">    Raises</span>
</span><span id="active_imaging_device-330"><a href="#active_imaging_device-330"><span class="linenos">330</span></a><span class="sd">    ------</span>
</span><span id="active_imaging_device-331"><a href="#active_imaging_device-331"><span class="linenos">331</span></a><span class="sd">    ValueError</span>
</span><span id="active_imaging_device-332"><a href="#active_imaging_device-332"><span class="linenos">332</span></a><span class="sd">        If the currently selected device is neither an electron beam nor an ion beam.</span>
</span><span id="active_imaging_device-333"><a href="#active_imaging_device-333"><span class="linenos">333</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="active_imaging_device-334"><a href="#active_imaging_device-334"><span class="linenos">334</span></a>    <span class="n">curr_device</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span><span class="n">microscope</span><span class="o">.</span><span class="n">imaging</span><span class="o">.</span><span class="n">get_active_device</span><span class="p">())</span>
</span><span id="active_imaging_device-335"><a href="#active_imaging_device-335"><span class="linenos">335</span></a>    <span class="k">if</span> <span class="n">curr_device</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Device</span><span class="o">.</span><span class="n">ELECTRON_BEAM</span><span class="p">:</span>
</span><span id="active_imaging_device-336"><a href="#active_imaging_device-336"><span class="linenos">336</span></a>        <span class="n">selected_beam</span> <span class="o">=</span> <span class="n">beam_object_type</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">)(</span>
</span><span id="active_imaging_device-337"><a href="#active_imaging_device-337"><span class="linenos">337</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">()</span>
</span><span id="active_imaging_device-338"><a href="#active_imaging_device-338"><span class="linenos">338</span></a>        <span class="p">)</span>
</span><span id="active_imaging_device-339"><a href="#active_imaging_device-339"><span class="linenos">339</span></a>    <span class="k">elif</span> <span class="n">curr_device</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Device</span><span class="o">.</span><span class="n">ION_BEAM</span><span class="p">:</span>
</span><span id="active_imaging_device-340"><a href="#active_imaging_device-340"><span class="linenos">340</span></a>        <span class="n">selected_beam</span> <span class="o">=</span> <span class="n">beam_object_type</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">)(</span>
</span><span id="active_imaging_device-341"><a href="#active_imaging_device-341"><span class="linenos">341</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">()</span>
</span><span id="active_imaging_device-342"><a href="#active_imaging_device-342"><span class="linenos">342</span></a>        <span class="p">)</span>
</span><span id="active_imaging_device-343"><a href="#active_imaging_device-343"><span class="linenos">343</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="active_imaging_device-344"><a href="#active_imaging_device-344"><span class="linenos">344</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="active_imaging_device-345"><a href="#active_imaging_device-345"><span class="linenos">345</span></a>            <span class="sa">f</span><span class="s2">&quot;Currently selected device </span><span class="si">{</span><span class="n">curr_device</span><span class="si">}</span><span class="s2">, make sure a quadrant in xTUI with either an Electron beam or Ion beam active is selected.&quot;</span>
</span><span id="active_imaging_device-346"><a href="#active_imaging_device-346"><span class="linenos">346</span></a>        <span class="p">)</span>
</span><span id="active_imaging_device-347"><a href="#active_imaging_device-347"><span class="linenos">347</span></a>    <span class="k">return</span> <span class="n">selected_beam</span>
</span></pre></div>


            <div class="docstring"><p>Determine the active imaging device and return the corresponding internal beam type object with null beam settings.</p>

<p>This function identifies the currently active imaging device on the microscope and returns the appropriate beam type object (electron or ion) with null beam settings.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object from which to determine the active imaging device.</p>

<h2 id="returns">Returns</h2>

<p>tbt.Beam
    The active beam object with null beam settings.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the currently selected device is neither an electron beam nor an ion beam.</p>
</div>


                </section>
                <section id="active_scan_settings">
                            <input id="active_scan_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">active_scan_settings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#Scan">pytribeam.types.Scan</a></span>:</span></span>

                <label class="view-source-button" for="active_scan_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#active_scan_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="active_scan_settings-350"><a href="#active_scan_settings-350"><span class="linenos">350</span></a><span class="k">def</span> <span class="nf">active_scan_settings</span><span class="p">(</span>
</span><span id="active_scan_settings-351"><a href="#active_scan_settings-351"><span class="linenos">351</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="active_scan_settings-352"><a href="#active_scan_settings-352"><span class="linenos">352</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Scan</span><span class="p">:</span>
</span><span id="active_scan_settings-353"><a href="#active_scan_settings-353"><span class="linenos">353</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="active_scan_settings-354"><a href="#active_scan_settings-354"><span class="linenos">354</span></a><span class="sd">    Retrieve the current active scan settings from the microscope to create a scan object.</span>
</span><span id="active_scan_settings-355"><a href="#active_scan_settings-355"><span class="linenos">355</span></a>
</span><span id="active_scan_settings-356"><a href="#active_scan_settings-356"><span class="linenos">356</span></a><span class="sd">    This function grabs the current scan settings on the microscope to make a scan object. These settings fully depend on the currently active scan settings as determined by xTUI.</span>
</span><span id="active_scan_settings-357"><a href="#active_scan_settings-357"><span class="linenos">357</span></a>
</span><span id="active_scan_settings-358"><a href="#active_scan_settings-358"><span class="linenos">358</span></a><span class="sd">    Parameters</span>
</span><span id="active_scan_settings-359"><a href="#active_scan_settings-359"><span class="linenos">359</span></a><span class="sd">    ----------</span>
</span><span id="active_scan_settings-360"><a href="#active_scan_settings-360"><span class="linenos">360</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="active_scan_settings-361"><a href="#active_scan_settings-361"><span class="linenos">361</span></a><span class="sd">        The microscope object from which to retrieve the active scan settings.</span>
</span><span id="active_scan_settings-362"><a href="#active_scan_settings-362"><span class="linenos">362</span></a>
</span><span id="active_scan_settings-363"><a href="#active_scan_settings-363"><span class="linenos">363</span></a><span class="sd">    Returns</span>
</span><span id="active_scan_settings-364"><a href="#active_scan_settings-364"><span class="linenos">364</span></a><span class="sd">    -------</span>
</span><span id="active_scan_settings-365"><a href="#active_scan_settings-365"><span class="linenos">365</span></a><span class="sd">    tbt.Scan</span>
</span><span id="active_scan_settings-366"><a href="#active_scan_settings-366"><span class="linenos">366</span></a><span class="sd">        The active scan object with its settings.</span>
</span><span id="active_scan_settings-367"><a href="#active_scan_settings-367"><span class="linenos">367</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="active_scan_settings-368"><a href="#active_scan_settings-368"><span class="linenos">368</span></a>    <span class="n">selected_beam</span> <span class="o">=</span> <span class="n">active_imaging_device</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="active_scan_settings-369"><a href="#active_scan_settings-369"><span class="linenos">369</span></a>    <span class="n">beam</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">beam_type</span><span class="p">(</span><span class="n">selected_beam</span><span class="p">,</span> <span class="n">microscope</span><span class="p">)</span>
</span><span id="active_scan_settings-370"><a href="#active_scan_settings-370"><span class="linenos">370</span></a>
</span><span id="active_scan_settings-371"><a href="#active_scan_settings-371"><span class="linenos">371</span></a>    <span class="n">rotation_deg</span> <span class="o">=</span> <span class="n">beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">rotation</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">RAD_TO_DEG</span>
</span><span id="active_scan_settings-372"><a href="#active_scan_settings-372"><span class="linenos">372</span></a>    <span class="n">dwell_time_us</span> <span class="o">=</span> <span class="n">beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">dwell_time</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">S_TO_US</span>
</span><span id="active_scan_settings-373"><a href="#active_scan_settings-373"><span class="linenos">373</span></a>    <span class="n">current_res</span> <span class="o">=</span> <span class="n">beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">resolution</span><span class="o">.</span><span class="n">value</span>
</span><span id="active_scan_settings-374"><a href="#active_scan_settings-374"><span class="linenos">374</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">string_to_res</span><span class="p">(</span><span class="n">current_res</span><span class="p">)</span>
</span><span id="active_scan_settings-375"><a href="#active_scan_settings-375"><span class="linenos">375</span></a>    <span class="n">resolution</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">PresetResolution</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span><span id="active_scan_settings-376"><a href="#active_scan_settings-376"><span class="linenos">376</span></a>
</span><span id="active_scan_settings-377"><a href="#active_scan_settings-377"><span class="linenos">377</span></a>    <span class="n">active_scan</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Scan</span><span class="p">(</span>
</span><span id="active_scan_settings-378"><a href="#active_scan_settings-378"><span class="linenos">378</span></a>        <span class="n">rotation_deg</span><span class="o">=</span><span class="n">rotation_deg</span><span class="p">,</span>
</span><span id="active_scan_settings-379"><a href="#active_scan_settings-379"><span class="linenos">379</span></a>        <span class="n">dwell_time_us</span><span class="o">=</span><span class="n">dwell_time_us</span><span class="p">,</span>
</span><span id="active_scan_settings-380"><a href="#active_scan_settings-380"><span class="linenos">380</span></a>        <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="active_scan_settings-381"><a href="#active_scan_settings-381"><span class="linenos">381</span></a>        <span class="c1"># mode=mode,</span>
</span><span id="active_scan_settings-382"><a href="#active_scan_settings-382"><span class="linenos">382</span></a>    <span class="p">)</span>
</span><span id="active_scan_settings-383"><a href="#active_scan_settings-383"><span class="linenos">383</span></a>
</span><span id="active_scan_settings-384"><a href="#active_scan_settings-384"><span class="linenos">384</span></a>    <span class="k">return</span> <span class="n">active_scan</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the current active scan settings from the microscope to create a scan object.</p>

<p>This function grabs the current scan settings on the microscope to make a scan object. These settings fully depend on the currently active scan settings as determined by xTUI.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object from which to retrieve the active scan settings.</p>

<h2 id="returns">Returns</h2>

<p>tbt.Scan
    The active scan object with its settings.</p>
</div>


                </section>
                <section id="active_stage_position_settings">
                            <input id="active_stage_position_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">active_stage_position_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#StagePositionUser">pytribeam.types.StagePositionUser</a></span>:</span></span>

                <label class="view-source-button" for="active_stage_position_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#active_stage_position_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="active_stage_position_settings-387"><a href="#active_stage_position_settings-387"><span class="linenos">387</span></a><span class="k">def</span> <span class="nf">active_stage_position_settings</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StagePositionUser</span><span class="p">:</span>
</span><span id="active_stage_position_settings-388"><a href="#active_stage_position_settings-388"><span class="linenos">388</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="active_stage_position_settings-389"><a href="#active_stage_position_settings-389"><span class="linenos">389</span></a><span class="sd">    Retrieve the current stage position in the raw coordinate system and user units [mm, deg].</span>
</span><span id="active_stage_position_settings-390"><a href="#active_stage_position_settings-390"><span class="linenos">390</span></a>
</span><span id="active_stage_position_settings-391"><a href="#active_stage_position_settings-391"><span class="linenos">391</span></a><span class="sd">    This function sets the stage coordinate system to RAW, retrieves the current stage position in encoder units (meters and radians), converts it to user units (millimeters and degrees), and ensures the r-axis is within the axis limit.</span>
</span><span id="active_stage_position_settings-392"><a href="#active_stage_position_settings-392"><span class="linenos">392</span></a>
</span><span id="active_stage_position_settings-393"><a href="#active_stage_position_settings-393"><span class="linenos">393</span></a><span class="sd">    Parameters</span>
</span><span id="active_stage_position_settings-394"><a href="#active_stage_position_settings-394"><span class="linenos">394</span></a><span class="sd">    ----------</span>
</span><span id="active_stage_position_settings-395"><a href="#active_stage_position_settings-395"><span class="linenos">395</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="active_stage_position_settings-396"><a href="#active_stage_position_settings-396"><span class="linenos">396</span></a><span class="sd">        The microscope object from which to retrieve the current stage position.</span>
</span><span id="active_stage_position_settings-397"><a href="#active_stage_position_settings-397"><span class="linenos">397</span></a>
</span><span id="active_stage_position_settings-398"><a href="#active_stage_position_settings-398"><span class="linenos">398</span></a><span class="sd">    Returns</span>
</span><span id="active_stage_position_settings-399"><a href="#active_stage_position_settings-399"><span class="linenos">399</span></a><span class="sd">    -------</span>
</span><span id="active_stage_position_settings-400"><a href="#active_stage_position_settings-400"><span class="linenos">400</span></a><span class="sd">    tbt.StagePositionUser</span>
</span><span id="active_stage_position_settings-401"><a href="#active_stage_position_settings-401"><span class="linenos">401</span></a><span class="sd">        The current stage position in user units [mm, deg].</span>
</span><span id="active_stage_position_settings-402"><a href="#active_stage_position_settings-402"><span class="linenos">402</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="active_stage_position_settings-403"><a href="#active_stage_position_settings-403"><span class="linenos">403</span></a>    <span class="n">stage</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageCoordinateSystem</span><span class="o">.</span><span class="n">RAW</span><span class="p">)</span>
</span><span id="active_stage_position_settings-404"><a href="#active_stage_position_settings-404"><span class="linenos">404</span></a>    <span class="c1"># encoder positions (pos) are in meters and radians</span>
</span><span id="active_stage_position_settings-405"><a href="#active_stage_position_settings-405"><span class="linenos">405</span></a>    <span class="n">direct_encoder_pos</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">current_position</span>
</span><span id="active_stage_position_settings-406"><a href="#active_stage_position_settings-406"><span class="linenos">406</span></a>    <span class="n">x_m</span><span class="p">,</span> <span class="n">y_m</span><span class="p">,</span> <span class="n">z_m</span> <span class="o">=</span> <span class="n">direct_encoder_pos</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">direct_encoder_pos</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">direct_encoder_pos</span><span class="o">.</span><span class="n">z</span>
</span><span id="active_stage_position_settings-407"><a href="#active_stage_position_settings-407"><span class="linenos">407</span></a>    <span class="n">r_rad</span><span class="p">,</span> <span class="n">t_rad</span> <span class="o">=</span> <span class="n">direct_encoder_pos</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">direct_encoder_pos</span><span class="o">.</span><span class="n">t</span>
</span><span id="active_stage_position_settings-408"><a href="#active_stage_position_settings-408"><span class="linenos">408</span></a>    <span class="n">coord_system_str</span> <span class="o">=</span> <span class="n">direct_encoder_pos</span><span class="o">.</span><span class="n">coordinate_system</span>
</span><span id="active_stage_position_settings-409"><a href="#active_stage_position_settings-409"><span class="linenos">409</span></a>
</span><span id="active_stage_position_settings-410"><a href="#active_stage_position_settings-410"><span class="linenos">410</span></a>    <span class="n">encoder_pos</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StagePositionEncoder</span><span class="p">(</span>
</span><span id="active_stage_position_settings-411"><a href="#active_stage_position_settings-411"><span class="linenos">411</span></a>        <span class="n">x</span><span class="o">=</span><span class="n">x_m</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_m</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z_m</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r_rad</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t_rad</span><span class="p">,</span> <span class="n">coordinate_system</span><span class="o">=</span><span class="n">coord_system_str</span>
</span><span id="active_stage_position_settings-412"><a href="#active_stage_position_settings-412"><span class="linenos">412</span></a>    <span class="p">)</span>
</span><span id="active_stage_position_settings-413"><a href="#active_stage_position_settings-413"><span class="linenos">413</span></a>    <span class="n">user_pos</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="n">encoder_to_user_position</span><span class="p">(</span><span class="n">encoder_pos</span><span class="p">)</span>
</span><span id="active_stage_position_settings-414"><a href="#active_stage_position_settings-414"><span class="linenos">414</span></a>
</span><span id="active_stage_position_settings-415"><a href="#active_stage_position_settings-415"><span class="linenos">415</span></a>    <span class="c1"># ensure r-axis is kept in axis limit</span>
</span><span id="active_stage_position_settings-416"><a href="#active_stage_position_settings-416"><span class="linenos">416</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="active_stage_position_settings-417"><a href="#active_stage_position_settings-417"><span class="linenos">417</span></a>        <span class="n">val</span><span class="o">=</span><span class="n">user_pos</span><span class="o">.</span><span class="n">r_deg</span><span class="p">,</span>
</span><span id="active_stage_position_settings-418"><a href="#active_stage_position_settings-418"><span class="linenos">418</span></a>        <span class="n">limit</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">rotation_axis_limit_deg</span><span class="p">,</span>
</span><span id="active_stage_position_settings-419"><a href="#active_stage_position_settings-419"><span class="linenos">419</span></a>        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">RIGHT_OPEN</span><span class="p">,</span>
</span><span id="active_stage_position_settings-420"><a href="#active_stage_position_settings-420"><span class="linenos">420</span></a>    <span class="p">):</span>
</span><span id="active_stage_position_settings-421"><a href="#active_stage_position_settings-421"><span class="linenos">421</span></a>        <span class="c1"># used as right-open internal: 180.0 is not valid and should be converted to -180.0</span>
</span><span id="active_stage_position_settings-422"><a href="#active_stage_position_settings-422"><span class="linenos">422</span></a>        <span class="k">while</span> <span class="n">user_pos</span><span class="o">.</span><span class="n">r_deg</span> <span class="o">&gt;=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">rotation_axis_limit_deg</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
</span><span id="active_stage_position_settings-423"><a href="#active_stage_position_settings-423"><span class="linenos">423</span></a>            <span class="n">new_r_deg</span> <span class="o">=</span> <span class="n">user_pos</span><span class="o">.</span><span class="n">r_deg</span> <span class="o">-</span> <span class="mf">360.0</span>
</span><span id="active_stage_position_settings-424"><a href="#active_stage_position_settings-424"><span class="linenos">424</span></a>        <span class="k">while</span> <span class="n">user_pos</span><span class="o">.</span><span class="n">r_deg</span> <span class="o">&lt;</span> <span class="n">Constants</span><span class="o">.</span><span class="n">rotation_axis_limit_deg</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
</span><span id="active_stage_position_settings-425"><a href="#active_stage_position_settings-425"><span class="linenos">425</span></a>            <span class="n">new_r_deg</span> <span class="o">=</span> <span class="n">user_pos</span><span class="o">.</span><span class="n">r_deg</span> <span class="o">+</span> <span class="mf">360.0</span>
</span><span id="active_stage_position_settings-426"><a href="#active_stage_position_settings-426"><span class="linenos">426</span></a>        <span class="n">new_r_deg</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">new_r_deg</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span><span id="active_stage_position_settings-427"><a href="#active_stage_position_settings-427"><span class="linenos">427</span></a>        <span class="n">user_pos</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StagePositionUser</span><span class="p">(</span>
</span><span id="active_stage_position_settings-428"><a href="#active_stage_position_settings-428"><span class="linenos">428</span></a>            <span class="n">x_mm</span><span class="o">=</span><span class="n">user_pos</span><span class="o">.</span><span class="n">x_mm</span><span class="p">,</span>
</span><span id="active_stage_position_settings-429"><a href="#active_stage_position_settings-429"><span class="linenos">429</span></a>            <span class="n">y_mm</span><span class="o">=</span><span class="n">user_pos</span><span class="o">.</span><span class="n">y_mm</span><span class="p">,</span>
</span><span id="active_stage_position_settings-430"><a href="#active_stage_position_settings-430"><span class="linenos">430</span></a>            <span class="n">z_mm</span><span class="o">=</span><span class="n">user_pos</span><span class="o">.</span><span class="n">z_mm</span><span class="p">,</span>
</span><span id="active_stage_position_settings-431"><a href="#active_stage_position_settings-431"><span class="linenos">431</span></a>            <span class="n">r_deg</span><span class="o">=</span><span class="n">new_r_deg</span><span class="p">,</span>
</span><span id="active_stage_position_settings-432"><a href="#active_stage_position_settings-432"><span class="linenos">432</span></a>            <span class="n">t_deg</span><span class="o">=</span><span class="n">user_pos</span><span class="o">.</span><span class="n">t_deg</span><span class="p">,</span>
</span><span id="active_stage_position_settings-433"><a href="#active_stage_position_settings-433"><span class="linenos">433</span></a>        <span class="p">)</span>
</span><span id="active_stage_position_settings-434"><a href="#active_stage_position_settings-434"><span class="linenos">434</span></a>
</span><span id="active_stage_position_settings-435"><a href="#active_stage_position_settings-435"><span class="linenos">435</span></a>    <span class="k">return</span> <span class="n">user_pos</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the current stage position in the raw coordinate system and user units [mm, deg].</p>

<p>This function sets the stage coordinate system to RAW, retrieves the current stage position in encoder units (meters and radians), converts it to user units (millimeters and degrees), and ensures the r-axis is within the axis limit.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object from which to retrieve the current stage position.</p>

<h2 id="returns">Returns</h2>

<p>tbt.StagePositionUser
    The current stage position in user units [mm, deg].</p>
</div>


                </section>
                <section id="active_laser_state">
                            <input id="active_laser_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">active_laser_state</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="n"><a href="types.html#LaserState">pytribeam.types.LaserState</a></span>:</span></span>

                <label class="view-source-button" for="active_laser_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#active_laser_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="active_laser_state-438"><a href="#active_laser_state-438"><span class="linenos">438</span></a><span class="k">def</span> <span class="nf">active_laser_state</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserState</span><span class="p">:</span>
</span><span id="active_laser_state-439"><a href="#active_laser_state-439"><span class="linenos">439</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="active_laser_state-440"><a href="#active_laser_state-440"><span class="linenos">440</span></a><span class="sd">    Retrieve the current state of the laser, including various properties that can be quickly read.</span>
</span><span id="active_laser_state-441"><a href="#active_laser_state-441"><span class="linenos">441</span></a>
</span><span id="active_laser_state-442"><a href="#active_laser_state-442"><span class="linenos">442</span></a><span class="sd">    This function returns a dictionary object for all properties that can be quickly read from the laser (not exhaustive). Power can be read but has its own method and is more involved. Flipper configuration can only be set, not read.</span>
</span><span id="active_laser_state-443"><a href="#active_laser_state-443"><span class="linenos">443</span></a>
</span><span id="active_laser_state-444"><a href="#active_laser_state-444"><span class="linenos">444</span></a><span class="sd">    Returns</span>
</span><span id="active_laser_state-445"><a href="#active_laser_state-445"><span class="linenos">445</span></a><span class="sd">    -------</span>
</span><span id="active_laser_state-446"><a href="#active_laser_state-446"><span class="linenos">446</span></a><span class="sd">    tbt.LaserState</span>
</span><span id="active_laser_state-447"><a href="#active_laser_state-447"><span class="linenos">447</span></a><span class="sd">        The current state of the laser, including wavelength, frequency, pulse divider, pulse energy, objective position, beam shift, pattern, and expected pattern duration.</span>
</span><span id="active_laser_state-448"><a href="#active_laser_state-448"><span class="linenos">448</span></a>
</span><span id="active_laser_state-449"><a href="#active_laser_state-449"><span class="linenos">449</span></a><span class="sd">    Raises</span>
</span><span id="active_laser_state-450"><a href="#active_laser_state-450"><span class="linenos">450</span></a><span class="sd">    ------</span>
</span><span id="active_laser_state-451"><a href="#active_laser_state-451"><span class="linenos">451</span></a><span class="sd">    KeyError</span>
</span><span id="active_laser_state-452"><a href="#active_laser_state-452"><span class="linenos">452</span></a><span class="sd">        If an unsupported LaserPatternType is encountered.</span>
</span><span id="active_laser_state-453"><a href="#active_laser_state-453"><span class="linenos">453</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="active_laser_state-454"><a href="#active_laser_state-454"><span class="linenos">454</span></a>    <span class="n">vals</span> <span class="o">=</span> <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">Laser_ReadValues</span><span class="p">()</span>
</span><span id="active_laser_state-455"><a href="#active_laser_state-455"><span class="linenos">455</span></a>    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;objective_position_mm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">LIP_GetZPosition</span><span class="p">()</span>
</span><span id="active_laser_state-456"><a href="#active_laser_state-456"><span class="linenos">456</span></a>    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;beam_shift_um_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">BeamShift_Get_X</span><span class="p">()</span>
</span><span id="active_laser_state-457"><a href="#active_laser_state-457"><span class="linenos">457</span></a>    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;beam_shift_um_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">BeamShift_Get_Y</span><span class="p">()</span>
</span><span id="active_laser_state-458"><a href="#active_laser_state-458"><span class="linenos">458</span></a>    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;shutter_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">Shutter_GetState</span><span class="p">()</span>
</span><span id="active_laser_state-459"><a href="#active_laser_state-459"><span class="linenos">459</span></a>    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">Patterning_ReadValues</span><span class="p">()</span>
</span><span id="active_laser_state-460"><a href="#active_laser_state-460"><span class="linenos">460</span></a>    <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;expected_pattern_duration_s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="active_laser_state-461"><a href="#active_laser_state-461"><span class="linenos">461</span></a>        <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span><span class="o">.</span><span class="n">Patterning_GetExpectedDuration</span><span class="p">()</span>
</span><span id="active_laser_state-462"><a href="#active_laser_state-462"><span class="linenos">462</span></a>    <span class="p">)</span>
</span><span id="active_laser_state-463"><a href="#active_laser_state-463"><span class="linenos">463</span></a>
</span><span id="active_laser_state-464"><a href="#active_laser_state-464"><span class="linenos">464</span></a>    <span class="n">pattern_db</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">]</span>
</span><span id="active_laser_state-465"><a href="#active_laser_state-465"><span class="linenos">465</span></a>    <span class="n">pattern_type</span> <span class="o">=</span> <span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;patternType&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="active_laser_state-466"><a href="#active_laser_state-466"><span class="linenos">466</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">pattern_type</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="p">):</span>
</span><span id="active_laser_state-467"><a href="#active_laser_state-467"><span class="linenos">467</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="active_laser_state-468"><a href="#active_laser_state-468"><span class="linenos">468</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported LaserPatternType of </span><span class="si">{</span><span class="n">pattern_type</span><span class="si">}</span><span class="s2">, supported types include: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="active_laser_state-469"><a href="#active_laser_state-469"><span class="linenos">469</span></a>        <span class="p">)</span>
</span><span id="active_laser_state-470"><a href="#active_laser_state-470"><span class="linenos">470</span></a>    <span class="n">pattern_type</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="p">(</span><span class="n">pattern_type</span><span class="p">)</span>
</span><span id="active_laser_state-471"><a href="#active_laser_state-471"><span class="linenos">471</span></a>    <span class="n">mode</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternMode</span><span class="p">(</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;patterningMode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="active_laser_state-472"><a href="#active_laser_state-472"><span class="linenos">472</span></a>    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternMode</span><span class="o">.</span><span class="n">COARSE</span><span class="p">:</span>
</span><span id="active_laser_state-473"><a href="#active_laser_state-473"><span class="linenos">473</span></a>        <span class="n">pixel_dwell_ms</span> <span class="o">=</span> <span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;dwellTime&quot;</span><span class="p">]</span>
</span><span id="active_laser_state-474"><a href="#active_laser_state-474"><span class="linenos">474</span></a>        <span class="n">pulses_per_pixel</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="active_laser_state-475"><a href="#active_laser_state-475"><span class="linenos">475</span></a>    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternMode</span><span class="o">.</span><span class="n">FINE</span><span class="p">:</span>
</span><span id="active_laser_state-476"><a href="#active_laser_state-476"><span class="linenos">476</span></a>        <span class="n">pixel_dwell_ms</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="active_laser_state-477"><a href="#active_laser_state-477"><span class="linenos">477</span></a>        <span class="n">pulses_per_pixel</span> <span class="o">=</span> <span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;pulsesPerPixel&quot;</span><span class="p">]</span>
</span><span id="active_laser_state-478"><a href="#active_laser_state-478"><span class="linenos">478</span></a>    <span class="n">rotation_deg</span> <span class="o">=</span> <span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;patternRotation_deg&quot;</span><span class="p">]</span>
</span><span id="active_laser_state-479"><a href="#active_laser_state-479"><span class="linenos">479</span></a>
</span><span id="active_laser_state-480"><a href="#active_laser_state-480"><span class="linenos">480</span></a>    <span class="k">if</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="o">.</span><span class="n">BOX</span><span class="p">:</span>
</span><span id="active_laser_state-481"><a href="#active_laser_state-481"><span class="linenos">481</span></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserBoxPattern</span><span class="p">(</span>
</span><span id="active_laser_state-482"><a href="#active_laser_state-482"><span class="linenos">482</span></a>            <span class="n">passes</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;passes&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-483"><a href="#active_laser_state-483"><span class="linenos">483</span></a>            <span class="n">size_x_um</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;xSize_um&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-484"><a href="#active_laser_state-484"><span class="linenos">484</span></a>            <span class="n">size_y_um</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;ySize_um&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-485"><a href="#active_laser_state-485"><span class="linenos">485</span></a>            <span class="n">pitch_x_um</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;xPitch_um&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-486"><a href="#active_laser_state-486"><span class="linenos">486</span></a>            <span class="n">pitch_y_um</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;yPitch_um&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-487"><a href="#active_laser_state-487"><span class="linenos">487</span></a>            <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">(</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;scanningMode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span>
</span><span id="active_laser_state-488"><a href="#active_laser_state-488"><span class="linenos">488</span></a>            <span class="n">coordinate_ref</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="p">(</span>
</span><span id="active_laser_state-489"><a href="#active_laser_state-489"><span class="linenos">489</span></a>                <span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;coordReference&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="active_laser_state-490"><a href="#active_laser_state-490"><span class="linenos">490</span></a>            <span class="p">),</span>
</span><span id="active_laser_state-491"><a href="#active_laser_state-491"><span class="linenos">491</span></a>        <span class="p">)</span>
</span><span id="active_laser_state-492"><a href="#active_laser_state-492"><span class="linenos">492</span></a>    <span class="k">if</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="o">.</span><span class="n">LINE</span><span class="p">:</span>
</span><span id="active_laser_state-493"><a href="#active_laser_state-493"><span class="linenos">493</span></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserLinePattern</span><span class="p">(</span>
</span><span id="active_laser_state-494"><a href="#active_laser_state-494"><span class="linenos">494</span></a>            <span class="n">passes</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;passes&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-495"><a href="#active_laser_state-495"><span class="linenos">495</span></a>            <span class="n">size_um</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;xSize_um&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-496"><a href="#active_laser_state-496"><span class="linenos">496</span></a>            <span class="n">pitch_um</span><span class="o">=</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;xPitch_um&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-497"><a href="#active_laser_state-497"><span class="linenos">497</span></a>            <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">(</span><span class="n">pattern_db</span><span class="p">[</span><span class="s2">&quot;scanningMode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span>
</span><span id="active_laser_state-498"><a href="#active_laser_state-498"><span class="linenos">498</span></a>        <span class="p">)</span>
</span><span id="active_laser_state-499"><a href="#active_laser_state-499"><span class="linenos">499</span></a>
</span><span id="active_laser_state-500"><a href="#active_laser_state-500"><span class="linenos">500</span></a>    <span class="n">pattern</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPattern</span><span class="p">(</span>
</span><span id="active_laser_state-501"><a href="#active_laser_state-501"><span class="linenos">501</span></a>        <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="active_laser_state-502"><a href="#active_laser_state-502"><span class="linenos">502</span></a>        <span class="n">rotation_deg</span><span class="o">=</span><span class="n">rotation_deg</span><span class="p">,</span>
</span><span id="active_laser_state-503"><a href="#active_laser_state-503"><span class="linenos">503</span></a>        <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span>
</span><span id="active_laser_state-504"><a href="#active_laser_state-504"><span class="linenos">504</span></a>        <span class="n">pulses_per_pixel</span><span class="o">=</span><span class="n">pulses_per_pixel</span><span class="p">,</span>
</span><span id="active_laser_state-505"><a href="#active_laser_state-505"><span class="linenos">505</span></a>        <span class="n">pixel_dwell_ms</span><span class="o">=</span><span class="n">pixel_dwell_ms</span><span class="p">,</span>
</span><span id="active_laser_state-506"><a href="#active_laser_state-506"><span class="linenos">506</span></a>    <span class="p">)</span>
</span><span id="active_laser_state-507"><a href="#active_laser_state-507"><span class="linenos">507</span></a>
</span><span id="active_laser_state-508"><a href="#active_laser_state-508"><span class="linenos">508</span></a>    <span class="n">state</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserState</span><span class="p">(</span>
</span><span id="active_laser_state-509"><a href="#active_laser_state-509"><span class="linenos">509</span></a>        <span class="n">wavelength_nm</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;wavelength_nm&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-510"><a href="#active_laser_state-510"><span class="linenos">510</span></a>        <span class="n">frequency_khz</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;frequency_kHz&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-511"><a href="#active_laser_state-511"><span class="linenos">511</span></a>        <span class="n">pulse_divider</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;pulse_divider&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-512"><a href="#active_laser_state-512"><span class="linenos">512</span></a>        <span class="n">pulse_energy_uj</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;pulse_energy_uJ&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-513"><a href="#active_laser_state-513"><span class="linenos">513</span></a>        <span class="n">objective_position_mm</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;objective_position_mm&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-514"><a href="#active_laser_state-514"><span class="linenos">514</span></a>        <span class="n">beam_shift_um</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;beam_shift_um_x&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;beam_shift_um_y&quot;</span><span class="p">]),</span>
</span><span id="active_laser_state-515"><a href="#active_laser_state-515"><span class="linenos">515</span></a>        <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span>
</span><span id="active_laser_state-516"><a href="#active_laser_state-516"><span class="linenos">516</span></a>        <span class="n">expected_pattern_duration_s</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s2">&quot;expected_pattern_duration_s&quot;</span><span class="p">],</span>
</span><span id="active_laser_state-517"><a href="#active_laser_state-517"><span class="linenos">517</span></a>    <span class="p">)</span>
</span><span id="active_laser_state-518"><a href="#active_laser_state-518"><span class="linenos">518</span></a>
</span><span id="active_laser_state-519"><a href="#active_laser_state-519"><span class="linenos">519</span></a>    <span class="k">return</span> <span class="n">state</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the current state of the laser, including various properties that can be quickly read.</p>

<p>This function returns a dictionary object for all properties that can be quickly read from the laser (not exhaustive). Power can be read but has its own method and is more involved. Flipper configuration can only be set, not read.</p>

<h2 id="returns">Returns</h2>

<p>tbt.LaserState
    The current state of the laser, including wavelength, frequency, pulse divider, pulse energy, objective position, beam shift, pattern, and expected pattern duration.</p>

<h2 id="raises">Raises</h2>

<p>KeyError
    If an unsupported LaserPatternType is encountered.</p>
</div>


                </section>
                <section id="active_laser_settings">
                            <input id="active_laser_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">active_laser_settings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#LaserSettings">pytribeam.types.LaserSettings</a></span>:</span></span>

                <label class="view-source-button" for="active_laser_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#active_laser_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="active_laser_settings-522"><a href="#active_laser_settings-522"><span class="linenos">522</span></a><span class="k">def</span> <span class="nf">active_laser_settings</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserSettings</span><span class="p">:</span>
</span><span id="active_laser_settings-523"><a href="#active_laser_settings-523"><span class="linenos">523</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="active_laser_settings-524"><a href="#active_laser_settings-524"><span class="linenos">524</span></a><span class="sd">    Retrieve the current active laser settings from the microscope to create a laser settings object.</span>
</span><span id="active_laser_settings-525"><a href="#active_laser_settings-525"><span class="linenos">525</span></a>
</span><span id="active_laser_settings-526"><a href="#active_laser_settings-526"><span class="linenos">526</span></a><span class="sd">    This function grabs the current laser state and uses it to create a laser settings object. Some values cannot be read by Laser Control and can only be set. For example, polarization will default to &quot;Vertical&quot; as this value cannot be read.</span>
</span><span id="active_laser_settings-527"><a href="#active_laser_settings-527"><span class="linenos">527</span></a>
</span><span id="active_laser_settings-528"><a href="#active_laser_settings-528"><span class="linenos">528</span></a><span class="sd">    Parameters</span>
</span><span id="active_laser_settings-529"><a href="#active_laser_settings-529"><span class="linenos">529</span></a><span class="sd">    ----------</span>
</span><span id="active_laser_settings-530"><a href="#active_laser_settings-530"><span class="linenos">530</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="active_laser_settings-531"><a href="#active_laser_settings-531"><span class="linenos">531</span></a><span class="sd">        The microscope object from which to retrieve the active laser settings.</span>
</span><span id="active_laser_settings-532"><a href="#active_laser_settings-532"><span class="linenos">532</span></a>
</span><span id="active_laser_settings-533"><a href="#active_laser_settings-533"><span class="linenos">533</span></a><span class="sd">    Returns</span>
</span><span id="active_laser_settings-534"><a href="#active_laser_settings-534"><span class="linenos">534</span></a><span class="sd">    -------</span>
</span><span id="active_laser_settings-535"><a href="#active_laser_settings-535"><span class="linenos">535</span></a><span class="sd">    tbt.LaserSettings</span>
</span><span id="active_laser_settings-536"><a href="#active_laser_settings-536"><span class="linenos">536</span></a><span class="sd">        The active laser settings object.</span>
</span><span id="active_laser_settings-537"><a href="#active_laser_settings-537"><span class="linenos">537</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="active_laser_settings-538"><a href="#active_laser_settings-538"><span class="linenos">538</span></a>    <span class="n">state</span> <span class="o">=</span> <span class="n">active_laser_state</span><span class="p">()</span>
</span><span id="active_laser_settings-539"><a href="#active_laser_settings-539"><span class="linenos">539</span></a>
</span><span id="active_laser_settings-540"><a href="#active_laser_settings-540"><span class="linenos">540</span></a>    <span class="n">settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserSettings</span><span class="p">(</span>
</span><span id="active_laser_settings-541"><a href="#active_laser_settings-541"><span class="linenos">541</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="active_laser_settings-542"><a href="#active_laser_settings-542"><span class="linenos">542</span></a>        <span class="n">pulse</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPulse</span><span class="p">(</span>
</span><span id="active_laser_settings-543"><a href="#active_laser_settings-543"><span class="linenos">543</span></a>            <span class="n">wavelength_nm</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">wavelength_nm</span><span class="p">,</span>
</span><span id="active_laser_settings-544"><a href="#active_laser_settings-544"><span class="linenos">544</span></a>            <span class="n">divider</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">pulse_divider</span><span class="p">,</span>
</span><span id="active_laser_settings-545"><a href="#active_laser_settings-545"><span class="linenos">545</span></a>            <span class="n">energy_uj</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">pulse_energy_uj</span><span class="p">,</span>
</span><span id="active_laser_settings-546"><a href="#active_laser_settings-546"><span class="linenos">546</span></a>            <span class="n">polarization</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPolarization</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">,</span>  <span class="c1"># TODO, can&#39;t read this, can only set it</span>
</span><span id="active_laser_settings-547"><a href="#active_laser_settings-547"><span class="linenos">547</span></a>        <span class="p">),</span>
</span><span id="active_laser_settings-548"><a href="#active_laser_settings-548"><span class="linenos">548</span></a>        <span class="n">objective_position_mm</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">objective_position_mm</span><span class="p">,</span>
</span><span id="active_laser_settings-549"><a href="#active_laser_settings-549"><span class="linenos">549</span></a>        <span class="n">beam_shift_um</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">beam_shift_um</span><span class="p">,</span>
</span><span id="active_laser_settings-550"><a href="#active_laser_settings-550"><span class="linenos">550</span></a>        <span class="n">pattern</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span>
</span><span id="active_laser_settings-551"><a href="#active_laser_settings-551"><span class="linenos">551</span></a>    <span class="p">)</span>
</span><span id="active_laser_settings-552"><a href="#active_laser_settings-552"><span class="linenos">552</span></a>
</span><span id="active_laser_settings-553"><a href="#active_laser_settings-553"><span class="linenos">553</span></a>    <span class="k">return</span> <span class="n">settings</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the current active laser settings from the microscope to create a laser settings object.</p>

<p>This function grabs the current laser state and uses it to create a laser settings object. Some values cannot be read by Laser Control and can only be set. For example, polarization will default to "Vertical" as this value cannot be read.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object from which to retrieve the active laser settings.</p>

<h2 id="returns">Returns</h2>

<p>tbt.LaserSettings
    The active laser settings object.</p>
</div>


                </section>
                <section id="available_detector_types">
                            <input id="available_detector_types-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">available_detector_types</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="available_detector_types-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#available_detector_types"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="available_detector_types-556"><a href="#available_detector_types-556"><span class="linenos">556</span></a><span class="k">def</span> <span class="nf">available_detector_types</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="available_detector_types-557"><a href="#available_detector_types-557"><span class="linenos">557</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="available_detector_types-558"><a href="#available_detector_types-558"><span class="linenos">558</span></a><span class="sd">    Retrieve the available detector types on the current microscope.</span>
</span><span id="available_detector_types-559"><a href="#available_detector_types-559"><span class="linenos">559</span></a>
</span><span id="available_detector_types-560"><a href="#available_detector_types-560"><span class="linenos">560</span></a><span class="sd">    This function returns a list of available detector types on the current microscope.</span>
</span><span id="available_detector_types-561"><a href="#available_detector_types-561"><span class="linenos">561</span></a>
</span><span id="available_detector_types-562"><a href="#available_detector_types-562"><span class="linenos">562</span></a><span class="sd">    Parameters</span>
</span><span id="available_detector_types-563"><a href="#available_detector_types-563"><span class="linenos">563</span></a><span class="sd">    ----------</span>
</span><span id="available_detector_types-564"><a href="#available_detector_types-564"><span class="linenos">564</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="available_detector_types-565"><a href="#available_detector_types-565"><span class="linenos">565</span></a><span class="sd">        The microscope object from which to retrieve the available detector types.</span>
</span><span id="available_detector_types-566"><a href="#available_detector_types-566"><span class="linenos">566</span></a>
</span><span id="available_detector_types-567"><a href="#available_detector_types-567"><span class="linenos">567</span></a><span class="sd">    Returns</span>
</span><span id="available_detector_types-568"><a href="#available_detector_types-568"><span class="linenos">568</span></a><span class="sd">    -------</span>
</span><span id="available_detector_types-569"><a href="#available_detector_types-569"><span class="linenos">569</span></a><span class="sd">    List[str]</span>
</span><span id="available_detector_types-570"><a href="#available_detector_types-570"><span class="linenos">570</span></a><span class="sd">        A list of available detector types.</span>
</span><span id="available_detector_types-571"><a href="#available_detector_types-571"><span class="linenos">571</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="available_detector_types-572"><a href="#available_detector_types-572"><span class="linenos">572</span></a>    <span class="n">detectors</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">available_values</span>
</span><span id="available_detector_types-573"><a href="#available_detector_types-573"><span class="linenos">573</span></a>    <span class="c1"># available = [tbt.DetectorType(i) for i in detectors]</span>
</span><span id="available_detector_types-574"><a href="#available_detector_types-574"><span class="linenos">574</span></a>    <span class="k">return</span> <span class="n">detectors</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the available detector types on the current microscope.</p>

<p>This function returns a list of available detector types on the current microscope.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object from which to retrieve the available detector types.</p>

<h2 id="returns">Returns</h2>

<p>List[str]
    A list of available detector types.</p>
</div>


                </section>
                <section id="available_detector_modes">
                            <input id="available_detector_modes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">available_detector_modes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="available_detector_modes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#available_detector_modes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="available_detector_modes-577"><a href="#available_detector_modes-577"><span class="linenos">577</span></a><span class="k">def</span> <span class="nf">available_detector_modes</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="available_detector_modes-578"><a href="#available_detector_modes-578"><span class="linenos">578</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="available_detector_modes-579"><a href="#available_detector_modes-579"><span class="linenos">579</span></a><span class="sd">    Retrieve the available detector modes on the current microscope.</span>
</span><span id="available_detector_modes-580"><a href="#available_detector_modes-580"><span class="linenos">580</span></a>
</span><span id="available_detector_modes-581"><a href="#available_detector_modes-581"><span class="linenos">581</span></a><span class="sd">    This function returns a list of available detector modes on the current microscope.</span>
</span><span id="available_detector_modes-582"><a href="#available_detector_modes-582"><span class="linenos">582</span></a>
</span><span id="available_detector_modes-583"><a href="#available_detector_modes-583"><span class="linenos">583</span></a><span class="sd">    Parameters</span>
</span><span id="available_detector_modes-584"><a href="#available_detector_modes-584"><span class="linenos">584</span></a><span class="sd">    ----------</span>
</span><span id="available_detector_modes-585"><a href="#available_detector_modes-585"><span class="linenos">585</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="available_detector_modes-586"><a href="#available_detector_modes-586"><span class="linenos">586</span></a><span class="sd">        The microscope object from which to retrieve the available detector modes.</span>
</span><span id="available_detector_modes-587"><a href="#available_detector_modes-587"><span class="linenos">587</span></a>
</span><span id="available_detector_modes-588"><a href="#available_detector_modes-588"><span class="linenos">588</span></a><span class="sd">    Returns</span>
</span><span id="available_detector_modes-589"><a href="#available_detector_modes-589"><span class="linenos">589</span></a><span class="sd">    -------</span>
</span><span id="available_detector_modes-590"><a href="#available_detector_modes-590"><span class="linenos">590</span></a><span class="sd">    List[str]</span>
</span><span id="available_detector_modes-591"><a href="#available_detector_modes-591"><span class="linenos">591</span></a><span class="sd">        A list of available detector modes.</span>
</span><span id="available_detector_modes-592"><a href="#available_detector_modes-592"><span class="linenos">592</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="available_detector_modes-593"><a href="#available_detector_modes-593"><span class="linenos">593</span></a>    <span class="n">modes</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">available_values</span>
</span><span id="available_detector_modes-594"><a href="#available_detector_modes-594"><span class="linenos">594</span></a>    <span class="c1"># available = [tbt.DetectorType(i) for i in modes]</span>
</span><span id="available_detector_modes-595"><a href="#available_detector_modes-595"><span class="linenos">595</span></a>    <span class="k">return</span> <span class="n">modes</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the available detector modes on the current microscope.</p>

<p>This function returns a list of available detector modes on the current microscope.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object from which to retrieve the available detector modes.</p>

<h2 id="returns">Returns</h2>

<p>List[str]
    A list of available detector modes.</p>
</div>


                </section>
                <section id="beam_object_type">
                            <input id="beam_object_type-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">beam_object_type</span><span class="signature pdoc-code condensed">(<span class="param"><span class="nb">type</span><span class="p">:</span> <span class="n"><a href="types.html#BeamType">pytribeam.types.BeamType</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#Beam">pytribeam.types.Beam</a></span>:</span></span>

                <label class="view-source-button" for="beam_object_type-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#beam_object_type"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="beam_object_type-598"><a href="#beam_object_type-598"><span class="linenos">598</span></a><span class="k">def</span> <span class="nf">beam_object_type</span><span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Beam</span><span class="p">:</span>
</span><span id="beam_object_type-599"><a href="#beam_object_type-599"><span class="linenos">599</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="beam_object_type-600"><a href="#beam_object_type-600"><span class="linenos">600</span></a><span class="sd">    Retrieve the beam object type based on the given beam type.</span>
</span><span id="beam_object_type-601"><a href="#beam_object_type-601"><span class="linenos">601</span></a>
</span><span id="beam_object_type-602"><a href="#beam_object_type-602"><span class="linenos">602</span></a><span class="sd">    This function returns the appropriate beam object type (electron or ion) based on the provided beam type.</span>
</span><span id="beam_object_type-603"><a href="#beam_object_type-603"><span class="linenos">603</span></a>
</span><span id="beam_object_type-604"><a href="#beam_object_type-604"><span class="linenos">604</span></a><span class="sd">    Parameters</span>
</span><span id="beam_object_type-605"><a href="#beam_object_type-605"><span class="linenos">605</span></a><span class="sd">    ----------</span>
</span><span id="beam_object_type-606"><a href="#beam_object_type-606"><span class="linenos">606</span></a><span class="sd">    type : tbt.BeamType</span>
</span><span id="beam_object_type-607"><a href="#beam_object_type-607"><span class="linenos">607</span></a><span class="sd">        The type of the beam (electron or ion).</span>
</span><span id="beam_object_type-608"><a href="#beam_object_type-608"><span class="linenos">608</span></a>
</span><span id="beam_object_type-609"><a href="#beam_object_type-609"><span class="linenos">609</span></a><span class="sd">    Returns</span>
</span><span id="beam_object_type-610"><a href="#beam_object_type-610"><span class="linenos">610</span></a><span class="sd">    -------</span>
</span><span id="beam_object_type-611"><a href="#beam_object_type-611"><span class="linenos">611</span></a><span class="sd">    tbt.Beam</span>
</span><span id="beam_object_type-612"><a href="#beam_object_type-612"><span class="linenos">612</span></a><span class="sd">        The corresponding beam object type.</span>
</span><span id="beam_object_type-613"><a href="#beam_object_type-613"><span class="linenos">613</span></a>
</span><span id="beam_object_type-614"><a href="#beam_object_type-614"><span class="linenos">614</span></a><span class="sd">    Raises</span>
</span><span id="beam_object_type-615"><a href="#beam_object_type-615"><span class="linenos">615</span></a><span class="sd">    ------</span>
</span><span id="beam_object_type-616"><a href="#beam_object_type-616"><span class="linenos">616</span></a><span class="sd">    NotImplementedError</span>
</span><span id="beam_object_type-617"><a href="#beam_object_type-617"><span class="linenos">617</span></a><span class="sd">        If the provided beam type is unsupported.</span>
</span><span id="beam_object_type-618"><a href="#beam_object_type-618"><span class="linenos">618</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="beam_object_type-619"><a href="#beam_object_type-619"><span class="linenos">619</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;electron&quot;</span><span class="p">:</span>
</span><span id="beam_object_type-620"><a href="#beam_object_type-620"><span class="linenos">620</span></a>        <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ElectronBeam</span>
</span><span id="beam_object_type-621"><a href="#beam_object_type-621"><span class="linenos">621</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;ion&quot;</span><span class="p">:</span>
</span><span id="beam_object_type-622"><a href="#beam_object_type-622"><span class="linenos">622</span></a>        <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">IonBeam</span>
</span><span id="beam_object_type-623"><a href="#beam_object_type-623"><span class="linenos">623</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported beam type </span><span class="si">{</span><span class="nb">type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the beam object type based on the given beam type.</p>

<p>This function returns the appropriate beam object type (electron or ion) based on the provided beam type.</p>

<h2 id="parameters">Parameters</h2>

<p>type : tbt.BeamType
    The type of the beam (electron or ion).</p>

<h2 id="returns">Returns</h2>

<p>tbt.Beam
    The corresponding beam object type.</p>

<h2 id="raises">Raises</h2>

<p>NotImplementedError
    If the provided beam type is unsupported.</p>
</div>


                </section>
                <section id="stage_limits">
                            <input id="stage_limits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stage_limits</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#StageLimits">pytribeam.types.StageLimits</a></span>:</span></span>

                <label class="view-source-button" for="stage_limits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#stage_limits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="stage_limits-626"><a href="#stage_limits-626"><span class="linenos">626</span></a><span class="k">def</span> <span class="nf">stage_limits</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StageLimits</span><span class="p">:</span>
</span><span id="stage_limits-627"><a href="#stage_limits-627"><span class="linenos">627</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="stage_limits-628"><a href="#stage_limits-628"><span class="linenos">628</span></a><span class="sd">    Retrieve the stage limits from the current microscope connection.</span>
</span><span id="stage_limits-629"><a href="#stage_limits-629"><span class="linenos">629</span></a>
</span><span id="stage_limits-630"><a href="#stage_limits-630"><span class="linenos">630</span></a><span class="sd">    This function retrieves the stage limits for the X, Y, Z, R, and T axes from the current microscope connection and returns them as a `StageLimits` object.</span>
</span><span id="stage_limits-631"><a href="#stage_limits-631"><span class="linenos">631</span></a>
</span><span id="stage_limits-632"><a href="#stage_limits-632"><span class="linenos">632</span></a><span class="sd">    Parameters</span>
</span><span id="stage_limits-633"><a href="#stage_limits-633"><span class="linenos">633</span></a><span class="sd">    ----------</span>
</span><span id="stage_limits-634"><a href="#stage_limits-634"><span class="linenos">634</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="stage_limits-635"><a href="#stage_limits-635"><span class="linenos">635</span></a><span class="sd">        The microscope object from which to retrieve the stage limits.</span>
</span><span id="stage_limits-636"><a href="#stage_limits-636"><span class="linenos">636</span></a>
</span><span id="stage_limits-637"><a href="#stage_limits-637"><span class="linenos">637</span></a><span class="sd">    Returns</span>
</span><span id="stage_limits-638"><a href="#stage_limits-638"><span class="linenos">638</span></a><span class="sd">    -------</span>
</span><span id="stage_limits-639"><a href="#stage_limits-639"><span class="linenos">639</span></a><span class="sd">    tbt.StageLimits</span>
</span><span id="stage_limits-640"><a href="#stage_limits-640"><span class="linenos">640</span></a><span class="sd">        The stage limits for the X, Y, Z, R, and T axes in user units (mm and degrees).</span>
</span><span id="stage_limits-641"><a href="#stage_limits-641"><span class="linenos">641</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="stage_limits-642"><a href="#stage_limits-642"><span class="linenos">642</span></a>    <span class="n">stage</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="stage_limits-643"><a href="#stage_limits-643"><span class="linenos">643</span></a>    <span class="c1"># x position</span>
</span><span id="stage_limits-644"><a href="#stage_limits-644"><span class="linenos">644</span></a>    <span class="n">min_x_mm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="stage_limits-645"><a href="#stage_limits-645"><span class="linenos">645</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
</span><span id="stage_limits-646"><a href="#stage_limits-646"><span class="linenos">646</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="stage_limits-647"><a href="#stage_limits-647"><span class="linenos">647</span></a>    <span class="p">)</span>
</span><span id="stage_limits-648"><a href="#stage_limits-648"><span class="linenos">648</span></a>    <span class="n">max_x_mm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="stage_limits-649"><a href="#stage_limits-649"><span class="linenos">649</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
</span><span id="stage_limits-650"><a href="#stage_limits-650"><span class="linenos">650</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="stage_limits-651"><a href="#stage_limits-651"><span class="linenos">651</span></a>    <span class="p">)</span>
</span><span id="stage_limits-652"><a href="#stage_limits-652"><span class="linenos">652</span></a>    <span class="c1"># y position</span>
</span><span id="stage_limits-653"><a href="#stage_limits-653"><span class="linenos">653</span></a>    <span class="n">min_y_mm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="stage_limits-654"><a href="#stage_limits-654"><span class="linenos">654</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
</span><span id="stage_limits-655"><a href="#stage_limits-655"><span class="linenos">655</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="stage_limits-656"><a href="#stage_limits-656"><span class="linenos">656</span></a>    <span class="p">)</span>
</span><span id="stage_limits-657"><a href="#stage_limits-657"><span class="linenos">657</span></a>    <span class="n">max_y_mm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="stage_limits-658"><a href="#stage_limits-658"><span class="linenos">658</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
</span><span id="stage_limits-659"><a href="#stage_limits-659"><span class="linenos">659</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="stage_limits-660"><a href="#stage_limits-660"><span class="linenos">660</span></a>    <span class="p">)</span>
</span><span id="stage_limits-661"><a href="#stage_limits-661"><span class="linenos">661</span></a>    <span class="c1"># z position</span>
</span><span id="stage_limits-662"><a href="#stage_limits-662"><span class="linenos">662</span></a>    <span class="n">min_z_mm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="stage_limits-663"><a href="#stage_limits-663"><span class="linenos">663</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
</span><span id="stage_limits-664"><a href="#stage_limits-664"><span class="linenos">664</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="stage_limits-665"><a href="#stage_limits-665"><span class="linenos">665</span></a>    <span class="p">)</span>
</span><span id="stage_limits-666"><a href="#stage_limits-666"><span class="linenos">666</span></a>    <span class="n">max_z_mm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="stage_limits-667"><a href="#stage_limits-667"><span class="linenos">667</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
</span><span id="stage_limits-668"><a href="#stage_limits-668"><span class="linenos">668</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="stage_limits-669"><a href="#stage_limits-669"><span class="linenos">669</span></a>    <span class="p">)</span>
</span><span id="stage_limits-670"><a href="#stage_limits-670"><span class="linenos">670</span></a>    <span class="c1"># r position</span>
</span><span id="stage_limits-671"><a href="#stage_limits-671"><span class="linenos">671</span></a>    <span class="n">min_r_deg</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">rotation_axis_limit_deg</span><span class="o">.</span><span class="n">min</span>
</span><span id="stage_limits-672"><a href="#stage_limits-672"><span class="linenos">672</span></a>    <span class="n">max_r_deg</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">rotation_axis_limit_deg</span><span class="o">.</span><span class="n">max</span>
</span><span id="stage_limits-673"><a href="#stage_limits-673"><span class="linenos">673</span></a>    <span class="c1"># t position</span>
</span><span id="stage_limits-674"><a href="#stage_limits-674"><span class="linenos">674</span></a>    <span class="n">min_t_deg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="stage_limits-675"><a href="#stage_limits-675"><span class="linenos">675</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
</span><span id="stage_limits-676"><a href="#stage_limits-676"><span class="linenos">676</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">RAD_TO_DEG</span>
</span><span id="stage_limits-677"><a href="#stage_limits-677"><span class="linenos">677</span></a>    <span class="p">)</span>
</span><span id="stage_limits-678"><a href="#stage_limits-678"><span class="linenos">678</span></a>    <span class="n">max_t_deg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="stage_limits-679"><a href="#stage_limits-679"><span class="linenos">679</span></a>        <span class="n">microscope</span><span class="o">.</span><span class="n">specimen</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">get_axis_limits</span><span class="p">(</span><span class="n">tbt</span><span class="o">.</span><span class="n">StageAxis</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
</span><span id="stage_limits-680"><a href="#stage_limits-680"><span class="linenos">680</span></a>        <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">RAD_TO_DEG</span>
</span><span id="stage_limits-681"><a href="#stage_limits-681"><span class="linenos">681</span></a>    <span class="p">)</span>
</span><span id="stage_limits-682"><a href="#stage_limits-682"><span class="linenos">682</span></a>
</span><span id="stage_limits-683"><a href="#stage_limits-683"><span class="linenos">683</span></a>    <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StageLimits</span><span class="p">(</span>
</span><span id="stage_limits-684"><a href="#stage_limits-684"><span class="linenos">684</span></a>        <span class="n">x_mm</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_x_mm</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_x_mm</span><span class="p">),</span>
</span><span id="stage_limits-685"><a href="#stage_limits-685"><span class="linenos">685</span></a>        <span class="n">y_mm</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_y_mm</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_y_mm</span><span class="p">),</span>
</span><span id="stage_limits-686"><a href="#stage_limits-686"><span class="linenos">686</span></a>        <span class="n">z_mm</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_z_mm</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_z_mm</span><span class="p">),</span>
</span><span id="stage_limits-687"><a href="#stage_limits-687"><span class="linenos">687</span></a>        <span class="n">r_deg</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_r_deg</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_r_deg</span><span class="p">),</span>
</span><span id="stage_limits-688"><a href="#stage_limits-688"><span class="linenos">688</span></a>        <span class="n">t_deg</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_t_deg</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_t_deg</span><span class="p">),</span>
</span><span id="stage_limits-689"><a href="#stage_limits-689"><span class="linenos">689</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the stage limits from the current microscope connection.</p>

<p>This function retrieves the stage limits for the X, Y, Z, R, and T axes from the current microscope connection and returns them as a <code>StageLimits</code> object.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object from which to retrieve the stage limits.</p>

<h2 id="returns">Returns</h2>

<p>tbt.StageLimits
    The stage limits for the X, Y, Z, R, and T axes in user units (mm and degrees).</p>
</div>


                </section>
                <section id="beam_limits">
                            <input id="beam_limits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">beam_limits</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">selected_beam</span><span class="p">:</span> <span class="nb">property</span>,</span><span class="param">	<span class="n">beam_type</span><span class="p">:</span> <span class="n"><a href="types.html#BeamType">pytribeam.types.BeamType</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#BeamLimits">pytribeam.types.BeamLimits</a></span>:</span></span>

                <label class="view-source-button" for="beam_limits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#beam_limits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="beam_limits-692"><a href="#beam_limits-692"><span class="linenos">692</span></a><span class="k">def</span> <span class="nf">beam_limits</span><span class="p">(</span>
</span><span id="beam_limits-693"><a href="#beam_limits-693"><span class="linenos">693</span></a>    <span class="n">selected_beam</span><span class="p">:</span> <span class="nb">property</span><span class="p">,</span>
</span><span id="beam_limits-694"><a href="#beam_limits-694"><span class="linenos">694</span></a>    <span class="n">beam_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">,</span>
</span><span id="beam_limits-695"><a href="#beam_limits-695"><span class="linenos">695</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamLimits</span><span class="p">:</span>
</span><span id="beam_limits-696"><a href="#beam_limits-696"><span class="linenos">696</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="beam_limits-697"><a href="#beam_limits-697"><span class="linenos">697</span></a><span class="sd">    Retrieve the beam limits for the selected beam and beam type.</span>
</span><span id="beam_limits-698"><a href="#beam_limits-698"><span class="linenos">698</span></a>
</span><span id="beam_limits-699"><a href="#beam_limits-699"><span class="linenos">699</span></a><span class="sd">    This function retrieves the limits for voltage, current, horizontal field width (HFW), and working distance for the selected beam and beam type, and returns them as a `BeamLimits` object.</span>
</span><span id="beam_limits-700"><a href="#beam_limits-700"><span class="linenos">700</span></a>
</span><span id="beam_limits-701"><a href="#beam_limits-701"><span class="linenos">701</span></a><span class="sd">    Parameters</span>
</span><span id="beam_limits-702"><a href="#beam_limits-702"><span class="linenos">702</span></a><span class="sd">    ----------</span>
</span><span id="beam_limits-703"><a href="#beam_limits-703"><span class="linenos">703</span></a><span class="sd">    selected_beam : property</span>
</span><span id="beam_limits-704"><a href="#beam_limits-704"><span class="linenos">704</span></a><span class="sd">        The selected beam property from which to retrieve the limits.</span>
</span><span id="beam_limits-705"><a href="#beam_limits-705"><span class="linenos">705</span></a><span class="sd">    beam_type : tbt.BeamType</span>
</span><span id="beam_limits-706"><a href="#beam_limits-706"><span class="linenos">706</span></a><span class="sd">        The type of the beam (electron or ion).</span>
</span><span id="beam_limits-707"><a href="#beam_limits-707"><span class="linenos">707</span></a>
</span><span id="beam_limits-708"><a href="#beam_limits-708"><span class="linenos">708</span></a><span class="sd">    Returns</span>
</span><span id="beam_limits-709"><a href="#beam_limits-709"><span class="linenos">709</span></a><span class="sd">    -------</span>
</span><span id="beam_limits-710"><a href="#beam_limits-710"><span class="linenos">710</span></a><span class="sd">    tbt.BeamLimits</span>
</span><span id="beam_limits-711"><a href="#beam_limits-711"><span class="linenos">711</span></a><span class="sd">        The beam limits for voltage, current, HFW, and working distance in user units (kV, nA, mm).</span>
</span><span id="beam_limits-712"><a href="#beam_limits-712"><span class="linenos">712</span></a>
</span><span id="beam_limits-713"><a href="#beam_limits-713"><span class="linenos">713</span></a><span class="sd">    Raises</span>
</span><span id="beam_limits-714"><a href="#beam_limits-714"><span class="linenos">714</span></a><span class="sd">    ------</span>
</span><span id="beam_limits-715"><a href="#beam_limits-715"><span class="linenos">715</span></a><span class="sd">    ValueError</span>
</span><span id="beam_limits-716"><a href="#beam_limits-716"><span class="linenos">716</span></a><span class="sd">        If the beam type is unsupported.</span>
</span><span id="beam_limits-717"><a href="#beam_limits-717"><span class="linenos">717</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="beam_limits-718"><a href="#beam_limits-718"><span class="linenos">718</span></a>    <span class="c1"># voltage range</span>
</span><span id="beam_limits-719"><a href="#beam_limits-719"><span class="linenos">719</span></a>    <span class="n">min_kv</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">high_voltage</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">min</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">V_TO_KV</span>
</span><span id="beam_limits-720"><a href="#beam_limits-720"><span class="linenos">720</span></a>    <span class="n">max_kv</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">high_voltage</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">V_TO_KV</span>
</span><span id="beam_limits-721"><a href="#beam_limits-721"><span class="linenos">721</span></a>
</span><span id="beam_limits-722"><a href="#beam_limits-722"><span class="linenos">722</span></a>    <span class="c1"># current range</span>
</span><span id="beam_limits-723"><a href="#beam_limits-723"><span class="linenos">723</span></a>    <span class="k">if</span> <span class="n">beam_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">:</span>
</span><span id="beam_limits-724"><a href="#beam_limits-724"><span class="linenos">724</span></a>        <span class="n">min_na</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">beam_current</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">min</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">A_TO_NA</span>
</span><span id="beam_limits-725"><a href="#beam_limits-725"><span class="linenos">725</span></a>        <span class="n">max_na</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">beam_current</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">A_TO_NA</span>
</span><span id="beam_limits-726"><a href="#beam_limits-726"><span class="linenos">726</span></a>    <span class="k">if</span> <span class="n">beam_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">:</span>
</span><span id="beam_limits-727"><a href="#beam_limits-727"><span class="linenos">727</span></a>        <span class="n">available_currents</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">beam_current</span><span class="o">.</span><span class="n">available_values</span>
</span><span id="beam_limits-728"><a href="#beam_limits-728"><span class="linenos">728</span></a>        <span class="n">min_na</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">available_currents</span><span class="p">)</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">A_TO_NA</span>
</span><span id="beam_limits-729"><a href="#beam_limits-729"><span class="linenos">729</span></a>        <span class="n">max_na</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">available_currents</span><span class="p">)</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">A_TO_NA</span>
</span><span id="beam_limits-730"><a href="#beam_limits-730"><span class="linenos">730</span></a>
</span><span id="beam_limits-731"><a href="#beam_limits-731"><span class="linenos">731</span></a>    <span class="c1"># hfw range</span>
</span><span id="beam_limits-732"><a href="#beam_limits-732"><span class="linenos">732</span></a>    <span class="n">min_hfw_mm</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">horizontal_field_width</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">min</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="beam_limits-733"><a href="#beam_limits-733"><span class="linenos">733</span></a>    <span class="n">max_hfw_mm</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">horizontal_field_width</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="beam_limits-734"><a href="#beam_limits-734"><span class="linenos">734</span></a>
</span><span id="beam_limits-735"><a href="#beam_limits-735"><span class="linenos">735</span></a>    <span class="c1"># working_dist range</span>
</span><span id="beam_limits-736"><a href="#beam_limits-736"><span class="linenos">736</span></a>    <span class="n">min_wd_mm</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">working_distance</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">min</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="beam_limits-737"><a href="#beam_limits-737"><span class="linenos">737</span></a>    <span class="n">max_wd_mm</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">working_distance</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">M_TO_MM</span>
</span><span id="beam_limits-738"><a href="#beam_limits-738"><span class="linenos">738</span></a>
</span><span id="beam_limits-739"><a href="#beam_limits-739"><span class="linenos">739</span></a>    <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamLimits</span><span class="p">(</span>
</span><span id="beam_limits-740"><a href="#beam_limits-740"><span class="linenos">740</span></a>        <span class="n">voltage_kv</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_kv</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_kv</span><span class="p">),</span>
</span><span id="beam_limits-741"><a href="#beam_limits-741"><span class="linenos">741</span></a>        <span class="n">current_na</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_na</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_na</span><span class="p">),</span>
</span><span id="beam_limits-742"><a href="#beam_limits-742"><span class="linenos">742</span></a>        <span class="n">hfw_mm</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_hfw_mm</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_hfw_mm</span><span class="p">),</span>
</span><span id="beam_limits-743"><a href="#beam_limits-743"><span class="linenos">743</span></a>        <span class="n">working_distance_mm</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_wd_mm</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_wd_mm</span><span class="p">),</span>
</span><span id="beam_limits-744"><a href="#beam_limits-744"><span class="linenos">744</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the beam limits for the selected beam and beam type.</p>

<p>This function retrieves the limits for voltage, current, horizontal field width (HFW), and working distance for the selected beam and beam type, and returns them as a <code>BeamLimits</code> object.</p>

<h2 id="parameters">Parameters</h2>

<p>selected_beam : property
    The selected beam property from which to retrieve the limits.
beam_type : tbt.BeamType
    The type of the beam (electron or ion).</p>

<h2 id="returns">Returns</h2>

<p>tbt.BeamLimits
    The beam limits for voltage, current, HFW, and working distance in user units (kV, nA, mm).</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the beam type is unsupported.</p>
</div>


                </section>
                <section id="general">
                            <input id="general-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">general</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">general_db</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#GeneralSettings">pytribeam.types.GeneralSettings</a></span>:</span></span>

                <label class="view-source-button" for="general-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#general"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="general-747"><a href="#general-747"><span class="linenos">747</span></a><span class="k">def</span> <span class="nf">general</span><span class="p">(</span>
</span><span id="general-748"><a href="#general-748"><span class="linenos">748</span></a>    <span class="n">general_db</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="general-749"><a href="#general-749"><span class="linenos">749</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="general-750"><a href="#general-750"><span class="linenos">750</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">GeneralSettings</span><span class="p">:</span>
</span><span id="general-751"><a href="#general-751"><span class="linenos">751</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="general-752"><a href="#general-752"><span class="linenos">752</span></a><span class="sd">    Convert a general settings dictionary to a built-in type and perform schema checking.</span>
</span><span id="general-753"><a href="#general-753"><span class="linenos">753</span></a>
</span><span id="general-754"><a href="#general-754"><span class="linenos">754</span></a><span class="sd">    This function converts a general settings dictionary from a .yml file to a `GeneralSettings` object. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="general-755"><a href="#general-755"><span class="linenos">755</span></a>
</span><span id="general-756"><a href="#general-756"><span class="linenos">756</span></a><span class="sd">    Parameters</span>
</span><span id="general-757"><a href="#general-757"><span class="linenos">757</span></a><span class="sd">    ----------</span>
</span><span id="general-758"><a href="#general-758"><span class="linenos">758</span></a><span class="sd">    general_db : dict</span>
</span><span id="general-759"><a href="#general-759"><span class="linenos">759</span></a><span class="sd">        The general settings dictionary from the .yml file.</span>
</span><span id="general-760"><a href="#general-760"><span class="linenos">760</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="general-761"><a href="#general-761"><span class="linenos">761</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="general-762"><a href="#general-762"><span class="linenos">762</span></a>
</span><span id="general-763"><a href="#general-763"><span class="linenos">763</span></a><span class="sd">    Returns</span>
</span><span id="general-764"><a href="#general-764"><span class="linenos">764</span></a><span class="sd">    -------</span>
</span><span id="general-765"><a href="#general-765"><span class="linenos">765</span></a><span class="sd">    tbt.GeneralSettings</span>
</span><span id="general-766"><a href="#general-766"><span class="linenos">766</span></a><span class="sd">        The general settings object.</span>
</span><span id="general-767"><a href="#general-767"><span class="linenos">767</span></a>
</span><span id="general-768"><a href="#general-768"><span class="linenos">768</span></a><span class="sd">    Raises</span>
</span><span id="general-769"><a href="#general-769"><span class="linenos">769</span></a><span class="sd">    ------</span>
</span><span id="general-770"><a href="#general-770"><span class="linenos">770</span></a><span class="sd">    NotImplementedError</span>
</span><span id="general-771"><a href="#general-771"><span class="linenos">771</span></a><span class="sd">        If the provided yml format is unsupported.</span>
</span><span id="general-772"><a href="#general-772"><span class="linenos">772</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="general-773"><a href="#general-773"><span class="linenos">773</span></a>
</span><span id="general-774"><a href="#general-774"><span class="linenos">774</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">yml_format</span> <span class="ow">in</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">:</span>
</span><span id="general-775"><a href="#general-775"><span class="linenos">775</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="general-776"><a href="#general-776"><span class="linenos">776</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Due to the complexity and number of variables, </span>
</span><span id="general-777"><a href="#general-777"><span class="linenos">777</span></a><span class="sd">        image objects should only be constructed using a yml file.&quot;&quot;&quot;</span>
</span><span id="general-778"><a href="#general-778"><span class="linenos">778</span></a>        <span class="p">)</span>
</span><span id="general-779"><a href="#general-779"><span class="linenos">779</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">yml_format</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">):</span>
</span><span id="general-780"><a href="#general-780"><span class="linenos">780</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported yml format of </span><span class="si">{</span><span class="n">yml_format</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="general-781"><a href="#general-781"><span class="linenos">781</span></a>
</span><span id="general-782"><a href="#general-782"><span class="linenos">782</span></a>    <span class="n">validate_general_settings</span><span class="p">(</span>
</span><span id="general-783"><a href="#general-783"><span class="linenos">783</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">general_db</span><span class="p">,</span>
</span><span id="general-784"><a href="#general-784"><span class="linenos">784</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="general-785"><a href="#general-785"><span class="linenos">785</span></a>    <span class="p">)</span>
</span><span id="general-786"><a href="#general-786"><span class="linenos">786</span></a>
</span><span id="general-787"><a href="#general-787"><span class="linenos">787</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="general-788"><a href="#general-788"><span class="linenos">788</span></a>        <span class="c1"># slice thickness</span>
</span><span id="general-789"><a href="#general-789"><span class="linenos">789</span></a>        <span class="n">slice_thickness_um</span> <span class="o">=</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;slice_thickness_um&quot;</span><span class="p">]</span>
</span><span id="general-790"><a href="#general-790"><span class="linenos">790</span></a>        <span class="c1"># max slice number</span>
</span><span id="general-791"><a href="#general-791"><span class="linenos">791</span></a>        <span class="n">max_slice_number</span> <span class="o">=</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;max_slice_num&quot;</span><span class="p">]</span>
</span><span id="general-792"><a href="#general-792"><span class="linenos">792</span></a>        <span class="c1"># pre tilt</span>
</span><span id="general-793"><a href="#general-793"><span class="linenos">793</span></a>        <span class="n">pre_tilt_deg</span> <span class="o">=</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;pre_tilt_deg&quot;</span><span class="p">]</span>
</span><span id="general-794"><a href="#general-794"><span class="linenos">794</span></a>        <span class="c1"># sectioning axis</span>
</span><span id="general-795"><a href="#general-795"><span class="linenos">795</span></a>        <span class="n">sectioning_axis</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">SectioningAxis</span><span class="p">(</span><span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;sectioning_axis&quot;</span><span class="p">])</span>
</span><span id="general-796"><a href="#general-796"><span class="linenos">796</span></a>        <span class="c1"># stage tolerance</span>
</span><span id="general-797"><a href="#general-797"><span class="linenos">797</span></a>        <span class="n">stage_tolerance</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StageTolerance</span><span class="p">(</span>
</span><span id="general-798"><a href="#general-798"><span class="linenos">798</span></a>            <span class="n">translational_um</span><span class="o">=</span><span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;stage_translational_tol_um&quot;</span><span class="p">],</span>
</span><span id="general-799"><a href="#general-799"><span class="linenos">799</span></a>            <span class="n">angular_deg</span><span class="o">=</span><span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;stage_angular_tol_deg&quot;</span><span class="p">],</span>
</span><span id="general-800"><a href="#general-800"><span class="linenos">800</span></a>        <span class="p">)</span>
</span><span id="general-801"><a href="#general-801"><span class="linenos">801</span></a>        <span class="c1"># connection</span>
</span><span id="general-802"><a href="#general-802"><span class="linenos">802</span></a>        <span class="n">connection</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">MicroscopeConnection</span><span class="p">(</span>
</span><span id="general-803"><a href="#general-803"><span class="linenos">803</span></a>            <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;connection_host&quot;</span><span class="p">],</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;connection_port&quot;</span><span class="p">]</span>
</span><span id="general-804"><a href="#general-804"><span class="linenos">804</span></a>        <span class="p">)</span>
</span><span id="general-805"><a href="#general-805"><span class="linenos">805</span></a>        <span class="c1"># EBSD OEM</span>
</span><span id="general-806"><a href="#general-806"><span class="linenos">806</span></a>        <span class="n">ebsd_oem</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">(</span><span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;EBSD_OEM&quot;</span><span class="p">])</span>
</span><span id="general-807"><a href="#general-807"><span class="linenos">807</span></a>        <span class="c1"># EDS OEM</span>
</span><span id="general-808"><a href="#general-808"><span class="linenos">808</span></a>        <span class="n">eds_oem</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">(</span><span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;EDS_OEM&quot;</span><span class="p">])</span>
</span><span id="general-809"><a href="#general-809"><span class="linenos">809</span></a>        <span class="c1"># exp dir</span>
</span><span id="general-810"><a href="#general-810"><span class="linenos">810</span></a>        <span class="n">exp_dir</span> <span class="o">=</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;exp_dir&quot;</span><span class="p">]</span>
</span><span id="general-811"><a href="#general-811"><span class="linenos">811</span></a>        <span class="c1"># h5 log name</span>
</span><span id="general-812"><a href="#general-812"><span class="linenos">812</span></a>        <span class="n">h5_log_name</span> <span class="o">=</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;h5_log_name&quot;</span><span class="p">]</span>
</span><span id="general-813"><a href="#general-813"><span class="linenos">813</span></a>        <span class="c1"># remove log file extension if the user provided it</span>
</span><span id="general-814"><a href="#general-814"><span class="linenos">814</span></a>        <span class="n">log_extension</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">logfile_extension</span>
</span><span id="general-815"><a href="#general-815"><span class="linenos">815</span></a>        <span class="k">if</span> <span class="n">h5_log_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">log_extension</span><span class="p">):</span>
</span><span id="general-816"><a href="#general-816"><span class="linenos">816</span></a>            <span class="n">h5_log_name</span> <span class="o">=</span> <span class="n">h5_log_name</span><span class="p">[:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">log_extension</span><span class="p">)]</span>
</span><span id="general-817"><a href="#general-817"><span class="linenos">817</span></a>        <span class="c1"># step count</span>
</span><span id="general-818"><a href="#general-818"><span class="linenos">818</span></a>        <span class="n">step_count</span> <span class="o">=</span> <span class="n">general_db</span><span class="p">[</span><span class="s2">&quot;step_count&quot;</span><span class="p">]</span>
</span><span id="general-819"><a href="#general-819"><span class="linenos">819</span></a>        <span class="n">yml_version</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="general-820"><a href="#general-820"><span class="linenos">820</span></a>
</span><span id="general-821"><a href="#general-821"><span class="linenos">821</span></a>    <span class="n">general_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">GeneralSettings</span><span class="p">(</span>
</span><span id="general-822"><a href="#general-822"><span class="linenos">822</span></a>        <span class="n">yml_version</span><span class="o">=</span><span class="n">yml_version</span><span class="p">,</span>
</span><span id="general-823"><a href="#general-823"><span class="linenos">823</span></a>        <span class="n">slice_thickness_um</span><span class="o">=</span><span class="n">slice_thickness_um</span><span class="p">,</span>
</span><span id="general-824"><a href="#general-824"><span class="linenos">824</span></a>        <span class="n">max_slice_number</span><span class="o">=</span><span class="n">max_slice_number</span><span class="p">,</span>
</span><span id="general-825"><a href="#general-825"><span class="linenos">825</span></a>        <span class="n">pre_tilt_deg</span><span class="o">=</span><span class="n">pre_tilt_deg</span><span class="p">,</span>
</span><span id="general-826"><a href="#general-826"><span class="linenos">826</span></a>        <span class="n">sectioning_axis</span><span class="o">=</span><span class="n">sectioning_axis</span><span class="p">,</span>
</span><span id="general-827"><a href="#general-827"><span class="linenos">827</span></a>        <span class="n">stage_tolerance</span><span class="o">=</span><span class="n">stage_tolerance</span><span class="p">,</span>
</span><span id="general-828"><a href="#general-828"><span class="linenos">828</span></a>        <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span>
</span><span id="general-829"><a href="#general-829"><span class="linenos">829</span></a>        <span class="n">EBSD_OEM</span><span class="o">=</span><span class="n">ebsd_oem</span><span class="p">,</span>
</span><span id="general-830"><a href="#general-830"><span class="linenos">830</span></a>        <span class="n">EDS_OEM</span><span class="o">=</span><span class="n">eds_oem</span><span class="p">,</span>
</span><span id="general-831"><a href="#general-831"><span class="linenos">831</span></a>        <span class="n">exp_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">exp_dir</span><span class="p">),</span>
</span><span id="general-832"><a href="#general-832"><span class="linenos">832</span></a>        <span class="n">h5_log_name</span><span class="o">=</span><span class="n">h5_log_name</span><span class="p">,</span>
</span><span id="general-833"><a href="#general-833"><span class="linenos">833</span></a>        <span class="n">step_count</span><span class="o">=</span><span class="n">step_count</span><span class="p">,</span>
</span><span id="general-834"><a href="#general-834"><span class="linenos">834</span></a>    <span class="p">)</span>
</span><span id="general-835"><a href="#general-835"><span class="linenos">835</span></a>
</span><span id="general-836"><a href="#general-836"><span class="linenos">836</span></a>    <span class="k">return</span> <span class="n">general_settings</span>
</span></pre></div>


            <div class="docstring"><p>Convert a general settings dictionary to a built-in type and perform schema checking.</p>

<p>This function converts a general settings dictionary from a .yml file to a <code>GeneralSettings</code> object. It performs schema checking to ensure valid inputs are requested.</p>

<h2 id="parameters">Parameters</h2>

<p>general_db : dict
    The general settings dictionary from the .yml file.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>tbt.GeneralSettings
    The general settings object.</p>

<h2 id="raises">Raises</h2>

<p>NotImplementedError
    If the provided yml format is unsupported.</p>
</div>


                </section>
                <section id="laser_box_pattern">
                            <input id="laser_box_pattern-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">laser_box_pattern</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#LaserBoxPattern">pytribeam.types.LaserBoxPattern</a></span>:</span></span>

                <label class="view-source-button" for="laser_box_pattern-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#laser_box_pattern"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="laser_box_pattern-839"><a href="#laser_box_pattern-839"><span class="linenos">839</span></a><span class="k">def</span> <span class="nf">laser_box_pattern</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserBoxPattern</span><span class="p">:</span>
</span><span id="laser_box_pattern-840"><a href="#laser_box_pattern-840"><span class="linenos">840</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="laser_box_pattern-841"><a href="#laser_box_pattern-841"><span class="linenos">841</span></a><span class="sd">    Convert a dictionary of laser box pattern settings to a `LaserBoxPattern` object.</span>
</span><span id="laser_box_pattern-842"><a href="#laser_box_pattern-842"><span class="linenos">842</span></a>
</span><span id="laser_box_pattern-843"><a href="#laser_box_pattern-843"><span class="linenos">843</span></a><span class="sd">    This function takes a dictionary of laser box pattern settings and converts it to a `LaserBoxPattern` object.</span>
</span><span id="laser_box_pattern-844"><a href="#laser_box_pattern-844"><span class="linenos">844</span></a>
</span><span id="laser_box_pattern-845"><a href="#laser_box_pattern-845"><span class="linenos">845</span></a><span class="sd">    Parameters</span>
</span><span id="laser_box_pattern-846"><a href="#laser_box_pattern-846"><span class="linenos">846</span></a><span class="sd">    ----------</span>
</span><span id="laser_box_pattern-847"><a href="#laser_box_pattern-847"><span class="linenos">847</span></a><span class="sd">    settings : dict</span>
</span><span id="laser_box_pattern-848"><a href="#laser_box_pattern-848"><span class="linenos">848</span></a><span class="sd">        The dictionary containing laser box pattern settings.</span>
</span><span id="laser_box_pattern-849"><a href="#laser_box_pattern-849"><span class="linenos">849</span></a>
</span><span id="laser_box_pattern-850"><a href="#laser_box_pattern-850"><span class="linenos">850</span></a><span class="sd">    Returns</span>
</span><span id="laser_box_pattern-851"><a href="#laser_box_pattern-851"><span class="linenos">851</span></a><span class="sd">    -------</span>
</span><span id="laser_box_pattern-852"><a href="#laser_box_pattern-852"><span class="linenos">852</span></a><span class="sd">    tbt.LaserBoxPattern</span>
</span><span id="laser_box_pattern-853"><a href="#laser_box_pattern-853"><span class="linenos">853</span></a><span class="sd">        The laser box pattern object.</span>
</span><span id="laser_box_pattern-854"><a href="#laser_box_pattern-854"><span class="linenos">854</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="laser_box_pattern-855"><a href="#laser_box_pattern-855"><span class="linenos">855</span></a>    <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserBoxPattern</span><span class="p">(</span>
</span><span id="laser_box_pattern-856"><a href="#laser_box_pattern-856"><span class="linenos">856</span></a>        <span class="n">passes</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;passes&quot;</span><span class="p">],</span>
</span><span id="laser_box_pattern-857"><a href="#laser_box_pattern-857"><span class="linenos">857</span></a>        <span class="n">size_x_um</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;size_x_um&quot;</span><span class="p">],</span>
</span><span id="laser_box_pattern-858"><a href="#laser_box_pattern-858"><span class="linenos">858</span></a>        <span class="n">size_y_um</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;size_y_um&quot;</span><span class="p">],</span>
</span><span id="laser_box_pattern-859"><a href="#laser_box_pattern-859"><span class="linenos">859</span></a>        <span class="n">pitch_x_um</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pitch_x_um&quot;</span><span class="p">],</span>
</span><span id="laser_box_pattern-860"><a href="#laser_box_pattern-860"><span class="linenos">860</span></a>        <span class="n">pitch_y_um</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pitch_y_um&quot;</span><span class="p">],</span>
</span><span id="laser_box_pattern-861"><a href="#laser_box_pattern-861"><span class="linenos">861</span></a>        <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;scan_type&quot;</span><span class="p">]),</span>
</span><span id="laser_box_pattern-862"><a href="#laser_box_pattern-862"><span class="linenos">862</span></a>        <span class="n">coordinate_ref</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;coordinate_ref&quot;</span><span class="p">]),</span>
</span><span id="laser_box_pattern-863"><a href="#laser_box_pattern-863"><span class="linenos">863</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert a dictionary of laser box pattern settings to a <code>LaserBoxPattern</code> object.</p>

<p>This function takes a dictionary of laser box pattern settings and converts it to a <code>LaserBoxPattern</code> object.</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    The dictionary containing laser box pattern settings.</p>

<h2 id="returns">Returns</h2>

<p>tbt.LaserBoxPattern
    The laser box pattern object.</p>
</div>


                </section>
                <section id="laser_line_pattern">
                            <input id="laser_line_pattern-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">laser_line_pattern</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#LaserBoxPattern">pytribeam.types.LaserBoxPattern</a></span>:</span></span>

                <label class="view-source-button" for="laser_line_pattern-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#laser_line_pattern"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="laser_line_pattern-866"><a href="#laser_line_pattern-866"><span class="linenos">866</span></a><span class="k">def</span> <span class="nf">laser_line_pattern</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserBoxPattern</span><span class="p">:</span>
</span><span id="laser_line_pattern-867"><a href="#laser_line_pattern-867"><span class="linenos">867</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="laser_line_pattern-868"><a href="#laser_line_pattern-868"><span class="linenos">868</span></a><span class="sd">    Convert a dictionary of laser line pattern settings to a `LaserLinePattern` object.</span>
</span><span id="laser_line_pattern-869"><a href="#laser_line_pattern-869"><span class="linenos">869</span></a>
</span><span id="laser_line_pattern-870"><a href="#laser_line_pattern-870"><span class="linenos">870</span></a><span class="sd">    This function takes a dictionary of laser line pattern settings and converts it to a `LaserLinePattern` object.</span>
</span><span id="laser_line_pattern-871"><a href="#laser_line_pattern-871"><span class="linenos">871</span></a>
</span><span id="laser_line_pattern-872"><a href="#laser_line_pattern-872"><span class="linenos">872</span></a><span class="sd">    Parameters</span>
</span><span id="laser_line_pattern-873"><a href="#laser_line_pattern-873"><span class="linenos">873</span></a><span class="sd">    ----------</span>
</span><span id="laser_line_pattern-874"><a href="#laser_line_pattern-874"><span class="linenos">874</span></a><span class="sd">    settings : dict</span>
</span><span id="laser_line_pattern-875"><a href="#laser_line_pattern-875"><span class="linenos">875</span></a><span class="sd">        The dictionary containing laser line pattern settings.</span>
</span><span id="laser_line_pattern-876"><a href="#laser_line_pattern-876"><span class="linenos">876</span></a>
</span><span id="laser_line_pattern-877"><a href="#laser_line_pattern-877"><span class="linenos">877</span></a><span class="sd">    Returns</span>
</span><span id="laser_line_pattern-878"><a href="#laser_line_pattern-878"><span class="linenos">878</span></a><span class="sd">    -------</span>
</span><span id="laser_line_pattern-879"><a href="#laser_line_pattern-879"><span class="linenos">879</span></a><span class="sd">    tbt.LaserLinePattern</span>
</span><span id="laser_line_pattern-880"><a href="#laser_line_pattern-880"><span class="linenos">880</span></a><span class="sd">        The laser line pattern object.</span>
</span><span id="laser_line_pattern-881"><a href="#laser_line_pattern-881"><span class="linenos">881</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="laser_line_pattern-882"><a href="#laser_line_pattern-882"><span class="linenos">882</span></a>    <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserLinePattern</span><span class="p">(</span>
</span><span id="laser_line_pattern-883"><a href="#laser_line_pattern-883"><span class="linenos">883</span></a>        <span class="n">passes</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;passes&quot;</span><span class="p">],</span>
</span><span id="laser_line_pattern-884"><a href="#laser_line_pattern-884"><span class="linenos">884</span></a>        <span class="n">size_um</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;size_um&quot;</span><span class="p">],</span>
</span><span id="laser_line_pattern-885"><a href="#laser_line_pattern-885"><span class="linenos">885</span></a>        <span class="n">pitch_um</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pitch_um&quot;</span><span class="p">],</span>
</span><span id="laser_line_pattern-886"><a href="#laser_line_pattern-886"><span class="linenos">886</span></a>        <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;scan_type&quot;</span><span class="p">]),</span>
</span><span id="laser_line_pattern-887"><a href="#laser_line_pattern-887"><span class="linenos">887</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert a dictionary of laser line pattern settings to a <code>LaserLinePattern</code> object.</p>

<p>This function takes a dictionary of laser line pattern settings and converts it to a <code>LaserLinePattern</code> object.</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    The dictionary containing laser line pattern settings.</p>

<h2 id="returns">Returns</h2>

<p>tbt.LaserLinePattern
    The laser line pattern object.</p>
</div>


                </section>
                <section id="laser">
                            <input id="laser-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">laser</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span>,</span><span class="param">	<span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#LaserSettings">pytribeam.types.LaserSettings</a></span>:</span></span>

                <label class="view-source-button" for="laser-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#laser"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="laser-890"><a href="#laser-890"><span class="linenos">890</span></a><span class="k">def</span> <span class="nf">laser</span><span class="p">(</span>
</span><span id="laser-891"><a href="#laser-891"><span class="linenos">891</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="laser-892"><a href="#laser-892"><span class="linenos">892</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="laser-893"><a href="#laser-893"><span class="linenos">893</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="laser-894"><a href="#laser-894"><span class="linenos">894</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="laser-895"><a href="#laser-895"><span class="linenos">895</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserSettings</span><span class="p">:</span>
</span><span id="laser-896"><a href="#laser-896"><span class="linenos">896</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="laser-897"><a href="#laser-897"><span class="linenos">897</span></a><span class="sd">    Convert a laser step from a .yml file to microscope settings for performing laser milling.</span>
</span><span id="laser-898"><a href="#laser-898"><span class="linenos">898</span></a>
</span><span id="laser-899"><a href="#laser-899"><span class="linenos">899</span></a><span class="sd">    This function converts a laser step from a .yml file to `LaserSettings` for the microscope. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="laser-900"><a href="#laser-900"><span class="linenos">900</span></a>
</span><span id="laser-901"><a href="#laser-901"><span class="linenos">901</span></a><span class="sd">    Parameters</span>
</span><span id="laser-902"><a href="#laser-902"><span class="linenos">902</span></a><span class="sd">    ----------</span>
</span><span id="laser-903"><a href="#laser-903"><span class="linenos">903</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="laser-904"><a href="#laser-904"><span class="linenos">904</span></a><span class="sd">        The microscope object for which to set the laser settings.</span>
</span><span id="laser-905"><a href="#laser-905"><span class="linenos">905</span></a><span class="sd">    step_settings : dict</span>
</span><span id="laser-906"><a href="#laser-906"><span class="linenos">906</span></a><span class="sd">        The dictionary containing the laser step settings from the .yml file.</span>
</span><span id="laser-907"><a href="#laser-907"><span class="linenos">907</span></a><span class="sd">    step_name : str</span>
</span><span id="laser-908"><a href="#laser-908"><span class="linenos">908</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="laser-909"><a href="#laser-909"><span class="linenos">909</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="laser-910"><a href="#laser-910"><span class="linenos">910</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="laser-911"><a href="#laser-911"><span class="linenos">911</span></a>
</span><span id="laser-912"><a href="#laser-912"><span class="linenos">912</span></a><span class="sd">    Returns</span>
</span><span id="laser-913"><a href="#laser-913"><span class="linenos">913</span></a><span class="sd">    -------</span>
</span><span id="laser-914"><a href="#laser-914"><span class="linenos">914</span></a><span class="sd">    tbt.LaserSettings</span>
</span><span id="laser-915"><a href="#laser-915"><span class="linenos">915</span></a><span class="sd">        The laser settings object.</span>
</span><span id="laser-916"><a href="#laser-916"><span class="linenos">916</span></a>
</span><span id="laser-917"><a href="#laser-917"><span class="linenos">917</span></a><span class="sd">    Raises</span>
</span><span id="laser-918"><a href="#laser-918"><span class="linenos">918</span></a><span class="sd">    ------</span>
</span><span id="laser-919"><a href="#laser-919"><span class="linenos">919</span></a><span class="sd">    KeyError</span>
</span><span id="laser-920"><a href="#laser-920"><span class="linenos">920</span></a><span class="sd">        If required settings are missing from the .yml file.</span>
</span><span id="laser-921"><a href="#laser-921"><span class="linenos">921</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="laser-922"><a href="#laser-922"><span class="linenos">922</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="laser-923"><a href="#laser-923"><span class="linenos">923</span></a>        <span class="c1"># pulse settings</span>
</span><span id="laser-924"><a href="#laser-924"><span class="linenos">924</span></a>        <span class="n">pulse_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pulse&quot;</span><span class="p">)</span>
</span><span id="laser-925"><a href="#laser-925"><span class="linenos">925</span></a>        <span class="k">if</span> <span class="n">pulse_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="laser-926"><a href="#laser-926"><span class="linenos">926</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="laser-927"><a href="#laser-927"><span class="linenos">927</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;pulse&#39; settings found in &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="laser-928"><a href="#laser-928"><span class="linenos">928</span></a>            <span class="p">)</span>
</span><span id="laser-929"><a href="#laser-929"><span class="linenos">929</span></a>        <span class="c1"># laser optics settings</span>
</span><span id="laser-930"><a href="#laser-930"><span class="linenos">930</span></a>        <span class="n">optics_set_db</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="laser-931"><a href="#laser-931"><span class="linenos">931</span></a>            <span class="s2">&quot;objective_position_mm&quot;</span><span class="p">:</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;objective_position_mm&quot;</span><span class="p">),</span>
</span><span id="laser-932"><a href="#laser-932"><span class="linenos">932</span></a>            <span class="s2">&quot;beam_shift_um_x&quot;</span><span class="p">:</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;beam_shift&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x_um&quot;</span><span class="p">),</span>
</span><span id="laser-933"><a href="#laser-933"><span class="linenos">933</span></a>            <span class="s2">&quot;beam_shift_um_y&quot;</span><span class="p">:</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;beam_shift&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y_um&quot;</span><span class="p">),</span>
</span><span id="laser-934"><a href="#laser-934"><span class="linenos">934</span></a>        <span class="p">}</span>
</span><span id="laser-935"><a href="#laser-935"><span class="linenos">935</span></a>        <span class="c1"># pattern settings</span>
</span><span id="laser-936"><a href="#laser-936"><span class="linenos">936</span></a>        <span class="n">pattern_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pattern&quot;</span><span class="p">)</span>
</span><span id="laser-937"><a href="#laser-937"><span class="linenos">937</span></a>        <span class="k">if</span> <span class="n">pattern_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="laser-938"><a href="#laser-938"><span class="linenos">938</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="laser-939"><a href="#laser-939"><span class="linenos">939</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;pattern&#39; settings found in &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="laser-940"><a href="#laser-940"><span class="linenos">940</span></a>            <span class="p">)</span>
</span><span id="laser-941"><a href="#laser-941"><span class="linenos">941</span></a>        <span class="n">line_pattern_db</span> <span class="o">=</span> <span class="n">pattern_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">)</span>
</span><span id="laser-942"><a href="#laser-942"><span class="linenos">942</span></a>        <span class="n">box_pattern_db</span> <span class="o">=</span> <span class="n">pattern_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
</span><span id="laser-943"><a href="#laser-943"><span class="linenos">943</span></a>
</span><span id="laser-944"><a href="#laser-944"><span class="linenos">944</span></a>    <span class="n">validate_pulse_settings</span><span class="p">(</span>
</span><span id="laser-945"><a href="#laser-945"><span class="linenos">945</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">pulse_set_db</span><span class="p">,</span>
</span><span id="laser-946"><a href="#laser-946"><span class="linenos">946</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="laser-947"><a href="#laser-947"><span class="linenos">947</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="laser-948"><a href="#laser-948"><span class="linenos">948</span></a>    <span class="p">)</span>
</span><span id="laser-949"><a href="#laser-949"><span class="linenos">949</span></a>    <span class="n">pulse</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPulse</span><span class="p">(</span>
</span><span id="laser-950"><a href="#laser-950"><span class="linenos">950</span></a>        <span class="n">wavelength_nm</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserWavelength</span><span class="p">(</span><span class="n">pulse_set_db</span><span class="p">[</span><span class="s2">&quot;wavelength_nm&quot;</span><span class="p">]),</span>
</span><span id="laser-951"><a href="#laser-951"><span class="linenos">951</span></a>        <span class="n">divider</span><span class="o">=</span><span class="n">pulse_set_db</span><span class="p">[</span><span class="s2">&quot;divider&quot;</span><span class="p">],</span>
</span><span id="laser-952"><a href="#laser-952"><span class="linenos">952</span></a>        <span class="n">energy_uj</span><span class="o">=</span><span class="n">pulse_set_db</span><span class="p">[</span><span class="s2">&quot;energy_uj&quot;</span><span class="p">],</span>
</span><span id="laser-953"><a href="#laser-953"><span class="linenos">953</span></a>        <span class="n">polarization</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPolarization</span><span class="p">(</span><span class="n">pulse_set_db</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]),</span>
</span><span id="laser-954"><a href="#laser-954"><span class="linenos">954</span></a>    <span class="p">)</span>
</span><span id="laser-955"><a href="#laser-955"><span class="linenos">955</span></a>
</span><span id="laser-956"><a href="#laser-956"><span class="linenos">956</span></a>    <span class="n">validate_laser_optics_settings</span><span class="p">(</span>
</span><span id="laser-957"><a href="#laser-957"><span class="linenos">957</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">optics_set_db</span><span class="p">,</span>
</span><span id="laser-958"><a href="#laser-958"><span class="linenos">958</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="laser-959"><a href="#laser-959"><span class="linenos">959</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="laser-960"><a href="#laser-960"><span class="linenos">960</span></a>    <span class="p">)</span>
</span><span id="laser-961"><a href="#laser-961"><span class="linenos">961</span></a>
</span><span id="laser-962"><a href="#laser-962"><span class="linenos">962</span></a>    <span class="n">pattern_type</span> <span class="o">=</span> <span class="n">validate_laser_pattern_settings</span><span class="p">(</span>
</span><span id="laser-963"><a href="#laser-963"><span class="linenos">963</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">pattern_set_db</span><span class="p">,</span>
</span><span id="laser-964"><a href="#laser-964"><span class="linenos">964</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="laser-965"><a href="#laser-965"><span class="linenos">965</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="laser-966"><a href="#laser-966"><span class="linenos">966</span></a>    <span class="p">)</span>
</span><span id="laser-967"><a href="#laser-967"><span class="linenos">967</span></a>    <span class="k">if</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="o">.</span><span class="n">BOX</span><span class="p">:</span>
</span><span id="laser-968"><a href="#laser-968"><span class="linenos">968</span></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="n">laser_box_pattern</span><span class="p">(</span><span class="n">box_pattern_db</span><span class="p">)</span>
</span><span id="laser-969"><a href="#laser-969"><span class="linenos">969</span></a>    <span class="k">if</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="o">.</span><span class="n">LINE</span><span class="p">:</span>
</span><span id="laser-970"><a href="#laser-970"><span class="linenos">970</span></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="n">laser_line_pattern</span><span class="p">(</span><span class="n">line_pattern_db</span><span class="p">)</span>
</span><span id="laser-971"><a href="#laser-971"><span class="linenos">971</span></a>    <span class="n">pattern</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPattern</span><span class="p">(</span>
</span><span id="laser-972"><a href="#laser-972"><span class="linenos">972</span></a>        <span class="n">mode</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternMode</span><span class="p">(</span><span class="n">pattern_set_db</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]),</span>
</span><span id="laser-973"><a href="#laser-973"><span class="linenos">973</span></a>        <span class="n">rotation_deg</span><span class="o">=</span><span class="n">pattern_set_db</span><span class="p">[</span><span class="s2">&quot;rotation_deg&quot;</span><span class="p">],</span>
</span><span id="laser-974"><a href="#laser-974"><span class="linenos">974</span></a>        <span class="n">pulses_per_pixel</span><span class="o">=</span><span class="n">pattern_set_db</span><span class="p">[</span><span class="s2">&quot;pulses_per_pixel&quot;</span><span class="p">],</span>
</span><span id="laser-975"><a href="#laser-975"><span class="linenos">975</span></a>        <span class="n">pixel_dwell_ms</span><span class="o">=</span><span class="n">pattern_set_db</span><span class="p">[</span><span class="s2">&quot;pixel_dwell_ms&quot;</span><span class="p">],</span>
</span><span id="laser-976"><a href="#laser-976"><span class="linenos">976</span></a>        <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span>
</span><span id="laser-977"><a href="#laser-977"><span class="linenos">977</span></a>    <span class="p">)</span>
</span><span id="laser-978"><a href="#laser-978"><span class="linenos">978</span></a>
</span><span id="laser-979"><a href="#laser-979"><span class="linenos">979</span></a>    <span class="n">laser_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserSettings</span><span class="p">(</span>
</span><span id="laser-980"><a href="#laser-980"><span class="linenos">980</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="laser-981"><a href="#laser-981"><span class="linenos">981</span></a>        <span class="n">pulse</span><span class="o">=</span><span class="n">pulse</span><span class="p">,</span>
</span><span id="laser-982"><a href="#laser-982"><span class="linenos">982</span></a>        <span class="n">objective_position_mm</span><span class="o">=</span><span class="n">optics_set_db</span><span class="p">[</span><span class="s2">&quot;objective_position_mm&quot;</span><span class="p">],</span>
</span><span id="laser-983"><a href="#laser-983"><span class="linenos">983</span></a>        <span class="n">beam_shift_um</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span>
</span><span id="laser-984"><a href="#laser-984"><span class="linenos">984</span></a>            <span class="n">x</span><span class="o">=</span><span class="n">optics_set_db</span><span class="p">[</span><span class="s2">&quot;beam_shift_um_x&quot;</span><span class="p">],</span>
</span><span id="laser-985"><a href="#laser-985"><span class="linenos">985</span></a>            <span class="n">y</span><span class="o">=</span><span class="n">optics_set_db</span><span class="p">[</span><span class="s2">&quot;beam_shift_um_y&quot;</span><span class="p">],</span>
</span><span id="laser-986"><a href="#laser-986"><span class="linenos">986</span></a>        <span class="p">),</span>
</span><span id="laser-987"><a href="#laser-987"><span class="linenos">987</span></a>        <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span>
</span><span id="laser-988"><a href="#laser-988"><span class="linenos">988</span></a>    <span class="p">)</span>
</span><span id="laser-989"><a href="#laser-989"><span class="linenos">989</span></a>
</span><span id="laser-990"><a href="#laser-990"><span class="linenos">990</span></a>    <span class="k">return</span> <span class="n">laser_settings</span>
</span></pre></div>


            <div class="docstring"><p>Convert a laser step from a .yml file to microscope settings for performing laser milling.</p>

<p>This function converts a laser step from a .yml file to <code>LaserSettings</code> for the microscope. It performs schema checking to ensure valid inputs are requested.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object for which to set the laser settings.
step_settings : dict
    The dictionary containing the laser step settings from the .yml file.
step_name : str
    The name of the step in the .yml file.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>tbt.LaserSettings
    The laser settings object.</p>

<h2 id="raises">Raises</h2>

<p>KeyError
    If required settings are missing from the .yml file.</p>
</div>


                </section>
                <section id="image">
                            <input id="image-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">image</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span>,</span><span class="param">	<span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#ImageSettings">pytribeam.types.ImageSettings</a></span>:</span></span>

                <label class="view-source-button" for="image-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#image"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="image-993"><a href="#image-993"><span class="linenos"> 993</span></a><span class="k">def</span> <span class="nf">image</span><span class="p">(</span>
</span><span id="image-994"><a href="#image-994"><span class="linenos"> 994</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="image-995"><a href="#image-995"><span class="linenos"> 995</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="image-996"><a href="#image-996"><span class="linenos"> 996</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="image-997"><a href="#image-997"><span class="linenos"> 997</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="image-998"><a href="#image-998"><span class="linenos"> 998</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ImageSettings</span><span class="p">:</span>
</span><span id="image-999"><a href="#image-999"><span class="linenos"> 999</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="image-1000"><a href="#image-1000"><span class="linenos">1000</span></a><span class="sd">    Convert an image step from a .yml file to microscope settings for capturing an image.</span>
</span><span id="image-1001"><a href="#image-1001"><span class="linenos">1001</span></a>
</span><span id="image-1002"><a href="#image-1002"><span class="linenos">1002</span></a><span class="sd">    This function converts an image step from a .yml file to `ImageSettings` for the microscope. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="image-1003"><a href="#image-1003"><span class="linenos">1003</span></a>
</span><span id="image-1004"><a href="#image-1004"><span class="linenos">1004</span></a><span class="sd">    Parameters</span>
</span><span id="image-1005"><a href="#image-1005"><span class="linenos">1005</span></a><span class="sd">    ----------</span>
</span><span id="image-1006"><a href="#image-1006"><span class="linenos">1006</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="image-1007"><a href="#image-1007"><span class="linenos">1007</span></a><span class="sd">        The microscope object for which to set the image settings.</span>
</span><span id="image-1008"><a href="#image-1008"><span class="linenos">1008</span></a><span class="sd">    step_settings : dict</span>
</span><span id="image-1009"><a href="#image-1009"><span class="linenos">1009</span></a><span class="sd">        The dictionary containing the image step settings from the .yml file.</span>
</span><span id="image-1010"><a href="#image-1010"><span class="linenos">1010</span></a><span class="sd">    step_name : str</span>
</span><span id="image-1011"><a href="#image-1011"><span class="linenos">1011</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="image-1012"><a href="#image-1012"><span class="linenos">1012</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="image-1013"><a href="#image-1013"><span class="linenos">1013</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="image-1014"><a href="#image-1014"><span class="linenos">1014</span></a>
</span><span id="image-1015"><a href="#image-1015"><span class="linenos">1015</span></a><span class="sd">    Returns</span>
</span><span id="image-1016"><a href="#image-1016"><span class="linenos">1016</span></a><span class="sd">    -------</span>
</span><span id="image-1017"><a href="#image-1017"><span class="linenos">1017</span></a><span class="sd">    tbt.ImageSettings</span>
</span><span id="image-1018"><a href="#image-1018"><span class="linenos">1018</span></a><span class="sd">        The image settings object.</span>
</span><span id="image-1019"><a href="#image-1019"><span class="linenos">1019</span></a>
</span><span id="image-1020"><a href="#image-1020"><span class="linenos">1020</span></a><span class="sd">    Raises</span>
</span><span id="image-1021"><a href="#image-1021"><span class="linenos">1021</span></a><span class="sd">    ------</span>
</span><span id="image-1022"><a href="#image-1022"><span class="linenos">1022</span></a><span class="sd">    KeyError</span>
</span><span id="image-1023"><a href="#image-1023"><span class="linenos">1023</span></a><span class="sd">        If required settings are missing from the .yml file.</span>
</span><span id="image-1024"><a href="#image-1024"><span class="linenos">1024</span></a><span class="sd">    NotImplementedError</span>
</span><span id="image-1025"><a href="#image-1025"><span class="linenos">1025</span></a><span class="sd">        If the provided beam type is unsupported.</span>
</span><span id="image-1026"><a href="#image-1026"><span class="linenos">1026</span></a><span class="sd">    ValueError</span>
</span><span id="image-1027"><a href="#image-1027"><span class="linenos">1027</span></a><span class="sd">        If invalid scan rotation is requested with dynamic focus or tilt correction, or if the bit depth is unsupported.</span>
</span><span id="image-1028"><a href="#image-1028"><span class="linenos">1028</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="image-1029"><a href="#image-1029"><span class="linenos">1029</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="image-1030"><a href="#image-1030"><span class="linenos">1030</span></a>        <span class="n">step_general</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_general_key</span><span class="p">)</span>
</span><span id="image-1031"><a href="#image-1031"><span class="linenos">1031</span></a>        <span class="k">if</span> <span class="n">step_general</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="image-1032"><a href="#image-1032"><span class="linenos">1032</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="image-1033"><a href="#image-1033"><span class="linenos">1033</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;step_general&#39; settings found in step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="image-1034"><a href="#image-1034"><span class="linenos">1034</span></a>            <span class="p">)</span>
</span><span id="image-1035"><a href="#image-1035"><span class="linenos">1035</span></a>        <span class="n">step_type</span> <span class="o">=</span> <span class="n">step_general</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_type_key</span><span class="p">)</span>
</span><span id="image-1036"><a href="#image-1036"><span class="linenos">1036</span></a>        <span class="k">if</span> <span class="n">step_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="image-1037"><a href="#image-1037"><span class="linenos">1037</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="image-1038"><a href="#image-1038"><span class="linenos">1038</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;step_type&#39; settings found in step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="image-1039"><a href="#image-1039"><span class="linenos">1039</span></a>            <span class="p">)</span>
</span><span id="image-1040"><a href="#image-1040"><span class="linenos">1040</span></a>        <span class="c1"># beam settings</span>
</span><span id="image-1041"><a href="#image-1041"><span class="linenos">1041</span></a>        <span class="n">beam_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;beam&quot;</span><span class="p">)</span>
</span><span id="image-1042"><a href="#image-1042"><span class="linenos">1042</span></a>        <span class="k">if</span> <span class="n">beam_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="image-1043"><a href="#image-1043"><span class="linenos">1043</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="image-1044"><a href="#image-1044"><span class="linenos">1044</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;beam&#39; settings found in &#39;</span><span class="si">{</span><span class="n">step_type</span><span class="si">}</span><span class="s2">&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="image-1045"><a href="#image-1045"><span class="linenos">1045</span></a>            <span class="p">)</span>
</span><span id="image-1046"><a href="#image-1046"><span class="linenos">1046</span></a>        <span class="n">beam_type_value</span> <span class="o">=</span> <span class="n">beam_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="image-1047"><a href="#image-1047"><span class="linenos">1047</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">beam_type_value</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">):</span>
</span><span id="image-1048"><a href="#image-1048"><span class="linenos">1048</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="image-1049"><a href="#image-1049"><span class="linenos">1049</span></a>                <span class="sa">f</span><span class="s2">&quot;Unsupported beam type of &#39;</span><span class="si">{</span><span class="n">beam_type_value</span><span class="si">}</span><span class="s2">&#39;, supported beam types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="image-1050"><a href="#image-1050"><span class="linenos">1050</span></a>            <span class="p">)</span>
</span><span id="image-1051"><a href="#image-1051"><span class="linenos">1051</span></a>        <span class="n">beam_type</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">(</span><span class="n">beam_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">))</span>
</span><span id="image-1052"><a href="#image-1052"><span class="linenos">1052</span></a>
</span><span id="image-1053"><a href="#image-1053"><span class="linenos">1053</span></a>        <span class="c1"># detector settings</span>
</span><span id="image-1054"><a href="#image-1054"><span class="linenos">1054</span></a>        <span class="n">detector_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;detector&quot;</span><span class="p">)</span>
</span><span id="image-1055"><a href="#image-1055"><span class="linenos">1055</span></a>        <span class="k">if</span> <span class="n">detector_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="image-1056"><a href="#image-1056"><span class="linenos">1056</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="image-1057"><a href="#image-1057"><span class="linenos">1057</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;detector&#39; settings found in &#39;</span><span class="si">{</span><span class="n">step_type</span><span class="si">}</span><span class="s2">&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="image-1058"><a href="#image-1058"><span class="linenos">1058</span></a>            <span class="p">)</span>
</span><span id="image-1059"><a href="#image-1059"><span class="linenos">1059</span></a>        <span class="n">auto_cb_set_db</span> <span class="o">=</span> <span class="n">detector_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;auto_cb&quot;</span><span class="p">)</span>
</span><span id="image-1060"><a href="#image-1060"><span class="linenos">1060</span></a>
</span><span id="image-1061"><a href="#image-1061"><span class="linenos">1061</span></a>        <span class="c1"># scan settings</span>
</span><span id="image-1062"><a href="#image-1062"><span class="linenos">1062</span></a>        <span class="n">scan_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan&quot;</span><span class="p">)</span>
</span><span id="image-1063"><a href="#image-1063"><span class="linenos">1063</span></a>        <span class="k">if</span> <span class="n">scan_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="image-1064"><a href="#image-1064"><span class="linenos">1064</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="image-1065"><a href="#image-1065"><span class="linenos">1065</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;scan&#39; settings found in &#39;</span><span class="si">{</span><span class="n">step_type</span><span class="si">}</span><span class="s2">&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="image-1066"><a href="#image-1066"><span class="linenos">1066</span></a>            <span class="p">)</span>
</span><span id="image-1067"><a href="#image-1067"><span class="linenos">1067</span></a>        <span class="n">scan_res</span> <span class="o">=</span> <span class="n">string_to_res</span><span class="p">(</span><span class="n">scan_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resolution&quot;</span><span class="p">))</span>
</span><span id="image-1068"><a href="#image-1068"><span class="linenos">1068</span></a>
</span><span id="image-1069"><a href="#image-1069"><span class="linenos">1069</span></a>        <span class="c1"># misc settings</span>
</span><span id="image-1070"><a href="#image-1070"><span class="linenos">1070</span></a>        <span class="n">bit_depth</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bit_depth&quot;</span><span class="p">)</span>
</span><span id="image-1071"><a href="#image-1071"><span class="linenos">1071</span></a>
</span><span id="image-1072"><a href="#image-1072"><span class="linenos">1072</span></a>    <span class="c1"># TODO incorporate tile settings</span>
</span><span id="image-1073"><a href="#image-1073"><span class="linenos">1073</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.1</span><span class="p">:</span>
</span><span id="image-1074"><a href="#image-1074"><span class="linenos">1074</span></a>        <span class="c1"># tile settings</span>
</span><span id="image-1075"><a href="#image-1075"><span class="linenos">1075</span></a>        <span class="n">tile_set_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tile_settings&quot;</span><span class="p">)</span>
</span><span id="image-1076"><a href="#image-1076"><span class="linenos">1076</span></a>
</span><span id="image-1077"><a href="#image-1077"><span class="linenos">1077</span></a>    <span class="n">validate_beam_settings</span><span class="p">(</span>
</span><span id="image-1078"><a href="#image-1078"><span class="linenos">1078</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="image-1079"><a href="#image-1079"><span class="linenos">1079</span></a>        <span class="n">beam_type</span><span class="o">=</span><span class="n">beam_type</span><span class="p">,</span>
</span><span id="image-1080"><a href="#image-1080"><span class="linenos">1080</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">,</span>
</span><span id="image-1081"><a href="#image-1081"><span class="linenos">1081</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="image-1082"><a href="#image-1082"><span class="linenos">1082</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="image-1083"><a href="#image-1083"><span class="linenos">1083</span></a>    <span class="p">)</span>
</span><span id="image-1084"><a href="#image-1084"><span class="linenos">1084</span></a>    <span class="n">beam_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">(</span>
</span><span id="image-1085"><a href="#image-1085"><span class="linenos">1085</span></a>        <span class="n">voltage_kv</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;voltage_kv&quot;</span><span class="p">],</span>
</span><span id="image-1086"><a href="#image-1086"><span class="linenos">1086</span></a>        <span class="n">voltage_tol_kv</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;voltage_tol_kv&quot;</span><span class="p">],</span>
</span><span id="image-1087"><a href="#image-1087"><span class="linenos">1087</span></a>        <span class="n">current_na</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;current_na&quot;</span><span class="p">],</span>
</span><span id="image-1088"><a href="#image-1088"><span class="linenos">1088</span></a>        <span class="n">current_tol_na</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;current_tol_na&quot;</span><span class="p">],</span>
</span><span id="image-1089"><a href="#image-1089"><span class="linenos">1089</span></a>        <span class="n">hfw_mm</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;hfw_mm&quot;</span><span class="p">],</span>
</span><span id="image-1090"><a href="#image-1090"><span class="linenos">1090</span></a>        <span class="n">working_dist_mm</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;working_dist_mm&quot;</span><span class="p">],</span>
</span><span id="image-1091"><a href="#image-1091"><span class="linenos">1091</span></a>        <span class="n">dynamic_focus</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;dynamic_focus&quot;</span><span class="p">],</span>
</span><span id="image-1092"><a href="#image-1092"><span class="linenos">1092</span></a>        <span class="n">tilt_correction</span><span class="o">=</span><span class="n">beam_set_db</span><span class="p">[</span><span class="s2">&quot;tilt_correction&quot;</span><span class="p">],</span>
</span><span id="image-1093"><a href="#image-1093"><span class="linenos">1093</span></a>    <span class="p">)</span>
</span><span id="image-1094"><a href="#image-1094"><span class="linenos">1094</span></a>
</span><span id="image-1095"><a href="#image-1095"><span class="linenos">1095</span></a>    <span class="n">validate_auto_cb_settings</span><span class="p">(</span>
</span><span id="image-1096"><a href="#image-1096"><span class="linenos">1096</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">auto_cb_set_db</span><span class="p">,</span>
</span><span id="image-1097"><a href="#image-1097"><span class="linenos">1097</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="image-1098"><a href="#image-1098"><span class="linenos">1098</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="image-1099"><a href="#image-1099"><span class="linenos">1099</span></a>    <span class="p">)</span>
</span><span id="image-1100"><a href="#image-1100"><span class="linenos">1100</span></a>    <span class="n">auto_cb_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ScanArea</span><span class="p">(</span>
</span><span id="image-1101"><a href="#image-1101"><span class="linenos">1101</span></a>        <span class="n">left</span><span class="o">=</span><span class="n">auto_cb_set_db</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">],</span>
</span><span id="image-1102"><a href="#image-1102"><span class="linenos">1102</span></a>        <span class="n">top</span><span class="o">=</span><span class="n">auto_cb_set_db</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">],</span>
</span><span id="image-1103"><a href="#image-1103"><span class="linenos">1103</span></a>        <span class="n">width</span><span class="o">=</span><span class="n">auto_cb_set_db</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
</span><span id="image-1104"><a href="#image-1104"><span class="linenos">1104</span></a>        <span class="n">height</span><span class="o">=</span><span class="n">auto_cb_set_db</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
</span><span id="image-1105"><a href="#image-1105"><span class="linenos">1105</span></a>    <span class="p">)</span>
</span><span id="image-1106"><a href="#image-1106"><span class="linenos">1106</span></a>
</span><span id="image-1107"><a href="#image-1107"><span class="linenos">1107</span></a>    <span class="n">validate_detector_settings</span><span class="p">(</span>
</span><span id="image-1108"><a href="#image-1108"><span class="linenos">1108</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="image-1109"><a href="#image-1109"><span class="linenos">1109</span></a>        <span class="n">beam_type</span><span class="o">=</span><span class="n">beam_type</span><span class="p">,</span>
</span><span id="image-1110"><a href="#image-1110"><span class="linenos">1110</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">detector_set_db</span><span class="p">,</span>
</span><span id="image-1111"><a href="#image-1111"><span class="linenos">1111</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="image-1112"><a href="#image-1112"><span class="linenos">1112</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="image-1113"><a href="#image-1113"><span class="linenos">1113</span></a>    <span class="p">)</span>
</span><span id="image-1114"><a href="#image-1114"><span class="linenos">1114</span></a>    <span class="n">detector_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Detector</span><span class="p">(</span>
</span><span id="image-1115"><a href="#image-1115"><span class="linenos">1115</span></a>        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">DetectorType</span><span class="p">(</span><span class="n">detector_set_db</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]),</span>
</span><span id="image-1116"><a href="#image-1116"><span class="linenos">1116</span></a>        <span class="n">mode</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">DetectorMode</span><span class="p">(</span><span class="n">detector_set_db</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]),</span>
</span><span id="image-1117"><a href="#image-1117"><span class="linenos">1117</span></a>        <span class="n">brightness</span><span class="o">=</span><span class="n">detector_set_db</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">],</span>
</span><span id="image-1118"><a href="#image-1118"><span class="linenos">1118</span></a>        <span class="n">contrast</span><span class="o">=</span><span class="n">detector_set_db</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
</span><span id="image-1119"><a href="#image-1119"><span class="linenos">1119</span></a>        <span class="n">auto_cb_settings</span><span class="o">=</span><span class="n">auto_cb_settings</span><span class="p">,</span>
</span><span id="image-1120"><a href="#image-1120"><span class="linenos">1120</span></a>        <span class="c1"># custom_settings=None,</span>
</span><span id="image-1121"><a href="#image-1121"><span class="linenos">1121</span></a>    <span class="p">)</span>
</span><span id="image-1122"><a href="#image-1122"><span class="linenos">1122</span></a>
</span><span id="image-1123"><a href="#image-1123"><span class="linenos">1123</span></a>    <span class="n">validate_scan_settings</span><span class="p">(</span>
</span><span id="image-1124"><a href="#image-1124"><span class="linenos">1124</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="image-1125"><a href="#image-1125"><span class="linenos">1125</span></a>        <span class="n">beam_type</span><span class="o">=</span><span class="n">beam_type</span><span class="p">,</span>
</span><span id="image-1126"><a href="#image-1126"><span class="linenos">1126</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">scan_set_db</span><span class="p">,</span>
</span><span id="image-1127"><a href="#image-1127"><span class="linenos">1127</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="image-1128"><a href="#image-1128"><span class="linenos">1128</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="image-1129"><a href="#image-1129"><span class="linenos">1129</span></a>    <span class="p">)</span>
</span><span id="image-1130"><a href="#image-1130"><span class="linenos">1130</span></a>
</span><span id="image-1131"><a href="#image-1131"><span class="linenos">1131</span></a>    <span class="c1"># cast resolution to preset if applicable</span>
</span><span id="image-1132"><a href="#image-1132"><span class="linenos">1132</span></a>    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">scan_res</span><span class="p">,</span> <span class="n">check_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">PresetResolution</span><span class="p">):</span>
</span><span id="image-1133"><a href="#image-1133"><span class="linenos">1133</span></a>        <span class="n">scan_res</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">PresetResolution</span><span class="p">(</span><span class="n">scan_res</span><span class="p">)</span>
</span><span id="image-1134"><a href="#image-1134"><span class="linenos">1134</span></a>
</span><span id="image-1135"><a href="#image-1135"><span class="linenos">1135</span></a>    <span class="n">scan_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Scan</span><span class="p">(</span>
</span><span id="image-1136"><a href="#image-1136"><span class="linenos">1136</span></a>        <span class="n">rotation_deg</span><span class="o">=</span><span class="n">scan_set_db</span><span class="p">[</span><span class="s2">&quot;rotation_deg&quot;</span><span class="p">],</span>
</span><span id="image-1137"><a href="#image-1137"><span class="linenos">1137</span></a>        <span class="n">dwell_time_us</span><span class="o">=</span><span class="n">scan_set_db</span><span class="p">[</span><span class="s2">&quot;dwell_time_us&quot;</span><span class="p">],</span>
</span><span id="image-1138"><a href="#image-1138"><span class="linenos">1138</span></a>        <span class="n">resolution</span><span class="o">=</span><span class="n">scan_res</span><span class="p">,</span>
</span><span id="image-1139"><a href="#image-1139"><span class="linenos">1139</span></a>        <span class="c1"># mode=tbt.ScanMode(scan_set_db[&quot;mode&quot;]),</span>
</span><span id="image-1140"><a href="#image-1140"><span class="linenos">1140</span></a>    <span class="p">)</span>
</span><span id="image-1141"><a href="#image-1141"><span class="linenos">1141</span></a>
</span><span id="image-1142"><a href="#image-1142"><span class="linenos">1142</span></a>    <span class="c1"># make sure Scan rotation is 0 if dynamic focus or tilt correction is on (using auto mode only for angular correction)</span>
</span><span id="image-1143"><a href="#image-1143"><span class="linenos">1143</span></a>    <span class="k">if</span> <span class="n">beam_settings</span><span class="o">.</span><span class="n">dynamic_focus</span> <span class="ow">or</span> <span class="n">beam_settings</span><span class="o">.</span><span class="n">tilt_correction</span><span class="p">:</span>
</span><span id="image-1144"><a href="#image-1144"><span class="linenos">1144</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">scan_settings</span><span class="o">.</span><span class="n">rotation_deg</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
</span><span id="image-1145"><a href="#image-1145"><span class="linenos">1145</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="image-1146"><a href="#image-1146"><span class="linenos">1146</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. Scan rotation of &#39;</span><span class="si">{</span><span class="n">scan_settings</span><span class="o">.</span><span class="n">rotation_deg</span><span class="si">}</span><span class="s2">&#39; degrees requested with tilt_correction and/or dynamic focus set to &#39;True&#39;. Cannot use dynamic focus or tilt correction for non-zero scan rotation.&quot;</span>
</span><span id="image-1147"><a href="#image-1147"><span class="linenos">1147</span></a>            <span class="p">)</span>
</span><span id="image-1148"><a href="#image-1148"><span class="linenos">1148</span></a>
</span><span id="image-1149"><a href="#image-1149"><span class="linenos">1149</span></a>    <span class="c1"># validate bit_depth</span>
</span><span id="image-1150"><a href="#image-1150"><span class="linenos">1150</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">bit_depth</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ColorDepth</span><span class="p">):</span>
</span><span id="image-1151"><a href="#image-1151"><span class="linenos">1151</span></a>        <span class="n">valid_bit_depths</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ColorDepth</span><span class="p">]</span>
</span><span id="image-1152"><a href="#image-1152"><span class="linenos">1152</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="image-1153"><a href="#image-1153"><span class="linenos">1153</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported bit depth of </span><span class="si">{</span><span class="n">bit_depth</span><span class="si">}</span><span class="s2">, available depths are </span><span class="si">{</span><span class="n">valid_bit_depths</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="image-1154"><a href="#image-1154"><span class="linenos">1154</span></a>        <span class="p">)</span>
</span><span id="image-1155"><a href="#image-1155"><span class="linenos">1155</span></a>
</span><span id="image-1156"><a href="#image-1156"><span class="linenos">1156</span></a>    <span class="n">image_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ImageSettings</span><span class="p">(</span>
</span><span id="image-1157"><a href="#image-1157"><span class="linenos">1157</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="image-1158"><a href="#image-1158"><span class="linenos">1158</span></a>        <span class="n">beam</span><span class="o">=</span><span class="n">beam_object_type</span><span class="p">(</span><span class="n">beam_type</span><span class="p">)(</span><span class="n">settings</span><span class="o">=</span><span class="n">beam_settings</span><span class="p">),</span>
</span><span id="image-1159"><a href="#image-1159"><span class="linenos">1159</span></a>        <span class="n">detector</span><span class="o">=</span><span class="n">detector_settings</span><span class="p">,</span>
</span><span id="image-1160"><a href="#image-1160"><span class="linenos">1160</span></a>        <span class="n">scan</span><span class="o">=</span><span class="n">scan_settings</span><span class="p">,</span>
</span><span id="image-1161"><a href="#image-1161"><span class="linenos">1161</span></a>        <span class="n">bit_depth</span><span class="o">=</span><span class="n">bit_depth</span><span class="p">,</span>
</span><span id="image-1162"><a href="#image-1162"><span class="linenos">1162</span></a>    <span class="p">)</span>
</span><span id="image-1163"><a href="#image-1163"><span class="linenos">1163</span></a>
</span><span id="image-1164"><a href="#image-1164"><span class="linenos">1164</span></a>    <span class="k">return</span> <span class="n">image_settings</span>
</span></pre></div>


            <div class="docstring"><p>Convert an image step from a .yml file to microscope settings for capturing an image.</p>

<p>This function converts an image step from a .yml file to <code>ImageSettings</code> for the microscope. It performs schema checking to ensure valid inputs are requested.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object for which to set the image settings.
step_settings : dict
    The dictionary containing the image step settings from the .yml file.
step_name : str
    The name of the step in the .yml file.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>tbt.ImageSettings
    The image settings object.</p>

<h2 id="raises">Raises</h2>

<p>KeyError
    If required settings are missing from the .yml file.
NotImplementedError
    If the provided beam type is unsupported.
ValueError
    If invalid scan rotation is requested with dynamic focus or tilt correction, or if the bit depth is unsupported.</p>
</div>


                </section>
                <section id="fib">
                            <input id="fib-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fib</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span>,</span><span class="param">	<span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#FIBSettings">pytribeam.types.FIBSettings</a></span>:</span></span>

                <label class="view-source-button" for="fib-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fib"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fib-1167"><a href="#fib-1167"><span class="linenos">1167</span></a><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span>
</span><span id="fib-1168"><a href="#fib-1168"><span class="linenos">1168</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="fib-1169"><a href="#fib-1169"><span class="linenos">1169</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="fib-1170"><a href="#fib-1170"><span class="linenos">1170</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="fib-1171"><a href="#fib-1171"><span class="linenos">1171</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="fib-1172"><a href="#fib-1172"><span class="linenos">1172</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBSettings</span><span class="p">:</span>
</span><span id="fib-1173"><a href="#fib-1173"><span class="linenos">1173</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="fib-1174"><a href="#fib-1174"><span class="linenos">1174</span></a><span class="sd">    Convert a FIB step from a .yml file to microscope settings for performing a FIB operation.</span>
</span><span id="fib-1175"><a href="#fib-1175"><span class="linenos">1175</span></a>
</span><span id="fib-1176"><a href="#fib-1176"><span class="linenos">1176</span></a><span class="sd">    This function converts a FIB step from a .yml file to `FIBSettings` for the microscope. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="fib-1177"><a href="#fib-1177"><span class="linenos">1177</span></a>
</span><span id="fib-1178"><a href="#fib-1178"><span class="linenos">1178</span></a><span class="sd">    Parameters</span>
</span><span id="fib-1179"><a href="#fib-1179"><span class="linenos">1179</span></a><span class="sd">    ----------</span>
</span><span id="fib-1180"><a href="#fib-1180"><span class="linenos">1180</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="fib-1181"><a href="#fib-1181"><span class="linenos">1181</span></a><span class="sd">        The microscope object for which to set the FIB settings.</span>
</span><span id="fib-1182"><a href="#fib-1182"><span class="linenos">1182</span></a><span class="sd">    step_settings : dict</span>
</span><span id="fib-1183"><a href="#fib-1183"><span class="linenos">1183</span></a><span class="sd">        The dictionary containing the FIB step settings from the .yml file.</span>
</span><span id="fib-1184"><a href="#fib-1184"><span class="linenos">1184</span></a><span class="sd">    step_name : str</span>
</span><span id="fib-1185"><a href="#fib-1185"><span class="linenos">1185</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="fib-1186"><a href="#fib-1186"><span class="linenos">1186</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="fib-1187"><a href="#fib-1187"><span class="linenos">1187</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="fib-1188"><a href="#fib-1188"><span class="linenos">1188</span></a>
</span><span id="fib-1189"><a href="#fib-1189"><span class="linenos">1189</span></a><span class="sd">    Returns</span>
</span><span id="fib-1190"><a href="#fib-1190"><span class="linenos">1190</span></a><span class="sd">    -------</span>
</span><span id="fib-1191"><a href="#fib-1191"><span class="linenos">1191</span></a><span class="sd">    tbt.FIBSettings</span>
</span><span id="fib-1192"><a href="#fib-1192"><span class="linenos">1192</span></a><span class="sd">        The FIB settings object.</span>
</span><span id="fib-1193"><a href="#fib-1193"><span class="linenos">1193</span></a>
</span><span id="fib-1194"><a href="#fib-1194"><span class="linenos">1194</span></a><span class="sd">    Raises</span>
</span><span id="fib-1195"><a href="#fib-1195"><span class="linenos">1195</span></a><span class="sd">    ------</span>
</span><span id="fib-1196"><a href="#fib-1196"><span class="linenos">1196</span></a><span class="sd">    KeyError</span>
</span><span id="fib-1197"><a href="#fib-1197"><span class="linenos">1197</span></a><span class="sd">        If required settings are missing from the .yml file.</span>
</span><span id="fib-1198"><a href="#fib-1198"><span class="linenos">1198</span></a><span class="sd">    ValueError</span>
</span><span id="fib-1199"><a href="#fib-1199"><span class="linenos">1199</span></a><span class="sd">        If invalid beam type is requested.</span>
</span><span id="fib-1200"><a href="#fib-1200"><span class="linenos">1200</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="fib-1201"><a href="#fib-1201"><span class="linenos">1201</span></a>    <span class="c1">## create image_step_settings from this</span>
</span><span id="fib-1202"><a href="#fib-1202"><span class="linenos">1202</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="fib-1203"><a href="#fib-1203"><span class="linenos">1203</span></a>        <span class="n">image_step_settings</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
</span><span id="fib-1204"><a href="#fib-1204"><span class="linenos">1204</span></a>        <span class="n">image_step_settings</span><span class="p">[</span><span class="s2">&quot;step_general&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;step_general&quot;</span><span class="p">)</span>
</span><span id="fib-1205"><a href="#fib-1205"><span class="linenos">1205</span></a>
</span><span id="fib-1206"><a href="#fib-1206"><span class="linenos">1206</span></a>        <span class="n">mill_step_settings</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mill&quot;</span><span class="p">)</span>
</span><span id="fib-1207"><a href="#fib-1207"><span class="linenos">1207</span></a>        <span class="n">mill_beam_db</span> <span class="o">=</span> <span class="n">mill_step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;beam&quot;</span><span class="p">)</span>
</span><span id="fib-1208"><a href="#fib-1208"><span class="linenos">1208</span></a>        <span class="n">mill_pattern_db</span> <span class="o">=</span> <span class="n">mill_step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pattern&quot;</span><span class="p">)</span>
</span><span id="fib-1209"><a href="#fib-1209"><span class="linenos">1209</span></a>
</span><span id="fib-1210"><a href="#fib-1210"><span class="linenos">1210</span></a>    <span class="c1"># ensure image is with an ion beam</span>
</span><span id="fib-1211"><a href="#fib-1211"><span class="linenos">1211</span></a>    <span class="n">enforce_beam_type</span><span class="p">(</span>
</span><span id="fib-1212"><a href="#fib-1212"><span class="linenos">1212</span></a>        <span class="n">tbt</span><span class="o">.</span><span class="n">IonBeam</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
</span><span id="fib-1213"><a href="#fib-1213"><span class="linenos">1213</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">image_step_settings</span><span class="p">,</span>
</span><span id="fib-1214"><a href="#fib-1214"><span class="linenos">1214</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="fib-1215"><a href="#fib-1215"><span class="linenos">1215</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="fib-1216"><a href="#fib-1216"><span class="linenos">1216</span></a>    <span class="p">)</span>
</span><span id="fib-1217"><a href="#fib-1217"><span class="linenos">1217</span></a>    <span class="n">image_settings</span> <span class="o">=</span> <span class="n">image</span><span class="p">(</span>
</span><span id="fib-1218"><a href="#fib-1218"><span class="linenos">1218</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="fib-1219"><a href="#fib-1219"><span class="linenos">1219</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">image_step_settings</span><span class="p">,</span>
</span><span id="fib-1220"><a href="#fib-1220"><span class="linenos">1220</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="fib-1221"><a href="#fib-1221"><span class="linenos">1221</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="fib-1222"><a href="#fib-1222"><span class="linenos">1222</span></a>    <span class="p">)</span>
</span><span id="fib-1223"><a href="#fib-1223"><span class="linenos">1223</span></a>
</span><span id="fib-1224"><a href="#fib-1224"><span class="linenos">1224</span></a>    <span class="c1">## fib mill settings</span>
</span><span id="fib-1225"><a href="#fib-1225"><span class="linenos">1225</span></a>    <span class="c1"># ensure milling is with an ion beam</span>
</span><span id="fib-1226"><a href="#fib-1226"><span class="linenos">1226</span></a>    <span class="n">enforce_beam_type</span><span class="p">(</span>
</span><span id="fib-1227"><a href="#fib-1227"><span class="linenos">1227</span></a>        <span class="n">tbt</span><span class="o">.</span><span class="n">IonBeam</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
</span><span id="fib-1228"><a href="#fib-1228"><span class="linenos">1228</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">mill_step_settings</span><span class="p">,</span>
</span><span id="fib-1229"><a href="#fib-1229"><span class="linenos">1229</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="fib-1230"><a href="#fib-1230"><span class="linenos">1230</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="fib-1231"><a href="#fib-1231"><span class="linenos">1231</span></a>    <span class="p">)</span>
</span><span id="fib-1232"><a href="#fib-1232"><span class="linenos">1232</span></a>    <span class="n">beam_type</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">(</span><span class="n">mill_beam_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">))</span>
</span><span id="fib-1233"><a href="#fib-1233"><span class="linenos">1233</span></a>    <span class="c1"># mill beam</span>
</span><span id="fib-1234"><a href="#fib-1234"><span class="linenos">1234</span></a>    <span class="n">validate_beam_settings</span><span class="p">(</span>
</span><span id="fib-1235"><a href="#fib-1235"><span class="linenos">1235</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="fib-1236"><a href="#fib-1236"><span class="linenos">1236</span></a>        <span class="n">beam_type</span><span class="o">=</span><span class="n">beam_type</span><span class="p">,</span>
</span><span id="fib-1237"><a href="#fib-1237"><span class="linenos">1237</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">,</span>
</span><span id="fib-1238"><a href="#fib-1238"><span class="linenos">1238</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="fib-1239"><a href="#fib-1239"><span class="linenos">1239</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="fib-1240"><a href="#fib-1240"><span class="linenos">1240</span></a>    <span class="p">)</span>
</span><span id="fib-1241"><a href="#fib-1241"><span class="linenos">1241</span></a>    <span class="n">mill_beam</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">IonBeam</span><span class="p">(</span>
</span><span id="fib-1242"><a href="#fib-1242"><span class="linenos">1242</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">(</span>
</span><span id="fib-1243"><a href="#fib-1243"><span class="linenos">1243</span></a>            <span class="n">voltage_kv</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;voltage_kv&quot;</span><span class="p">],</span>
</span><span id="fib-1244"><a href="#fib-1244"><span class="linenos">1244</span></a>            <span class="n">voltage_tol_kv</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;voltage_tol_kv&quot;</span><span class="p">],</span>
</span><span id="fib-1245"><a href="#fib-1245"><span class="linenos">1245</span></a>            <span class="n">current_na</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;current_na&quot;</span><span class="p">],</span>
</span><span id="fib-1246"><a href="#fib-1246"><span class="linenos">1246</span></a>            <span class="n">current_tol_na</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;current_tol_na&quot;</span><span class="p">],</span>
</span><span id="fib-1247"><a href="#fib-1247"><span class="linenos">1247</span></a>            <span class="n">hfw_mm</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;hfw_mm&quot;</span><span class="p">],</span>
</span><span id="fib-1248"><a href="#fib-1248"><span class="linenos">1248</span></a>            <span class="n">working_dist_mm</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;working_dist_mm&quot;</span><span class="p">],</span>
</span><span id="fib-1249"><a href="#fib-1249"><span class="linenos">1249</span></a>            <span class="n">dynamic_focus</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;dynamic_focus&quot;</span><span class="p">],</span>
</span><span id="fib-1250"><a href="#fib-1250"><span class="linenos">1250</span></a>            <span class="n">tilt_correction</span><span class="o">=</span><span class="n">mill_beam_db</span><span class="p">[</span><span class="s2">&quot;tilt_correction&quot;</span><span class="p">],</span>
</span><span id="fib-1251"><a href="#fib-1251"><span class="linenos">1251</span></a>        <span class="p">)</span>
</span><span id="fib-1252"><a href="#fib-1252"><span class="linenos">1252</span></a>    <span class="p">)</span>
</span><span id="fib-1253"><a href="#fib-1253"><span class="linenos">1253</span></a>
</span><span id="fib-1254"><a href="#fib-1254"><span class="linenos">1254</span></a>    <span class="c1"># fib pattern settings</span>
</span><span id="fib-1255"><a href="#fib-1255"><span class="linenos">1255</span></a>    <span class="n">pattern</span> <span class="o">=</span> <span class="n">validate_fib_pattern_settings</span><span class="p">(</span>
</span><span id="fib-1256"><a href="#fib-1256"><span class="linenos">1256</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="fib-1257"><a href="#fib-1257"><span class="linenos">1257</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">mill_pattern_db</span><span class="p">,</span>
</span><span id="fib-1258"><a href="#fib-1258"><span class="linenos">1258</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="fib-1259"><a href="#fib-1259"><span class="linenos">1259</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="fib-1260"><a href="#fib-1260"><span class="linenos">1260</span></a>    <span class="p">)</span>
</span><span id="fib-1261"><a href="#fib-1261"><span class="linenos">1261</span></a>
</span><span id="fib-1262"><a href="#fib-1262"><span class="linenos">1262</span></a>    <span class="n">fib_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBSettings</span><span class="p">(</span>
</span><span id="fib-1263"><a href="#fib-1263"><span class="linenos">1263</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="fib-1264"><a href="#fib-1264"><span class="linenos">1264</span></a>        <span class="n">image</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
</span><span id="fib-1265"><a href="#fib-1265"><span class="linenos">1265</span></a>        <span class="n">mill_beam</span><span class="o">=</span><span class="n">mill_beam</span><span class="p">,</span>
</span><span id="fib-1266"><a href="#fib-1266"><span class="linenos">1266</span></a>        <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span>
</span><span id="fib-1267"><a href="#fib-1267"><span class="linenos">1267</span></a>    <span class="p">)</span>
</span><span id="fib-1268"><a href="#fib-1268"><span class="linenos">1268</span></a>    <span class="k">return</span> <span class="n">fib_settings</span>
</span></pre></div>


            <div class="docstring"><p>Convert a FIB step from a .yml file to microscope settings for performing a FIB operation.</p>

<p>This function converts a FIB step from a .yml file to <code>FIBSettings</code> for the microscope. It performs schema checking to ensure valid inputs are requested.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object for which to set the FIB settings.
step_settings : dict
    The dictionary containing the FIB step settings from the .yml file.
step_name : str
    The name of the step in the .yml file.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>tbt.FIBSettings
    The FIB settings object.</p>

<h2 id="raises">Raises</h2>

<p>KeyError
    If required settings are missing from the .yml file.
ValueError
    If invalid beam type is requested.</p>
</div>


                </section>
                <section id="enforce_beam_type">
                            <input id="enforce_beam_type-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@singledispatch</div>

        <span class="def">def</span>
        <span class="name">enforce_beam_type</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">beam_type</span>,</span><span class="param">	<span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="enforce_beam_type-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#enforce_beam_type"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="enforce_beam_type-1271"><a href="#enforce_beam_type-1271"><span class="linenos">1271</span></a><span class="nd">@singledispatch</span>
</span><span id="enforce_beam_type-1272"><a href="#enforce_beam_type-1272"><span class="linenos">1272</span></a><span class="k">def</span> <span class="nf">enforce_beam_type</span><span class="p">(</span>
</span><span id="enforce_beam_type-1273"><a href="#enforce_beam_type-1273"><span class="linenos">1273</span></a>    <span class="n">beam_type</span><span class="p">,</span>
</span><span id="enforce_beam_type-1274"><a href="#enforce_beam_type-1274"><span class="linenos">1274</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="enforce_beam_type-1275"><a href="#enforce_beam_type-1275"><span class="linenos">1275</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="enforce_beam_type-1276"><a href="#enforce_beam_type-1276"><span class="linenos">1276</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="enforce_beam_type-1277"><a href="#enforce_beam_type-1277"><span class="linenos">1277</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="enforce_beam_type-1278"><a href="#enforce_beam_type-1278"><span class="linenos">1278</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="enforce_beam_type-1279"><a href="#enforce_beam_type-1279"><span class="linenos">1279</span></a><span class="sd">    Enforce a specific beam type is used for an operation based on a dictionary.</span>
</span><span id="enforce_beam_type-1280"><a href="#enforce_beam_type-1280"><span class="linenos">1280</span></a>
</span><span id="enforce_beam_type-1281"><a href="#enforce_beam_type-1281"><span class="linenos">1281</span></a><span class="sd">    This function ensures that the specified beam type is used for an operation based on the provided settings dictionary. The dictionary must contain a sub-dictionary with the key &#39;beam&#39;.</span>
</span><span id="enforce_beam_type-1282"><a href="#enforce_beam_type-1282"><span class="linenos">1282</span></a>
</span><span id="enforce_beam_type-1283"><a href="#enforce_beam_type-1283"><span class="linenos">1283</span></a><span class="sd">    Parameters</span>
</span><span id="enforce_beam_type-1284"><a href="#enforce_beam_type-1284"><span class="linenos">1284</span></a><span class="sd">    ----------</span>
</span><span id="enforce_beam_type-1285"><a href="#enforce_beam_type-1285"><span class="linenos">1285</span></a><span class="sd">    beam_type : Any</span>
</span><span id="enforce_beam_type-1286"><a href="#enforce_beam_type-1286"><span class="linenos">1286</span></a><span class="sd">        The beam type to enforce.</span>
</span><span id="enforce_beam_type-1287"><a href="#enforce_beam_type-1287"><span class="linenos">1287</span></a><span class="sd">    step_settings : dict</span>
</span><span id="enforce_beam_type-1288"><a href="#enforce_beam_type-1288"><span class="linenos">1288</span></a><span class="sd">        The dictionary containing the step settings.</span>
</span><span id="enforce_beam_type-1289"><a href="#enforce_beam_type-1289"><span class="linenos">1289</span></a><span class="sd">    step_name : str</span>
</span><span id="enforce_beam_type-1290"><a href="#enforce_beam_type-1290"><span class="linenos">1290</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="enforce_beam_type-1291"><a href="#enforce_beam_type-1291"><span class="linenos">1291</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="enforce_beam_type-1292"><a href="#enforce_beam_type-1292"><span class="linenos">1292</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="enforce_beam_type-1293"><a href="#enforce_beam_type-1293"><span class="linenos">1293</span></a>
</span><span id="enforce_beam_type-1294"><a href="#enforce_beam_type-1294"><span class="linenos">1294</span></a><span class="sd">    Returns</span>
</span><span id="enforce_beam_type-1295"><a href="#enforce_beam_type-1295"><span class="linenos">1295</span></a><span class="sd">    -------</span>
</span><span id="enforce_beam_type-1296"><a href="#enforce_beam_type-1296"><span class="linenos">1296</span></a><span class="sd">    bool</span>
</span><span id="enforce_beam_type-1297"><a href="#enforce_beam_type-1297"><span class="linenos">1297</span></a><span class="sd">        True if the beam type is enforced successfully.</span>
</span><span id="enforce_beam_type-1298"><a href="#enforce_beam_type-1298"><span class="linenos">1298</span></a>
</span><span id="enforce_beam_type-1299"><a href="#enforce_beam_type-1299"><span class="linenos">1299</span></a><span class="sd">    Raises</span>
</span><span id="enforce_beam_type-1300"><a href="#enforce_beam_type-1300"><span class="linenos">1300</span></a><span class="sd">    ------</span>
</span><span id="enforce_beam_type-1301"><a href="#enforce_beam_type-1301"><span class="linenos">1301</span></a><span class="sd">    NotImplementedError</span>
</span><span id="enforce_beam_type-1302"><a href="#enforce_beam_type-1302"><span class="linenos">1302</span></a><span class="sd">        If no handler is available for the provided type.</span>
</span><span id="enforce_beam_type-1303"><a href="#enforce_beam_type-1303"><span class="linenos">1303</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="enforce_beam_type-1304"><a href="#enforce_beam_type-1304"><span class="linenos">1304</span></a>    <span class="n">_</span> <span class="o">=</span> <span class="n">beam_type</span>
</span><span id="enforce_beam_type-1305"><a href="#enforce_beam_type-1305"><span class="linenos">1305</span></a>    <span class="n">__</span> <span class="o">=</span> <span class="n">step_settings</span>
</span><span id="enforce_beam_type-1306"><a href="#enforce_beam_type-1306"><span class="linenos">1306</span></a>    <span class="n">___</span> <span class="o">=</span> <span class="n">step_name</span>
</span><span id="enforce_beam_type-1307"><a href="#enforce_beam_type-1307"><span class="linenos">1307</span></a>    <span class="n">____</span> <span class="o">=</span> <span class="n">yml_format</span>
</span><span id="enforce_beam_type-1308"><a href="#enforce_beam_type-1308"><span class="linenos">1308</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No handler for type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">step_settings</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Enforce a specific beam type is used for an operation based on a dictionary.</p>

<p>This function ensures that the specified beam type is used for an operation based on the provided settings dictionary. The dictionary must contain a sub-dictionary with the key 'beam'.</p>

<h2 id="parameters">Parameters</h2>

<p>beam_type : Any
    The beam type to enforce.
step_settings : dict
    The dictionary containing the step settings.
step_name : str
    The name of the step in the .yml file.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the beam type is enforced successfully.</p>

<h2 id="raises">Raises</h2>

<p>NotImplementedError
    If no handler is available for the provided type.</p>
</div>


                </section>
                <section id="ebsd">
                            <input id="ebsd-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ebsd</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span>,</span><span class="param">	<span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#EBSDSettings">pytribeam.types.EBSDSettings</a></span>:</span></span>

                <label class="view-source-button" for="ebsd-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ebsd"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ebsd-1413"><a href="#ebsd-1413"><span class="linenos">1413</span></a><span class="k">def</span> <span class="nf">ebsd</span><span class="p">(</span>
</span><span id="ebsd-1414"><a href="#ebsd-1414"><span class="linenos">1414</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="ebsd-1415"><a href="#ebsd-1415"><span class="linenos">1415</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="ebsd-1416"><a href="#ebsd-1416"><span class="linenos">1416</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ebsd-1417"><a href="#ebsd-1417"><span class="linenos">1417</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="ebsd-1418"><a href="#ebsd-1418"><span class="linenos">1418</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">EBSDSettings</span><span class="p">:</span>
</span><span id="ebsd-1419"><a href="#ebsd-1419"><span class="linenos">1419</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ebsd-1420"><a href="#ebsd-1420"><span class="linenos">1420</span></a><span class="sd">    Convert an EBSD step from a .yml file to microscope settings for performing an EBSD operation.</span>
</span><span id="ebsd-1421"><a href="#ebsd-1421"><span class="linenos">1421</span></a>
</span><span id="ebsd-1422"><a href="#ebsd-1422"><span class="linenos">1422</span></a><span class="sd">    This function converts an EBSD step from a .yml file to `EBSDSettings` for the microscope. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="ebsd-1423"><a href="#ebsd-1423"><span class="linenos">1423</span></a>
</span><span id="ebsd-1424"><a href="#ebsd-1424"><span class="linenos">1424</span></a><span class="sd">    Parameters</span>
</span><span id="ebsd-1425"><a href="#ebsd-1425"><span class="linenos">1425</span></a><span class="sd">    ----------</span>
</span><span id="ebsd-1426"><a href="#ebsd-1426"><span class="linenos">1426</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="ebsd-1427"><a href="#ebsd-1427"><span class="linenos">1427</span></a><span class="sd">        The microscope object for which to set the EBSD settings.</span>
</span><span id="ebsd-1428"><a href="#ebsd-1428"><span class="linenos">1428</span></a><span class="sd">    step_settings : dict</span>
</span><span id="ebsd-1429"><a href="#ebsd-1429"><span class="linenos">1429</span></a><span class="sd">        The dictionary containing the EBSD step settings from the .yml file.</span>
</span><span id="ebsd-1430"><a href="#ebsd-1430"><span class="linenos">1430</span></a><span class="sd">    step_name : str</span>
</span><span id="ebsd-1431"><a href="#ebsd-1431"><span class="linenos">1431</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="ebsd-1432"><a href="#ebsd-1432"><span class="linenos">1432</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="ebsd-1433"><a href="#ebsd-1433"><span class="linenos">1433</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="ebsd-1434"><a href="#ebsd-1434"><span class="linenos">1434</span></a>
</span><span id="ebsd-1435"><a href="#ebsd-1435"><span class="linenos">1435</span></a><span class="sd">    Returns</span>
</span><span id="ebsd-1436"><a href="#ebsd-1436"><span class="linenos">1436</span></a><span class="sd">    -------</span>
</span><span id="ebsd-1437"><a href="#ebsd-1437"><span class="linenos">1437</span></a><span class="sd">    tbt.EBSDSettings</span>
</span><span id="ebsd-1438"><a href="#ebsd-1438"><span class="linenos">1438</span></a><span class="sd">        The EBSD settings object.</span>
</span><span id="ebsd-1439"><a href="#ebsd-1439"><span class="linenos">1439</span></a>
</span><span id="ebsd-1440"><a href="#ebsd-1440"><span class="linenos">1440</span></a><span class="sd">    Raises</span>
</span><span id="ebsd-1441"><a href="#ebsd-1441"><span class="linenos">1441</span></a><span class="sd">    ------</span>
</span><span id="ebsd-1442"><a href="#ebsd-1442"><span class="linenos">1442</span></a><span class="sd">    KeyError</span>
</span><span id="ebsd-1443"><a href="#ebsd-1443"><span class="linenos">1443</span></a><span class="sd">        If required settings are missing from the .yml file or if the &#39;concurrent_EDS&#39; key is invalid.</span>
</span><span id="ebsd-1444"><a href="#ebsd-1444"><span class="linenos">1444</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ebsd-1445"><a href="#ebsd-1445"><span class="linenos">1445</span></a>    <span class="n">enforce_beam_type</span><span class="p">(</span>
</span><span id="ebsd-1446"><a href="#ebsd-1446"><span class="linenos">1446</span></a>        <span class="n">tbt</span><span class="o">.</span><span class="n">ElectronBeam</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
</span><span id="ebsd-1447"><a href="#ebsd-1447"><span class="linenos">1447</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="ebsd-1448"><a href="#ebsd-1448"><span class="linenos">1448</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="ebsd-1449"><a href="#ebsd-1449"><span class="linenos">1449</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="ebsd-1450"><a href="#ebsd-1450"><span class="linenos">1450</span></a>    <span class="p">)</span>
</span><span id="ebsd-1451"><a href="#ebsd-1451"><span class="linenos">1451</span></a>    <span class="n">image_settings</span> <span class="o">=</span> <span class="n">image</span><span class="p">(</span>
</span><span id="ebsd-1452"><a href="#ebsd-1452"><span class="linenos">1452</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="ebsd-1453"><a href="#ebsd-1453"><span class="linenos">1453</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="ebsd-1454"><a href="#ebsd-1454"><span class="linenos">1454</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="ebsd-1455"><a href="#ebsd-1455"><span class="linenos">1455</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="ebsd-1456"><a href="#ebsd-1456"><span class="linenos">1456</span></a>    <span class="p">)</span>
</span><span id="ebsd-1457"><a href="#ebsd-1457"><span class="linenos">1457</span></a>    <span class="n">concurrent_EDS</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;concurrent_EDS&quot;</span><span class="p">)</span>
</span><span id="ebsd-1458"><a href="#ebsd-1458"><span class="linenos">1458</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">concurrent_EDS</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">concurrent_EDS</span><span class="p">):</span>
</span><span id="ebsd-1459"><a href="#ebsd-1459"><span class="linenos">1459</span></a>        <span class="n">enable_eds</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ebsd-1460"><a href="#ebsd-1460"><span class="linenos">1460</span></a>    <span class="k">elif</span> <span class="n">concurrent_EDS</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="ebsd-1461"><a href="#ebsd-1461"><span class="linenos">1461</span></a>        <span class="n">enable_eds</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ebsd-1462"><a href="#ebsd-1462"><span class="linenos">1462</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="ebsd-1463"><a href="#ebsd-1463"><span class="linenos">1463</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="ebsd-1464"><a href="#ebsd-1464"><span class="linenos">1464</span></a>            <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, an EBSD type step. &#39;concurrent_EDS&#39; key is &#39;</span><span class="si">{</span><span class="n">concurrent_EDS</span><span class="si">}</span><span class="s2">&#39; of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">concurrent_EDS</span><span class="p">)</span><span class="si">}</span><span class="s2"> but must be boolean (True/False) or of NoneType (null in .yml).&quot;</span>
</span><span id="ebsd-1465"><a href="#ebsd-1465"><span class="linenos">1465</span></a>        <span class="p">)</span>
</span><span id="ebsd-1466"><a href="#ebsd-1466"><span class="linenos">1466</span></a>    <span class="n">ebsd_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">EBSDSettings</span><span class="p">(</span>
</span><span id="ebsd-1467"><a href="#ebsd-1467"><span class="linenos">1467</span></a>        <span class="n">image</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
</span><span id="ebsd-1468"><a href="#ebsd-1468"><span class="linenos">1468</span></a>        <span class="n">enable_eds</span><span class="o">=</span><span class="n">enable_eds</span><span class="p">,</span>
</span><span id="ebsd-1469"><a href="#ebsd-1469"><span class="linenos">1469</span></a>        <span class="n">enable_ebsd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ebsd-1470"><a href="#ebsd-1470"><span class="linenos">1470</span></a>    <span class="p">)</span>
</span><span id="ebsd-1471"><a href="#ebsd-1471"><span class="linenos">1471</span></a>    <span class="k">return</span> <span class="n">ebsd_settings</span>
</span></pre></div>


            <div class="docstring"><p>Convert an EBSD step from a .yml file to microscope settings for performing an EBSD operation.</p>

<p>This function converts an EBSD step from a .yml file to <code>EBSDSettings</code> for the microscope. It performs schema checking to ensure valid inputs are requested.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object for which to set the EBSD settings.
step_settings : dict
    The dictionary containing the EBSD step settings from the .yml file.
step_name : str
    The name of the step in the .yml file.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>tbt.EBSDSettings
    The EBSD settings object.</p>

<h2 id="raises">Raises</h2>

<p>KeyError
    If required settings are missing from the .yml file or if the 'concurrent_EDS' key is invalid.</p>
</div>


                </section>
                <section id="eds">
                            <input id="eds-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">eds</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span>,</span><span class="param">	<span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#EDSSettings">pytribeam.types.EDSSettings</a></span>:</span></span>

                <label class="view-source-button" for="eds-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#eds"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="eds-1474"><a href="#eds-1474"><span class="linenos">1474</span></a><span class="k">def</span> <span class="nf">eds</span><span class="p">(</span>
</span><span id="eds-1475"><a href="#eds-1475"><span class="linenos">1475</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="eds-1476"><a href="#eds-1476"><span class="linenos">1476</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="eds-1477"><a href="#eds-1477"><span class="linenos">1477</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="eds-1478"><a href="#eds-1478"><span class="linenos">1478</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="eds-1479"><a href="#eds-1479"><span class="linenos">1479</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">EDSSettings</span><span class="p">:</span>
</span><span id="eds-1480"><a href="#eds-1480"><span class="linenos">1480</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="eds-1481"><a href="#eds-1481"><span class="linenos">1481</span></a><span class="sd">    Convert an EDS step from a .yml file to microscope settings for performing an EDS operation.</span>
</span><span id="eds-1482"><a href="#eds-1482"><span class="linenos">1482</span></a>
</span><span id="eds-1483"><a href="#eds-1483"><span class="linenos">1483</span></a><span class="sd">    This function converts an EDS step from a .yml file to `EDSSettings` for the microscope. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="eds-1484"><a href="#eds-1484"><span class="linenos">1484</span></a>
</span><span id="eds-1485"><a href="#eds-1485"><span class="linenos">1485</span></a><span class="sd">    Parameters</span>
</span><span id="eds-1486"><a href="#eds-1486"><span class="linenos">1486</span></a><span class="sd">    ----------</span>
</span><span id="eds-1487"><a href="#eds-1487"><span class="linenos">1487</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="eds-1488"><a href="#eds-1488"><span class="linenos">1488</span></a><span class="sd">        The microscope object for which to set the EDS settings.</span>
</span><span id="eds-1489"><a href="#eds-1489"><span class="linenos">1489</span></a><span class="sd">    step_settings : dict</span>
</span><span id="eds-1490"><a href="#eds-1490"><span class="linenos">1490</span></a><span class="sd">        The dictionary containing the EDS step settings from the .yml file.</span>
</span><span id="eds-1491"><a href="#eds-1491"><span class="linenos">1491</span></a><span class="sd">    step_name : str</span>
</span><span id="eds-1492"><a href="#eds-1492"><span class="linenos">1492</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="eds-1493"><a href="#eds-1493"><span class="linenos">1493</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="eds-1494"><a href="#eds-1494"><span class="linenos">1494</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="eds-1495"><a href="#eds-1495"><span class="linenos">1495</span></a>
</span><span id="eds-1496"><a href="#eds-1496"><span class="linenos">1496</span></a><span class="sd">    Returns</span>
</span><span id="eds-1497"><a href="#eds-1497"><span class="linenos">1497</span></a><span class="sd">    -------</span>
</span><span id="eds-1498"><a href="#eds-1498"><span class="linenos">1498</span></a><span class="sd">    tbt.EDSSettings</span>
</span><span id="eds-1499"><a href="#eds-1499"><span class="linenos">1499</span></a><span class="sd">        The EDS settings object.</span>
</span><span id="eds-1500"><a href="#eds-1500"><span class="linenos">1500</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="eds-1501"><a href="#eds-1501"><span class="linenos">1501</span></a>    <span class="n">enforce_beam_type</span><span class="p">(</span>
</span><span id="eds-1502"><a href="#eds-1502"><span class="linenos">1502</span></a>        <span class="n">tbt</span><span class="o">.</span><span class="n">ElectronBeam</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
</span><span id="eds-1503"><a href="#eds-1503"><span class="linenos">1503</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="eds-1504"><a href="#eds-1504"><span class="linenos">1504</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="eds-1505"><a href="#eds-1505"><span class="linenos">1505</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="eds-1506"><a href="#eds-1506"><span class="linenos">1506</span></a>    <span class="p">)</span>
</span><span id="eds-1507"><a href="#eds-1507"><span class="linenos">1507</span></a>    <span class="n">image_settings</span> <span class="o">=</span> <span class="n">image</span><span class="p">(</span>
</span><span id="eds-1508"><a href="#eds-1508"><span class="linenos">1508</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="eds-1509"><a href="#eds-1509"><span class="linenos">1509</span></a>        <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="eds-1510"><a href="#eds-1510"><span class="linenos">1510</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="eds-1511"><a href="#eds-1511"><span class="linenos">1511</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="eds-1512"><a href="#eds-1512"><span class="linenos">1512</span></a>    <span class="p">)</span>
</span><span id="eds-1513"><a href="#eds-1513"><span class="linenos">1513</span></a>    <span class="n">eds_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">EDSSettings</span><span class="p">(</span>
</span><span id="eds-1514"><a href="#eds-1514"><span class="linenos">1514</span></a>        <span class="n">image</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
</span><span id="eds-1515"><a href="#eds-1515"><span class="linenos">1515</span></a>        <span class="n">enable_eds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="eds-1516"><a href="#eds-1516"><span class="linenos">1516</span></a>    <span class="p">)</span>
</span><span id="eds-1517"><a href="#eds-1517"><span class="linenos">1517</span></a>    <span class="k">return</span> <span class="n">eds_settings</span>
</span></pre></div>


            <div class="docstring"><p>Convert an EDS step from a .yml file to microscope settings for performing an EDS operation.</p>

<p>This function converts an EDS step from a .yml file to <code>EDSSettings</code> for the microscope. It performs schema checking to ensure valid inputs are requested.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object for which to set the EDS settings.
step_settings : dict
    The dictionary containing the EDS step settings from the .yml file.
step_name : str
    The name of the step in the .yml file.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>tbt.EDSSettings
    The EDS settings object.</p>
</div>


                </section>
                <section id="custom">
                            <input id="custom-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">custom</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span>,</span><span class="param">	<span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#CustomSettings">pytribeam.types.CustomSettings</a></span>:</span></span>

                <label class="view-source-button" for="custom-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#custom"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="custom-1520"><a href="#custom-1520"><span class="linenos">1520</span></a><span class="k">def</span> <span class="nf">custom</span><span class="p">(</span>
</span><span id="custom-1521"><a href="#custom-1521"><span class="linenos">1521</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="custom-1522"><a href="#custom-1522"><span class="linenos">1522</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="custom-1523"><a href="#custom-1523"><span class="linenos">1523</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="custom-1524"><a href="#custom-1524"><span class="linenos">1524</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="custom-1525"><a href="#custom-1525"><span class="linenos">1525</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">CustomSettings</span><span class="p">:</span>
</span><span id="custom-1526"><a href="#custom-1526"><span class="linenos">1526</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="custom-1527"><a href="#custom-1527"><span class="linenos">1527</span></a><span class="sd">    Convert a custom step from a .yml file to custom settings for the microscope.</span>
</span><span id="custom-1528"><a href="#custom-1528"><span class="linenos">1528</span></a>
</span><span id="custom-1529"><a href="#custom-1529"><span class="linenos">1529</span></a><span class="sd">    This function converts a custom step from a .yml file to `CustomSettings` for the microscope. It performs schema checking to ensure valid inputs are requested.</span>
</span><span id="custom-1530"><a href="#custom-1530"><span class="linenos">1530</span></a>
</span><span id="custom-1531"><a href="#custom-1531"><span class="linenos">1531</span></a><span class="sd">    Parameters</span>
</span><span id="custom-1532"><a href="#custom-1532"><span class="linenos">1532</span></a><span class="sd">    ----------</span>
</span><span id="custom-1533"><a href="#custom-1533"><span class="linenos">1533</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="custom-1534"><a href="#custom-1534"><span class="linenos">1534</span></a><span class="sd">        The microscope object for which to set the custom settings.</span>
</span><span id="custom-1535"><a href="#custom-1535"><span class="linenos">1535</span></a><span class="sd">    step_settings : dict</span>
</span><span id="custom-1536"><a href="#custom-1536"><span class="linenos">1536</span></a><span class="sd">        The dictionary containing the custom step settings from the .yml file.</span>
</span><span id="custom-1537"><a href="#custom-1537"><span class="linenos">1537</span></a><span class="sd">    step_name : str</span>
</span><span id="custom-1538"><a href="#custom-1538"><span class="linenos">1538</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="custom-1539"><a href="#custom-1539"><span class="linenos">1539</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="custom-1540"><a href="#custom-1540"><span class="linenos">1540</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="custom-1541"><a href="#custom-1541"><span class="linenos">1541</span></a>
</span><span id="custom-1542"><a href="#custom-1542"><span class="linenos">1542</span></a><span class="sd">    Returns</span>
</span><span id="custom-1543"><a href="#custom-1543"><span class="linenos">1543</span></a><span class="sd">    -------</span>
</span><span id="custom-1544"><a href="#custom-1544"><span class="linenos">1544</span></a><span class="sd">    tbt.CustomSettings</span>
</span><span id="custom-1545"><a href="#custom-1545"><span class="linenos">1545</span></a><span class="sd">        The custom settings object.</span>
</span><span id="custom-1546"><a href="#custom-1546"><span class="linenos">1546</span></a>
</span><span id="custom-1547"><a href="#custom-1547"><span class="linenos">1547</span></a><span class="sd">    Raises</span>
</span><span id="custom-1548"><a href="#custom-1548"><span class="linenos">1548</span></a><span class="sd">    ------</span>
</span><span id="custom-1549"><a href="#custom-1549"><span class="linenos">1549</span></a><span class="sd">    KeyError</span>
</span><span id="custom-1550"><a href="#custom-1550"><span class="linenos">1550</span></a><span class="sd">        If required settings are missing from the .yml file.</span>
</span><span id="custom-1551"><a href="#custom-1551"><span class="linenos">1551</span></a><span class="sd">    ValueError</span>
</span><span id="custom-1552"><a href="#custom-1552"><span class="linenos">1552</span></a><span class="sd">        If the specified script or executable path does not exist.</span>
</span><span id="custom-1553"><a href="#custom-1553"><span class="linenos">1553</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="custom-1554"><a href="#custom-1554"><span class="linenos">1554</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="custom-1555"><a href="#custom-1555"><span class="linenos">1555</span></a>        <span class="n">script_path</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;script_path&quot;</span><span class="p">)</span>
</span><span id="custom-1556"><a href="#custom-1556"><span class="linenos">1556</span></a>        <span class="k">if</span> <span class="n">script_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="custom-1557"><a href="#custom-1557"><span class="linenos">1557</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="custom-1558"><a href="#custom-1558"><span class="linenos">1558</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;script_path&#39; found in custom step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="custom-1559"><a href="#custom-1559"><span class="linenos">1559</span></a>            <span class="p">)</span>
</span><span id="custom-1560"><a href="#custom-1560"><span class="linenos">1560</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">script_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span><span id="custom-1561"><a href="#custom-1561"><span class="linenos">1561</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="custom-1562"><a href="#custom-1562"><span class="linenos">1562</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid location for script at location </span><span class="si">{</span><span class="n">script_path</span><span class="si">}</span><span class="s2">. File does not exist.&quot;</span>
</span><span id="custom-1563"><a href="#custom-1563"><span class="linenos">1563</span></a>            <span class="p">)</span>
</span><span id="custom-1564"><a href="#custom-1564"><span class="linenos">1564</span></a>
</span><span id="custom-1565"><a href="#custom-1565"><span class="linenos">1565</span></a>        <span class="n">executable_path</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;executable_path&quot;</span><span class="p">)</span>
</span><span id="custom-1566"><a href="#custom-1566"><span class="linenos">1566</span></a>        <span class="k">if</span> <span class="n">executable_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="custom-1567"><a href="#custom-1567"><span class="linenos">1567</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="custom-1568"><a href="#custom-1568"><span class="linenos">1568</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;executable_path&#39; found in custom step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="custom-1569"><a href="#custom-1569"><span class="linenos">1569</span></a>            <span class="p">)</span>
</span><span id="custom-1570"><a href="#custom-1570"><span class="linenos">1570</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span><span id="custom-1571"><a href="#custom-1571"><span class="linenos">1571</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="custom-1572"><a href="#custom-1572"><span class="linenos">1572</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid location for executable at location </span><span class="si">{</span><span class="n">executable_path</span><span class="si">}</span><span class="s2">. File does not exist.&quot;</span>
</span><span id="custom-1573"><a href="#custom-1573"><span class="linenos">1573</span></a>            <span class="p">)</span>
</span><span id="custom-1574"><a href="#custom-1574"><span class="linenos">1574</span></a>
</span><span id="custom-1575"><a href="#custom-1575"><span class="linenos">1575</span></a>    <span class="n">custom_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">CustomSettings</span><span class="p">(</span>
</span><span id="custom-1576"><a href="#custom-1576"><span class="linenos">1576</span></a>        <span class="n">script_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">script_path</span><span class="p">),</span>
</span><span id="custom-1577"><a href="#custom-1577"><span class="linenos">1577</span></a>        <span class="n">executable_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">executable_path</span><span class="p">),</span>
</span><span id="custom-1578"><a href="#custom-1578"><span class="linenos">1578</span></a>    <span class="p">)</span>
</span><span id="custom-1579"><a href="#custom-1579"><span class="linenos">1579</span></a>    <span class="k">return</span> <span class="n">custom_settings</span>
</span></pre></div>


            <div class="docstring"><p>Convert a custom step from a .yml file to custom settings for the microscope.</p>

<p>This function converts a custom step from a .yml file to <code>CustomSettings</code> for the microscope. It performs schema checking to ensure valid inputs are requested.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object for which to set the custom settings.
step_settings : dict
    The dictionary containing the custom step settings from the .yml file.
step_name : str
    The name of the step in the .yml file.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>tbt.CustomSettings
    The custom settings object.</p>

<h2 id="raises">Raises</h2>

<p>KeyError
    If required settings are missing from the .yml file.
ValueError
    If the specified script or executable path does not exist.</p>
</div>


                </section>
                <section id="scan_limits">
                            <input id="scan_limits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">scan_limits</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">selected_beam</span><span class="p">:</span> <span class="nb">property</span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#ScanLimits">pytribeam.types.ScanLimits</a></span>:</span></span>

                <label class="view-source-button" for="scan_limits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#scan_limits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="scan_limits-1588"><a href="#scan_limits-1588"><span class="linenos">1588</span></a><span class="k">def</span> <span class="nf">scan_limits</span><span class="p">(</span>
</span><span id="scan_limits-1589"><a href="#scan_limits-1589"><span class="linenos">1589</span></a>    <span class="n">selected_beam</span><span class="p">:</span> <span class="nb">property</span><span class="p">,</span>
</span><span id="scan_limits-1590"><a href="#scan_limits-1590"><span class="linenos">1590</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ScanLimits</span><span class="p">:</span>
</span><span id="scan_limits-1591"><a href="#scan_limits-1591"><span class="linenos">1591</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="scan_limits-1592"><a href="#scan_limits-1592"><span class="linenos">1592</span></a><span class="sd">    Retrieve the scan settings limits for the selected beam.</span>
</span><span id="scan_limits-1593"><a href="#scan_limits-1593"><span class="linenos">1593</span></a>
</span><span id="scan_limits-1594"><a href="#scan_limits-1594"><span class="linenos">1594</span></a><span class="sd">    This function retrieves the limits for rotation and dwell time for the selected beam and returns them as a `ScanLimits` object.</span>
</span><span id="scan_limits-1595"><a href="#scan_limits-1595"><span class="linenos">1595</span></a>
</span><span id="scan_limits-1596"><a href="#scan_limits-1596"><span class="linenos">1596</span></a><span class="sd">    Parameters</span>
</span><span id="scan_limits-1597"><a href="#scan_limits-1597"><span class="linenos">1597</span></a><span class="sd">    ----------</span>
</span><span id="scan_limits-1598"><a href="#scan_limits-1598"><span class="linenos">1598</span></a><span class="sd">    selected_beam : property</span>
</span><span id="scan_limits-1599"><a href="#scan_limits-1599"><span class="linenos">1599</span></a><span class="sd">        The selected beam property from which to retrieve the scan limits.</span>
</span><span id="scan_limits-1600"><a href="#scan_limits-1600"><span class="linenos">1600</span></a>
</span><span id="scan_limits-1601"><a href="#scan_limits-1601"><span class="linenos">1601</span></a><span class="sd">    Returns</span>
</span><span id="scan_limits-1602"><a href="#scan_limits-1602"><span class="linenos">1602</span></a><span class="sd">    -------</span>
</span><span id="scan_limits-1603"><a href="#scan_limits-1603"><span class="linenos">1603</span></a><span class="sd">    tbt.ScanLimits</span>
</span><span id="scan_limits-1604"><a href="#scan_limits-1604"><span class="linenos">1604</span></a><span class="sd">        The scan limits for rotation (degrees) and dwell time (microseconds).</span>
</span><span id="scan_limits-1605"><a href="#scan_limits-1605"><span class="linenos">1605</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="scan_limits-1606"><a href="#scan_limits-1606"><span class="linenos">1606</span></a>    <span class="c1"># rotation</span>
</span><span id="scan_limits-1607"><a href="#scan_limits-1607"><span class="linenos">1607</span></a>    <span class="n">min_deg</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">rotation</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">min</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">RAD_TO_DEG</span>
</span><span id="scan_limits-1608"><a href="#scan_limits-1608"><span class="linenos">1608</span></a>    <span class="n">max_deg</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">rotation</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">RAD_TO_DEG</span>
</span><span id="scan_limits-1609"><a href="#scan_limits-1609"><span class="linenos">1609</span></a>    <span class="c1"># dwell_time</span>
</span><span id="scan_limits-1610"><a href="#scan_limits-1610"><span class="linenos">1610</span></a>    <span class="n">min_dwell_us</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">dwell_time</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">min</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">S_TO_US</span>
</span><span id="scan_limits-1611"><a href="#scan_limits-1611"><span class="linenos">1611</span></a>    <span class="n">max_dwell_us</span> <span class="o">=</span> <span class="n">selected_beam</span><span class="o">.</span><span class="n">scanning</span><span class="o">.</span><span class="n">dwell_time</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">max</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">S_TO_US</span>
</span><span id="scan_limits-1612"><a href="#scan_limits-1612"><span class="linenos">1612</span></a>
</span><span id="scan_limits-1613"><a href="#scan_limits-1613"><span class="linenos">1613</span></a>    <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ScanLimits</span><span class="p">(</span>
</span><span id="scan_limits-1614"><a href="#scan_limits-1614"><span class="linenos">1614</span></a>        <span class="n">rotation_deg</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_deg</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_deg</span><span class="p">),</span>
</span><span id="scan_limits-1615"><a href="#scan_limits-1615"><span class="linenos">1615</span></a>        <span class="n">dwell_us</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">min_dwell_us</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_dwell_us</span><span class="p">),</span>
</span><span id="scan_limits-1616"><a href="#scan_limits-1616"><span class="linenos">1616</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the scan settings limits for the selected beam.</p>

<p>This function retrieves the limits for rotation and dwell time for the selected beam and returns them as a <code>ScanLimits</code> object.</p>

<h2 id="parameters">Parameters</h2>

<p>selected_beam : property
    The selected beam property from which to retrieve the scan limits.</p>

<h2 id="returns">Returns</h2>

<p>tbt.ScanLimits
    The scan limits for rotation (degrees) and dwell time (microseconds).</p>
</div>


                </section>
                <section id="string_to_res">
                            <input id="string_to_res-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">string_to_res</span><span class="signature pdoc-code condensed">(<span class="param"><span class="nb">input</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#Resolution">pytribeam.types.Resolution</a></span>:</span></span>

                <label class="view-source-button" for="string_to_res-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#string_to_res"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="string_to_res-1619"><a href="#string_to_res-1619"><span class="linenos">1619</span></a><span class="k">def</span> <span class="nf">string_to_res</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Resolution</span><span class="p">:</span>
</span><span id="string_to_res-1620"><a href="#string_to_res-1620"><span class="linenos">1620</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="string_to_res-1621"><a href="#string_to_res-1621"><span class="linenos">1621</span></a><span class="sd">    Convert a string in the format &quot;{{width}}x{{height}}&quot; to a resolution object.</span>
</span><span id="string_to_res-1622"><a href="#string_to_res-1622"><span class="linenos">1622</span></a>
</span><span id="string_to_res-1623"><a href="#string_to_res-1623"><span class="linenos">1623</span></a><span class="sd">    This function takes a string representing the resolution in the format &quot;WIDTHxHEIGHT&quot; and converts it to a `Resolution` object.</span>
</span><span id="string_to_res-1624"><a href="#string_to_res-1624"><span class="linenos">1624</span></a>
</span><span id="string_to_res-1625"><a href="#string_to_res-1625"><span class="linenos">1625</span></a><span class="sd">    Parameters</span>
</span><span id="string_to_res-1626"><a href="#string_to_res-1626"><span class="linenos">1626</span></a><span class="sd">    ----------</span>
</span><span id="string_to_res-1627"><a href="#string_to_res-1627"><span class="linenos">1627</span></a><span class="sd">    input : str</span>
</span><span id="string_to_res-1628"><a href="#string_to_res-1628"><span class="linenos">1628</span></a><span class="sd">        The string representing the resolution in the format &quot;WIDTHxHEIGHT&quot;.</span>
</span><span id="string_to_res-1629"><a href="#string_to_res-1629"><span class="linenos">1629</span></a>
</span><span id="string_to_res-1630"><a href="#string_to_res-1630"><span class="linenos">1630</span></a><span class="sd">    Returns</span>
</span><span id="string_to_res-1631"><a href="#string_to_res-1631"><span class="linenos">1631</span></a><span class="sd">    -------</span>
</span><span id="string_to_res-1632"><a href="#string_to_res-1632"><span class="linenos">1632</span></a><span class="sd">    tbt.Resolution</span>
</span><span id="string_to_res-1633"><a href="#string_to_res-1633"><span class="linenos">1633</span></a><span class="sd">        The resolution object.</span>
</span><span id="string_to_res-1634"><a href="#string_to_res-1634"><span class="linenos">1634</span></a>
</span><span id="string_to_res-1635"><a href="#string_to_res-1635"><span class="linenos">1635</span></a><span class="sd">    Raises</span>
</span><span id="string_to_res-1636"><a href="#string_to_res-1636"><span class="linenos">1636</span></a><span class="sd">    ------</span>
</span><span id="string_to_res-1637"><a href="#string_to_res-1637"><span class="linenos">1637</span></a><span class="sd">    ValueError</span>
</span><span id="string_to_res-1638"><a href="#string_to_res-1638"><span class="linenos">1638</span></a><span class="sd">        If the input string is not in the expected format.</span>
</span><span id="string_to_res-1639"><a href="#string_to_res-1639"><span class="linenos">1639</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="string_to_res-1640"><a href="#string_to_res-1640"><span class="linenos">1640</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="string_to_res-1641"><a href="#string_to_res-1641"><span class="linenos">1641</span></a>        <span class="n">split_res</span> <span class="o">=</span> <span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
</span><span id="string_to_res-1642"><a href="#string_to_res-1642"><span class="linenos">1642</span></a>        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split_res</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">split_res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="string_to_res-1643"><a href="#string_to_res-1643"><span class="linenos">1643</span></a>    <span class="k">except</span><span class="p">:</span>
</span><span id="string_to_res-1644"><a href="#string_to_res-1644"><span class="linenos">1644</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="string_to_res-1645"><a href="#string_to_res-1645"><span class="linenos">1645</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Invalid string format, </span>
</span><span id="string_to_res-1646"><a href="#string_to_res-1646"><span class="linenos">1646</span></a><span class="s2">                            expected string format of &quot;WIDTHxHEIGHT&quot;, </span>
</span><span id="string_to_res-1647"><a href="#string_to_res-1647"><span class="linenos">1647</span></a><span class="s2">                            but received the following: &quot;</span><span class="si">{</span><span class="nb">input</span><span class="si">}</span><span class="s2">&quot;.&quot;&quot;&quot;</span>
</span><span id="string_to_res-1648"><a href="#string_to_res-1648"><span class="linenos">1648</span></a>        <span class="p">)</span>
</span><span id="string_to_res-1649"><a href="#string_to_res-1649"><span class="linenos">1649</span></a>
</span><span id="string_to_res-1650"><a href="#string_to_res-1650"><span class="linenos">1650</span></a>    <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Resolution</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert a string in the format "{{width}}x{{height}}" to a resolution object.</p>

<p>This function takes a string representing the resolution in the format "WIDTHxHEIGHT" and converts it to a <code>Resolution</code> object.</p>

<h2 id="parameters">Parameters</h2>

<p>input : str
    The string representing the resolution in the format "WIDTHxHEIGHT".</p>

<h2 id="returns">Returns</h2>

<p>tbt.Resolution
    The resolution object.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the input string is not in the expected format.</p>
</div>


                </section>
                <section id="valid_string_resolution">
                            <input id="valid_string_resolution-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">valid_string_resolution</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">string_resolution</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="valid_string_resolution-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#valid_string_resolution"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="valid_string_resolution-1653"><a href="#valid_string_resolution-1653"><span class="linenos">1653</span></a><span class="k">def</span> <span class="nf">valid_string_resolution</span><span class="p">(</span><span class="n">string_resolution</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="valid_string_resolution-1654"><a href="#valid_string_resolution-1654"><span class="linenos">1654</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="valid_string_resolution-1655"><a href="#valid_string_resolution-1655"><span class="linenos">1655</span></a><span class="sd">    Validate a string resolution.</span>
</span><span id="valid_string_resolution-1656"><a href="#valid_string_resolution-1656"><span class="linenos">1656</span></a>
</span><span id="valid_string_resolution-1657"><a href="#valid_string_resolution-1657"><span class="linenos">1657</span></a><span class="sd">    This function validates a string resolution by converting it to a `Resolution` object and checking if the width and height are within the specified limits.</span>
</span><span id="valid_string_resolution-1658"><a href="#valid_string_resolution-1658"><span class="linenos">1658</span></a>
</span><span id="valid_string_resolution-1659"><a href="#valid_string_resolution-1659"><span class="linenos">1659</span></a><span class="sd">    Parameters</span>
</span><span id="valid_string_resolution-1660"><a href="#valid_string_resolution-1660"><span class="linenos">1660</span></a><span class="sd">    ----------</span>
</span><span id="valid_string_resolution-1661"><a href="#valid_string_resolution-1661"><span class="linenos">1661</span></a><span class="sd">    string_resolution : str</span>
</span><span id="valid_string_resolution-1662"><a href="#valid_string_resolution-1662"><span class="linenos">1662</span></a><span class="sd">        The string representing the resolution in the format &quot;WIDTHxHEIGHT&quot;.</span>
</span><span id="valid_string_resolution-1663"><a href="#valid_string_resolution-1663"><span class="linenos">1663</span></a>
</span><span id="valid_string_resolution-1664"><a href="#valid_string_resolution-1664"><span class="linenos">1664</span></a><span class="sd">    Returns</span>
</span><span id="valid_string_resolution-1665"><a href="#valid_string_resolution-1665"><span class="linenos">1665</span></a><span class="sd">    -------</span>
</span><span id="valid_string_resolution-1666"><a href="#valid_string_resolution-1666"><span class="linenos">1666</span></a><span class="sd">    bool</span>
</span><span id="valid_string_resolution-1667"><a href="#valid_string_resolution-1667"><span class="linenos">1667</span></a><span class="sd">        True if the resolution is valid, False otherwise.</span>
</span><span id="valid_string_resolution-1668"><a href="#valid_string_resolution-1668"><span class="linenos">1668</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="valid_string_resolution-1669"><a href="#valid_string_resolution-1669"><span class="linenos">1669</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">string_to_res</span><span class="p">(</span><span class="n">string_resolution</span><span class="p">)</span>
</span><span id="valid_string_resolution-1670"><a href="#valid_string_resolution-1670"><span class="linenos">1670</span></a>    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">height</span>
</span><span id="valid_string_resolution-1671"><a href="#valid_string_resolution-1671"><span class="linenos">1671</span></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="valid_string_resolution-1672"><a href="#valid_string_resolution-1672"><span class="linenos">1672</span></a>        <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="valid_string_resolution-1673"><a href="#valid_string_resolution-1673"><span class="linenos">1673</span></a>            <span class="n">width</span><span class="p">,</span>
</span><span id="valid_string_resolution-1674"><a href="#valid_string_resolution-1674"><span class="linenos">1674</span></a>            <span class="n">limit</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">scan_resolution_limit</span><span class="p">,</span>
</span><span id="valid_string_resolution-1675"><a href="#valid_string_resolution-1675"><span class="linenos">1675</span></a>            <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="valid_string_resolution-1676"><a href="#valid_string_resolution-1676"><span class="linenos">1676</span></a>        <span class="p">)</span>
</span><span id="valid_string_resolution-1677"><a href="#valid_string_resolution-1677"><span class="linenos">1677</span></a>    <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="valid_string_resolution-1678"><a href="#valid_string_resolution-1678"><span class="linenos">1678</span></a>        <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="valid_string_resolution-1679"><a href="#valid_string_resolution-1679"><span class="linenos">1679</span></a>            <span class="n">height</span><span class="p">,</span>
</span><span id="valid_string_resolution-1680"><a href="#valid_string_resolution-1680"><span class="linenos">1680</span></a>            <span class="n">limit</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">scan_resolution_limit</span><span class="p">,</span>
</span><span id="valid_string_resolution-1681"><a href="#valid_string_resolution-1681"><span class="linenos">1681</span></a>            <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="valid_string_resolution-1682"><a href="#valid_string_resolution-1682"><span class="linenos">1682</span></a>        <span class="p">)</span>
</span><span id="valid_string_resolution-1683"><a href="#valid_string_resolution-1683"><span class="linenos">1683</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Validate a string resolution.</p>

<p>This function validates a string resolution by converting it to a <code>Resolution</code> object and checking if the width and height are within the specified limits.</p>

<h2 id="parameters">Parameters</h2>

<p>string_resolution : str
    The string representing the resolution in the format "WIDTHxHEIGHT".</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the resolution is valid, False otherwise.</p>
</div>


                </section>
                <section id="validate_auto_cb_settings">
                            <input id="validate_auto_cb_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_auto_cb_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_auto_cb_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_auto_cb_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_auto_cb_settings-1686"><a href="#validate_auto_cb_settings-1686"><span class="linenos">1686</span></a><span class="k">def</span> <span class="nf">validate_auto_cb_settings</span><span class="p">(</span>
</span><span id="validate_auto_cb_settings-1687"><a href="#validate_auto_cb_settings-1687"><span class="linenos">1687</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1688"><a href="#validate_auto_cb_settings-1688"><span class="linenos">1688</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1689"><a href="#validate_auto_cb_settings-1689"><span class="linenos">1689</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1690"><a href="#validate_auto_cb_settings-1690"><span class="linenos">1690</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_auto_cb_settings-1691"><a href="#validate_auto_cb_settings-1691"><span class="linenos">1691</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_auto_cb_settings-1692"><a href="#validate_auto_cb_settings-1692"><span class="linenos">1692</span></a><span class="sd">    Perform schema checking for auto contrast/brightness setting dictionary.</span>
</span><span id="validate_auto_cb_settings-1693"><a href="#validate_auto_cb_settings-1693"><span class="linenos">1693</span></a>
</span><span id="validate_auto_cb_settings-1694"><a href="#validate_auto_cb_settings-1694"><span class="linenos">1694</span></a><span class="sd">    This function validates the auto contrast/brightness settings dictionary based on the specified yml format.</span>
</span><span id="validate_auto_cb_settings-1695"><a href="#validate_auto_cb_settings-1695"><span class="linenos">1695</span></a>
</span><span id="validate_auto_cb_settings-1696"><a href="#validate_auto_cb_settings-1696"><span class="linenos">1696</span></a><span class="sd">    Parameters</span>
</span><span id="validate_auto_cb_settings-1697"><a href="#validate_auto_cb_settings-1697"><span class="linenos">1697</span></a><span class="sd">    ----------</span>
</span><span id="validate_auto_cb_settings-1698"><a href="#validate_auto_cb_settings-1698"><span class="linenos">1698</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_auto_cb_settings-1699"><a href="#validate_auto_cb_settings-1699"><span class="linenos">1699</span></a><span class="sd">        The dictionary containing the auto contrast/brightness settings.</span>
</span><span id="validate_auto_cb_settings-1700"><a href="#validate_auto_cb_settings-1700"><span class="linenos">1700</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_auto_cb_settings-1701"><a href="#validate_auto_cb_settings-1701"><span class="linenos">1701</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_auto_cb_settings-1702"><a href="#validate_auto_cb_settings-1702"><span class="linenos">1702</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_auto_cb_settings-1703"><a href="#validate_auto_cb_settings-1703"><span class="linenos">1703</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_auto_cb_settings-1704"><a href="#validate_auto_cb_settings-1704"><span class="linenos">1704</span></a>
</span><span id="validate_auto_cb_settings-1705"><a href="#validate_auto_cb_settings-1705"><span class="linenos">1705</span></a><span class="sd">    Returns</span>
</span><span id="validate_auto_cb_settings-1706"><a href="#validate_auto_cb_settings-1706"><span class="linenos">1706</span></a><span class="sd">    -------</span>
</span><span id="validate_auto_cb_settings-1707"><a href="#validate_auto_cb_settings-1707"><span class="linenos">1707</span></a><span class="sd">    bool</span>
</span><span id="validate_auto_cb_settings-1708"><a href="#validate_auto_cb_settings-1708"><span class="linenos">1708</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_auto_cb_settings-1709"><a href="#validate_auto_cb_settings-1709"><span class="linenos">1709</span></a>
</span><span id="validate_auto_cb_settings-1710"><a href="#validate_auto_cb_settings-1710"><span class="linenos">1710</span></a><span class="sd">    Raises</span>
</span><span id="validate_auto_cb_settings-1711"><a href="#validate_auto_cb_settings-1711"><span class="linenos">1711</span></a><span class="sd">    ------</span>
</span><span id="validate_auto_cb_settings-1712"><a href="#validate_auto_cb_settings-1712"><span class="linenos">1712</span></a><span class="sd">    KeyError</span>
</span><span id="validate_auto_cb_settings-1713"><a href="#validate_auto_cb_settings-1713"><span class="linenos">1713</span></a><span class="sd">        If required keys are missing from the settings dictionary.</span>
</span><span id="validate_auto_cb_settings-1714"><a href="#validate_auto_cb_settings-1714"><span class="linenos">1714</span></a><span class="sd">    ValueError</span>
</span><span id="validate_auto_cb_settings-1715"><a href="#validate_auto_cb_settings-1715"><span class="linenos">1715</span></a><span class="sd">        If the settings do not satisfy the specified schema.</span>
</span><span id="validate_auto_cb_settings-1716"><a href="#validate_auto_cb_settings-1716"><span class="linenos">1716</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_auto_cb_settings-1717"><a href="#validate_auto_cb_settings-1717"><span class="linenos">1717</span></a>
</span><span id="validate_auto_cb_settings-1718"><a href="#validate_auto_cb_settings-1718"><span class="linenos">1718</span></a>    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">none_value_dictionary</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
</span><span id="validate_auto_cb_settings-1719"><a href="#validate_auto_cb_settings-1719"><span class="linenos">1719</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="validate_auto_cb_settings-1720"><a href="#validate_auto_cb_settings-1720"><span class="linenos">1720</span></a>
</span><span id="validate_auto_cb_settings-1721"><a href="#validate_auto_cb_settings-1721"><span class="linenos">1721</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_auto_cb_settings-1722"><a href="#validate_auto_cb_settings-1722"><span class="linenos">1722</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_auto_cb_settings-1723"><a href="#validate_auto_cb_settings-1723"><span class="linenos">1723</span></a>            <span class="n">missing_key</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
</span><span id="validate_auto_cb_settings-1724"><a href="#validate_auto_cb_settings-1724"><span class="linenos">1724</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="validate_auto_cb_settings-1725"><a href="#validate_auto_cb_settings-1725"><span class="linenos">1725</span></a>            <span class="n">missing_key</span> <span class="o">=</span> <span class="s2">&quot;top&quot;</span>
</span><span id="validate_auto_cb_settings-1726"><a href="#validate_auto_cb_settings-1726"><span class="linenos">1726</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="validate_auto_cb_settings-1727"><a href="#validate_auto_cb_settings-1727"><span class="linenos">1727</span></a>            <span class="sa">f</span><span class="s2">&quot;Missing or no value for &#39;</span><span class="si">{</span><span class="n">missing_key</span><span class="si">}</span><span class="s2">&#39; key in &#39;auto_cb&#39; sub-dictionary in step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; All &#39;auto_cb&#39; sub-dictionary values must be declared by the user to implement this capability.&quot;</span>
</span><span id="validate_auto_cb_settings-1728"><a href="#validate_auto_cb_settings-1728"><span class="linenos">1728</span></a>        <span class="p">)</span>
</span><span id="validate_auto_cb_settings-1729"><a href="#validate_auto_cb_settings-1729"><span class="linenos">1729</span></a>
</span><span id="validate_auto_cb_settings-1730"><a href="#validate_auto_cb_settings-1730"><span class="linenos">1730</span></a>    <span class="n">origin_limit</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># reduced area limit for scan window</span>
</span><span id="validate_auto_cb_settings-1731"><a href="#validate_auto_cb_settings-1731"><span class="linenos">1731</span></a>    <span class="n">width_limit</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">])</span>
</span><span id="validate_auto_cb_settings-1732"><a href="#validate_auto_cb_settings-1732"><span class="linenos">1732</span></a>    <span class="n">height_limit</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">])</span>
</span><span id="validate_auto_cb_settings-1733"><a href="#validate_auto_cb_settings-1733"><span class="linenos">1733</span></a>
</span><span id="validate_auto_cb_settings-1734"><a href="#validate_auto_cb_settings-1734"><span class="linenos">1734</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_auto_cb_settings-1735"><a href="#validate_auto_cb_settings-1735"><span class="linenos">1735</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_auto_cb_settings-1736"><a href="#validate_auto_cb_settings-1736"><span class="linenos">1736</span></a>            <span class="p">{</span>
</span><span id="validate_auto_cb_settings-1737"><a href="#validate_auto_cb_settings-1737"><span class="linenos">1737</span></a>                <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_auto_cb_settings-1738"><a href="#validate_auto_cb_settings-1738"><span class="linenos">1738</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1739"><a href="#validate_auto_cb_settings-1739"><span class="linenos">1739</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_auto_cb_settings-1740"><a href="#validate_auto_cb_settings-1740"><span class="linenos">1740</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1741"><a href="#validate_auto_cb_settings-1741"><span class="linenos">1741</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">origin_limit</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1742"><a href="#validate_auto_cb_settings-1742"><span class="linenos">1742</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">RIGHT_OPEN</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1743"><a href="#validate_auto_cb_settings-1743"><span class="linenos">1743</span></a>                    <span class="p">),</span>
</span><span id="validate_auto_cb_settings-1744"><a href="#validate_auto_cb_settings-1744"><span class="linenos">1744</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested auto contrast/brightness window setting &#39;left&#39; of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;0 &lt;= left &lt; </span><span class="si">{</span><span class="n">origin_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;. Origin is in top-left corner of the field of view.&quot;</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1745"><a href="#validate_auto_cb_settings-1745"><span class="linenos">1745</span></a>                <span class="p">),</span>
</span><span id="validate_auto_cb_settings-1746"><a href="#validate_auto_cb_settings-1746"><span class="linenos">1746</span></a>                <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_auto_cb_settings-1747"><a href="#validate_auto_cb_settings-1747"><span class="linenos">1747</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1748"><a href="#validate_auto_cb_settings-1748"><span class="linenos">1748</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_auto_cb_settings-1749"><a href="#validate_auto_cb_settings-1749"><span class="linenos">1749</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1750"><a href="#validate_auto_cb_settings-1750"><span class="linenos">1750</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">origin_limit</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1751"><a href="#validate_auto_cb_settings-1751"><span class="linenos">1751</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">RIGHT_OPEN</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1752"><a href="#validate_auto_cb_settings-1752"><span class="linenos">1752</span></a>                    <span class="p">),</span>
</span><span id="validate_auto_cb_settings-1753"><a href="#validate_auto_cb_settings-1753"><span class="linenos">1753</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested auto contrast/brightness windows setting &#39;top&#39; of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;0.0 &lt;= top &lt; </span><span class="si">{</span><span class="n">origin_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;. Origin is in top-left corner of the field of view.&quot;</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1754"><a href="#validate_auto_cb_settings-1754"><span class="linenos">1754</span></a>                <span class="p">),</span>
</span><span id="validate_auto_cb_settings-1755"><a href="#validate_auto_cb_settings-1755"><span class="linenos">1755</span></a>                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_auto_cb_settings-1756"><a href="#validate_auto_cb_settings-1756"><span class="linenos">1756</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1757"><a href="#validate_auto_cb_settings-1757"><span class="linenos">1757</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_auto_cb_settings-1758"><a href="#validate_auto_cb_settings-1758"><span class="linenos">1758</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1759"><a href="#validate_auto_cb_settings-1759"><span class="linenos">1759</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">width_limit</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1760"><a href="#validate_auto_cb_settings-1760"><span class="linenos">1760</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">LEFT_OPEN</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1761"><a href="#validate_auto_cb_settings-1761"><span class="linenos">1761</span></a>                    <span class="p">),</span>
</span><span id="validate_auto_cb_settings-1762"><a href="#validate_auto_cb_settings-1762"><span class="linenos">1762</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested auto contrast/brightness windows setting &#39;width&#39; of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> must satisfy &#39;0.0 &lt; width &lt;= </span><span class="si">{</span><span class="n">width_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39; with &#39;left&#39; setting of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> as total width (&#39;left&#39; + &#39;width&#39;) cannot exceed 1.0&quot;</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1763"><a href="#validate_auto_cb_settings-1763"><span class="linenos">1763</span></a>                <span class="p">),</span>
</span><span id="validate_auto_cb_settings-1764"><a href="#validate_auto_cb_settings-1764"><span class="linenos">1764</span></a>                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_auto_cb_settings-1765"><a href="#validate_auto_cb_settings-1765"><span class="linenos">1765</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1766"><a href="#validate_auto_cb_settings-1766"><span class="linenos">1766</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_auto_cb_settings-1767"><a href="#validate_auto_cb_settings-1767"><span class="linenos">1767</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1768"><a href="#validate_auto_cb_settings-1768"><span class="linenos">1768</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">height_limit</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1769"><a href="#validate_auto_cb_settings-1769"><span class="linenos">1769</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">LEFT_OPEN</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1770"><a href="#validate_auto_cb_settings-1770"><span class="linenos">1770</span></a>                    <span class="p">),</span>
</span><span id="validate_auto_cb_settings-1771"><a href="#validate_auto_cb_settings-1771"><span class="linenos">1771</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested auto contrast/brightness windows setting &#39;height&#39; of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> must satisfy &#39;0.0 &lt; height &lt;= </span><span class="si">{</span><span class="n">height_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39; with &#39;top&#39; setting of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> as total height (&#39;top&#39; + &#39;height&#39;) cannot exceed 1.0&quot;</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1772"><a href="#validate_auto_cb_settings-1772"><span class="linenos">1772</span></a>                <span class="p">),</span>
</span><span id="validate_auto_cb_settings-1773"><a href="#validate_auto_cb_settings-1773"><span class="linenos">1773</span></a>            <span class="p">},</span>
</span><span id="validate_auto_cb_settings-1774"><a href="#validate_auto_cb_settings-1774"><span class="linenos">1774</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_auto_cb_settings-1775"><a href="#validate_auto_cb_settings-1775"><span class="linenos">1775</span></a>        <span class="p">)</span>
</span><span id="validate_auto_cb_settings-1776"><a href="#validate_auto_cb_settings-1776"><span class="linenos">1776</span></a>
</span><span id="validate_auto_cb_settings-1777"><a href="#validate_auto_cb_settings-1777"><span class="linenos">1777</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_auto_cb_settings-1778"><a href="#validate_auto_cb_settings-1778"><span class="linenos">1778</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_auto_cb_settings-1779"><a href="#validate_auto_cb_settings-1779"><span class="linenos">1779</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="validate_auto_cb_settings-1780"><a href="#validate_auto_cb_settings-1780"><span class="linenos">1780</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_auto_cb_settings-1781"><a href="#validate_auto_cb_settings-1781"><span class="linenos">1781</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="validate_auto_cb_settings-1782"><a href="#validate_auto_cb_settings-1782"><span class="linenos">1782</span></a>        <span class="p">)</span>
</span><span id="validate_auto_cb_settings-1783"><a href="#validate_auto_cb_settings-1783"><span class="linenos">1783</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for auto contrast/brightness setting dictionary.</p>

<p>This function validates the auto contrast/brightness settings dictionary based on the specified yml format.</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    The dictionary containing the auto contrast/brightness settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
step_name : str
    The name of the step in the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>KeyError
    If required keys are missing from the settings dictionary.
ValueError
    If the settings do not satisfy the specified schema.</p>
</div>


                </section>
                <section id="validate_stage_position">
                            <input id="validate_stage_position-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_stage_position</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_stage_position-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_stage_position"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_stage_position-1786"><a href="#validate_stage_position-1786"><span class="linenos">1786</span></a><span class="k">def</span> <span class="nf">validate_stage_position</span><span class="p">(</span>
</span><span id="validate_stage_position-1787"><a href="#validate_stage_position-1787"><span class="linenos">1787</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="validate_stage_position-1788"><a href="#validate_stage_position-1788"><span class="linenos">1788</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_stage_position-1789"><a href="#validate_stage_position-1789"><span class="linenos">1789</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_stage_position-1790"><a href="#validate_stage_position-1790"><span class="linenos">1790</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_stage_position-1791"><a href="#validate_stage_position-1791"><span class="linenos">1791</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_stage_position-1792"><a href="#validate_stage_position-1792"><span class="linenos">1792</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_stage_position-1793"><a href="#validate_stage_position-1793"><span class="linenos">1793</span></a><span class="sd">    Perform schema checking for stage position dictionary.</span>
</span><span id="validate_stage_position-1794"><a href="#validate_stage_position-1794"><span class="linenos">1794</span></a>
</span><span id="validate_stage_position-1795"><a href="#validate_stage_position-1795"><span class="linenos">1795</span></a><span class="sd">    This function validates the stage position settings dictionary based on the specified yml format and the stage limits of the microscope.</span>
</span><span id="validate_stage_position-1796"><a href="#validate_stage_position-1796"><span class="linenos">1796</span></a>
</span><span id="validate_stage_position-1797"><a href="#validate_stage_position-1797"><span class="linenos">1797</span></a><span class="sd">    Parameters</span>
</span><span id="validate_stage_position-1798"><a href="#validate_stage_position-1798"><span class="linenos">1798</span></a><span class="sd">    ----------</span>
</span><span id="validate_stage_position-1799"><a href="#validate_stage_position-1799"><span class="linenos">1799</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="validate_stage_position-1800"><a href="#validate_stage_position-1800"><span class="linenos">1800</span></a><span class="sd">        The microscope object for which to validate the stage position settings.</span>
</span><span id="validate_stage_position-1801"><a href="#validate_stage_position-1801"><span class="linenos">1801</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_stage_position-1802"><a href="#validate_stage_position-1802"><span class="linenos">1802</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_stage_position-1803"><a href="#validate_stage_position-1803"><span class="linenos">1803</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_stage_position-1804"><a href="#validate_stage_position-1804"><span class="linenos">1804</span></a><span class="sd">        The dictionary containing the stage position settings.</span>
</span><span id="validate_stage_position-1805"><a href="#validate_stage_position-1805"><span class="linenos">1805</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_stage_position-1806"><a href="#validate_stage_position-1806"><span class="linenos">1806</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_stage_position-1807"><a href="#validate_stage_position-1807"><span class="linenos">1807</span></a>
</span><span id="validate_stage_position-1808"><a href="#validate_stage_position-1808"><span class="linenos">1808</span></a><span class="sd">    Returns</span>
</span><span id="validate_stage_position-1809"><a href="#validate_stage_position-1809"><span class="linenos">1809</span></a><span class="sd">    -------</span>
</span><span id="validate_stage_position-1810"><a href="#validate_stage_position-1810"><span class="linenos">1810</span></a><span class="sd">    bool</span>
</span><span id="validate_stage_position-1811"><a href="#validate_stage_position-1811"><span class="linenos">1811</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_stage_position-1812"><a href="#validate_stage_position-1812"><span class="linenos">1812</span></a>
</span><span id="validate_stage_position-1813"><a href="#validate_stage_position-1813"><span class="linenos">1813</span></a><span class="sd">    Raises</span>
</span><span id="validate_stage_position-1814"><a href="#validate_stage_position-1814"><span class="linenos">1814</span></a><span class="sd">    ------</span>
</span><span id="validate_stage_position-1815"><a href="#validate_stage_position-1815"><span class="linenos">1815</span></a><span class="sd">    ValueError</span>
</span><span id="validate_stage_position-1816"><a href="#validate_stage_position-1816"><span class="linenos">1816</span></a><span class="sd">        If the yml version is unsupported.</span>
</span><span id="validate_stage_position-1817"><a href="#validate_stage_position-1817"><span class="linenos">1817</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_stage_position-1818"><a href="#validate_stage_position-1818"><span class="linenos">1818</span></a>    <span class="n">limits</span> <span class="o">=</span> <span class="n">stage_limits</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="validate_stage_position-1819"><a href="#validate_stage_position-1819"><span class="linenos">1819</span></a>
</span><span id="validate_stage_position-1820"><a href="#validate_stage_position-1820"><span class="linenos">1820</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_stage_position-1821"><a href="#validate_stage_position-1821"><span class="linenos">1821</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_stage_position-1822"><a href="#validate_stage_position-1822"><span class="linenos">1822</span></a>            <span class="p">{</span>
</span><span id="validate_stage_position-1823"><a href="#validate_stage_position-1823"><span class="linenos">1823</span></a>                <span class="s2">&quot;x_mm&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_stage_position-1824"><a href="#validate_stage_position-1824"><span class="linenos">1824</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_stage_position-1825"><a href="#validate_stage_position-1825"><span class="linenos">1825</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_stage_position-1826"><a href="#validate_stage_position-1826"><span class="linenos">1826</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_stage_position-1827"><a href="#validate_stage_position-1827"><span class="linenos">1827</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">x_mm</span><span class="p">,</span>
</span><span id="validate_stage_position-1828"><a href="#validate_stage_position-1828"><span class="linenos">1828</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="validate_stage_position-1829"><a href="#validate_stage_position-1829"><span class="linenos">1829</span></a>                    <span class="p">),</span>
</span><span id="validate_stage_position-1830"><a href="#validate_stage_position-1830"><span class="linenos">1830</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested x-axis position of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;x_mm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> mm for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;</span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">x_mm</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= x_mm &lt;= </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">x_mm</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="validate_stage_position-1831"><a href="#validate_stage_position-1831"><span class="linenos">1831</span></a>                <span class="p">),</span>
</span><span id="validate_stage_position-1832"><a href="#validate_stage_position-1832"><span class="linenos">1832</span></a>                <span class="s2">&quot;y_mm&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_stage_position-1833"><a href="#validate_stage_position-1833"><span class="linenos">1833</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_stage_position-1834"><a href="#validate_stage_position-1834"><span class="linenos">1834</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_stage_position-1835"><a href="#validate_stage_position-1835"><span class="linenos">1835</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_stage_position-1836"><a href="#validate_stage_position-1836"><span class="linenos">1836</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">y_mm</span><span class="p">,</span>
</span><span id="validate_stage_position-1837"><a href="#validate_stage_position-1837"><span class="linenos">1837</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="validate_stage_position-1838"><a href="#validate_stage_position-1838"><span class="linenos">1838</span></a>                    <span class="p">),</span>
</span><span id="validate_stage_position-1839"><a href="#validate_stage_position-1839"><span class="linenos">1839</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested y-axis position of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;y_mm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> mm for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;</span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">y_mm</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= y_mm &lt;= </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">y_mm</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="validate_stage_position-1840"><a href="#validate_stage_position-1840"><span class="linenos">1840</span></a>                <span class="p">),</span>
</span><span id="validate_stage_position-1841"><a href="#validate_stage_position-1841"><span class="linenos">1841</span></a>                <span class="s2">&quot;z_mm&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_stage_position-1842"><a href="#validate_stage_position-1842"><span class="linenos">1842</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_stage_position-1843"><a href="#validate_stage_position-1843"><span class="linenos">1843</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_stage_position-1844"><a href="#validate_stage_position-1844"><span class="linenos">1844</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_stage_position-1845"><a href="#validate_stage_position-1845"><span class="linenos">1845</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">z_mm</span><span class="p">,</span>
</span><span id="validate_stage_position-1846"><a href="#validate_stage_position-1846"><span class="linenos">1846</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="validate_stage_position-1847"><a href="#validate_stage_position-1847"><span class="linenos">1847</span></a>                    <span class="p">),</span>
</span><span id="validate_stage_position-1848"><a href="#validate_stage_position-1848"><span class="linenos">1848</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested z-axis position of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;z_mm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> mm for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;</span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">z_mm</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= z_mm &lt;= </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">z_mm</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="validate_stage_position-1849"><a href="#validate_stage_position-1849"><span class="linenos">1849</span></a>                <span class="p">),</span>
</span><span id="validate_stage_position-1850"><a href="#validate_stage_position-1850"><span class="linenos">1850</span></a>                <span class="s2">&quot;r_deg&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_stage_position-1851"><a href="#validate_stage_position-1851"><span class="linenos">1851</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_stage_position-1852"><a href="#validate_stage_position-1852"><span class="linenos">1852</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_stage_position-1853"><a href="#validate_stage_position-1853"><span class="linenos">1853</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_stage_position-1854"><a href="#validate_stage_position-1854"><span class="linenos">1854</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">r_deg</span><span class="p">,</span>
</span><span id="validate_stage_position-1855"><a href="#validate_stage_position-1855"><span class="linenos">1855</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">RIGHT_OPEN</span><span class="p">,</span>
</span><span id="validate_stage_position-1856"><a href="#validate_stage_position-1856"><span class="linenos">1856</span></a>                    <span class="p">),</span>
</span><span id="validate_stage_position-1857"><a href="#validate_stage_position-1857"><span class="linenos">1857</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested r-axis position of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;r_deg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> degree for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;</span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">r_deg</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= r_deg &lt; </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">r_deg</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="validate_stage_position-1858"><a href="#validate_stage_position-1858"><span class="linenos">1858</span></a>                <span class="p">),</span>
</span><span id="validate_stage_position-1859"><a href="#validate_stage_position-1859"><span class="linenos">1859</span></a>                <span class="s2">&quot;t_deg&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_stage_position-1860"><a href="#validate_stage_position-1860"><span class="linenos">1860</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_stage_position-1861"><a href="#validate_stage_position-1861"><span class="linenos">1861</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_stage_position-1862"><a href="#validate_stage_position-1862"><span class="linenos">1862</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_stage_position-1863"><a href="#validate_stage_position-1863"><span class="linenos">1863</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">t_deg</span><span class="p">,</span>
</span><span id="validate_stage_position-1864"><a href="#validate_stage_position-1864"><span class="linenos">1864</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="validate_stage_position-1865"><a href="#validate_stage_position-1865"><span class="linenos">1865</span></a>                    <span class="p">),</span>
</span><span id="validate_stage_position-1866"><a href="#validate_stage_position-1866"><span class="linenos">1866</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested r-axis position of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;t_deg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> degree for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; must satisfy &#39;</span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">t_deg</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= t_deg &lt;= </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">t_deg</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="validate_stage_position-1867"><a href="#validate_stage_position-1867"><span class="linenos">1867</span></a>                <span class="p">),</span>
</span><span id="validate_stage_position-1868"><a href="#validate_stage_position-1868"><span class="linenos">1868</span></a>            <span class="p">},</span>
</span><span id="validate_stage_position-1869"><a href="#validate_stage_position-1869"><span class="linenos">1869</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_stage_position-1870"><a href="#validate_stage_position-1870"><span class="linenos">1870</span></a>        <span class="p">)</span>
</span><span id="validate_stage_position-1871"><a href="#validate_stage_position-1871"><span class="linenos">1871</span></a>
</span><span id="validate_stage_position-1872"><a href="#validate_stage_position-1872"><span class="linenos">1872</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_stage_position-1873"><a href="#validate_stage_position-1873"><span class="linenos">1873</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_stage_position-1874"><a href="#validate_stage_position-1874"><span class="linenos">1874</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="validate_stage_position-1875"><a href="#validate_stage_position-1875"><span class="linenos">1875</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_stage_position-1876"><a href="#validate_stage_position-1876"><span class="linenos">1876</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="validate_stage_position-1877"><a href="#validate_stage_position-1877"><span class="linenos">1877</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for stage position dictionary.</p>

<p>This function validates the stage position settings dictionary based on the specified yml format and the stage limits of the microscope.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object for which to validate the stage position settings.
step_name : str
    The name of the step in the .yml file.
settings : dict
    The dictionary containing the stage position settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the yml version is unsupported.</p>
</div>


                </section>
                <section id="validate_beam_settings">
                            <input id="validate_beam_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_beam_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span>,</span><span class="param">	<span class="n">beam_type</span><span class="p">:</span> <span class="n"><a href="types.html#BeamType">pytribeam.types.BeamType</a></span>,</span><span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_beam_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_beam_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_beam_settings-1880"><a href="#validate_beam_settings-1880"><span class="linenos">1880</span></a><span class="k">def</span> <span class="nf">validate_beam_settings</span><span class="p">(</span>
</span><span id="validate_beam_settings-1881"><a href="#validate_beam_settings-1881"><span class="linenos">1881</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="validate_beam_settings-1882"><a href="#validate_beam_settings-1882"><span class="linenos">1882</span></a>    <span class="n">beam_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">,</span>
</span><span id="validate_beam_settings-1883"><a href="#validate_beam_settings-1883"><span class="linenos">1883</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_beam_settings-1884"><a href="#validate_beam_settings-1884"><span class="linenos">1884</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_beam_settings-1885"><a href="#validate_beam_settings-1885"><span class="linenos">1885</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_beam_settings-1886"><a href="#validate_beam_settings-1886"><span class="linenos">1886</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_beam_settings-1887"><a href="#validate_beam_settings-1887"><span class="linenos">1887</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_beam_settings-1888"><a href="#validate_beam_settings-1888"><span class="linenos">1888</span></a><span class="sd">    Perform schema checking for beam setting dictionary.</span>
</span><span id="validate_beam_settings-1889"><a href="#validate_beam_settings-1889"><span class="linenos">1889</span></a>
</span><span id="validate_beam_settings-1890"><a href="#validate_beam_settings-1890"><span class="linenos">1890</span></a><span class="sd">    This function validates the beam settings dictionary based on the specified yml format and the beam limits of the microscope.</span>
</span><span id="validate_beam_settings-1891"><a href="#validate_beam_settings-1891"><span class="linenos">1891</span></a>
</span><span id="validate_beam_settings-1892"><a href="#validate_beam_settings-1892"><span class="linenos">1892</span></a><span class="sd">    Parameters</span>
</span><span id="validate_beam_settings-1893"><a href="#validate_beam_settings-1893"><span class="linenos">1893</span></a><span class="sd">    ----------</span>
</span><span id="validate_beam_settings-1894"><a href="#validate_beam_settings-1894"><span class="linenos">1894</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="validate_beam_settings-1895"><a href="#validate_beam_settings-1895"><span class="linenos">1895</span></a><span class="sd">        The microscope object for which to validate the beam settings.</span>
</span><span id="validate_beam_settings-1896"><a href="#validate_beam_settings-1896"><span class="linenos">1896</span></a><span class="sd">    beam_type : tbt.BeamType</span>
</span><span id="validate_beam_settings-1897"><a href="#validate_beam_settings-1897"><span class="linenos">1897</span></a><span class="sd">        The type of the beam (electron or ion).</span>
</span><span id="validate_beam_settings-1898"><a href="#validate_beam_settings-1898"><span class="linenos">1898</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_beam_settings-1899"><a href="#validate_beam_settings-1899"><span class="linenos">1899</span></a><span class="sd">        The dictionary containing the beam settings.</span>
</span><span id="validate_beam_settings-1900"><a href="#validate_beam_settings-1900"><span class="linenos">1900</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_beam_settings-1901"><a href="#validate_beam_settings-1901"><span class="linenos">1901</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_beam_settings-1902"><a href="#validate_beam_settings-1902"><span class="linenos">1902</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_beam_settings-1903"><a href="#validate_beam_settings-1903"><span class="linenos">1903</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_beam_settings-1904"><a href="#validate_beam_settings-1904"><span class="linenos">1904</span></a>
</span><span id="validate_beam_settings-1905"><a href="#validate_beam_settings-1905"><span class="linenos">1905</span></a><span class="sd">    Returns</span>
</span><span id="validate_beam_settings-1906"><a href="#validate_beam_settings-1906"><span class="linenos">1906</span></a><span class="sd">    -------</span>
</span><span id="validate_beam_settings-1907"><a href="#validate_beam_settings-1907"><span class="linenos">1907</span></a><span class="sd">    bool</span>
</span><span id="validate_beam_settings-1908"><a href="#validate_beam_settings-1908"><span class="linenos">1908</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_beam_settings-1909"><a href="#validate_beam_settings-1909"><span class="linenos">1909</span></a>
</span><span id="validate_beam_settings-1910"><a href="#validate_beam_settings-1910"><span class="linenos">1910</span></a><span class="sd">    Raises</span>
</span><span id="validate_beam_settings-1911"><a href="#validate_beam_settings-1911"><span class="linenos">1911</span></a><span class="sd">    ------</span>
</span><span id="validate_beam_settings-1912"><a href="#validate_beam_settings-1912"><span class="linenos">1912</span></a><span class="sd">    ValueError</span>
</span><span id="validate_beam_settings-1913"><a href="#validate_beam_settings-1913"><span class="linenos">1913</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="validate_beam_settings-1914"><a href="#validate_beam_settings-1914"><span class="linenos">1914</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_beam_settings-1915"><a href="#validate_beam_settings-1915"><span class="linenos">1915</span></a>    <span class="n">specified_beam</span> <span class="o">=</span> <span class="n">beam_object_type</span><span class="p">(</span><span class="n">beam_type</span><span class="p">)(</span><span class="n">settings</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">())</span>
</span><span id="validate_beam_settings-1916"><a href="#validate_beam_settings-1916"><span class="linenos">1916</span></a>    <span class="n">selected_beam</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">beam_type</span><span class="p">(</span><span class="n">specified_beam</span><span class="p">,</span> <span class="n">microscope</span><span class="p">)</span>
</span><span id="validate_beam_settings-1917"><a href="#validate_beam_settings-1917"><span class="linenos">1917</span></a>
</span><span id="validate_beam_settings-1918"><a href="#validate_beam_settings-1918"><span class="linenos">1918</span></a>    <span class="n">limits</span> <span class="o">=</span> <span class="n">beam_limits</span><span class="p">(</span><span class="n">selected_beam</span><span class="p">,</span> <span class="n">beam_type</span><span class="p">)</span>
</span><span id="validate_beam_settings-1919"><a href="#validate_beam_settings-1919"><span class="linenos">1919</span></a>
</span><span id="validate_beam_settings-1920"><a href="#validate_beam_settings-1920"><span class="linenos">1920</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_beam_settings-1921"><a href="#validate_beam_settings-1921"><span class="linenos">1921</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_beam_settings-1922"><a href="#validate_beam_settings-1922"><span class="linenos">1922</span></a>            <span class="p">{</span>
</span><span id="validate_beam_settings-1923"><a href="#validate_beam_settings-1923"><span class="linenos">1923</span></a>                <span class="s2">&quot;voltage_kv&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_beam_settings-1924"><a href="#validate_beam_settings-1924"><span class="linenos">1924</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_beam_settings-1925"><a href="#validate_beam_settings-1925"><span class="linenos">1925</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_beam_settings-1926"><a href="#validate_beam_settings-1926"><span class="linenos">1926</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_beam_settings-1927"><a href="#validate_beam_settings-1927"><span class="linenos">1927</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">voltage_kv</span><span class="p">,</span>
</span><span id="validate_beam_settings-1928"><a href="#validate_beam_settings-1928"><span class="linenos">1928</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="validate_beam_settings-1929"><a href="#validate_beam_settings-1929"><span class="linenos">1929</span></a>                    <span class="p">),</span>
</span><span id="validate_beam_settings-1930"><a href="#validate_beam_settings-1930"><span class="linenos">1930</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested voltage of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;voltage_kv&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; kV not within limits of </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">voltage_kv</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> kV and </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">voltage_kv</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2"> kV.&quot;</span><span class="p">,</span>
</span><span id="validate_beam_settings-1931"><a href="#validate_beam_settings-1931"><span class="linenos">1931</span></a>                <span class="p">),</span>
</span><span id="validate_beam_settings-1932"><a href="#validate_beam_settings-1932"><span class="linenos">1932</span></a>                <span class="s2">&quot;voltage_tol_kv&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_beam_settings-1933"><a href="#validate_beam_settings-1933"><span class="linenos">1933</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_beam_settings-1934"><a href="#validate_beam_settings-1934"><span class="linenos">1934</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_beam_settings-1935"><a href="#validate_beam_settings-1935"><span class="linenos">1935</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested voltage tolerance of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;voltage_tol_kv&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; kV must be a positive float (greater than 0).&quot;</span><span class="p">,</span>
</span><span id="validate_beam_settings-1936"><a href="#validate_beam_settings-1936"><span class="linenos">1936</span></a>                <span class="p">),</span>
</span><span id="validate_beam_settings-1937"><a href="#validate_beam_settings-1937"><span class="linenos">1937</span></a>                <span class="s2">&quot;current_na&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_beam_settings-1938"><a href="#validate_beam_settings-1938"><span class="linenos">1938</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_beam_settings-1939"><a href="#validate_beam_settings-1939"><span class="linenos">1939</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_beam_settings-1940"><a href="#validate_beam_settings-1940"><span class="linenos">1940</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_beam_settings-1941"><a href="#validate_beam_settings-1941"><span class="linenos">1941</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">current_na</span><span class="p">,</span>
</span><span id="validate_beam_settings-1942"><a href="#validate_beam_settings-1942"><span class="linenos">1942</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="validate_beam_settings-1943"><a href="#validate_beam_settings-1943"><span class="linenos">1943</span></a>                    <span class="p">),</span>
</span><span id="validate_beam_settings-1944"><a href="#validate_beam_settings-1944"><span class="linenos">1944</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested voltage of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;current_na&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; nA not within limits of </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">current_na</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> nA and </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">current_na</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2"> nA&quot;</span><span class="p">,</span>
</span><span id="validate_beam_settings-1945"><a href="#validate_beam_settings-1945"><span class="linenos">1945</span></a>                <span class="p">),</span>
</span><span id="validate_beam_settings-1946"><a href="#validate_beam_settings-1946"><span class="linenos">1946</span></a>                <span class="s2">&quot;current_tol_na&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_beam_settings-1947"><a href="#validate_beam_settings-1947"><span class="linenos">1947</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_beam_settings-1948"><a href="#validate_beam_settings-1948"><span class="linenos">1948</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_beam_settings-1949"><a href="#validate_beam_settings-1949"><span class="linenos">1949</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;current_tol_na&#39; must be a positive float (greater than 0)&quot;</span><span class="p">,</span>
</span><span id="validate_beam_settings-1950"><a href="#validate_beam_settings-1950"><span class="linenos">1950</span></a>                <span class="p">),</span>
</span><span id="validate_beam_settings-1951"><a href="#validate_beam_settings-1951"><span class="linenos">1951</span></a>                <span class="s2">&quot;hfw_mm&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_beam_settings-1952"><a href="#validate_beam_settings-1952"><span class="linenos">1952</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_beam_settings-1953"><a href="#validate_beam_settings-1953"><span class="linenos">1953</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_beam_settings-1954"><a href="#validate_beam_settings-1954"><span class="linenos">1954</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_beam_settings-1955"><a href="#validate_beam_settings-1955"><span class="linenos">1955</span></a>                        <span class="n">limits</span><span class="o">.</span><span class="n">hfw_mm</span><span class="p">,</span>
</span><span id="validate_beam_settings-1956"><a href="#validate_beam_settings-1956"><span class="linenos">1956</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="validate_beam_settings-1957"><a href="#validate_beam_settings-1957"><span class="linenos">1957</span></a>                    <span class="p">),</span>
</span><span id="validate_beam_settings-1958"><a href="#validate_beam_settings-1958"><span class="linenos">1958</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested horizontal field width of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;hfw_mm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm not within limits of </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">hfw_mm</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> mm and </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">hfw_mm</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2"> mm&quot;</span><span class="p">,</span>
</span><span id="validate_beam_settings-1959"><a href="#validate_beam_settings-1959"><span class="linenos">1959</span></a>                <span class="p">),</span>
</span><span id="validate_beam_settings-1960"><a href="#validate_beam_settings-1960"><span class="linenos">1960</span></a>                <span class="s2">&quot;working_dist_mm&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_beam_settings-1961"><a href="#validate_beam_settings-1961"><span class="linenos">1961</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_beam_settings-1962"><a href="#validate_beam_settings-1962"><span class="linenos">1962</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_beam_settings-1963"><a href="#validate_beam_settings-1963"><span class="linenos">1963</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_beam_settings-1964"><a href="#validate_beam_settings-1964"><span class="linenos">1964</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">limits</span><span class="o">.</span><span class="n">working_distance_mm</span><span class="p">,</span>
</span><span id="validate_beam_settings-1965"><a href="#validate_beam_settings-1965"><span class="linenos">1965</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="validate_beam_settings-1966"><a href="#validate_beam_settings-1966"><span class="linenos">1966</span></a>                    <span class="p">),</span>
</span><span id="validate_beam_settings-1967"><a href="#validate_beam_settings-1967"><span class="linenos">1967</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested working distance of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;working_dist_mm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm not within limits of </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">working_distance_mm</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> mm and </span><span class="si">{</span><span class="n">limits</span><span class="o">.</span><span class="n">working_distance_mm</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2"> mm&quot;</span><span class="p">,</span>
</span><span id="validate_beam_settings-1968"><a href="#validate_beam_settings-1968"><span class="linenos">1968</span></a>                <span class="p">),</span>
</span><span id="validate_beam_settings-1969"><a href="#validate_beam_settings-1969"><span class="linenos">1969</span></a>            <span class="p">},</span>
</span><span id="validate_beam_settings-1970"><a href="#validate_beam_settings-1970"><span class="linenos">1970</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_beam_settings-1971"><a href="#validate_beam_settings-1971"><span class="linenos">1971</span></a>        <span class="p">)</span>
</span><span id="validate_beam_settings-1972"><a href="#validate_beam_settings-1972"><span class="linenos">1972</span></a>
</span><span id="validate_beam_settings-1973"><a href="#validate_beam_settings-1973"><span class="linenos">1973</span></a>        <span class="n">e_beam_schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_beam_settings-1974"><a href="#validate_beam_settings-1974"><span class="linenos">1974</span></a>            <span class="p">{</span>
</span><span id="validate_beam_settings-1975"><a href="#validate_beam_settings-1975"><span class="linenos">1975</span></a>                <span class="s2">&quot;dynamic_focus&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="validate_beam_settings-1976"><a href="#validate_beam_settings-1976"><span class="linenos">1976</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="validate_beam_settings-1977"><a href="#validate_beam_settings-1977"><span class="linenos">1977</span></a>                    <span class="nb">bool</span><span class="p">,</span>
</span><span id="validate_beam_settings-1978"><a href="#validate_beam_settings-1978"><span class="linenos">1978</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; with &#39;electron&#39; beam imaging, &#39;dynamic_focus&#39; must be a boolean value but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dynamic_focus&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dynamic_focus&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_beam_settings-1979"><a href="#validate_beam_settings-1979"><span class="linenos">1979</span></a>                <span class="p">),</span>
</span><span id="validate_beam_settings-1980"><a href="#validate_beam_settings-1980"><span class="linenos">1980</span></a>                <span class="s2">&quot;tilt_correction&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="validate_beam_settings-1981"><a href="#validate_beam_settings-1981"><span class="linenos">1981</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="validate_beam_settings-1982"><a href="#validate_beam_settings-1982"><span class="linenos">1982</span></a>                    <span class="nb">bool</span><span class="p">,</span>
</span><span id="validate_beam_settings-1983"><a href="#validate_beam_settings-1983"><span class="linenos">1983</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; with &#39;electron&#39; beam imaging, &#39;tilt_correction&#39; must be a boolean value but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;tilt_correction&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;tilt_correction&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_beam_settings-1984"><a href="#validate_beam_settings-1984"><span class="linenos">1984</span></a>                <span class="p">),</span>
</span><span id="validate_beam_settings-1985"><a href="#validate_beam_settings-1985"><span class="linenos">1985</span></a>            <span class="p">},</span>
</span><span id="validate_beam_settings-1986"><a href="#validate_beam_settings-1986"><span class="linenos">1986</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_beam_settings-1987"><a href="#validate_beam_settings-1987"><span class="linenos">1987</span></a>        <span class="p">)</span>
</span><span id="validate_beam_settings-1988"><a href="#validate_beam_settings-1988"><span class="linenos">1988</span></a>        <span class="n">i_beam_schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_beam_settings-1989"><a href="#validate_beam_settings-1989"><span class="linenos">1989</span></a>            <span class="p">{</span>
</span><span id="validate_beam_settings-1990"><a href="#validate_beam_settings-1990"><span class="linenos">1990</span></a>                <span class="s2">&quot;dynamic_focus&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="validate_beam_settings-1991"><a href="#validate_beam_settings-1991"><span class="linenos">1991</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="validate_beam_settings-1992"><a href="#validate_beam_settings-1992"><span class="linenos">1992</span></a>                    <span class="kc">False</span><span class="p">,</span>
</span><span id="validate_beam_settings-1993"><a href="#validate_beam_settings-1993"><span class="linenos">1993</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; with &#39;ion&#39; beam imaging, &#39;dynamic_focus&#39; must be &#39;False&#39; or &#39;None&#39; but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dynamic_focus&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dynamic_focus&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_beam_settings-1994"><a href="#validate_beam_settings-1994"><span class="linenos">1994</span></a>                <span class="p">),</span>
</span><span id="validate_beam_settings-1995"><a href="#validate_beam_settings-1995"><span class="linenos">1995</span></a>                <span class="s2">&quot;tilt_correction&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="validate_beam_settings-1996"><a href="#validate_beam_settings-1996"><span class="linenos">1996</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="validate_beam_settings-1997"><a href="#validate_beam_settings-1997"><span class="linenos">1997</span></a>                    <span class="kc">False</span><span class="p">,</span>
</span><span id="validate_beam_settings-1998"><a href="#validate_beam_settings-1998"><span class="linenos">1998</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; with &#39;ion&#39; beam imaging, &#39;tilt_correction&#39; must be &#39;False&#39; or &#39;None&#39; but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;tilt_correction&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;tilt_correction&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_beam_settings-1999"><a href="#validate_beam_settings-1999"><span class="linenos">1999</span></a>                <span class="p">),</span>
</span><span id="validate_beam_settings-2000"><a href="#validate_beam_settings-2000"><span class="linenos">2000</span></a>            <span class="p">},</span>
</span><span id="validate_beam_settings-2001"><a href="#validate_beam_settings-2001"><span class="linenos">2001</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_beam_settings-2002"><a href="#validate_beam_settings-2002"><span class="linenos">2002</span></a>        <span class="p">)</span>
</span><span id="validate_beam_settings-2003"><a href="#validate_beam_settings-2003"><span class="linenos">2003</span></a>
</span><span id="validate_beam_settings-2004"><a href="#validate_beam_settings-2004"><span class="linenos">2004</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_beam_settings-2005"><a href="#validate_beam_settings-2005"><span class="linenos">2005</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_beam_settings-2006"><a href="#validate_beam_settings-2006"><span class="linenos">2006</span></a>        <span class="k">if</span> <span class="n">specified_beam</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">:</span>
</span><span id="validate_beam_settings-2007"><a href="#validate_beam_settings-2007"><span class="linenos">2007</span></a>            <span class="n">e_beam_schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_beam_settings-2008"><a href="#validate_beam_settings-2008"><span class="linenos">2008</span></a>        <span class="k">if</span> <span class="n">specified_beam</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">:</span>
</span><span id="validate_beam_settings-2009"><a href="#validate_beam_settings-2009"><span class="linenos">2009</span></a>            <span class="n">i_beam_schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_beam_settings-2010"><a href="#validate_beam_settings-2010"><span class="linenos">2010</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="validate_beam_settings-2011"><a href="#validate_beam_settings-2011"><span class="linenos">2011</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_beam_settings-2012"><a href="#validate_beam_settings-2012"><span class="linenos">2012</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="validate_beam_settings-2013"><a href="#validate_beam_settings-2013"><span class="linenos">2013</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for beam setting dictionary.</p>

<p>This function validates the beam settings dictionary based on the specified yml format and the beam limits of the microscope.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object for which to validate the beam settings.
beam_type : tbt.BeamType
    The type of the beam (electron or ion).
settings : dict
    The dictionary containing the beam settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
step_name : str
    The name of the step in the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the yml version is unsupported or if the settings do not satisfy the specified schema.</p>
</div>


                </section>
                <section id="validate_detector_settings">
                            <input id="validate_detector_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_detector_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span>,</span><span class="param">	<span class="n">beam_type</span><span class="p">:</span> <span class="n"><a href="types.html#BeamType">pytribeam.types.BeamType</a></span>,</span><span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_detector_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_detector_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_detector_settings-2016"><a href="#validate_detector_settings-2016"><span class="linenos">2016</span></a><span class="k">def</span> <span class="nf">validate_detector_settings</span><span class="p">(</span>
</span><span id="validate_detector_settings-2017"><a href="#validate_detector_settings-2017"><span class="linenos">2017</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="validate_detector_settings-2018"><a href="#validate_detector_settings-2018"><span class="linenos">2018</span></a>    <span class="n">beam_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">,</span>
</span><span id="validate_detector_settings-2019"><a href="#validate_detector_settings-2019"><span class="linenos">2019</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_detector_settings-2020"><a href="#validate_detector_settings-2020"><span class="linenos">2020</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_detector_settings-2021"><a href="#validate_detector_settings-2021"><span class="linenos">2021</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_detector_settings-2022"><a href="#validate_detector_settings-2022"><span class="linenos">2022</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_detector_settings-2023"><a href="#validate_detector_settings-2023"><span class="linenos">2023</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_detector_settings-2024"><a href="#validate_detector_settings-2024"><span class="linenos">2024</span></a><span class="sd">    Perform schema checking for detector setting dictionary.</span>
</span><span id="validate_detector_settings-2025"><a href="#validate_detector_settings-2025"><span class="linenos">2025</span></a>
</span><span id="validate_detector_settings-2026"><a href="#validate_detector_settings-2026"><span class="linenos">2026</span></a><span class="sd">    This function validates the detector settings dictionary based on the specified yml format and the detector capabilities of the microscope.</span>
</span><span id="validate_detector_settings-2027"><a href="#validate_detector_settings-2027"><span class="linenos">2027</span></a>
</span><span id="validate_detector_settings-2028"><a href="#validate_detector_settings-2028"><span class="linenos">2028</span></a><span class="sd">    Parameters</span>
</span><span id="validate_detector_settings-2029"><a href="#validate_detector_settings-2029"><span class="linenos">2029</span></a><span class="sd">    ----------</span>
</span><span id="validate_detector_settings-2030"><a href="#validate_detector_settings-2030"><span class="linenos">2030</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="validate_detector_settings-2031"><a href="#validate_detector_settings-2031"><span class="linenos">2031</span></a><span class="sd">        The microscope object for which to validate the detector settings.</span>
</span><span id="validate_detector_settings-2032"><a href="#validate_detector_settings-2032"><span class="linenos">2032</span></a><span class="sd">    beam_type : tbt.BeamType</span>
</span><span id="validate_detector_settings-2033"><a href="#validate_detector_settings-2033"><span class="linenos">2033</span></a><span class="sd">        The type of the beam (electron or ion).</span>
</span><span id="validate_detector_settings-2034"><a href="#validate_detector_settings-2034"><span class="linenos">2034</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_detector_settings-2035"><a href="#validate_detector_settings-2035"><span class="linenos">2035</span></a><span class="sd">        The dictionary containing the detector settings.</span>
</span><span id="validate_detector_settings-2036"><a href="#validate_detector_settings-2036"><span class="linenos">2036</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_detector_settings-2037"><a href="#validate_detector_settings-2037"><span class="linenos">2037</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_detector_settings-2038"><a href="#validate_detector_settings-2038"><span class="linenos">2038</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_detector_settings-2039"><a href="#validate_detector_settings-2039"><span class="linenos">2039</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_detector_settings-2040"><a href="#validate_detector_settings-2040"><span class="linenos">2040</span></a>
</span><span id="validate_detector_settings-2041"><a href="#validate_detector_settings-2041"><span class="linenos">2041</span></a><span class="sd">    Returns</span>
</span><span id="validate_detector_settings-2042"><a href="#validate_detector_settings-2042"><span class="linenos">2042</span></a><span class="sd">    -------</span>
</span><span id="validate_detector_settings-2043"><a href="#validate_detector_settings-2043"><span class="linenos">2043</span></a><span class="sd">    bool</span>
</span><span id="validate_detector_settings-2044"><a href="#validate_detector_settings-2044"><span class="linenos">2044</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_detector_settings-2045"><a href="#validate_detector_settings-2045"><span class="linenos">2045</span></a>
</span><span id="validate_detector_settings-2046"><a href="#validate_detector_settings-2046"><span class="linenos">2046</span></a><span class="sd">    Raises</span>
</span><span id="validate_detector_settings-2047"><a href="#validate_detector_settings-2047"><span class="linenos">2047</span></a><span class="sd">    ------</span>
</span><span id="validate_detector_settings-2048"><a href="#validate_detector_settings-2048"><span class="linenos">2048</span></a><span class="sd">    KeyError</span>
</span><span id="validate_detector_settings-2049"><a href="#validate_detector_settings-2049"><span class="linenos">2049</span></a><span class="sd">        If auto contrast/brightness settings conflict with fixed brightness/contrast values.</span>
</span><span id="validate_detector_settings-2050"><a href="#validate_detector_settings-2050"><span class="linenos">2050</span></a><span class="sd">    ValueError</span>
</span><span id="validate_detector_settings-2051"><a href="#validate_detector_settings-2051"><span class="linenos">2051</span></a><span class="sd">        If the yml version is unsupported, or if the settings do not satisfy the specified schema, or if the detector type or mode is unsupported.</span>
</span><span id="validate_detector_settings-2052"><a href="#validate_detector_settings-2052"><span class="linenos">2052</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_detector_settings-2053"><a href="#validate_detector_settings-2053"><span class="linenos">2053</span></a>
</span><span id="validate_detector_settings-2054"><a href="#validate_detector_settings-2054"><span class="linenos">2054</span></a>    <span class="c1"># switch to top left quad, enable e-beam</span>
</span><span id="validate_detector_settings-2055"><a href="#validate_detector_settings-2055"><span class="linenos">2055</span></a>    <span class="n">devices</span><span class="o">.</span><span class="n">device_access</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="validate_detector_settings-2056"><a href="#validate_detector_settings-2056"><span class="linenos">2056</span></a>
</span><span id="validate_detector_settings-2057"><a href="#validate_detector_settings-2057"><span class="linenos">2057</span></a>    <span class="c1"># set specified beam to active imaging device</span>
</span><span id="validate_detector_settings-2058"><a href="#validate_detector_settings-2058"><span class="linenos">2058</span></a>    <span class="n">specified_beam</span> <span class="o">=</span> <span class="n">beam_object_type</span><span class="p">(</span><span class="n">beam_type</span><span class="p">)(</span><span class="n">settings</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">())</span>
</span><span id="validate_detector_settings-2059"><a href="#validate_detector_settings-2059"><span class="linenos">2059</span></a>    <span class="n">img</span><span class="o">.</span><span class="n">set_beam_device</span><span class="p">(</span>
</span><span id="validate_detector_settings-2060"><a href="#validate_detector_settings-2060"><span class="linenos">2060</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="validate_detector_settings-2061"><a href="#validate_detector_settings-2061"><span class="linenos">2061</span></a>        <span class="n">device</span><span class="o">=</span><span class="n">specified_beam</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
</span><span id="validate_detector_settings-2062"><a href="#validate_detector_settings-2062"><span class="linenos">2062</span></a>    <span class="p">)</span>
</span><span id="validate_detector_settings-2063"><a href="#validate_detector_settings-2063"><span class="linenos">2063</span></a>
</span><span id="validate_detector_settings-2064"><a href="#validate_detector_settings-2064"><span class="linenos">2064</span></a>    <span class="n">auto_cb_db</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;auto_cb&quot;</span><span class="p">)</span>
</span><span id="validate_detector_settings-2065"><a href="#validate_detector_settings-2065"><span class="linenos">2065</span></a>    <span class="n">use_auto_cb</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">none_value_dictionary</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;auto_cb&quot;</span><span class="p">))</span>
</span><span id="validate_detector_settings-2066"><a href="#validate_detector_settings-2066"><span class="linenos">2066</span></a>    <span class="k">if</span> <span class="n">use_auto_cb</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="validate_detector_settings-2067"><a href="#validate_detector_settings-2067"><span class="linenos">2067</span></a>        <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;brightness&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contrast&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="validate_detector_settings-2068"><a href="#validate_detector_settings-2068"><span class="linenos">2068</span></a>    <span class="p">):</span>
</span><span id="validate_detector_settings-2069"><a href="#validate_detector_settings-2069"><span class="linenos">2069</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="validate_detector_settings-2070"><a href="#validate_detector_settings-2070"><span class="linenos">2070</span></a>            <span class="sa">f</span><span class="s2">&quot;Auto contrast/brightness settings of </span><span class="si">{</span><span class="n">auto_cb_db</span><span class="si">}</span><span class="s2"> provided while settings of fixed brightness of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brightness&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; and fixed contrast of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;contrast&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; were also provided. Users may use either fixed brightness/contrast values or auto contrast/brightness settings, but not both.&quot;</span>
</span><span id="validate_detector_settings-2071"><a href="#validate_detector_settings-2071"><span class="linenos">2071</span></a>        <span class="p">)</span>
</span><span id="validate_detector_settings-2072"><a href="#validate_detector_settings-2072"><span class="linenos">2072</span></a>
</span><span id="validate_detector_settings-2073"><a href="#validate_detector_settings-2073"><span class="linenos">2073</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_detector_settings-2074"><a href="#validate_detector_settings-2074"><span class="linenos">2074</span></a>        <span class="n">detector</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="validate_detector_settings-2075"><a href="#validate_detector_settings-2075"><span class="linenos">2075</span></a>        <span class="n">mode</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>
</span><span id="validate_detector_settings-2076"><a href="#validate_detector_settings-2076"><span class="linenos">2076</span></a>        <span class="n">cb_limit</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="validate_detector_settings-2077"><a href="#validate_detector_settings-2077"><span class="linenos">2077</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_detector_settings-2078"><a href="#validate_detector_settings-2078"><span class="linenos">2078</span></a>            <span class="p">{</span>
</span><span id="validate_detector_settings-2079"><a href="#validate_detector_settings-2079"><span class="linenos">2079</span></a>                <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="validate_detector_settings-2080"><a href="#validate_detector_settings-2080"><span class="linenos">2080</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="validate_detector_settings-2081"><a href="#validate_detector_settings-2081"><span class="linenos">2081</span></a>                    <span class="n">And</span><span class="p">(</span>
</span><span id="validate_detector_settings-2082"><a href="#validate_detector_settings-2082"><span class="linenos">2082</span></a>                        <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_detector_settings-2083"><a href="#validate_detector_settings-2083"><span class="linenos">2083</span></a>                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_detector_settings-2084"><a href="#validate_detector_settings-2084"><span class="linenos">2084</span></a>                            <span class="n">x</span><span class="p">,</span>
</span><span id="validate_detector_settings-2085"><a href="#validate_detector_settings-2085"><span class="linenos">2085</span></a>                            <span class="n">limit</span><span class="o">=</span><span class="n">cb_limit</span><span class="p">,</span>
</span><span id="validate_detector_settings-2086"><a href="#validate_detector_settings-2086"><span class="linenos">2086</span></a>                            <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">LEFT_OPEN</span><span class="p">,</span>
</span><span id="validate_detector_settings-2087"><a href="#validate_detector_settings-2087"><span class="linenos">2087</span></a>                        <span class="p">),</span>
</span><span id="validate_detector_settings-2088"><a href="#validate_detector_settings-2088"><span class="linenos">2088</span></a>                    <span class="p">),</span>
</span><span id="validate_detector_settings-2089"><a href="#validate_detector_settings-2089"><span class="linenos">2089</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested fixed brightness of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;brightness&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;. This is not within limits of &#39;&gt;</span><span class="si">{</span><span class="n">cb_limit</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&#39; and &#39;&lt;=</span><span class="si">{</span><span class="n">cb_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
</span><span id="validate_detector_settings-2090"><a href="#validate_detector_settings-2090"><span class="linenos">2090</span></a>                <span class="p">),</span>
</span><span id="validate_detector_settings-2091"><a href="#validate_detector_settings-2091"><span class="linenos">2091</span></a>                <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="validate_detector_settings-2092"><a href="#validate_detector_settings-2092"><span class="linenos">2092</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="validate_detector_settings-2093"><a href="#validate_detector_settings-2093"><span class="linenos">2093</span></a>                    <span class="n">And</span><span class="p">(</span>
</span><span id="validate_detector_settings-2094"><a href="#validate_detector_settings-2094"><span class="linenos">2094</span></a>                        <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_detector_settings-2095"><a href="#validate_detector_settings-2095"><span class="linenos">2095</span></a>                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_detector_settings-2096"><a href="#validate_detector_settings-2096"><span class="linenos">2096</span></a>                            <span class="n">x</span><span class="p">,</span>
</span><span id="validate_detector_settings-2097"><a href="#validate_detector_settings-2097"><span class="linenos">2097</span></a>                            <span class="n">limit</span><span class="o">=</span><span class="n">cb_limit</span><span class="p">,</span>
</span><span id="validate_detector_settings-2098"><a href="#validate_detector_settings-2098"><span class="linenos">2098</span></a>                            <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">LEFT_OPEN</span><span class="p">,</span>
</span><span id="validate_detector_settings-2099"><a href="#validate_detector_settings-2099"><span class="linenos">2099</span></a>                        <span class="p">),</span>
</span><span id="validate_detector_settings-2100"><a href="#validate_detector_settings-2100"><span class="linenos">2100</span></a>                    <span class="p">),</span>
</span><span id="validate_detector_settings-2101"><a href="#validate_detector_settings-2101"><span class="linenos">2101</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested fixed contrast of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;contrast&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;. This is either not within limits of &#39;&gt;</span><span class="si">{</span><span class="n">cb_limit</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&#39; and &#39;&lt;=</span><span class="si">{</span><span class="n">cb_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
</span><span id="validate_detector_settings-2102"><a href="#validate_detector_settings-2102"><span class="linenos">2102</span></a>                <span class="p">),</span>
</span><span id="validate_detector_settings-2103"><a href="#validate_detector_settings-2103"><span class="linenos">2103</span></a>            <span class="p">},</span>
</span><span id="validate_detector_settings-2104"><a href="#validate_detector_settings-2104"><span class="linenos">2104</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_detector_settings-2105"><a href="#validate_detector_settings-2105"><span class="linenos">2105</span></a>        <span class="p">)</span>
</span><span id="validate_detector_settings-2106"><a href="#validate_detector_settings-2106"><span class="linenos">2106</span></a>
</span><span id="validate_detector_settings-2107"><a href="#validate_detector_settings-2107"><span class="linenos">2107</span></a>    <span class="c1"># check detector type</span>
</span><span id="validate_detector_settings-2108"><a href="#validate_detector_settings-2108"><span class="linenos">2108</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">detector</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">DetectorType</span><span class="p">):</span>
</span><span id="validate_detector_settings-2109"><a href="#validate_detector_settings-2109"><span class="linenos">2109</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_detector_settings-2110"><a href="#validate_detector_settings-2110"><span class="linenos">2110</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported detector type of &#39;</span><span class="si">{</span><span class="n">detector</span><span class="si">}</span><span class="s2">&#39; on step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="validate_detector_settings-2111"><a href="#validate_detector_settings-2111"><span class="linenos">2111</span></a>        <span class="p">)</span>
</span><span id="validate_detector_settings-2112"><a href="#validate_detector_settings-2112"><span class="linenos">2112</span></a>    <span class="n">detector_type</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">DetectorType</span><span class="p">(</span><span class="n">detector</span><span class="p">)</span>
</span><span id="validate_detector_settings-2113"><a href="#validate_detector_settings-2113"><span class="linenos">2113</span></a>    <span class="n">microscope_detector_types</span> <span class="o">=</span> <span class="n">available_detector_types</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="validate_detector_settings-2114"><a href="#validate_detector_settings-2114"><span class="linenos">2114</span></a>    <span class="k">if</span> <span class="n">detector_type</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">microscope_detector_types</span><span class="p">:</span>
</span><span id="validate_detector_settings-2115"><a href="#validate_detector_settings-2115"><span class="linenos">2115</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_detector_settings-2116"><a href="#validate_detector_settings-2116"><span class="linenos">2116</span></a>            <span class="sa">f</span><span class="s2">&quot;Requested detector of </span><span class="si">{</span><span class="n">detector_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> is unavailable on this tool. Available detectors are: </span><span class="si">{</span><span class="n">microscope_detector_types</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="validate_detector_settings-2117"><a href="#validate_detector_settings-2117"><span class="linenos">2117</span></a>        <span class="p">)</span>
</span><span id="validate_detector_settings-2118"><a href="#validate_detector_settings-2118"><span class="linenos">2118</span></a>    <span class="c1"># make sure to set this detector as the active one to access modes</span>
</span><span id="validate_detector_settings-2119"><a href="#validate_detector_settings-2119"><span class="linenos">2119</span></a>    <span class="n">img</span><span class="o">.</span><span class="n">detector_type</span><span class="p">(</span>
</span><span id="validate_detector_settings-2120"><a href="#validate_detector_settings-2120"><span class="linenos">2120</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="validate_detector_settings-2121"><a href="#validate_detector_settings-2121"><span class="linenos">2121</span></a>        <span class="n">detector</span><span class="o">=</span><span class="n">detector_type</span><span class="p">,</span>
</span><span id="validate_detector_settings-2122"><a href="#validate_detector_settings-2122"><span class="linenos">2122</span></a>    <span class="p">)</span>
</span><span id="validate_detector_settings-2123"><a href="#validate_detector_settings-2123"><span class="linenos">2123</span></a>
</span><span id="validate_detector_settings-2124"><a href="#validate_detector_settings-2124"><span class="linenos">2124</span></a>    <span class="c1"># check detector mode</span>
</span><span id="validate_detector_settings-2125"><a href="#validate_detector_settings-2125"><span class="linenos">2125</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">DetectorMode</span><span class="p">):</span>
</span><span id="validate_detector_settings-2126"><a href="#validate_detector_settings-2126"><span class="linenos">2126</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_detector_settings-2127"><a href="#validate_detector_settings-2127"><span class="linenos">2127</span></a>            <span class="sa">f</span><span class="s1">&#39;Unsupported detector mode of &quot;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">&quot; for &quot;</span><span class="si">{</span><span class="n">detector</span><span class="si">}</span><span class="s1">&quot; detector&#39;</span>
</span><span id="validate_detector_settings-2128"><a href="#validate_detector_settings-2128"><span class="linenos">2128</span></a>        <span class="p">)</span>
</span><span id="validate_detector_settings-2129"><a href="#validate_detector_settings-2129"><span class="linenos">2129</span></a>    <span class="n">detector_mode</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">DetectorMode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="validate_detector_settings-2130"><a href="#validate_detector_settings-2130"><span class="linenos">2130</span></a>    <span class="n">microscope_detector_modes</span> <span class="o">=</span> <span class="n">available_detector_modes</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="validate_detector_settings-2131"><a href="#validate_detector_settings-2131"><span class="linenos">2131</span></a>    <span class="k">if</span> <span class="n">detector_mode</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">microscope_detector_modes</span><span class="p">:</span>
</span><span id="validate_detector_settings-2132"><a href="#validate_detector_settings-2132"><span class="linenos">2132</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_detector_settings-2133"><a href="#validate_detector_settings-2133"><span class="linenos">2133</span></a>            <span class="sa">f</span><span class="s2">&quot;Requested mode of </span><span class="si">{</span><span class="n">detector_mode</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">detector_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> detector is invalid. Valid mode types are: </span><span class="si">{</span><span class="n">microscope_detector_modes</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="validate_detector_settings-2134"><a href="#validate_detector_settings-2134"><span class="linenos">2134</span></a>        <span class="p">)</span>
</span><span id="validate_detector_settings-2135"><a href="#validate_detector_settings-2135"><span class="linenos">2135</span></a>
</span><span id="validate_detector_settings-2136"><a href="#validate_detector_settings-2136"><span class="linenos">2136</span></a>    <span class="c1"># check detector settings</span>
</span><span id="validate_detector_settings-2137"><a href="#validate_detector_settings-2137"><span class="linenos">2137</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_detector_settings-2138"><a href="#validate_detector_settings-2138"><span class="linenos">2138</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_detector_settings-2139"><a href="#validate_detector_settings-2139"><span class="linenos">2139</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="validate_detector_settings-2140"><a href="#validate_detector_settings-2140"><span class="linenos">2140</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_detector_settings-2141"><a href="#validate_detector_settings-2141"><span class="linenos">2141</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="validate_detector_settings-2142"><a href="#validate_detector_settings-2142"><span class="linenos">2142</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for detector setting dictionary.</p>

<p>This function validates the detector settings dictionary based on the specified yml format and the detector capabilities of the microscope.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object for which to validate the detector settings.
beam_type : tbt.BeamType
    The type of the beam (electron or ion).
settings : dict
    The dictionary containing the detector settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
step_name : str
    The name of the step in the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>KeyError
    If auto contrast/brightness settings conflict with fixed brightness/contrast values.
ValueError
    If the yml version is unsupported, or if the settings do not satisfy the specified schema, or if the detector type or mode is unsupported.</p>
</div>


                </section>
                <section id="validate_EBSD_EDS_settings">
                            <input id="validate_EBSD_EDS_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_EBSD_EDS_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">connection_host</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">connection_port</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">ebsd_oem</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">eds_oem</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_EBSD_EDS_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_EBSD_EDS_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_EBSD_EDS_settings-2145"><a href="#validate_EBSD_EDS_settings-2145"><span class="linenos">2145</span></a><span class="k">def</span> <span class="nf">validate_EBSD_EDS_settings</span><span class="p">(</span>
</span><span id="validate_EBSD_EDS_settings-2146"><a href="#validate_EBSD_EDS_settings-2146"><span class="linenos">2146</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_EBSD_EDS_settings-2147"><a href="#validate_EBSD_EDS_settings-2147"><span class="linenos">2147</span></a>    <span class="n">connection_host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_EBSD_EDS_settings-2148"><a href="#validate_EBSD_EDS_settings-2148"><span class="linenos">2148</span></a>    <span class="n">connection_port</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_EBSD_EDS_settings-2149"><a href="#validate_EBSD_EDS_settings-2149"><span class="linenos">2149</span></a>    <span class="n">ebsd_oem</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_EBSD_EDS_settings-2150"><a href="#validate_EBSD_EDS_settings-2150"><span class="linenos">2150</span></a>    <span class="n">eds_oem</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_EBSD_EDS_settings-2151"><a href="#validate_EBSD_EDS_settings-2151"><span class="linenos">2151</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_EBSD_EDS_settings-2152"><a href="#validate_EBSD_EDS_settings-2152"><span class="linenos">2152</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_EBSD_EDS_settings-2153"><a href="#validate_EBSD_EDS_settings-2153"><span class="linenos">2153</span></a><span class="sd">    Check EBSD and EDS OEM and connection for supported OEMs.</span>
</span><span id="validate_EBSD_EDS_settings-2154"><a href="#validate_EBSD_EDS_settings-2154"><span class="linenos">2154</span></a>
</span><span id="validate_EBSD_EDS_settings-2155"><a href="#validate_EBSD_EDS_settings-2155"><span class="linenos">2155</span></a><span class="sd">    This function ensures that the specified EBSD and EDS OEMs are supported and that the connection settings are valid.</span>
</span><span id="validate_EBSD_EDS_settings-2156"><a href="#validate_EBSD_EDS_settings-2156"><span class="linenos">2156</span></a>
</span><span id="validate_EBSD_EDS_settings-2157"><a href="#validate_EBSD_EDS_settings-2157"><span class="linenos">2157</span></a><span class="sd">    Parameters</span>
</span><span id="validate_EBSD_EDS_settings-2158"><a href="#validate_EBSD_EDS_settings-2158"><span class="linenos">2158</span></a><span class="sd">    ----------</span>
</span><span id="validate_EBSD_EDS_settings-2159"><a href="#validate_EBSD_EDS_settings-2159"><span class="linenos">2159</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_EBSD_EDS_settings-2160"><a href="#validate_EBSD_EDS_settings-2160"><span class="linenos">2160</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_EBSD_EDS_settings-2161"><a href="#validate_EBSD_EDS_settings-2161"><span class="linenos">2161</span></a><span class="sd">    connection_host : str</span>
</span><span id="validate_EBSD_EDS_settings-2162"><a href="#validate_EBSD_EDS_settings-2162"><span class="linenos">2162</span></a><span class="sd">        The host for the microscope connection.</span>
</span><span id="validate_EBSD_EDS_settings-2163"><a href="#validate_EBSD_EDS_settings-2163"><span class="linenos">2163</span></a><span class="sd">    connection_port : str</span>
</span><span id="validate_EBSD_EDS_settings-2164"><a href="#validate_EBSD_EDS_settings-2164"><span class="linenos">2164</span></a><span class="sd">        The port for the microscope connection.</span>
</span><span id="validate_EBSD_EDS_settings-2165"><a href="#validate_EBSD_EDS_settings-2165"><span class="linenos">2165</span></a><span class="sd">    ebsd_oem : str</span>
</span><span id="validate_EBSD_EDS_settings-2166"><a href="#validate_EBSD_EDS_settings-2166"><span class="linenos">2166</span></a><span class="sd">        The OEM for the EBSD device.</span>
</span><span id="validate_EBSD_EDS_settings-2167"><a href="#validate_EBSD_EDS_settings-2167"><span class="linenos">2167</span></a><span class="sd">    eds_oem : str</span>
</span><span id="validate_EBSD_EDS_settings-2168"><a href="#validate_EBSD_EDS_settings-2168"><span class="linenos">2168</span></a><span class="sd">        The OEM for the EDS device.</span>
</span><span id="validate_EBSD_EDS_settings-2169"><a href="#validate_EBSD_EDS_settings-2169"><span class="linenos">2169</span></a>
</span><span id="validate_EBSD_EDS_settings-2170"><a href="#validate_EBSD_EDS_settings-2170"><span class="linenos">2170</span></a><span class="sd">    Returns</span>
</span><span id="validate_EBSD_EDS_settings-2171"><a href="#validate_EBSD_EDS_settings-2171"><span class="linenos">2171</span></a><span class="sd">    -------</span>
</span><span id="validate_EBSD_EDS_settings-2172"><a href="#validate_EBSD_EDS_settings-2172"><span class="linenos">2172</span></a><span class="sd">    bool</span>
</span><span id="validate_EBSD_EDS_settings-2173"><a href="#validate_EBSD_EDS_settings-2173"><span class="linenos">2173</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_EBSD_EDS_settings-2174"><a href="#validate_EBSD_EDS_settings-2174"><span class="linenos">2174</span></a>
</span><span id="validate_EBSD_EDS_settings-2175"><a href="#validate_EBSD_EDS_settings-2175"><span class="linenos">2175</span></a><span class="sd">    Raises</span>
</span><span id="validate_EBSD_EDS_settings-2176"><a href="#validate_EBSD_EDS_settings-2176"><span class="linenos">2176</span></a><span class="sd">    ------</span>
</span><span id="validate_EBSD_EDS_settings-2177"><a href="#validate_EBSD_EDS_settings-2177"><span class="linenos">2177</span></a><span class="sd">    NotImplementedError</span>
</span><span id="validate_EBSD_EDS_settings-2178"><a href="#validate_EBSD_EDS_settings-2178"><span class="linenos">2178</span></a><span class="sd">        If differing EBSD and EDS OEMs are requested.</span>
</span><span id="validate_EBSD_EDS_settings-2179"><a href="#validate_EBSD_EDS_settings-2179"><span class="linenos">2179</span></a><span class="sd">    ValueError</span>
</span><span id="validate_EBSD_EDS_settings-2180"><a href="#validate_EBSD_EDS_settings-2180"><span class="linenos">2180</span></a><span class="sd">        If the EBSD or EDS OEM is unsupported.</span>
</span><span id="validate_EBSD_EDS_settings-2181"><a href="#validate_EBSD_EDS_settings-2181"><span class="linenos">2181</span></a><span class="sd">    SystemError</span>
</span><span id="validate_EBSD_EDS_settings-2182"><a href="#validate_EBSD_EDS_settings-2182"><span class="linenos">2182</span></a><span class="sd">        If the Laser API is not accessible.</span>
</span><span id="validate_EBSD_EDS_settings-2183"><a href="#validate_EBSD_EDS_settings-2183"><span class="linenos">2183</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_EBSD_EDS_settings-2184"><a href="#validate_EBSD_EDS_settings-2184"><span class="linenos">2184</span></a>    <span class="c1"># ensure same manufacturer for both EBSD and EDS</span>
</span><span id="validate_EBSD_EDS_settings-2185"><a href="#validate_EBSD_EDS_settings-2185"><span class="linenos">2185</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ebsd_oem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">eds_oem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ebsd_oem</span> <span class="o">!=</span> <span class="n">eds_oem</span><span class="p">):</span>
</span><span id="validate_EBSD_EDS_settings-2186"><a href="#validate_EBSD_EDS_settings-2186"><span class="linenos">2186</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="validate_EBSD_EDS_settings-2187"><a href="#validate_EBSD_EDS_settings-2187"><span class="linenos">2187</span></a>            <span class="sa">f</span><span class="s2">&quot;Differing EBSD and EDS OEMs are not supported. Requested EBSD OEM of &#39;</span><span class="si">{</span><span class="n">ebsd_oem</span><span class="si">}</span><span class="s2">&#39; and EDS OEM of &#39;</span><span class="si">{</span><span class="n">eds_oem</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="validate_EBSD_EDS_settings-2188"><a href="#validate_EBSD_EDS_settings-2188"><span class="linenos">2188</span></a>        <span class="p">)</span>
</span><span id="validate_EBSD_EDS_settings-2189"><a href="#validate_EBSD_EDS_settings-2189"><span class="linenos">2189</span></a>
</span><span id="validate_EBSD_EDS_settings-2190"><a href="#validate_EBSD_EDS_settings-2190"><span class="linenos">2190</span></a>    <span class="c1"># Check EBSD OEM</span>
</span><span id="validate_EBSD_EDS_settings-2191"><a href="#validate_EBSD_EDS_settings-2191"><span class="linenos">2191</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">ebsd_oem</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">):</span>
</span><span id="validate_EBSD_EDS_settings-2192"><a href="#validate_EBSD_EDS_settings-2192"><span class="linenos">2192</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_EBSD_EDS_settings-2193"><a href="#validate_EBSD_EDS_settings-2193"><span class="linenos">2193</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported EBSD OEM of &#39;</span><span class="si">{</span><span class="n">ebsd_oem</span><span class="si">}</span><span class="s2">&#39;. Supported OEM types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="validate_EBSD_EDS_settings-2194"><a href="#validate_EBSD_EDS_settings-2194"><span class="linenos">2194</span></a>        <span class="p">)</span>
</span><span id="validate_EBSD_EDS_settings-2195"><a href="#validate_EBSD_EDS_settings-2195"><span class="linenos">2195</span></a>    <span class="n">ebsd_device</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">(</span><span class="n">ebsd_oem</span><span class="p">)</span>
</span><span id="validate_EBSD_EDS_settings-2196"><a href="#validate_EBSD_EDS_settings-2196"><span class="linenos">2196</span></a>    <span class="c1"># Check EDS OEM</span>
</span><span id="validate_EBSD_EDS_settings-2197"><a href="#validate_EBSD_EDS_settings-2197"><span class="linenos">2197</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">eds_oem</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">):</span>
</span><span id="validate_EBSD_EDS_settings-2198"><a href="#validate_EBSD_EDS_settings-2198"><span class="linenos">2198</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_EBSD_EDS_settings-2199"><a href="#validate_EBSD_EDS_settings-2199"><span class="linenos">2199</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported EDS OEM of &#39;</span><span class="si">{</span><span class="n">eds_oem</span><span class="si">}</span><span class="s2">&#39;. Supported OEM types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="validate_EBSD_EDS_settings-2200"><a href="#validate_EBSD_EDS_settings-2200"><span class="linenos">2200</span></a>        <span class="p">)</span>
</span><span id="validate_EBSD_EDS_settings-2201"><a href="#validate_EBSD_EDS_settings-2201"><span class="linenos">2201</span></a>    <span class="n">eds_device</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">(</span><span class="n">eds_oem</span><span class="p">)</span>
</span><span id="validate_EBSD_EDS_settings-2202"><a href="#validate_EBSD_EDS_settings-2202"><span class="linenos">2202</span></a>
</span><span id="validate_EBSD_EDS_settings-2203"><a href="#validate_EBSD_EDS_settings-2203"><span class="linenos">2203</span></a>    <span class="c1"># exit if both devices are none, no need for laser control</span>
</span><span id="validate_EBSD_EDS_settings-2204"><a href="#validate_EBSD_EDS_settings-2204"><span class="linenos">2204</span></a>    <span class="k">if</span> <span class="n">ebsd_device</span> <span class="o">==</span> <span class="n">eds_device</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
</span><span id="validate_EBSD_EDS_settings-2205"><a href="#validate_EBSD_EDS_settings-2205"><span class="linenos">2205</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="validate_EBSD_EDS_settings-2206"><a href="#validate_EBSD_EDS_settings-2206"><span class="linenos">2206</span></a>
</span><span id="validate_EBSD_EDS_settings-2207"><a href="#validate_EBSD_EDS_settings-2207"><span class="linenos">2207</span></a>    <span class="c1"># check EBSD and EDS connection</span>
</span><span id="validate_EBSD_EDS_settings-2208"><a href="#validate_EBSD_EDS_settings-2208"><span class="linenos">2208</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_EBSD_EDS_settings-2209"><a href="#validate_EBSD_EDS_settings-2209"><span class="linenos">2209</span></a>        <span class="n">fs_laser</span><span class="o">.</span><span class="n">tfs_laser</span>
</span><span id="validate_EBSD_EDS_settings-2210"><a href="#validate_EBSD_EDS_settings-2210"><span class="linenos">2210</span></a>    <span class="k">except</span><span class="p">:</span>
</span><span id="validate_EBSD_EDS_settings-2211"><a href="#validate_EBSD_EDS_settings-2211"><span class="linenos">2211</span></a>        <span class="k">raise</span> <span class="ne">SystemError</span><span class="p">(</span>
</span><span id="validate_EBSD_EDS_settings-2212"><a href="#validate_EBSD_EDS_settings-2212"><span class="linenos">2212</span></a>            <span class="s2">&quot;EBSD and/or EDS control requested, but Laser API not accessible, so cannot use EBSD and EDS control. Please restart Laser API, or if not installed, change OEM to &#39;null&#39;, or leave blank in settings file.&quot;</span>
</span><span id="validate_EBSD_EDS_settings-2213"><a href="#validate_EBSD_EDS_settings-2213"><span class="linenos">2213</span></a>        <span class="p">)</span>
</span><span id="validate_EBSD_EDS_settings-2214"><a href="#validate_EBSD_EDS_settings-2214"><span class="linenos">2214</span></a>    <span class="n">microscope</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">()</span>
</span><span id="validate_EBSD_EDS_settings-2215"><a href="#validate_EBSD_EDS_settings-2215"><span class="linenos">2215</span></a>    <span class="n">ut</span><span class="o">.</span><span class="n">connect_microscope</span><span class="p">(</span>
</span><span id="validate_EBSD_EDS_settings-2216"><a href="#validate_EBSD_EDS_settings-2216"><span class="linenos">2216</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="validate_EBSD_EDS_settings-2217"><a href="#validate_EBSD_EDS_settings-2217"><span class="linenos">2217</span></a>        <span class="n">quiet_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_EBSD_EDS_settings-2218"><a href="#validate_EBSD_EDS_settings-2218"><span class="linenos">2218</span></a>        <span class="n">connection_host</span><span class="o">=</span><span class="n">connection_host</span><span class="p">,</span>
</span><span id="validate_EBSD_EDS_settings-2219"><a href="#validate_EBSD_EDS_settings-2219"><span class="linenos">2219</span></a>        <span class="n">connection_port</span><span class="o">=</span><span class="n">connection_port</span><span class="p">,</span>
</span><span id="validate_EBSD_EDS_settings-2220"><a href="#validate_EBSD_EDS_settings-2220"><span class="linenos">2220</span></a>    <span class="p">)</span>
</span><span id="validate_EBSD_EDS_settings-2221"><a href="#validate_EBSD_EDS_settings-2221"><span class="linenos">2221</span></a>    <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">(</span><span class="n">eds_oem</span><span class="p">)</span> <span class="o">!=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
</span><span id="validate_EBSD_EDS_settings-2222"><a href="#validate_EBSD_EDS_settings-2222"><span class="linenos">2222</span></a>        <span class="n">devices</span><span class="o">.</span><span class="n">retract_EDS</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="validate_EBSD_EDS_settings-2223"><a href="#validate_EBSD_EDS_settings-2223"><span class="linenos">2223</span></a>    <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="p">(</span><span class="n">ebsd_oem</span><span class="p">)</span> <span class="o">!=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">ExternalDeviceOEM</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
</span><span id="validate_EBSD_EDS_settings-2224"><a href="#validate_EBSD_EDS_settings-2224"><span class="linenos">2224</span></a>        <span class="n">devices</span><span class="o">.</span><span class="n">retract_EBSD</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="validate_EBSD_EDS_settings-2225"><a href="#validate_EBSD_EDS_settings-2225"><span class="linenos">2225</span></a>    <span class="n">ut</span><span class="o">.</span><span class="n">disconnect_microscope</span><span class="p">(</span>
</span><span id="validate_EBSD_EDS_settings-2226"><a href="#validate_EBSD_EDS_settings-2226"><span class="linenos">2226</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="validate_EBSD_EDS_settings-2227"><a href="#validate_EBSD_EDS_settings-2227"><span class="linenos">2227</span></a>        <span class="n">quiet_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_EBSD_EDS_settings-2228"><a href="#validate_EBSD_EDS_settings-2228"><span class="linenos">2228</span></a>    <span class="p">)</span>
</span><span id="validate_EBSD_EDS_settings-2229"><a href="#validate_EBSD_EDS_settings-2229"><span class="linenos">2229</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Check EBSD and EDS OEM and connection for supported OEMs.</p>

<p>This function ensures that the specified EBSD and EDS OEMs are supported and that the connection settings are valid.</p>

<h2 id="parameters">Parameters</h2>

<p>yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
connection_host : str
    The host for the microscope connection.
connection_port : str
    The port for the microscope connection.
ebsd_oem : str
    The OEM for the EBSD device.
eds_oem : str
    The OEM for the EDS device.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>NotImplementedError
    If differing EBSD and EDS OEMs are requested.
ValueError
    If the EBSD or EDS OEM is unsupported.
SystemError
    If the Laser API is not accessible.</p>
</div>


                </section>
                <section id="validate_general_settings">
                            <input id="validate_general_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_general_settings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>, </span><span class="param"><span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_general_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_general_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_general_settings-2232"><a href="#validate_general_settings-2232"><span class="linenos">2232</span></a><span class="k">def</span> <span class="nf">validate_general_settings</span><span class="p">(</span>
</span><span id="validate_general_settings-2233"><a href="#validate_general_settings-2233"><span class="linenos">2233</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_general_settings-2234"><a href="#validate_general_settings-2234"><span class="linenos">2234</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_general_settings-2235"><a href="#validate_general_settings-2235"><span class="linenos">2235</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_general_settings-2236"><a href="#validate_general_settings-2236"><span class="linenos">2236</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_general_settings-2237"><a href="#validate_general_settings-2237"><span class="linenos">2237</span></a><span class="sd">    Perform schema checking for general setting dictionary.</span>
</span><span id="validate_general_settings-2238"><a href="#validate_general_settings-2238"><span class="linenos">2238</span></a>
</span><span id="validate_general_settings-2239"><a href="#validate_general_settings-2239"><span class="linenos">2239</span></a><span class="sd">    This function validates the general settings dictionary based on the specified yml format. It checks the microscope connection and EBSD/EDS connection if valid OEMs are specified.</span>
</span><span id="validate_general_settings-2240"><a href="#validate_general_settings-2240"><span class="linenos">2240</span></a>
</span><span id="validate_general_settings-2241"><a href="#validate_general_settings-2241"><span class="linenos">2241</span></a><span class="sd">    Parameters</span>
</span><span id="validate_general_settings-2242"><a href="#validate_general_settings-2242"><span class="linenos">2242</span></a><span class="sd">    ----------</span>
</span><span id="validate_general_settings-2243"><a href="#validate_general_settings-2243"><span class="linenos">2243</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_general_settings-2244"><a href="#validate_general_settings-2244"><span class="linenos">2244</span></a><span class="sd">        The dictionary containing the general settings.</span>
</span><span id="validate_general_settings-2245"><a href="#validate_general_settings-2245"><span class="linenos">2245</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_general_settings-2246"><a href="#validate_general_settings-2246"><span class="linenos">2246</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_general_settings-2247"><a href="#validate_general_settings-2247"><span class="linenos">2247</span></a>
</span><span id="validate_general_settings-2248"><a href="#validate_general_settings-2248"><span class="linenos">2248</span></a><span class="sd">    Returns</span>
</span><span id="validate_general_settings-2249"><a href="#validate_general_settings-2249"><span class="linenos">2249</span></a><span class="sd">    -------</span>
</span><span id="validate_general_settings-2250"><a href="#validate_general_settings-2250"><span class="linenos">2250</span></a><span class="sd">    bool</span>
</span><span id="validate_general_settings-2251"><a href="#validate_general_settings-2251"><span class="linenos">2251</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_general_settings-2252"><a href="#validate_general_settings-2252"><span class="linenos">2252</span></a>
</span><span id="validate_general_settings-2253"><a href="#validate_general_settings-2253"><span class="linenos">2253</span></a><span class="sd">    Raises</span>
</span><span id="validate_general_settings-2254"><a href="#validate_general_settings-2254"><span class="linenos">2254</span></a><span class="sd">    ------</span>
</span><span id="validate_general_settings-2255"><a href="#validate_general_settings-2255"><span class="linenos">2255</span></a><span class="sd">    ValueError</span>
</span><span id="validate_general_settings-2256"><a href="#validate_general_settings-2256"><span class="linenos">2256</span></a><span class="sd">        If the general settings dictionary is empty, or if the settings do not satisfy the specified schema, or if the connection is invalid.</span>
</span><span id="validate_general_settings-2257"><a href="#validate_general_settings-2257"><span class="linenos">2257</span></a><span class="sd">    NotImplementedError</span>
</span><span id="validate_general_settings-2258"><a href="#validate_general_settings-2258"><span class="linenos">2258</span></a><span class="sd">        If the sectioning axis is unsupported.</span>
</span><span id="validate_general_settings-2259"><a href="#validate_general_settings-2259"><span class="linenos">2259</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_general_settings-2260"><a href="#validate_general_settings-2260"><span class="linenos">2260</span></a>
</span><span id="validate_general_settings-2261"><a href="#validate_general_settings-2261"><span class="linenos">2261</span></a>    <span class="k">if</span> <span class="n">settings</span> <span class="o">==</span> <span class="p">{}:</span>
</span><span id="validate_general_settings-2262"><a href="#validate_general_settings-2262"><span class="linenos">2262</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;General settings dictionary is empty.&quot;</span><span class="p">)</span>
</span><span id="validate_general_settings-2263"><a href="#validate_general_settings-2263"><span class="linenos">2263</span></a>
</span><span id="validate_general_settings-2264"><a href="#validate_general_settings-2264"><span class="linenos">2264</span></a>    <span class="n">slice_thickness_limit_um</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">slice_thickness_limit_um</span>
</span><span id="validate_general_settings-2265"><a href="#validate_general_settings-2265"><span class="linenos">2265</span></a>    <span class="n">pre_tilt_limit_deg</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">pre_tilt_limit_deg_generic</span>
</span><span id="validate_general_settings-2266"><a href="#validate_general_settings-2266"><span class="linenos">2266</span></a>
</span><span id="validate_general_settings-2267"><a href="#validate_general_settings-2267"><span class="linenos">2267</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_general_settings-2268"><a href="#validate_general_settings-2268"><span class="linenos">2268</span></a>        <span class="n">sectioning_axis</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sectioning_axis&quot;</span><span class="p">)</span>
</span><span id="validate_general_settings-2269"><a href="#validate_general_settings-2269"><span class="linenos">2269</span></a>        <span class="n">connection_host</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;connection_host&quot;</span><span class="p">)</span>
</span><span id="validate_general_settings-2270"><a href="#validate_general_settings-2270"><span class="linenos">2270</span></a>        <span class="n">connection_port</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;connection_port&quot;</span><span class="p">)</span>
</span><span id="validate_general_settings-2271"><a href="#validate_general_settings-2271"><span class="linenos">2271</span></a>        <span class="n">ebsd_oem</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;EBSD_OEM&quot;</span><span class="p">)</span>
</span><span id="validate_general_settings-2272"><a href="#validate_general_settings-2272"><span class="linenos">2272</span></a>        <span class="n">eds_oem</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;EDS_OEM&quot;</span><span class="p">)</span>
</span><span id="validate_general_settings-2273"><a href="#validate_general_settings-2273"><span class="linenos">2273</span></a>        <span class="n">exp_dir</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exp_dir&quot;</span><span class="p">)</span>
</span><span id="validate_general_settings-2274"><a href="#validate_general_settings-2274"><span class="linenos">2274</span></a>        <span class="n">h5_log_name</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;h5_log_name&quot;</span><span class="p">)</span>
</span><span id="validate_general_settings-2275"><a href="#validate_general_settings-2275"><span class="linenos">2275</span></a>
</span><span id="validate_general_settings-2276"><a href="#validate_general_settings-2276"><span class="linenos">2276</span></a>    <span class="c1"># Validate the non-numeric values</span>
</span><span id="validate_general_settings-2277"><a href="#validate_general_settings-2277"><span class="linenos">2277</span></a>    <span class="c1"># Check sectioning axis</span>
</span><span id="validate_general_settings-2278"><a href="#validate_general_settings-2278"><span class="linenos">2278</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">sectioning_axis</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">SectioningAxis</span><span class="p">):</span>
</span><span id="validate_general_settings-2279"><a href="#validate_general_settings-2279"><span class="linenos">2279</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported sectioning axis of </span><span class="si">{</span><span class="n">sectioning_axis</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="validate_general_settings-2280"><a href="#validate_general_settings-2280"><span class="linenos">2280</span></a>    <span class="c1"># TODO</span>
</span><span id="validate_general_settings-2281"><a href="#validate_general_settings-2281"><span class="linenos">2281</span></a>    <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">SectioningAxis</span><span class="p">(</span><span class="n">sectioning_axis</span><span class="p">)</span> <span class="o">!=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">SectioningAxis</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
</span><span id="validate_general_settings-2282"><a href="#validate_general_settings-2282"><span class="linenos">2282</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Currently only Z-axis sectioning is supported.&quot;</span><span class="p">)</span>
</span><span id="validate_general_settings-2283"><a href="#validate_general_settings-2283"><span class="linenos">2283</span></a>    <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">SectioningAxis</span><span class="p">(</span><span class="n">sectioning_axis</span><span class="p">)</span> <span class="o">!=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">SectioningAxis</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
</span><span id="validate_general_settings-2284"><a href="#validate_general_settings-2284"><span class="linenos">2284</span></a>        <span class="n">pre_tilt_limit_deg</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="n">pre_tilt_limit_deg_non_Z_sectioning</span>  <span class="c1"># overwrite</span>
</span><span id="validate_general_settings-2285"><a href="#validate_general_settings-2285"><span class="linenos">2285</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="validate_general_settings-2286"><a href="#validate_general_settings-2286"><span class="linenos">2286</span></a>            <span class="s2">&quot;Pre-tilt value must be zero (0.0) degrees when using a sectioning axis other than &#39;Z&#39;&quot;</span>
</span><span id="validate_general_settings-2287"><a href="#validate_general_settings-2287"><span class="linenos">2287</span></a>        <span class="p">)</span>
</span><span id="validate_general_settings-2288"><a href="#validate_general_settings-2288"><span class="linenos">2288</span></a>    <span class="c1"># Check connection host and port</span>
</span><span id="validate_general_settings-2289"><a href="#validate_general_settings-2289"><span class="linenos">2289</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_microscope_connection</span><span class="p">(</span>
</span><span id="validate_general_settings-2290"><a href="#validate_general_settings-2290"><span class="linenos">2290</span></a>        <span class="n">host</span><span class="o">=</span><span class="n">connection_host</span><span class="p">,</span>
</span><span id="validate_general_settings-2291"><a href="#validate_general_settings-2291"><span class="linenos">2291</span></a>        <span class="n">port</span><span class="o">=</span><span class="n">connection_port</span><span class="p">,</span>
</span><span id="validate_general_settings-2292"><a href="#validate_general_settings-2292"><span class="linenos">2292</span></a>    <span class="p">):</span>
</span><span id="validate_general_settings-2293"><a href="#validate_general_settings-2293"><span class="linenos">2293</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_general_settings-2294"><a href="#validate_general_settings-2294"><span class="linenos">2294</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported connection with host of </span><span class="si">{</span><span class="n">connection_host</span><span class="si">}</span><span class="s2"> and port of </span><span class="si">{</span><span class="n">connection_port</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="validate_general_settings-2295"><a href="#validate_general_settings-2295"><span class="linenos">2295</span></a>        <span class="p">)</span>
</span><span id="validate_general_settings-2296"><a href="#validate_general_settings-2296"><span class="linenos">2296</span></a>
</span><span id="validate_general_settings-2297"><a href="#validate_general_settings-2297"><span class="linenos">2297</span></a>    <span class="c1"># check EBSD and EDS</span>
</span><span id="validate_general_settings-2298"><a href="#validate_general_settings-2298"><span class="linenos">2298</span></a>    <span class="n">validate_EBSD_EDS_settings</span><span class="p">(</span>
</span><span id="validate_general_settings-2299"><a href="#validate_general_settings-2299"><span class="linenos">2299</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="validate_general_settings-2300"><a href="#validate_general_settings-2300"><span class="linenos">2300</span></a>        <span class="n">connection_host</span><span class="o">=</span><span class="n">connection_host</span><span class="p">,</span>
</span><span id="validate_general_settings-2301"><a href="#validate_general_settings-2301"><span class="linenos">2301</span></a>        <span class="n">connection_port</span><span class="o">=</span><span class="n">connection_port</span><span class="p">,</span>
</span><span id="validate_general_settings-2302"><a href="#validate_general_settings-2302"><span class="linenos">2302</span></a>        <span class="n">ebsd_oem</span><span class="o">=</span><span class="n">ebsd_oem</span><span class="p">,</span>
</span><span id="validate_general_settings-2303"><a href="#validate_general_settings-2303"><span class="linenos">2303</span></a>        <span class="n">eds_oem</span><span class="o">=</span><span class="n">eds_oem</span><span class="p">,</span>
</span><span id="validate_general_settings-2304"><a href="#validate_general_settings-2304"><span class="linenos">2304</span></a>    <span class="p">)</span>
</span><span id="validate_general_settings-2305"><a href="#validate_general_settings-2305"><span class="linenos">2305</span></a>
</span><span id="validate_general_settings-2306"><a href="#validate_general_settings-2306"><span class="linenos">2306</span></a>    <span class="c1"># Check exp dir</span>
</span><span id="validate_general_settings-2307"><a href="#validate_general_settings-2307"><span class="linenos">2307</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_general_settings-2308"><a href="#validate_general_settings-2308"><span class="linenos">2308</span></a>        <span class="n">Path</span><span class="p">(</span><span class="n">exp_dir</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="validate_general_settings-2309"><a href="#validate_general_settings-2309"><span class="linenos">2309</span></a>            <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_general_settings-2310"><a href="#validate_general_settings-2310"><span class="linenos">2310</span></a>            <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_general_settings-2311"><a href="#validate_general_settings-2311"><span class="linenos">2311</span></a>        <span class="p">)</span>
</span><span id="validate_general_settings-2312"><a href="#validate_general_settings-2312"><span class="linenos">2312</span></a>    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="validate_general_settings-2313"><a href="#validate_general_settings-2313"><span class="linenos">2313</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_general_settings-2314"><a href="#validate_general_settings-2314"><span class="linenos">2314</span></a>            <span class="sa">f</span><span class="s1">&#39;Requested experimental directory of &quot;</span><span class="si">{</span><span class="n">exp_dir</span><span class="si">}</span><span class="s1">&quot;, which is not a valid path.&#39;</span>
</span><span id="validate_general_settings-2315"><a href="#validate_general_settings-2315"><span class="linenos">2315</span></a>        <span class="p">)</span>
</span><span id="validate_general_settings-2316"><a href="#validate_general_settings-2316"><span class="linenos">2316</span></a>    <span class="c1"># Check h5 log name</span>
</span><span id="validate_general_settings-2317"><a href="#validate_general_settings-2317"><span class="linenos">2317</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">h5_log_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="validate_general_settings-2318"><a href="#validate_general_settings-2318"><span class="linenos">2318</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unsupported h5 log name of &quot;</span><span class="si">{</span><span class="n">h5_log_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
</span><span id="validate_general_settings-2319"><a href="#validate_general_settings-2319"><span class="linenos">2319</span></a>
</span><span id="validate_general_settings-2320"><a href="#validate_general_settings-2320"><span class="linenos">2320</span></a>    <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_general_settings-2321"><a href="#validate_general_settings-2321"><span class="linenos">2321</span></a>        <span class="p">{</span>
</span><span id="validate_general_settings-2322"><a href="#validate_general_settings-2322"><span class="linenos">2322</span></a>            <span class="s2">&quot;slice_thickness_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_general_settings-2323"><a href="#validate_general_settings-2323"><span class="linenos">2323</span></a>                <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_general_settings-2324"><a href="#validate_general_settings-2324"><span class="linenos">2324</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_general_settings-2325"><a href="#validate_general_settings-2325"><span class="linenos">2325</span></a>                    <span class="n">x</span><span class="p">,</span>
</span><span id="validate_general_settings-2326"><a href="#validate_general_settings-2326"><span class="linenos">2326</span></a>                    <span class="n">limit</span><span class="o">=</span><span class="n">slice_thickness_limit_um</span><span class="p">,</span>
</span><span id="validate_general_settings-2327"><a href="#validate_general_settings-2327"><span class="linenos">2327</span></a>                    <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="validate_general_settings-2328"><a href="#validate_general_settings-2328"><span class="linenos">2328</span></a>                <span class="p">),</span>
</span><span id="validate_general_settings-2329"><a href="#validate_general_settings-2329"><span class="linenos">2329</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested slice thickness of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;slice_thickness_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> um must satisfy &#39;</span><span class="si">{</span><span class="n">slice_thickness_limit_um</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= slice_thickness_um &lt;= </span><span class="si">{</span><span class="n">slice_thickness_limit_um</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="validate_general_settings-2330"><a href="#validate_general_settings-2330"><span class="linenos">2330</span></a>            <span class="p">),</span>
</span><span id="validate_general_settings-2331"><a href="#validate_general_settings-2331"><span class="linenos">2331</span></a>            <span class="s2">&quot;max_slice_num&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_general_settings-2332"><a href="#validate_general_settings-2332"><span class="linenos">2332</span></a>                <span class="nb">int</span><span class="p">,</span>
</span><span id="validate_general_settings-2333"><a href="#validate_general_settings-2333"><span class="linenos">2333</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_general_settings-2334"><a href="#validate_general_settings-2334"><span class="linenos">2334</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested max slice number of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;max_slice_num&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> must satisfy &#39;0 &lt; max_slice_number&#39;&quot;</span><span class="p">,</span>
</span><span id="validate_general_settings-2335"><a href="#validate_general_settings-2335"><span class="linenos">2335</span></a>            <span class="p">),</span>
</span><span id="validate_general_settings-2336"><a href="#validate_general_settings-2336"><span class="linenos">2336</span></a>            <span class="s2">&quot;pre_tilt_deg&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_general_settings-2337"><a href="#validate_general_settings-2337"><span class="linenos">2337</span></a>                <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_general_settings-2338"><a href="#validate_general_settings-2338"><span class="linenos">2338</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_general_settings-2339"><a href="#validate_general_settings-2339"><span class="linenos">2339</span></a>                    <span class="n">x</span><span class="p">,</span>
</span><span id="validate_general_settings-2340"><a href="#validate_general_settings-2340"><span class="linenos">2340</span></a>                    <span class="n">limit</span><span class="o">=</span><span class="n">pre_tilt_limit_deg</span><span class="p">,</span>
</span><span id="validate_general_settings-2341"><a href="#validate_general_settings-2341"><span class="linenos">2341</span></a>                    <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="validate_general_settings-2342"><a href="#validate_general_settings-2342"><span class="linenos">2342</span></a>                <span class="p">),</span>
</span><span id="validate_general_settings-2343"><a href="#validate_general_settings-2343"><span class="linenos">2343</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested pre tilt of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pre_tilt_deg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> degrees must satisfy &#39;</span><span class="si">{</span><span class="n">pre_tilt_limit_deg</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= pre_tilt_deg &lt;= </span><span class="si">{</span><span class="n">pre_tilt_limit_deg</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="validate_general_settings-2344"><a href="#validate_general_settings-2344"><span class="linenos">2344</span></a>            <span class="p">),</span>
</span><span id="validate_general_settings-2345"><a href="#validate_general_settings-2345"><span class="linenos">2345</span></a>            <span class="s2">&quot;stage_translational_tol_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_general_settings-2346"><a href="#validate_general_settings-2346"><span class="linenos">2346</span></a>                <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_general_settings-2347"><a href="#validate_general_settings-2347"><span class="linenos">2347</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_general_settings-2348"><a href="#validate_general_settings-2348"><span class="linenos">2348</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested stage translational tolerance of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;stage_translational_tol_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> um must be a positive float (greater than 0)&quot;</span><span class="p">,</span>
</span><span id="validate_general_settings-2349"><a href="#validate_general_settings-2349"><span class="linenos">2349</span></a>            <span class="p">),</span>
</span><span id="validate_general_settings-2350"><a href="#validate_general_settings-2350"><span class="linenos">2350</span></a>            <span class="s2">&quot;stage_angular_tol_deg&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_general_settings-2351"><a href="#validate_general_settings-2351"><span class="linenos">2351</span></a>                <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_general_settings-2352"><a href="#validate_general_settings-2352"><span class="linenos">2352</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_general_settings-2353"><a href="#validate_general_settings-2353"><span class="linenos">2353</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested stage angular tolerance of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;stage_angular_tol_deg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> degrees must be a positive float (greater than 0)&quot;</span><span class="p">,</span>
</span><span id="validate_general_settings-2354"><a href="#validate_general_settings-2354"><span class="linenos">2354</span></a>            <span class="p">),</span>
</span><span id="validate_general_settings-2355"><a href="#validate_general_settings-2355"><span class="linenos">2355</span></a>            <span class="s2">&quot;step_count&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_general_settings-2356"><a href="#validate_general_settings-2356"><span class="linenos">2356</span></a>                <span class="nb">int</span><span class="p">,</span>
</span><span id="validate_general_settings-2357"><a href="#validate_general_settings-2357"><span class="linenos">2357</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_general_settings-2358"><a href="#validate_general_settings-2358"><span class="linenos">2358</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Requested step count of </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;step_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> must be a positive int (greater than 0)&quot;</span><span class="p">,</span>
</span><span id="validate_general_settings-2359"><a href="#validate_general_settings-2359"><span class="linenos">2359</span></a>            <span class="p">),</span>
</span><span id="validate_general_settings-2360"><a href="#validate_general_settings-2360"><span class="linenos">2360</span></a>        <span class="p">},</span>
</span><span id="validate_general_settings-2361"><a href="#validate_general_settings-2361"><span class="linenos">2361</span></a>        <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_general_settings-2362"><a href="#validate_general_settings-2362"><span class="linenos">2362</span></a>    <span class="p">)</span>
</span><span id="validate_general_settings-2363"><a href="#validate_general_settings-2363"><span class="linenos">2363</span></a>
</span><span id="validate_general_settings-2364"><a href="#validate_general_settings-2364"><span class="linenos">2364</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_general_settings-2365"><a href="#validate_general_settings-2365"><span class="linenos">2365</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_general_settings-2366"><a href="#validate_general_settings-2366"><span class="linenos">2366</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="validate_general_settings-2367"><a href="#validate_general_settings-2367"><span class="linenos">2367</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_general_settings-2368"><a href="#validate_general_settings-2368"><span class="linenos">2368</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="validate_general_settings-2369"><a href="#validate_general_settings-2369"><span class="linenos">2369</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for general setting dictionary.</p>

<p>This function validates the general settings dictionary based on the specified yml format. It checks the microscope connection and EBSD/EDS connection if valid OEMs are specified.</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    The dictionary containing the general settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the general settings dictionary is empty, or if the settings do not satisfy the specified schema, or if the connection is invalid.
NotImplementedError
    If the sectioning axis is unsupported.</p>
</div>


                </section>
                <section id="validate_scan_settings">
                            <input id="validate_scan_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_scan_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span>,</span><span class="param">	<span class="n">beam_type</span><span class="p">:</span> <span class="n"><a href="types.html#BeamType">pytribeam.types.BeamType</a></span>,</span><span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_scan_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_scan_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_scan_settings-2372"><a href="#validate_scan_settings-2372"><span class="linenos">2372</span></a><span class="k">def</span> <span class="nf">validate_scan_settings</span><span class="p">(</span>
</span><span id="validate_scan_settings-2373"><a href="#validate_scan_settings-2373"><span class="linenos">2373</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="validate_scan_settings-2374"><a href="#validate_scan_settings-2374"><span class="linenos">2374</span></a>    <span class="n">beam_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">BeamType</span><span class="p">,</span>
</span><span id="validate_scan_settings-2375"><a href="#validate_scan_settings-2375"><span class="linenos">2375</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_scan_settings-2376"><a href="#validate_scan_settings-2376"><span class="linenos">2376</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_scan_settings-2377"><a href="#validate_scan_settings-2377"><span class="linenos">2377</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_scan_settings-2378"><a href="#validate_scan_settings-2378"><span class="linenos">2378</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_scan_settings-2379"><a href="#validate_scan_settings-2379"><span class="linenos">2379</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_scan_settings-2380"><a href="#validate_scan_settings-2380"><span class="linenos">2380</span></a><span class="sd">    Perform schema checking for scan setting dictionary.</span>
</span><span id="validate_scan_settings-2381"><a href="#validate_scan_settings-2381"><span class="linenos">2381</span></a>
</span><span id="validate_scan_settings-2382"><a href="#validate_scan_settings-2382"><span class="linenos">2382</span></a><span class="sd">    This function validates the scan settings dictionary based on the specified yml format and the scan limits of the microscope.</span>
</span><span id="validate_scan_settings-2383"><a href="#validate_scan_settings-2383"><span class="linenos">2383</span></a>
</span><span id="validate_scan_settings-2384"><a href="#validate_scan_settings-2384"><span class="linenos">2384</span></a><span class="sd">    Parameters</span>
</span><span id="validate_scan_settings-2385"><a href="#validate_scan_settings-2385"><span class="linenos">2385</span></a><span class="sd">    ----------</span>
</span><span id="validate_scan_settings-2386"><a href="#validate_scan_settings-2386"><span class="linenos">2386</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="validate_scan_settings-2387"><a href="#validate_scan_settings-2387"><span class="linenos">2387</span></a><span class="sd">        The microscope object for which to validate the scan settings.</span>
</span><span id="validate_scan_settings-2388"><a href="#validate_scan_settings-2388"><span class="linenos">2388</span></a><span class="sd">    beam_type : tbt.BeamType</span>
</span><span id="validate_scan_settings-2389"><a href="#validate_scan_settings-2389"><span class="linenos">2389</span></a><span class="sd">        The type of the beam (electron or ion).</span>
</span><span id="validate_scan_settings-2390"><a href="#validate_scan_settings-2390"><span class="linenos">2390</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_scan_settings-2391"><a href="#validate_scan_settings-2391"><span class="linenos">2391</span></a><span class="sd">        The dictionary containing the scan settings.</span>
</span><span id="validate_scan_settings-2392"><a href="#validate_scan_settings-2392"><span class="linenos">2392</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_scan_settings-2393"><a href="#validate_scan_settings-2393"><span class="linenos">2393</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_scan_settings-2394"><a href="#validate_scan_settings-2394"><span class="linenos">2394</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_scan_settings-2395"><a href="#validate_scan_settings-2395"><span class="linenos">2395</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_scan_settings-2396"><a href="#validate_scan_settings-2396"><span class="linenos">2396</span></a>
</span><span id="validate_scan_settings-2397"><a href="#validate_scan_settings-2397"><span class="linenos">2397</span></a><span class="sd">    Returns</span>
</span><span id="validate_scan_settings-2398"><a href="#validate_scan_settings-2398"><span class="linenos">2398</span></a><span class="sd">    -------</span>
</span><span id="validate_scan_settings-2399"><a href="#validate_scan_settings-2399"><span class="linenos">2399</span></a><span class="sd">    bool</span>
</span><span id="validate_scan_settings-2400"><a href="#validate_scan_settings-2400"><span class="linenos">2400</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_scan_settings-2401"><a href="#validate_scan_settings-2401"><span class="linenos">2401</span></a>
</span><span id="validate_scan_settings-2402"><a href="#validate_scan_settings-2402"><span class="linenos">2402</span></a><span class="sd">    Raises</span>
</span><span id="validate_scan_settings-2403"><a href="#validate_scan_settings-2403"><span class="linenos">2403</span></a><span class="sd">    ------</span>
</span><span id="validate_scan_settings-2404"><a href="#validate_scan_settings-2404"><span class="linenos">2404</span></a><span class="sd">    ValueError</span>
</span><span id="validate_scan_settings-2405"><a href="#validate_scan_settings-2405"><span class="linenos">2405</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="validate_scan_settings-2406"><a href="#validate_scan_settings-2406"><span class="linenos">2406</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_scan_settings-2407"><a href="#validate_scan_settings-2407"><span class="linenos">2407</span></a>    <span class="n">specified_beam</span> <span class="o">=</span> <span class="n">beam_object_type</span><span class="p">(</span><span class="n">beam_type</span><span class="p">)(</span><span class="n">settings</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">BeamSettings</span><span class="p">())</span>
</span><span id="validate_scan_settings-2408"><a href="#validate_scan_settings-2408"><span class="linenos">2408</span></a>    <span class="n">selected_beam</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">beam_type</span><span class="p">(</span><span class="n">specified_beam</span><span class="p">,</span> <span class="n">microscope</span><span class="p">)</span>
</span><span id="validate_scan_settings-2409"><a href="#validate_scan_settings-2409"><span class="linenos">2409</span></a>
</span><span id="validate_scan_settings-2410"><a href="#validate_scan_settings-2410"><span class="linenos">2410</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Schema checking for scan setting dictionary, format specified by yml_format&quot;&quot;&quot;</span>
</span><span id="validate_scan_settings-2411"><a href="#validate_scan_settings-2411"><span class="linenos">2411</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_scan_settings-2412"><a href="#validate_scan_settings-2412"><span class="linenos">2412</span></a>        <span class="n">limits</span> <span class="o">=</span> <span class="n">scan_limits</span><span class="p">(</span><span class="n">selected_beam</span><span class="p">)</span>
</span><span id="validate_scan_settings-2413"><a href="#validate_scan_settings-2413"><span class="linenos">2413</span></a>        <span class="n">resolution</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span>
</span><span id="validate_scan_settings-2414"><a href="#validate_scan_settings-2414"><span class="linenos">2414</span></a>        <span class="n">rotation_limit</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">rotation_deg</span>
</span><span id="validate_scan_settings-2415"><a href="#validate_scan_settings-2415"><span class="linenos">2415</span></a>        <span class="n">dwell_limit</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">dwell_us</span>
</span><span id="validate_scan_settings-2416"><a href="#validate_scan_settings-2416"><span class="linenos">2416</span></a>
</span><span id="validate_scan_settings-2417"><a href="#validate_scan_settings-2417"><span class="linenos">2417</span></a>    <span class="c1"># check resolution</span>
</span><span id="validate_scan_settings-2418"><a href="#validate_scan_settings-2418"><span class="linenos">2418</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">string_to_res</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="validate_scan_settings-2419"><a href="#validate_scan_settings-2419"><span class="linenos">2419</span></a>
</span><span id="validate_scan_settings-2420"><a href="#validate_scan_settings-2420"><span class="linenos">2420</span></a>    <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_scan_settings-2421"><a href="#validate_scan_settings-2421"><span class="linenos">2421</span></a>        <span class="p">{</span>
</span><span id="validate_scan_settings-2422"><a href="#validate_scan_settings-2422"><span class="linenos">2422</span></a>            <span class="s2">&quot;resolution&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_scan_settings-2423"><a href="#validate_scan_settings-2423"><span class="linenos">2423</span></a>                <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_scan_settings-2424"><a href="#validate_scan_settings-2424"><span class="linenos">2424</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">valid_string_resolution</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
</span><span id="validate_scan_settings-2425"><a href="#validate_scan_settings-2425"><span class="linenos">2425</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, resolution provided was </span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, but must be an integer width and height in format &#39;[width]x[height]&#39;  with each dimension satisfying &#39;</span><span class="si">{</span><span class="n">Constants</span><span class="o">.</span><span class="n">scan_resolution_limit</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> &lt;= [value] &lt;=  </span><span class="si">{</span><span class="n">Constants</span><span class="o">.</span><span class="n">scan_resolution_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="validate_scan_settings-2426"><a href="#validate_scan_settings-2426"><span class="linenos">2426</span></a>            <span class="p">),</span>
</span><span id="validate_scan_settings-2427"><a href="#validate_scan_settings-2427"><span class="linenos">2427</span></a>            <span class="s2">&quot;rotation_deg&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_scan_settings-2428"><a href="#validate_scan_settings-2428"><span class="linenos">2428</span></a>                <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_scan_settings-2429"><a href="#validate_scan_settings-2429"><span class="linenos">2429</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_scan_settings-2430"><a href="#validate_scan_settings-2430"><span class="linenos">2430</span></a>                    <span class="n">x</span><span class="p">,</span>
</span><span id="validate_scan_settings-2431"><a href="#validate_scan_settings-2431"><span class="linenos">2431</span></a>                    <span class="n">limit</span><span class="o">=</span><span class="n">rotation_limit</span><span class="p">,</span>
</span><span id="validate_scan_settings-2432"><a href="#validate_scan_settings-2432"><span class="linenos">2432</span></a>                    <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="validate_scan_settings-2433"><a href="#validate_scan_settings-2433"><span class="linenos">2433</span></a>                <span class="p">),</span>
</span><span id="validate_scan_settings-2434"><a href="#validate_scan_settings-2434"><span class="linenos">2434</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested fixed rotation of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;rotation_deg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; degrees. This is not a float or not within limits of &#39;&gt;=</span><span class="si">{</span><span class="n">rotation_limit</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&#39; and &#39;&lt;=</span><span class="si">{</span><span class="n">rotation_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39; degrees. Setting is of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;rotation_deg&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="validate_scan_settings-2435"><a href="#validate_scan_settings-2435"><span class="linenos">2435</span></a>            <span class="p">),</span>
</span><span id="validate_scan_settings-2436"><a href="#validate_scan_settings-2436"><span class="linenos">2436</span></a>            <span class="s2">&quot;dwell_time_us&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_scan_settings-2437"><a href="#validate_scan_settings-2437"><span class="linenos">2437</span></a>                <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_scan_settings-2438"><a href="#validate_scan_settings-2438"><span class="linenos">2438</span></a>                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_scan_settings-2439"><a href="#validate_scan_settings-2439"><span class="linenos">2439</span></a>                    <span class="n">x</span><span class="p">,</span>
</span><span id="validate_scan_settings-2440"><a href="#validate_scan_settings-2440"><span class="linenos">2440</span></a>                    <span class="n">limit</span><span class="o">=</span><span class="n">dwell_limit</span><span class="p">,</span>
</span><span id="validate_scan_settings-2441"><a href="#validate_scan_settings-2441"><span class="linenos">2441</span></a>                    <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="validate_scan_settings-2442"><a href="#validate_scan_settings-2442"><span class="linenos">2442</span></a>                <span class="p">),</span>
</span><span id="validate_scan_settings-2443"><a href="#validate_scan_settings-2443"><span class="linenos">2443</span></a>                <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, requested fixed dwell_time of &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dwell_time_us&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; microseconds. This is a float or not within limits of &#39;&gt;=</span><span class="si">{</span><span class="n">dwell_limit</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">&#39; and &#39;&lt;=</span><span class="si">{</span><span class="n">dwell_limit</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">&#39; microseconds. Settting is of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dwell_time_us&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="validate_scan_settings-2444"><a href="#validate_scan_settings-2444"><span class="linenos">2444</span></a>            <span class="p">),</span>
</span><span id="validate_scan_settings-2445"><a href="#validate_scan_settings-2445"><span class="linenos">2445</span></a>        <span class="p">},</span>
</span><span id="validate_scan_settings-2446"><a href="#validate_scan_settings-2446"><span class="linenos">2446</span></a>        <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_scan_settings-2447"><a href="#validate_scan_settings-2447"><span class="linenos">2447</span></a>    <span class="p">)</span>
</span><span id="validate_scan_settings-2448"><a href="#validate_scan_settings-2448"><span class="linenos">2448</span></a>
</span><span id="validate_scan_settings-2449"><a href="#validate_scan_settings-2449"><span class="linenos">2449</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_scan_settings-2450"><a href="#validate_scan_settings-2450"><span class="linenos">2450</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_scan_settings-2451"><a href="#validate_scan_settings-2451"><span class="linenos">2451</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="validate_scan_settings-2452"><a href="#validate_scan_settings-2452"><span class="linenos">2452</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_scan_settings-2453"><a href="#validate_scan_settings-2453"><span class="linenos">2453</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="validate_scan_settings-2454"><a href="#validate_scan_settings-2454"><span class="linenos">2454</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for scan setting dictionary.</p>

<p>This function validates the scan settings dictionary based on the specified yml format and the scan limits of the microscope.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object for which to validate the scan settings.
beam_type : tbt.BeamType
    The type of the beam (electron or ion).
settings : dict
    The dictionary containing the scan settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
step_name : str
    The name of the step in the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the yml version is unsupported or if the settings do not satisfy the specified schema.</p>
</div>


                </section>
                <section id="stage_position_settings">
                            <input id="stage_position_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stage_position_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">general_settings</span><span class="p">:</span> <span class="n"><a href="types.html#GeneralSettings">pytribeam.types.GeneralSettings</a></span>,</span><span class="param">	<span class="n">step_stage_settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#StageSettings">pytribeam.types.StageSettings</a></span>:</span></span>

                <label class="view-source-button" for="stage_position_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#stage_position_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="stage_position_settings-2457"><a href="#stage_position_settings-2457"><span class="linenos">2457</span></a><span class="k">def</span> <span class="nf">stage_position_settings</span><span class="p">(</span>
</span><span id="stage_position_settings-2458"><a href="#stage_position_settings-2458"><span class="linenos">2458</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="stage_position_settings-2459"><a href="#stage_position_settings-2459"><span class="linenos">2459</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="stage_position_settings-2460"><a href="#stage_position_settings-2460"><span class="linenos">2460</span></a>    <span class="n">general_settings</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">GeneralSettings</span><span class="p">,</span>
</span><span id="stage_position_settings-2461"><a href="#stage_position_settings-2461"><span class="linenos">2461</span></a>    <span class="n">step_stage_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="stage_position_settings-2462"><a href="#stage_position_settings-2462"><span class="linenos">2462</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="stage_position_settings-2463"><a href="#stage_position_settings-2463"><span class="linenos">2463</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StageSettings</span><span class="p">:</span>
</span><span id="stage_position_settings-2464"><a href="#stage_position_settings-2464"><span class="linenos">2464</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="stage_position_settings-2465"><a href="#stage_position_settings-2465"><span class="linenos">2465</span></a><span class="sd">    Create a StagePositionUser object from settings, including validation.</span>
</span><span id="stage_position_settings-2466"><a href="#stage_position_settings-2466"><span class="linenos">2466</span></a>
</span><span id="stage_position_settings-2467"><a href="#stage_position_settings-2467"><span class="linenos">2467</span></a><span class="sd">    This function creates a `StagePositionUser` object from the provided settings and performs validation.</span>
</span><span id="stage_position_settings-2468"><a href="#stage_position_settings-2468"><span class="linenos">2468</span></a>
</span><span id="stage_position_settings-2469"><a href="#stage_position_settings-2469"><span class="linenos">2469</span></a><span class="sd">    Parameters</span>
</span><span id="stage_position_settings-2470"><a href="#stage_position_settings-2470"><span class="linenos">2470</span></a><span class="sd">    ----------</span>
</span><span id="stage_position_settings-2471"><a href="#stage_position_settings-2471"><span class="linenos">2471</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="stage_position_settings-2472"><a href="#stage_position_settings-2472"><span class="linenos">2472</span></a><span class="sd">        The microscope object for which to set the stage position.</span>
</span><span id="stage_position_settings-2473"><a href="#stage_position_settings-2473"><span class="linenos">2473</span></a><span class="sd">    step_name : str</span>
</span><span id="stage_position_settings-2474"><a href="#stage_position_settings-2474"><span class="linenos">2474</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="stage_position_settings-2475"><a href="#stage_position_settings-2475"><span class="linenos">2475</span></a><span class="sd">    general_settings : tbt.GeneralSettings</span>
</span><span id="stage_position_settings-2476"><a href="#stage_position_settings-2476"><span class="linenos">2476</span></a><span class="sd">        The general settings object.</span>
</span><span id="stage_position_settings-2477"><a href="#stage_position_settings-2477"><span class="linenos">2477</span></a><span class="sd">    step_stage_settings : dict</span>
</span><span id="stage_position_settings-2478"><a href="#stage_position_settings-2478"><span class="linenos">2478</span></a><span class="sd">        The dictionary containing the stage position settings for the step.</span>
</span><span id="stage_position_settings-2479"><a href="#stage_position_settings-2479"><span class="linenos">2479</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="stage_position_settings-2480"><a href="#stage_position_settings-2480"><span class="linenos">2480</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="stage_position_settings-2481"><a href="#stage_position_settings-2481"><span class="linenos">2481</span></a>
</span><span id="stage_position_settings-2482"><a href="#stage_position_settings-2482"><span class="linenos">2482</span></a><span class="sd">    Returns</span>
</span><span id="stage_position_settings-2483"><a href="#stage_position_settings-2483"><span class="linenos">2483</span></a><span class="sd">    -------</span>
</span><span id="stage_position_settings-2484"><a href="#stage_position_settings-2484"><span class="linenos">2484</span></a><span class="sd">    tbt.StageSettings</span>
</span><span id="stage_position_settings-2485"><a href="#stage_position_settings-2485"><span class="linenos">2485</span></a><span class="sd">        The stage settings object.</span>
</span><span id="stage_position_settings-2486"><a href="#stage_position_settings-2486"><span class="linenos">2486</span></a>
</span><span id="stage_position_settings-2487"><a href="#stage_position_settings-2487"><span class="linenos">2487</span></a><span class="sd">    Raises</span>
</span><span id="stage_position_settings-2488"><a href="#stage_position_settings-2488"><span class="linenos">2488</span></a><span class="sd">    ------</span>
</span><span id="stage_position_settings-2489"><a href="#stage_position_settings-2489"><span class="linenos">2489</span></a><span class="sd">    NotImplementedError</span>
</span><span id="stage_position_settings-2490"><a href="#stage_position_settings-2490"><span class="linenos">2490</span></a><span class="sd">        If the rotation side value is unsupported.</span>
</span><span id="stage_position_settings-2491"><a href="#stage_position_settings-2491"><span class="linenos">2491</span></a><span class="sd">    ValueError</span>
</span><span id="stage_position_settings-2492"><a href="#stage_position_settings-2492"><span class="linenos">2492</span></a><span class="sd">        If the stage position settings do not satisfy the specified schema.</span>
</span><span id="stage_position_settings-2493"><a href="#stage_position_settings-2493"><span class="linenos">2493</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="stage_position_settings-2494"><a href="#stage_position_settings-2494"><span class="linenos">2494</span></a>
</span><span id="stage_position_settings-2495"><a href="#stage_position_settings-2495"><span class="linenos">2495</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="stage_position_settings-2496"><a href="#stage_position_settings-2496"><span class="linenos">2496</span></a>        <span class="n">pos_db</span> <span class="o">=</span> <span class="n">step_stage_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;initial_position&quot;</span><span class="p">)</span>
</span><span id="stage_position_settings-2497"><a href="#stage_position_settings-2497"><span class="linenos">2497</span></a>
</span><span id="stage_position_settings-2498"><a href="#stage_position_settings-2498"><span class="linenos">2498</span></a>        <span class="n">rotation_side</span> <span class="o">=</span> <span class="n">step_stage_settings</span><span class="p">[</span><span class="s2">&quot;rotation_side&quot;</span><span class="p">]</span>
</span><span id="stage_position_settings-2499"><a href="#stage_position_settings-2499"><span class="linenos">2499</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">rotation_side</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">RotationSide</span><span class="p">):</span>
</span><span id="stage_position_settings-2500"><a href="#stage_position_settings-2500"><span class="linenos">2500</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="stage_position_settings-2501"><a href="#stage_position_settings-2501"><span class="linenos">2501</span></a>                <span class="sa">f</span><span class="s2">&quot;Unsupported rotation_side value of &#39;</span><span class="si">{</span><span class="n">rotation_side</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rotation_side</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; in step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, supported rotation_side values are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">RotationSide</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="stage_position_settings-2502"><a href="#stage_position_settings-2502"><span class="linenos">2502</span></a>            <span class="p">)</span>
</span><span id="stage_position_settings-2503"><a href="#stage_position_settings-2503"><span class="linenos">2503</span></a>
</span><span id="stage_position_settings-2504"><a href="#stage_position_settings-2504"><span class="linenos">2504</span></a>    <span class="n">validate_stage_position</span><span class="p">(</span>
</span><span id="stage_position_settings-2505"><a href="#stage_position_settings-2505"><span class="linenos">2505</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="stage_position_settings-2506"><a href="#stage_position_settings-2506"><span class="linenos">2506</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="stage_position_settings-2507"><a href="#stage_position_settings-2507"><span class="linenos">2507</span></a>        <span class="n">settings</span><span class="o">=</span><span class="n">pos_db</span><span class="p">,</span>
</span><span id="stage_position_settings-2508"><a href="#stage_position_settings-2508"><span class="linenos">2508</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="stage_position_settings-2509"><a href="#stage_position_settings-2509"><span class="linenos">2509</span></a>    <span class="p">)</span>
</span><span id="stage_position_settings-2510"><a href="#stage_position_settings-2510"><span class="linenos">2510</span></a>
</span><span id="stage_position_settings-2511"><a href="#stage_position_settings-2511"><span class="linenos">2511</span></a>    <span class="n">initial_position</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StagePositionUser</span><span class="p">(</span>
</span><span id="stage_position_settings-2512"><a href="#stage_position_settings-2512"><span class="linenos">2512</span></a>        <span class="n">x_mm</span><span class="o">=</span><span class="n">pos_db</span><span class="p">[</span><span class="s2">&quot;x_mm&quot;</span><span class="p">],</span>
</span><span id="stage_position_settings-2513"><a href="#stage_position_settings-2513"><span class="linenos">2513</span></a>        <span class="n">y_mm</span><span class="o">=</span><span class="n">pos_db</span><span class="p">[</span><span class="s2">&quot;y_mm&quot;</span><span class="p">],</span>
</span><span id="stage_position_settings-2514"><a href="#stage_position_settings-2514"><span class="linenos">2514</span></a>        <span class="n">z_mm</span><span class="o">=</span><span class="n">pos_db</span><span class="p">[</span><span class="s2">&quot;z_mm&quot;</span><span class="p">],</span>
</span><span id="stage_position_settings-2515"><a href="#stage_position_settings-2515"><span class="linenos">2515</span></a>        <span class="n">r_deg</span><span class="o">=</span><span class="n">pos_db</span><span class="p">[</span><span class="s2">&quot;r_deg&quot;</span><span class="p">],</span>
</span><span id="stage_position_settings-2516"><a href="#stage_position_settings-2516"><span class="linenos">2516</span></a>        <span class="n">t_deg</span><span class="o">=</span><span class="n">pos_db</span><span class="p">[</span><span class="s2">&quot;t_deg&quot;</span><span class="p">],</span>
</span><span id="stage_position_settings-2517"><a href="#stage_position_settings-2517"><span class="linenos">2517</span></a>    <span class="p">)</span>
</span><span id="stage_position_settings-2518"><a href="#stage_position_settings-2518"><span class="linenos">2518</span></a>
</span><span id="stage_position_settings-2519"><a href="#stage_position_settings-2519"><span class="linenos">2519</span></a>    <span class="n">pretilt_angle_deg</span> <span class="o">=</span> <span class="n">general_settings</span><span class="o">.</span><span class="n">pre_tilt_deg</span>
</span><span id="stage_position_settings-2520"><a href="#stage_position_settings-2520"><span class="linenos">2520</span></a>    <span class="n">sectioning_axis</span> <span class="o">=</span> <span class="n">general_settings</span><span class="o">.</span><span class="n">sectioning_axis</span>
</span><span id="stage_position_settings-2521"><a href="#stage_position_settings-2521"><span class="linenos">2521</span></a>
</span><span id="stage_position_settings-2522"><a href="#stage_position_settings-2522"><span class="linenos">2522</span></a>    <span class="n">stage_settings</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StageSettings</span><span class="p">(</span>
</span><span id="stage_position_settings-2523"><a href="#stage_position_settings-2523"><span class="linenos">2523</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="stage_position_settings-2524"><a href="#stage_position_settings-2524"><span class="linenos">2524</span></a>        <span class="n">initial_position</span><span class="o">=</span><span class="n">initial_position</span><span class="p">,</span>
</span><span id="stage_position_settings-2525"><a href="#stage_position_settings-2525"><span class="linenos">2525</span></a>        <span class="n">pretilt_angle_deg</span><span class="o">=</span><span class="n">pretilt_angle_deg</span><span class="p">,</span>
</span><span id="stage_position_settings-2526"><a href="#stage_position_settings-2526"><span class="linenos">2526</span></a>        <span class="n">sectioning_axis</span><span class="o">=</span><span class="n">sectioning_axis</span><span class="p">,</span>
</span><span id="stage_position_settings-2527"><a href="#stage_position_settings-2527"><span class="linenos">2527</span></a>        <span class="n">rotation_side</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">RotationSide</span><span class="p">(</span><span class="n">rotation_side</span><span class="p">),</span>
</span><span id="stage_position_settings-2528"><a href="#stage_position_settings-2528"><span class="linenos">2528</span></a>        <span class="c1"># movement_mode=tbt.StageMovementMode.OUT_OF_PLANE,</span>
</span><span id="stage_position_settings-2529"><a href="#stage_position_settings-2529"><span class="linenos">2529</span></a>    <span class="p">)</span>
</span><span id="stage_position_settings-2530"><a href="#stage_position_settings-2530"><span class="linenos">2530</span></a>
</span><span id="stage_position_settings-2531"><a href="#stage_position_settings-2531"><span class="linenos">2531</span></a>    <span class="k">return</span> <span class="n">stage_settings</span>
</span></pre></div>


            <div class="docstring"><p>Create a StagePositionUser object from settings, including validation.</p>

<p>This function creates a <code>StagePositionUser</code> object from the provided settings and performs validation.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object for which to set the stage position.
step_name : str
    The name of the step in the .yml file.
general_settings : tbt.GeneralSettings
    The general settings object.
step_stage_settings : dict
    The dictionary containing the stage position settings for the step.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>tbt.StageSettings
    The stage settings object.</p>

<h2 id="raises">Raises</h2>

<p>NotImplementedError
    If the rotation side value is unsupported.
ValueError
    If the stage position settings do not satisfy the specified schema.</p>
</div>


                </section>
                <section id="validate_pulse_settings">
                            <input id="validate_pulse_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_pulse_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_pulse_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_pulse_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_pulse_settings-2534"><a href="#validate_pulse_settings-2534"><span class="linenos">2534</span></a><span class="k">def</span> <span class="nf">validate_pulse_settings</span><span class="p">(</span>
</span><span id="validate_pulse_settings-2535"><a href="#validate_pulse_settings-2535"><span class="linenos">2535</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_pulse_settings-2536"><a href="#validate_pulse_settings-2536"><span class="linenos">2536</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_pulse_settings-2537"><a href="#validate_pulse_settings-2537"><span class="linenos">2537</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_pulse_settings-2538"><a href="#validate_pulse_settings-2538"><span class="linenos">2538</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_pulse_settings-2539"><a href="#validate_pulse_settings-2539"><span class="linenos">2539</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_pulse_settings-2540"><a href="#validate_pulse_settings-2540"><span class="linenos">2540</span></a><span class="sd">    Perform schema checking for pulse setting dictionary.</span>
</span><span id="validate_pulse_settings-2541"><a href="#validate_pulse_settings-2541"><span class="linenos">2541</span></a>
</span><span id="validate_pulse_settings-2542"><a href="#validate_pulse_settings-2542"><span class="linenos">2542</span></a><span class="sd">    This function validates the pulse settings dictionary based on the specified yml format.</span>
</span><span id="validate_pulse_settings-2543"><a href="#validate_pulse_settings-2543"><span class="linenos">2543</span></a>
</span><span id="validate_pulse_settings-2544"><a href="#validate_pulse_settings-2544"><span class="linenos">2544</span></a><span class="sd">    Parameters</span>
</span><span id="validate_pulse_settings-2545"><a href="#validate_pulse_settings-2545"><span class="linenos">2545</span></a><span class="sd">    ----------</span>
</span><span id="validate_pulse_settings-2546"><a href="#validate_pulse_settings-2546"><span class="linenos">2546</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_pulse_settings-2547"><a href="#validate_pulse_settings-2547"><span class="linenos">2547</span></a><span class="sd">        The dictionary containing the pulse settings.</span>
</span><span id="validate_pulse_settings-2548"><a href="#validate_pulse_settings-2548"><span class="linenos">2548</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_pulse_settings-2549"><a href="#validate_pulse_settings-2549"><span class="linenos">2549</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_pulse_settings-2550"><a href="#validate_pulse_settings-2550"><span class="linenos">2550</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_pulse_settings-2551"><a href="#validate_pulse_settings-2551"><span class="linenos">2551</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_pulse_settings-2552"><a href="#validate_pulse_settings-2552"><span class="linenos">2552</span></a>
</span><span id="validate_pulse_settings-2553"><a href="#validate_pulse_settings-2553"><span class="linenos">2553</span></a><span class="sd">    Returns</span>
</span><span id="validate_pulse_settings-2554"><a href="#validate_pulse_settings-2554"><span class="linenos">2554</span></a><span class="sd">    -------</span>
</span><span id="validate_pulse_settings-2555"><a href="#validate_pulse_settings-2555"><span class="linenos">2555</span></a><span class="sd">    bool</span>
</span><span id="validate_pulse_settings-2556"><a href="#validate_pulse_settings-2556"><span class="linenos">2556</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_pulse_settings-2557"><a href="#validate_pulse_settings-2557"><span class="linenos">2557</span></a>
</span><span id="validate_pulse_settings-2558"><a href="#validate_pulse_settings-2558"><span class="linenos">2558</span></a><span class="sd">    Raises</span>
</span><span id="validate_pulse_settings-2559"><a href="#validate_pulse_settings-2559"><span class="linenos">2559</span></a><span class="sd">    ------</span>
</span><span id="validate_pulse_settings-2560"><a href="#validate_pulse_settings-2560"><span class="linenos">2560</span></a><span class="sd">    NotImplementedError</span>
</span><span id="validate_pulse_settings-2561"><a href="#validate_pulse_settings-2561"><span class="linenos">2561</span></a><span class="sd">        If the wavelength or polarization value is unsupported.</span>
</span><span id="validate_pulse_settings-2562"><a href="#validate_pulse_settings-2562"><span class="linenos">2562</span></a><span class="sd">    ValueError</span>
</span><span id="validate_pulse_settings-2563"><a href="#validate_pulse_settings-2563"><span class="linenos">2563</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="validate_pulse_settings-2564"><a href="#validate_pulse_settings-2564"><span class="linenos">2564</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_pulse_settings-2565"><a href="#validate_pulse_settings-2565"><span class="linenos">2565</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_pulse_settings-2566"><a href="#validate_pulse_settings-2566"><span class="linenos">2566</span></a>        <span class="n">wavelength_nm</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;wavelength_nm&quot;</span><span class="p">)</span>
</span><span id="validate_pulse_settings-2567"><a href="#validate_pulse_settings-2567"><span class="linenos">2567</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">wavelength_nm</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserWavelength</span><span class="p">):</span>
</span><span id="validate_pulse_settings-2568"><a href="#validate_pulse_settings-2568"><span class="linenos">2568</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="validate_pulse_settings-2569"><a href="#validate_pulse_settings-2569"><span class="linenos">2569</span></a>                <span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, unsupported wavelength of &#39;</span><span class="si">{</span><span class="n">wavelength_nm</span><span class="si">}</span><span class="s2">&#39; nm (data type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">wavelength_nm</span><span class="p">)</span><span class="si">}</span><span class="s2">), supported wavelengths are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserWavelength</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="validate_pulse_settings-2570"><a href="#validate_pulse_settings-2570"><span class="linenos">2570</span></a>            <span class="p">)</span>
</span><span id="validate_pulse_settings-2571"><a href="#validate_pulse_settings-2571"><span class="linenos">2571</span></a>        <span class="n">polarization</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;polarization&quot;</span><span class="p">)</span>
</span><span id="validate_pulse_settings-2572"><a href="#validate_pulse_settings-2572"><span class="linenos">2572</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">polarization</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPolarization</span><span class="p">):</span>
</span><span id="validate_pulse_settings-2573"><a href="#validate_pulse_settings-2573"><span class="linenos">2573</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="validate_pulse_settings-2574"><a href="#validate_pulse_settings-2574"><span class="linenos">2574</span></a>                <span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, unsupported laser polarization of &#39;</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&#39;, supported values are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPolarization</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="validate_pulse_settings-2575"><a href="#validate_pulse_settings-2575"><span class="linenos">2575</span></a>            <span class="p">)</span>
</span><span id="validate_pulse_settings-2576"><a href="#validate_pulse_settings-2576"><span class="linenos">2576</span></a>
</span><span id="validate_pulse_settings-2577"><a href="#validate_pulse_settings-2577"><span class="linenos">2577</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_pulse_settings-2578"><a href="#validate_pulse_settings-2578"><span class="linenos">2578</span></a>            <span class="p">{</span>
</span><span id="validate_pulse_settings-2579"><a href="#validate_pulse_settings-2579"><span class="linenos">2579</span></a>                <span class="s2">&quot;divider&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_pulse_settings-2580"><a href="#validate_pulse_settings-2580"><span class="linenos">2580</span></a>                    <span class="nb">int</span><span class="p">,</span>
</span><span id="validate_pulse_settings-2581"><a href="#validate_pulse_settings-2581"><span class="linenos">2581</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_pulse_settings-2582"><a href="#validate_pulse_settings-2582"><span class="linenos">2582</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;divider&#39; parameter must be a positive integer greater than 0 but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;divider&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_pulse_settings-2583"><a href="#validate_pulse_settings-2583"><span class="linenos">2583</span></a>                <span class="p">),</span>
</span><span id="validate_pulse_settings-2584"><a href="#validate_pulse_settings-2584"><span class="linenos">2584</span></a>                <span class="s2">&quot;energy_uj&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_pulse_settings-2585"><a href="#validate_pulse_settings-2585"><span class="linenos">2585</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_pulse_settings-2586"><a href="#validate_pulse_settings-2586"><span class="linenos">2586</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_pulse_settings-2587"><a href="#validate_pulse_settings-2587"><span class="linenos">2587</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;energy_uj&#39; parameter must be a positive float greater than 0 but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;energy_uj&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_pulse_settings-2588"><a href="#validate_pulse_settings-2588"><span class="linenos">2588</span></a>                <span class="p">),</span>
</span><span id="validate_pulse_settings-2589"><a href="#validate_pulse_settings-2589"><span class="linenos">2589</span></a>            <span class="p">},</span>
</span><span id="validate_pulse_settings-2590"><a href="#validate_pulse_settings-2590"><span class="linenos">2590</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_pulse_settings-2591"><a href="#validate_pulse_settings-2591"><span class="linenos">2591</span></a>        <span class="p">)</span>
</span><span id="validate_pulse_settings-2592"><a href="#validate_pulse_settings-2592"><span class="linenos">2592</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_pulse_settings-2593"><a href="#validate_pulse_settings-2593"><span class="linenos">2593</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_pulse_settings-2594"><a href="#validate_pulse_settings-2594"><span class="linenos">2594</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="validate_pulse_settings-2595"><a href="#validate_pulse_settings-2595"><span class="linenos">2595</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_pulse_settings-2596"><a href="#validate_pulse_settings-2596"><span class="linenos">2596</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="validate_pulse_settings-2597"><a href="#validate_pulse_settings-2597"><span class="linenos">2597</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for pulse setting dictionary.</p>

<p>This function validates the pulse settings dictionary based on the specified yml format.</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    The dictionary containing the pulse settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
step_name : str
    The name of the step in the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>NotImplementedError
    If the wavelength or polarization value is unsupported.
ValueError
    If the yml version is unsupported or if the settings do not satisfy the specified schema.</p>
</div>


                </section>
                <section id="validate_laser_optics_settings">
                            <input id="validate_laser_optics_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_laser_optics_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_laser_optics_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_laser_optics_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_laser_optics_settings-2600"><a href="#validate_laser_optics_settings-2600"><span class="linenos">2600</span></a><span class="k">def</span> <span class="nf">validate_laser_optics_settings</span><span class="p">(</span>
</span><span id="validate_laser_optics_settings-2601"><a href="#validate_laser_optics_settings-2601"><span class="linenos">2601</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_laser_optics_settings-2602"><a href="#validate_laser_optics_settings-2602"><span class="linenos">2602</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_laser_optics_settings-2603"><a href="#validate_laser_optics_settings-2603"><span class="linenos">2603</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_laser_optics_settings-2604"><a href="#validate_laser_optics_settings-2604"><span class="linenos">2604</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_laser_optics_settings-2605"><a href="#validate_laser_optics_settings-2605"><span class="linenos">2605</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_laser_optics_settings-2606"><a href="#validate_laser_optics_settings-2606"><span class="linenos">2606</span></a><span class="sd">    Perform schema checking for laser optics setting dictionary.</span>
</span><span id="validate_laser_optics_settings-2607"><a href="#validate_laser_optics_settings-2607"><span class="linenos">2607</span></a>
</span><span id="validate_laser_optics_settings-2608"><a href="#validate_laser_optics_settings-2608"><span class="linenos">2608</span></a><span class="sd">    This function validates the laser optics settings dictionary based on the specified yml format.</span>
</span><span id="validate_laser_optics_settings-2609"><a href="#validate_laser_optics_settings-2609"><span class="linenos">2609</span></a>
</span><span id="validate_laser_optics_settings-2610"><a href="#validate_laser_optics_settings-2610"><span class="linenos">2610</span></a><span class="sd">    Parameters</span>
</span><span id="validate_laser_optics_settings-2611"><a href="#validate_laser_optics_settings-2611"><span class="linenos">2611</span></a><span class="sd">    ----------</span>
</span><span id="validate_laser_optics_settings-2612"><a href="#validate_laser_optics_settings-2612"><span class="linenos">2612</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_laser_optics_settings-2613"><a href="#validate_laser_optics_settings-2613"><span class="linenos">2613</span></a><span class="sd">        The dictionary containing the laser optics settings.</span>
</span><span id="validate_laser_optics_settings-2614"><a href="#validate_laser_optics_settings-2614"><span class="linenos">2614</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_laser_optics_settings-2615"><a href="#validate_laser_optics_settings-2615"><span class="linenos">2615</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_laser_optics_settings-2616"><a href="#validate_laser_optics_settings-2616"><span class="linenos">2616</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_laser_optics_settings-2617"><a href="#validate_laser_optics_settings-2617"><span class="linenos">2617</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_laser_optics_settings-2618"><a href="#validate_laser_optics_settings-2618"><span class="linenos">2618</span></a>
</span><span id="validate_laser_optics_settings-2619"><a href="#validate_laser_optics_settings-2619"><span class="linenos">2619</span></a><span class="sd">    Returns</span>
</span><span id="validate_laser_optics_settings-2620"><a href="#validate_laser_optics_settings-2620"><span class="linenos">2620</span></a><span class="sd">    -------</span>
</span><span id="validate_laser_optics_settings-2621"><a href="#validate_laser_optics_settings-2621"><span class="linenos">2621</span></a><span class="sd">    bool</span>
</span><span id="validate_laser_optics_settings-2622"><a href="#validate_laser_optics_settings-2622"><span class="linenos">2622</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_laser_optics_settings-2623"><a href="#validate_laser_optics_settings-2623"><span class="linenos">2623</span></a>
</span><span id="validate_laser_optics_settings-2624"><a href="#validate_laser_optics_settings-2624"><span class="linenos">2624</span></a><span class="sd">    Raises</span>
</span><span id="validate_laser_optics_settings-2625"><a href="#validate_laser_optics_settings-2625"><span class="linenos">2625</span></a><span class="sd">    ------</span>
</span><span id="validate_laser_optics_settings-2626"><a href="#validate_laser_optics_settings-2626"><span class="linenos">2626</span></a><span class="sd">    ValueError</span>
</span><span id="validate_laser_optics_settings-2627"><a href="#validate_laser_optics_settings-2627"><span class="linenos">2627</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="validate_laser_optics_settings-2628"><a href="#validate_laser_optics_settings-2628"><span class="linenos">2628</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_laser_optics_settings-2629"><a href="#validate_laser_optics_settings-2629"><span class="linenos">2629</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_laser_optics_settings-2630"><a href="#validate_laser_optics_settings-2630"><span class="linenos">2630</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_laser_optics_settings-2631"><a href="#validate_laser_optics_settings-2631"><span class="linenos">2631</span></a>            <span class="p">{</span>
</span><span id="validate_laser_optics_settings-2632"><a href="#validate_laser_optics_settings-2632"><span class="linenos">2632</span></a>                <span class="s2">&quot;objective_position_mm&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_optics_settings-2633"><a href="#validate_laser_optics_settings-2633"><span class="linenos">2633</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_laser_optics_settings-2634"><a href="#validate_laser_optics_settings-2634"><span class="linenos">2634</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span>
</span><span id="validate_laser_optics_settings-2635"><a href="#validate_laser_optics_settings-2635"><span class="linenos">2635</span></a>                        <span class="n">x</span><span class="p">,</span>
</span><span id="validate_laser_optics_settings-2636"><a href="#validate_laser_optics_settings-2636"><span class="linenos">2636</span></a>                        <span class="n">limit</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">laser_objective_limit_mm</span><span class="p">,</span>
</span><span id="validate_laser_optics_settings-2637"><a href="#validate_laser_optics_settings-2637"><span class="linenos">2637</span></a>                        <span class="nb">type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">IntervalType</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span id="validate_laser_optics_settings-2638"><a href="#validate_laser_optics_settings-2638"><span class="linenos">2638</span></a>                    <span class="p">),</span>
</span><span id="validate_laser_optics_settings-2639"><a href="#validate_laser_optics_settings-2639"><span class="linenos">2639</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;objective_position_mm&#39; parameter must be a float satisfying the following: </span><span class="si">{</span><span class="n">Constants</span><span class="o">.</span><span class="n">laser_objective_limit_mm</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2"> mm &lt;= value &lt;= </span><span class="si">{</span><span class="n">Constants</span><span class="o">.</span><span class="n">laser_objective_limit_mm</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2"> mm. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;objective_position_mm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;objective_position_mm&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_optics_settings-2640"><a href="#validate_laser_optics_settings-2640"><span class="linenos">2640</span></a>                <span class="p">),</span>
</span><span id="validate_laser_optics_settings-2641"><a href="#validate_laser_optics_settings-2641"><span class="linenos">2641</span></a>                <span class="s2">&quot;beam_shift_um_x&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_optics_settings-2642"><a href="#validate_laser_optics_settings-2642"><span class="linenos">2642</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_laser_optics_settings-2643"><a href="#validate_laser_optics_settings-2643"><span class="linenos">2643</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;x&#39; parameter for &#39;beam_shift_um&#39; sub-dictioanry must be a float but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;beam_shift_um_x&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;beam_shift_um_x&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_optics_settings-2644"><a href="#validate_laser_optics_settings-2644"><span class="linenos">2644</span></a>                <span class="p">),</span>
</span><span id="validate_laser_optics_settings-2645"><a href="#validate_laser_optics_settings-2645"><span class="linenos">2645</span></a>                <span class="s2">&quot;beam_shift_um_y&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_optics_settings-2646"><a href="#validate_laser_optics_settings-2646"><span class="linenos">2646</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_laser_optics_settings-2647"><a href="#validate_laser_optics_settings-2647"><span class="linenos">2647</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;y&#39; parameter for &#39;beam_shift_um&#39; sub-dictioanry must be a float but &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;beam_shift_um_y&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;beam_shift_um_y&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_optics_settings-2648"><a href="#validate_laser_optics_settings-2648"><span class="linenos">2648</span></a>                <span class="p">),</span>
</span><span id="validate_laser_optics_settings-2649"><a href="#validate_laser_optics_settings-2649"><span class="linenos">2649</span></a>            <span class="p">},</span>
</span><span id="validate_laser_optics_settings-2650"><a href="#validate_laser_optics_settings-2650"><span class="linenos">2650</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_laser_optics_settings-2651"><a href="#validate_laser_optics_settings-2651"><span class="linenos">2651</span></a>        <span class="p">)</span>
</span><span id="validate_laser_optics_settings-2652"><a href="#validate_laser_optics_settings-2652"><span class="linenos">2652</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_laser_optics_settings-2653"><a href="#validate_laser_optics_settings-2653"><span class="linenos">2653</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_laser_optics_settings-2654"><a href="#validate_laser_optics_settings-2654"><span class="linenos">2654</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="validate_laser_optics_settings-2655"><a href="#validate_laser_optics_settings-2655"><span class="linenos">2655</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_laser_optics_settings-2656"><a href="#validate_laser_optics_settings-2656"><span class="linenos">2656</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="validate_laser_optics_settings-2657"><a href="#validate_laser_optics_settings-2657"><span class="linenos">2657</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for laser optics setting dictionary.</p>

<p>This function validates the laser optics settings dictionary based on the specified yml format.</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    The dictionary containing the laser optics settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
step_name : str
    The name of the step in the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the yml version is unsupported or if the settings do not satisfy the specified schema.</p>
</div>


                </section>
                <section id="validate_laser_box_settings">
                            <input id="validate_laser_box_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_laser_box_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_laser_box_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_laser_box_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_laser_box_settings-2660"><a href="#validate_laser_box_settings-2660"><span class="linenos">2660</span></a><span class="k">def</span> <span class="nf">validate_laser_box_settings</span><span class="p">(</span>
</span><span id="validate_laser_box_settings-2661"><a href="#validate_laser_box_settings-2661"><span class="linenos">2661</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2662"><a href="#validate_laser_box_settings-2662"><span class="linenos">2662</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2663"><a href="#validate_laser_box_settings-2663"><span class="linenos">2663</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2664"><a href="#validate_laser_box_settings-2664"><span class="linenos">2664</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_laser_box_settings-2665"><a href="#validate_laser_box_settings-2665"><span class="linenos">2665</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_laser_box_settings-2666"><a href="#validate_laser_box_settings-2666"><span class="linenos">2666</span></a><span class="sd">    Perform schema checking for laser box pattern setting dictionary.</span>
</span><span id="validate_laser_box_settings-2667"><a href="#validate_laser_box_settings-2667"><span class="linenos">2667</span></a>
</span><span id="validate_laser_box_settings-2668"><a href="#validate_laser_box_settings-2668"><span class="linenos">2668</span></a><span class="sd">    This function validates the laser box pattern settings dictionary based on the specified yml format.</span>
</span><span id="validate_laser_box_settings-2669"><a href="#validate_laser_box_settings-2669"><span class="linenos">2669</span></a>
</span><span id="validate_laser_box_settings-2670"><a href="#validate_laser_box_settings-2670"><span class="linenos">2670</span></a><span class="sd">    Parameters</span>
</span><span id="validate_laser_box_settings-2671"><a href="#validate_laser_box_settings-2671"><span class="linenos">2671</span></a><span class="sd">    ----------</span>
</span><span id="validate_laser_box_settings-2672"><a href="#validate_laser_box_settings-2672"><span class="linenos">2672</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_laser_box_settings-2673"><a href="#validate_laser_box_settings-2673"><span class="linenos">2673</span></a><span class="sd">        The dictionary containing the laser box pattern settings.</span>
</span><span id="validate_laser_box_settings-2674"><a href="#validate_laser_box_settings-2674"><span class="linenos">2674</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_laser_box_settings-2675"><a href="#validate_laser_box_settings-2675"><span class="linenos">2675</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_laser_box_settings-2676"><a href="#validate_laser_box_settings-2676"><span class="linenos">2676</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_laser_box_settings-2677"><a href="#validate_laser_box_settings-2677"><span class="linenos">2677</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_laser_box_settings-2678"><a href="#validate_laser_box_settings-2678"><span class="linenos">2678</span></a>
</span><span id="validate_laser_box_settings-2679"><a href="#validate_laser_box_settings-2679"><span class="linenos">2679</span></a><span class="sd">    Returns</span>
</span><span id="validate_laser_box_settings-2680"><a href="#validate_laser_box_settings-2680"><span class="linenos">2680</span></a><span class="sd">    -------</span>
</span><span id="validate_laser_box_settings-2681"><a href="#validate_laser_box_settings-2681"><span class="linenos">2681</span></a><span class="sd">    bool</span>
</span><span id="validate_laser_box_settings-2682"><a href="#validate_laser_box_settings-2682"><span class="linenos">2682</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_laser_box_settings-2683"><a href="#validate_laser_box_settings-2683"><span class="linenos">2683</span></a>
</span><span id="validate_laser_box_settings-2684"><a href="#validate_laser_box_settings-2684"><span class="linenos">2684</span></a><span class="sd">    Raises</span>
</span><span id="validate_laser_box_settings-2685"><a href="#validate_laser_box_settings-2685"><span class="linenos">2685</span></a><span class="sd">    ------</span>
</span><span id="validate_laser_box_settings-2686"><a href="#validate_laser_box_settings-2686"><span class="linenos">2686</span></a><span class="sd">    NotImplementedError</span>
</span><span id="validate_laser_box_settings-2687"><a href="#validate_laser_box_settings-2687"><span class="linenos">2687</span></a><span class="sd">        If the scan type or coordinate reference value is unsupported.</span>
</span><span id="validate_laser_box_settings-2688"><a href="#validate_laser_box_settings-2688"><span class="linenos">2688</span></a><span class="sd">    ValueError</span>
</span><span id="validate_laser_box_settings-2689"><a href="#validate_laser_box_settings-2689"><span class="linenos">2689</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="validate_laser_box_settings-2690"><a href="#validate_laser_box_settings-2690"><span class="linenos">2690</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_laser_box_settings-2691"><a href="#validate_laser_box_settings-2691"><span class="linenos">2691</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_laser_box_settings-2692"><a href="#validate_laser_box_settings-2692"><span class="linenos">2692</span></a>        <span class="c1"># scan type</span>
</span><span id="validate_laser_box_settings-2693"><a href="#validate_laser_box_settings-2693"><span class="linenos">2693</span></a>        <span class="n">scan_type</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_type&quot;</span><span class="p">)</span>
</span><span id="validate_laser_box_settings-2694"><a href="#validate_laser_box_settings-2694"><span class="linenos">2694</span></a>        <span class="n">scan_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="validate_laser_box_settings-2695"><a href="#validate_laser_box_settings-2695"><span class="linenos">2695</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="o">.</span><span class="n">RASTER</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2696"><a href="#validate_laser_box_settings-2696"><span class="linenos">2696</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="o">.</span><span class="n">SERPENTINE</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2697"><a href="#validate_laser_box_settings-2697"><span class="linenos">2697</span></a>        <span class="p">]</span>
</span><span id="validate_laser_box_settings-2698"><a href="#validate_laser_box_settings-2698"><span class="linenos">2698</span></a>        <span class="n">scan_type_error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, unsupported scan type of &#39;</span><span class="si">{</span><span class="n">scan_type</span><span class="si">}</span><span class="s2">&#39; for box pattern, supported scan types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">scan_types</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="validate_laser_box_settings-2699"><a href="#validate_laser_box_settings-2699"><span class="linenos">2699</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">scan_type</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">):</span>
</span><span id="validate_laser_box_settings-2700"><a href="#validate_laser_box_settings-2700"><span class="linenos">2700</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">scan_type_error_msg</span><span class="p">)</span>
</span><span id="validate_laser_box_settings-2701"><a href="#validate_laser_box_settings-2701"><span class="linenos">2701</span></a>        <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">(</span><span class="n">scan_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">scan_types</span><span class="p">:</span>
</span><span id="validate_laser_box_settings-2702"><a href="#validate_laser_box_settings-2702"><span class="linenos">2702</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">scan_type_error_msg</span><span class="p">)</span>
</span><span id="validate_laser_box_settings-2703"><a href="#validate_laser_box_settings-2703"><span class="linenos">2703</span></a>
</span><span id="validate_laser_box_settings-2704"><a href="#validate_laser_box_settings-2704"><span class="linenos">2704</span></a>        <span class="c1"># coordinate reference</span>
</span><span id="validate_laser_box_settings-2705"><a href="#validate_laser_box_settings-2705"><span class="linenos">2705</span></a>        <span class="n">coordinate_ref</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;coordinate_ref&quot;</span><span class="p">)</span>
</span><span id="validate_laser_box_settings-2706"><a href="#validate_laser_box_settings-2706"><span class="linenos">2706</span></a>        <span class="n">coord_refs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="validate_laser_box_settings-2707"><a href="#validate_laser_box_settings-2707"><span class="linenos">2707</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="o">.</span><span class="n">CENTER</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2708"><a href="#validate_laser_box_settings-2708"><span class="linenos">2708</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="o">.</span><span class="n">UPPER_CENTER</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2709"><a href="#validate_laser_box_settings-2709"><span class="linenos">2709</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="o">.</span><span class="n">UPPER_LEFT</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2710"><a href="#validate_laser_box_settings-2710"><span class="linenos">2710</span></a>        <span class="p">]</span>
</span><span id="validate_laser_box_settings-2711"><a href="#validate_laser_box_settings-2711"><span class="linenos">2711</span></a>        <span class="n">coord_error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, unsupported coordinate reference of &#39;</span><span class="si">{</span><span class="n">coordinate_ref</span><span class="si">}</span><span class="s2">&#39; for box pattern, supported coordinate references are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">coord_refs</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="validate_laser_box_settings-2712"><a href="#validate_laser_box_settings-2712"><span class="linenos">2712</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">coordinate_ref</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="p">):</span>
</span><span id="validate_laser_box_settings-2713"><a href="#validate_laser_box_settings-2713"><span class="linenos">2713</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">coord_error_msg</span><span class="p">)</span>
</span><span id="validate_laser_box_settings-2714"><a href="#validate_laser_box_settings-2714"><span class="linenos">2714</span></a>        <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">CoordinateReference</span><span class="p">(</span><span class="n">coordinate_ref</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">coord_refs</span><span class="p">:</span>
</span><span id="validate_laser_box_settings-2715"><a href="#validate_laser_box_settings-2715"><span class="linenos">2715</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">coord_error_msg</span><span class="p">)</span>
</span><span id="validate_laser_box_settings-2716"><a href="#validate_laser_box_settings-2716"><span class="linenos">2716</span></a>
</span><span id="validate_laser_box_settings-2717"><a href="#validate_laser_box_settings-2717"><span class="linenos">2717</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_laser_box_settings-2718"><a href="#validate_laser_box_settings-2718"><span class="linenos">2718</span></a>            <span class="p">{</span>
</span><span id="validate_laser_box_settings-2719"><a href="#validate_laser_box_settings-2719"><span class="linenos">2719</span></a>                <span class="s2">&quot;passes&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_box_settings-2720"><a href="#validate_laser_box_settings-2720"><span class="linenos">2720</span></a>                    <span class="nb">int</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2721"><a href="#validate_laser_box_settings-2721"><span class="linenos">2721</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2722"><a href="#validate_laser_box_settings-2722"><span class="linenos">2722</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;passes&#39; parameter in &#39;box&#39; type pattern must be a positive integer. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;passes&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;passes&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2723"><a href="#validate_laser_box_settings-2723"><span class="linenos">2723</span></a>                <span class="p">),</span>
</span><span id="validate_laser_box_settings-2724"><a href="#validate_laser_box_settings-2724"><span class="linenos">2724</span></a>                <span class="s2">&quot;size_x_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_box_settings-2725"><a href="#validate_laser_box_settings-2725"><span class="linenos">2725</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2726"><a href="#validate_laser_box_settings-2726"><span class="linenos">2726</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2727"><a href="#validate_laser_box_settings-2727"><span class="linenos">2727</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;size_x_um&#39; parameter in &#39;box&#39; type pattern must be a positive float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;size_x_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;size_x_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2728"><a href="#validate_laser_box_settings-2728"><span class="linenos">2728</span></a>                <span class="p">),</span>
</span><span id="validate_laser_box_settings-2729"><a href="#validate_laser_box_settings-2729"><span class="linenos">2729</span></a>                <span class="s2">&quot;size_y_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_box_settings-2730"><a href="#validate_laser_box_settings-2730"><span class="linenos">2730</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2731"><a href="#validate_laser_box_settings-2731"><span class="linenos">2731</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2732"><a href="#validate_laser_box_settings-2732"><span class="linenos">2732</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;size_y_um&#39; parameter in &#39;box&#39; type pattern must be a positive float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;size_y_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;size_y_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2733"><a href="#validate_laser_box_settings-2733"><span class="linenos">2733</span></a>                <span class="p">),</span>
</span><span id="validate_laser_box_settings-2734"><a href="#validate_laser_box_settings-2734"><span class="linenos">2734</span></a>                <span class="s2">&quot;pitch_x_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_box_settings-2735"><a href="#validate_laser_box_settings-2735"><span class="linenos">2735</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2736"><a href="#validate_laser_box_settings-2736"><span class="linenos">2736</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2737"><a href="#validate_laser_box_settings-2737"><span class="linenos">2737</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pitch_x_um&#39; parameter in &#39;box&#39; type pattern must be a positive float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pitch_x_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pitch_x_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2738"><a href="#validate_laser_box_settings-2738"><span class="linenos">2738</span></a>                <span class="p">),</span>
</span><span id="validate_laser_box_settings-2739"><a href="#validate_laser_box_settings-2739"><span class="linenos">2739</span></a>                <span class="s2">&quot;pitch_y_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_box_settings-2740"><a href="#validate_laser_box_settings-2740"><span class="linenos">2740</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2741"><a href="#validate_laser_box_settings-2741"><span class="linenos">2741</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2742"><a href="#validate_laser_box_settings-2742"><span class="linenos">2742</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pitch_y_um&#39; parameter in &#39;box&#39; type pattern must be a positive float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pitch_y_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pitch_y_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2743"><a href="#validate_laser_box_settings-2743"><span class="linenos">2743</span></a>                <span class="p">),</span>
</span><span id="validate_laser_box_settings-2744"><a href="#validate_laser_box_settings-2744"><span class="linenos">2744</span></a>            <span class="p">},</span>
</span><span id="validate_laser_box_settings-2745"><a href="#validate_laser_box_settings-2745"><span class="linenos">2745</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_laser_box_settings-2746"><a href="#validate_laser_box_settings-2746"><span class="linenos">2746</span></a>        <span class="p">)</span>
</span><span id="validate_laser_box_settings-2747"><a href="#validate_laser_box_settings-2747"><span class="linenos">2747</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_laser_box_settings-2748"><a href="#validate_laser_box_settings-2748"><span class="linenos">2748</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_laser_box_settings-2749"><a href="#validate_laser_box_settings-2749"><span class="linenos">2749</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="validate_laser_box_settings-2750"><a href="#validate_laser_box_settings-2750"><span class="linenos">2750</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_laser_box_settings-2751"><a href="#validate_laser_box_settings-2751"><span class="linenos">2751</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="validate_laser_box_settings-2752"><a href="#validate_laser_box_settings-2752"><span class="linenos">2752</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for laser box pattern setting dictionary.</p>

<p>This function validates the laser box pattern settings dictionary based on the specified yml format.</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    The dictionary containing the laser box pattern settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
step_name : str
    The name of the step in the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>NotImplementedError
    If the scan type or coordinate reference value is unsupported.
ValueError
    If the yml version is unsupported or if the settings do not satisfy the specified schema.</p>
</div>


                </section>
                <section id="validate_laser_line_settings">
                            <input id="validate_laser_line_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_laser_line_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_laser_line_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_laser_line_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_laser_line_settings-2755"><a href="#validate_laser_line_settings-2755"><span class="linenos">2755</span></a><span class="k">def</span> <span class="nf">validate_laser_line_settings</span><span class="p">(</span>
</span><span id="validate_laser_line_settings-2756"><a href="#validate_laser_line_settings-2756"><span class="linenos">2756</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2757"><a href="#validate_laser_line_settings-2757"><span class="linenos">2757</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2758"><a href="#validate_laser_line_settings-2758"><span class="linenos">2758</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2759"><a href="#validate_laser_line_settings-2759"><span class="linenos">2759</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_laser_line_settings-2760"><a href="#validate_laser_line_settings-2760"><span class="linenos">2760</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_laser_line_settings-2761"><a href="#validate_laser_line_settings-2761"><span class="linenos">2761</span></a><span class="sd">    Perform schema checking for laser line pattern setting dictionary.</span>
</span><span id="validate_laser_line_settings-2762"><a href="#validate_laser_line_settings-2762"><span class="linenos">2762</span></a>
</span><span id="validate_laser_line_settings-2763"><a href="#validate_laser_line_settings-2763"><span class="linenos">2763</span></a><span class="sd">    This function validates the laser line pattern settings dictionary based on the specified yml format.</span>
</span><span id="validate_laser_line_settings-2764"><a href="#validate_laser_line_settings-2764"><span class="linenos">2764</span></a>
</span><span id="validate_laser_line_settings-2765"><a href="#validate_laser_line_settings-2765"><span class="linenos">2765</span></a><span class="sd">    Parameters</span>
</span><span id="validate_laser_line_settings-2766"><a href="#validate_laser_line_settings-2766"><span class="linenos">2766</span></a><span class="sd">    ----------</span>
</span><span id="validate_laser_line_settings-2767"><a href="#validate_laser_line_settings-2767"><span class="linenos">2767</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_laser_line_settings-2768"><a href="#validate_laser_line_settings-2768"><span class="linenos">2768</span></a><span class="sd">        The dictionary containing the laser line pattern settings.</span>
</span><span id="validate_laser_line_settings-2769"><a href="#validate_laser_line_settings-2769"><span class="linenos">2769</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_laser_line_settings-2770"><a href="#validate_laser_line_settings-2770"><span class="linenos">2770</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_laser_line_settings-2771"><a href="#validate_laser_line_settings-2771"><span class="linenos">2771</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_laser_line_settings-2772"><a href="#validate_laser_line_settings-2772"><span class="linenos">2772</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_laser_line_settings-2773"><a href="#validate_laser_line_settings-2773"><span class="linenos">2773</span></a>
</span><span id="validate_laser_line_settings-2774"><a href="#validate_laser_line_settings-2774"><span class="linenos">2774</span></a><span class="sd">    Returns</span>
</span><span id="validate_laser_line_settings-2775"><a href="#validate_laser_line_settings-2775"><span class="linenos">2775</span></a><span class="sd">    -------</span>
</span><span id="validate_laser_line_settings-2776"><a href="#validate_laser_line_settings-2776"><span class="linenos">2776</span></a><span class="sd">    bool</span>
</span><span id="validate_laser_line_settings-2777"><a href="#validate_laser_line_settings-2777"><span class="linenos">2777</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_laser_line_settings-2778"><a href="#validate_laser_line_settings-2778"><span class="linenos">2778</span></a>
</span><span id="validate_laser_line_settings-2779"><a href="#validate_laser_line_settings-2779"><span class="linenos">2779</span></a><span class="sd">    Raises</span>
</span><span id="validate_laser_line_settings-2780"><a href="#validate_laser_line_settings-2780"><span class="linenos">2780</span></a><span class="sd">    ------</span>
</span><span id="validate_laser_line_settings-2781"><a href="#validate_laser_line_settings-2781"><span class="linenos">2781</span></a><span class="sd">    NotImplementedError</span>
</span><span id="validate_laser_line_settings-2782"><a href="#validate_laser_line_settings-2782"><span class="linenos">2782</span></a><span class="sd">        If the scan type value is unsupported.</span>
</span><span id="validate_laser_line_settings-2783"><a href="#validate_laser_line_settings-2783"><span class="linenos">2783</span></a><span class="sd">    ValueError</span>
</span><span id="validate_laser_line_settings-2784"><a href="#validate_laser_line_settings-2784"><span class="linenos">2784</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="validate_laser_line_settings-2785"><a href="#validate_laser_line_settings-2785"><span class="linenos">2785</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_laser_line_settings-2786"><a href="#validate_laser_line_settings-2786"><span class="linenos">2786</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_laser_line_settings-2787"><a href="#validate_laser_line_settings-2787"><span class="linenos">2787</span></a>        <span class="c1"># scan type</span>
</span><span id="validate_laser_line_settings-2788"><a href="#validate_laser_line_settings-2788"><span class="linenos">2788</span></a>        <span class="n">scan_type</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_type&quot;</span><span class="p">)</span>
</span><span id="validate_laser_line_settings-2789"><a href="#validate_laser_line_settings-2789"><span class="linenos">2789</span></a>        <span class="n">scan_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="validate_laser_line_settings-2790"><a href="#validate_laser_line_settings-2790"><span class="linenos">2790</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="o">.</span><span class="n">SINGLE</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2791"><a href="#validate_laser_line_settings-2791"><span class="linenos">2791</span></a>            <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="o">.</span><span class="n">LAP</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2792"><a href="#validate_laser_line_settings-2792"><span class="linenos">2792</span></a>        <span class="p">]</span>
</span><span id="validate_laser_line_settings-2793"><a href="#validate_laser_line_settings-2793"><span class="linenos">2793</span></a>        <span class="n">scan_type_error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, unsupported scan type of &#39;</span><span class="si">{</span><span class="n">scan_type</span><span class="si">}</span><span class="s2">&#39; for line pattern, supported scan types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">scan_types</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="validate_laser_line_settings-2794"><a href="#validate_laser_line_settings-2794"><span class="linenos">2794</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">scan_type</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">):</span>
</span><span id="validate_laser_line_settings-2795"><a href="#validate_laser_line_settings-2795"><span class="linenos">2795</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">scan_type_error_msg</span><span class="p">)</span>
</span><span id="validate_laser_line_settings-2796"><a href="#validate_laser_line_settings-2796"><span class="linenos">2796</span></a>        <span class="k">if</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserScanType</span><span class="p">(</span><span class="n">scan_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">scan_types</span><span class="p">:</span>
</span><span id="validate_laser_line_settings-2797"><a href="#validate_laser_line_settings-2797"><span class="linenos">2797</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">scan_type_error_msg</span><span class="p">)</span>
</span><span id="validate_laser_line_settings-2798"><a href="#validate_laser_line_settings-2798"><span class="linenos">2798</span></a>
</span><span id="validate_laser_line_settings-2799"><a href="#validate_laser_line_settings-2799"><span class="linenos">2799</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_laser_line_settings-2800"><a href="#validate_laser_line_settings-2800"><span class="linenos">2800</span></a>            <span class="p">{</span>
</span><span id="validate_laser_line_settings-2801"><a href="#validate_laser_line_settings-2801"><span class="linenos">2801</span></a>                <span class="s2">&quot;passes&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_line_settings-2802"><a href="#validate_laser_line_settings-2802"><span class="linenos">2802</span></a>                    <span class="nb">int</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2803"><a href="#validate_laser_line_settings-2803"><span class="linenos">2803</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2804"><a href="#validate_laser_line_settings-2804"><span class="linenos">2804</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;passes&#39; parameter in &#39;line&#39; type pattern must be a positive integer. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;passes&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;passes&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2805"><a href="#validate_laser_line_settings-2805"><span class="linenos">2805</span></a>                <span class="p">),</span>
</span><span id="validate_laser_line_settings-2806"><a href="#validate_laser_line_settings-2806"><span class="linenos">2806</span></a>                <span class="s2">&quot;size_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_line_settings-2807"><a href="#validate_laser_line_settings-2807"><span class="linenos">2807</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2808"><a href="#validate_laser_line_settings-2808"><span class="linenos">2808</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2809"><a href="#validate_laser_line_settings-2809"><span class="linenos">2809</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;size_um&#39; parameter in &#39;line&#39; type pattern must be a positive float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;size_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;size_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2810"><a href="#validate_laser_line_settings-2810"><span class="linenos">2810</span></a>                <span class="p">),</span>
</span><span id="validate_laser_line_settings-2811"><a href="#validate_laser_line_settings-2811"><span class="linenos">2811</span></a>                <span class="s2">&quot;pitch_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_line_settings-2812"><a href="#validate_laser_line_settings-2812"><span class="linenos">2812</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2813"><a href="#validate_laser_line_settings-2813"><span class="linenos">2813</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2814"><a href="#validate_laser_line_settings-2814"><span class="linenos">2814</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pitch_um&#39; parameter in &#39;line&#39; type pattern must be a positive float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pitch_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; mm (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pitch_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2815"><a href="#validate_laser_line_settings-2815"><span class="linenos">2815</span></a>                <span class="p">),</span>
</span><span id="validate_laser_line_settings-2816"><a href="#validate_laser_line_settings-2816"><span class="linenos">2816</span></a>            <span class="p">},</span>
</span><span id="validate_laser_line_settings-2817"><a href="#validate_laser_line_settings-2817"><span class="linenos">2817</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_laser_line_settings-2818"><a href="#validate_laser_line_settings-2818"><span class="linenos">2818</span></a>        <span class="p">)</span>
</span><span id="validate_laser_line_settings-2819"><a href="#validate_laser_line_settings-2819"><span class="linenos">2819</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_laser_line_settings-2820"><a href="#validate_laser_line_settings-2820"><span class="linenos">2820</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_laser_line_settings-2821"><a href="#validate_laser_line_settings-2821"><span class="linenos">2821</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="validate_laser_line_settings-2822"><a href="#validate_laser_line_settings-2822"><span class="linenos">2822</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_laser_line_settings-2823"><a href="#validate_laser_line_settings-2823"><span class="linenos">2823</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="validate_laser_line_settings-2824"><a href="#validate_laser_line_settings-2824"><span class="linenos">2824</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for laser line pattern setting dictionary.</p>

<p>This function validates the laser line pattern settings dictionary based on the specified yml format.</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    The dictionary containing the laser line pattern settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
step_name : str
    The name of the step in the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>NotImplementedError
    If the scan type value is unsupported.
ValueError
    If the yml version is unsupported or if the settings do not satisfy the specified schema.</p>
</div>


                </section>
                <section id="validate_laser_mode_settings">
                            <input id="validate_laser_mode_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_laser_mode_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_laser_mode_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_laser_mode_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_laser_mode_settings-2827"><a href="#validate_laser_mode_settings-2827"><span class="linenos">2827</span></a><span class="k">def</span> <span class="nf">validate_laser_mode_settings</span><span class="p">(</span>
</span><span id="validate_laser_mode_settings-2828"><a href="#validate_laser_mode_settings-2828"><span class="linenos">2828</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2829"><a href="#validate_laser_mode_settings-2829"><span class="linenos">2829</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2830"><a href="#validate_laser_mode_settings-2830"><span class="linenos">2830</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2831"><a href="#validate_laser_mode_settings-2831"><span class="linenos">2831</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_laser_mode_settings-2832"><a href="#validate_laser_mode_settings-2832"><span class="linenos">2832</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_laser_mode_settings-2833"><a href="#validate_laser_mode_settings-2833"><span class="linenos">2833</span></a><span class="sd">    Perform schema checking for laser mode setting dictionary.</span>
</span><span id="validate_laser_mode_settings-2834"><a href="#validate_laser_mode_settings-2834"><span class="linenos">2834</span></a>
</span><span id="validate_laser_mode_settings-2835"><a href="#validate_laser_mode_settings-2835"><span class="linenos">2835</span></a><span class="sd">    This function validates the laser mode settings dictionary based on the specified yml format.</span>
</span><span id="validate_laser_mode_settings-2836"><a href="#validate_laser_mode_settings-2836"><span class="linenos">2836</span></a>
</span><span id="validate_laser_mode_settings-2837"><a href="#validate_laser_mode_settings-2837"><span class="linenos">2837</span></a><span class="sd">    Parameters</span>
</span><span id="validate_laser_mode_settings-2838"><a href="#validate_laser_mode_settings-2838"><span class="linenos">2838</span></a><span class="sd">    ----------</span>
</span><span id="validate_laser_mode_settings-2839"><a href="#validate_laser_mode_settings-2839"><span class="linenos">2839</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_laser_mode_settings-2840"><a href="#validate_laser_mode_settings-2840"><span class="linenos">2840</span></a><span class="sd">        The dictionary containing the laser mode settings.</span>
</span><span id="validate_laser_mode_settings-2841"><a href="#validate_laser_mode_settings-2841"><span class="linenos">2841</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_laser_mode_settings-2842"><a href="#validate_laser_mode_settings-2842"><span class="linenos">2842</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_laser_mode_settings-2843"><a href="#validate_laser_mode_settings-2843"><span class="linenos">2843</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_laser_mode_settings-2844"><a href="#validate_laser_mode_settings-2844"><span class="linenos">2844</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_laser_mode_settings-2845"><a href="#validate_laser_mode_settings-2845"><span class="linenos">2845</span></a>
</span><span id="validate_laser_mode_settings-2846"><a href="#validate_laser_mode_settings-2846"><span class="linenos">2846</span></a><span class="sd">    Returns</span>
</span><span id="validate_laser_mode_settings-2847"><a href="#validate_laser_mode_settings-2847"><span class="linenos">2847</span></a><span class="sd">    -------</span>
</span><span id="validate_laser_mode_settings-2848"><a href="#validate_laser_mode_settings-2848"><span class="linenos">2848</span></a><span class="sd">    bool</span>
</span><span id="validate_laser_mode_settings-2849"><a href="#validate_laser_mode_settings-2849"><span class="linenos">2849</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_laser_mode_settings-2850"><a href="#validate_laser_mode_settings-2850"><span class="linenos">2850</span></a>
</span><span id="validate_laser_mode_settings-2851"><a href="#validate_laser_mode_settings-2851"><span class="linenos">2851</span></a><span class="sd">    Raises</span>
</span><span id="validate_laser_mode_settings-2852"><a href="#validate_laser_mode_settings-2852"><span class="linenos">2852</span></a><span class="sd">    ------</span>
</span><span id="validate_laser_mode_settings-2853"><a href="#validate_laser_mode_settings-2853"><span class="linenos">2853</span></a><span class="sd">    NotImplementedError</span>
</span><span id="validate_laser_mode_settings-2854"><a href="#validate_laser_mode_settings-2854"><span class="linenos">2854</span></a><span class="sd">        If the laser pattern mode value is unsupported.</span>
</span><span id="validate_laser_mode_settings-2855"><a href="#validate_laser_mode_settings-2855"><span class="linenos">2855</span></a><span class="sd">    ValueError</span>
</span><span id="validate_laser_mode_settings-2856"><a href="#validate_laser_mode_settings-2856"><span class="linenos">2856</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="validate_laser_mode_settings-2857"><a href="#validate_laser_mode_settings-2857"><span class="linenos">2857</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_laser_mode_settings-2858"><a href="#validate_laser_mode_settings-2858"><span class="linenos">2858</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_laser_mode_settings-2859"><a href="#validate_laser_mode_settings-2859"><span class="linenos">2859</span></a>        <span class="n">mode</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>
</span><span id="validate_laser_mode_settings-2860"><a href="#validate_laser_mode_settings-2860"><span class="linenos">2860</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternMode</span><span class="p">):</span>
</span><span id="validate_laser_mode_settings-2861"><a href="#validate_laser_mode_settings-2861"><span class="linenos">2861</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="validate_laser_mode_settings-2862"><a href="#validate_laser_mode_settings-2862"><span class="linenos">2862</span></a>                <span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, unsupported laser pattern mode of &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;, supported values are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternMode</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="validate_laser_mode_settings-2863"><a href="#validate_laser_mode_settings-2863"><span class="linenos">2863</span></a>            <span class="p">)</span>
</span><span id="validate_laser_mode_settings-2864"><a href="#validate_laser_mode_settings-2864"><span class="linenos">2864</span></a>
</span><span id="validate_laser_mode_settings-2865"><a href="#validate_laser_mode_settings-2865"><span class="linenos">2865</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_laser_mode_settings-2866"><a href="#validate_laser_mode_settings-2866"><span class="linenos">2866</span></a>            <span class="p">{</span>
</span><span id="validate_laser_mode_settings-2867"><a href="#validate_laser_mode_settings-2867"><span class="linenos">2867</span></a>                <span class="s2">&quot;rotation_deg&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_mode_settings-2868"><a href="#validate_laser_mode_settings-2868"><span class="linenos">2868</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2869"><a href="#validate_laser_mode_settings-2869"><span class="linenos">2869</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;rotation_deg&#39; parameter must be a float. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;rotation_deg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; degrees (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;rotation_deg&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2870"><a href="#validate_laser_mode_settings-2870"><span class="linenos">2870</span></a>                <span class="p">),</span>
</span><span id="validate_laser_mode_settings-2871"><a href="#validate_laser_mode_settings-2871"><span class="linenos">2871</span></a>            <span class="p">},</span>
</span><span id="validate_laser_mode_settings-2872"><a href="#validate_laser_mode_settings-2872"><span class="linenos">2872</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2873"><a href="#validate_laser_mode_settings-2873"><span class="linenos">2873</span></a>        <span class="p">)</span>
</span><span id="validate_laser_mode_settings-2874"><a href="#validate_laser_mode_settings-2874"><span class="linenos">2874</span></a>        <span class="n">schema_fine</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_laser_mode_settings-2875"><a href="#validate_laser_mode_settings-2875"><span class="linenos">2875</span></a>            <span class="p">{</span>
</span><span id="validate_laser_mode_settings-2876"><a href="#validate_laser_mode_settings-2876"><span class="linenos">2876</span></a>                <span class="s2">&quot;pixel_dwell_ms&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="validate_laser_mode_settings-2877"><a href="#validate_laser_mode_settings-2877"><span class="linenos">2877</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2878"><a href="#validate_laser_mode_settings-2878"><span class="linenos">2878</span></a>                    <span class="s2">&quot;null&quot;</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2879"><a href="#validate_laser_mode_settings-2879"><span class="linenos">2879</span></a>                    <span class="s2">&quot;None&quot;</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2880"><a href="#validate_laser_mode_settings-2880"><span class="linenos">2880</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pixel_dwell_ms&#39; parameter does not apply to the selected &#39;fine&#39; milling mode. Set &#39;pixel_dwell_ms&#39; to &#39;null&#39; &#39;None&#39; or leave the entry blank to continue.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2881"><a href="#validate_laser_mode_settings-2881"><span class="linenos">2881</span></a>                <span class="p">),</span>
</span><span id="validate_laser_mode_settings-2882"><a href="#validate_laser_mode_settings-2882"><span class="linenos">2882</span></a>                <span class="s2">&quot;pulses_per_pixel&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_mode_settings-2883"><a href="#validate_laser_mode_settings-2883"><span class="linenos">2883</span></a>                    <span class="nb">int</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2884"><a href="#validate_laser_mode_settings-2884"><span class="linenos">2884</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2885"><a href="#validate_laser_mode_settings-2885"><span class="linenos">2885</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pulses_per_pixel&#39; parameter is required for pattern type of &#39;fine&#39;. &#39;pulses_per_pixel&#39; must be a positive integer greater than 0. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pulses_per_pixel&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pulses_per_pixel&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2886"><a href="#validate_laser_mode_settings-2886"><span class="linenos">2886</span></a>                <span class="p">),</span>
</span><span id="validate_laser_mode_settings-2887"><a href="#validate_laser_mode_settings-2887"><span class="linenos">2887</span></a>            <span class="p">},</span>
</span><span id="validate_laser_mode_settings-2888"><a href="#validate_laser_mode_settings-2888"><span class="linenos">2888</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2889"><a href="#validate_laser_mode_settings-2889"><span class="linenos">2889</span></a>        <span class="p">)</span>
</span><span id="validate_laser_mode_settings-2890"><a href="#validate_laser_mode_settings-2890"><span class="linenos">2890</span></a>        <span class="n">schema_coarse</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_laser_mode_settings-2891"><a href="#validate_laser_mode_settings-2891"><span class="linenos">2891</span></a>            <span class="p">{</span>
</span><span id="validate_laser_mode_settings-2892"><a href="#validate_laser_mode_settings-2892"><span class="linenos">2892</span></a>                <span class="s2">&quot;pixel_dwell_ms&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_laser_mode_settings-2893"><a href="#validate_laser_mode_settings-2893"><span class="linenos">2893</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2894"><a href="#validate_laser_mode_settings-2894"><span class="linenos">2894</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2895"><a href="#validate_laser_mode_settings-2895"><span class="linenos">2895</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pixel_dwell_ms&#39; parameter is required for pattern type of &#39;coarse&#39;. &#39;pixel_dwell_ms&#39; must be a positive float greater than 0. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pixel_dwell_ms&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pixel_dwell_ms&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">) was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2896"><a href="#validate_laser_mode_settings-2896"><span class="linenos">2896</span></a>                <span class="p">),</span>
</span><span id="validate_laser_mode_settings-2897"><a href="#validate_laser_mode_settings-2897"><span class="linenos">2897</span></a>                <span class="s2">&quot;pulses_per_pixel&quot;</span><span class="p">:</span> <span class="n">Or</span><span class="p">(</span>
</span><span id="validate_laser_mode_settings-2898"><a href="#validate_laser_mode_settings-2898"><span class="linenos">2898</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2899"><a href="#validate_laser_mode_settings-2899"><span class="linenos">2899</span></a>                    <span class="s2">&quot;null&quot;</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2900"><a href="#validate_laser_mode_settings-2900"><span class="linenos">2900</span></a>                    <span class="s2">&quot;None&quot;</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2901"><a href="#validate_laser_mode_settings-2901"><span class="linenos">2901</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;, &#39;pulses_per_pixel&#39; parameter does not apply to the selected &#39;coarse&#39; milling mode. Set &#39;pulses_per_pixel&#39; to &#39;null&#39; &#39;None&#39; or leave the entry blank to continue.&quot;</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2902"><a href="#validate_laser_mode_settings-2902"><span class="linenos">2902</span></a>                <span class="p">),</span>
</span><span id="validate_laser_mode_settings-2903"><a href="#validate_laser_mode_settings-2903"><span class="linenos">2903</span></a>            <span class="p">},</span>
</span><span id="validate_laser_mode_settings-2904"><a href="#validate_laser_mode_settings-2904"><span class="linenos">2904</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_laser_mode_settings-2905"><a href="#validate_laser_mode_settings-2905"><span class="linenos">2905</span></a>        <span class="p">)</span>
</span><span id="validate_laser_mode_settings-2906"><a href="#validate_laser_mode_settings-2906"><span class="linenos">2906</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_laser_mode_settings-2907"><a href="#validate_laser_mode_settings-2907"><span class="linenos">2907</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_laser_mode_settings-2908"><a href="#validate_laser_mode_settings-2908"><span class="linenos">2908</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;fine&quot;</span><span class="p">:</span>
</span><span id="validate_laser_mode_settings-2909"><a href="#validate_laser_mode_settings-2909"><span class="linenos">2909</span></a>            <span class="n">schema_fine</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_laser_mode_settings-2910"><a href="#validate_laser_mode_settings-2910"><span class="linenos">2910</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;coarse&quot;</span><span class="p">:</span>
</span><span id="validate_laser_mode_settings-2911"><a href="#validate_laser_mode_settings-2911"><span class="linenos">2911</span></a>            <span class="n">schema_coarse</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_laser_mode_settings-2912"><a href="#validate_laser_mode_settings-2912"><span class="linenos">2912</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="validate_laser_mode_settings-2913"><a href="#validate_laser_mode_settings-2913"><span class="linenos">2913</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_laser_mode_settings-2914"><a href="#validate_laser_mode_settings-2914"><span class="linenos">2914</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="validate_laser_mode_settings-2915"><a href="#validate_laser_mode_settings-2915"><span class="linenos">2915</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for laser mode setting dictionary.</p>

<p>This function validates the laser mode settings dictionary based on the specified yml format.</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    The dictionary containing the laser mode settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
step_name : str
    The name of the step in the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>NotImplementedError
    If the laser pattern mode value is unsupported.
ValueError
    If the yml version is unsupported or if the settings do not satisfy the specified schema.</p>
</div>


                </section>
                <section id="validate_laser_pattern_settings">
                            <input id="validate_laser_pattern_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_laser_pattern_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#LaserPatternType">pytribeam.types.LaserPatternType</a></span>:</span></span>

                <label class="view-source-button" for="validate_laser_pattern_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_laser_pattern_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_laser_pattern_settings-2918"><a href="#validate_laser_pattern_settings-2918"><span class="linenos">2918</span></a><span class="k">def</span> <span class="nf">validate_laser_pattern_settings</span><span class="p">(</span>
</span><span id="validate_laser_pattern_settings-2919"><a href="#validate_laser_pattern_settings-2919"><span class="linenos">2919</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_laser_pattern_settings-2920"><a href="#validate_laser_pattern_settings-2920"><span class="linenos">2920</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_laser_pattern_settings-2921"><a href="#validate_laser_pattern_settings-2921"><span class="linenos">2921</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_laser_pattern_settings-2922"><a href="#validate_laser_pattern_settings-2922"><span class="linenos">2922</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="p">:</span>
</span><span id="validate_laser_pattern_settings-2923"><a href="#validate_laser_pattern_settings-2923"><span class="linenos">2923</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_laser_pattern_settings-2924"><a href="#validate_laser_pattern_settings-2924"><span class="linenos">2924</span></a><span class="sd">    Perform schema checking for laser pattern setting dictionary.</span>
</span><span id="validate_laser_pattern_settings-2925"><a href="#validate_laser_pattern_settings-2925"><span class="linenos">2925</span></a>
</span><span id="validate_laser_pattern_settings-2926"><a href="#validate_laser_pattern_settings-2926"><span class="linenos">2926</span></a><span class="sd">    This function validates the laser pattern settings dictionary based on the specified yml format and determines the type of pattern (box or line).</span>
</span><span id="validate_laser_pattern_settings-2927"><a href="#validate_laser_pattern_settings-2927"><span class="linenos">2927</span></a>
</span><span id="validate_laser_pattern_settings-2928"><a href="#validate_laser_pattern_settings-2928"><span class="linenos">2928</span></a><span class="sd">    Parameters</span>
</span><span id="validate_laser_pattern_settings-2929"><a href="#validate_laser_pattern_settings-2929"><span class="linenos">2929</span></a><span class="sd">    ----------</span>
</span><span id="validate_laser_pattern_settings-2930"><a href="#validate_laser_pattern_settings-2930"><span class="linenos">2930</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_laser_pattern_settings-2931"><a href="#validate_laser_pattern_settings-2931"><span class="linenos">2931</span></a><span class="sd">        The dictionary containing the laser pattern settings.</span>
</span><span id="validate_laser_pattern_settings-2932"><a href="#validate_laser_pattern_settings-2932"><span class="linenos">2932</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_laser_pattern_settings-2933"><a href="#validate_laser_pattern_settings-2933"><span class="linenos">2933</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_laser_pattern_settings-2934"><a href="#validate_laser_pattern_settings-2934"><span class="linenos">2934</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_laser_pattern_settings-2935"><a href="#validate_laser_pattern_settings-2935"><span class="linenos">2935</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_laser_pattern_settings-2936"><a href="#validate_laser_pattern_settings-2936"><span class="linenos">2936</span></a>
</span><span id="validate_laser_pattern_settings-2937"><a href="#validate_laser_pattern_settings-2937"><span class="linenos">2937</span></a><span class="sd">    Returns</span>
</span><span id="validate_laser_pattern_settings-2938"><a href="#validate_laser_pattern_settings-2938"><span class="linenos">2938</span></a><span class="sd">    -------</span>
</span><span id="validate_laser_pattern_settings-2939"><a href="#validate_laser_pattern_settings-2939"><span class="linenos">2939</span></a><span class="sd">    tbt.LaserPatternType</span>
</span><span id="validate_laser_pattern_settings-2940"><a href="#validate_laser_pattern_settings-2940"><span class="linenos">2940</span></a><span class="sd">        The type of the laser pattern (box or line).</span>
</span><span id="validate_laser_pattern_settings-2941"><a href="#validate_laser_pattern_settings-2941"><span class="linenos">2941</span></a>
</span><span id="validate_laser_pattern_settings-2942"><a href="#validate_laser_pattern_settings-2942"><span class="linenos">2942</span></a><span class="sd">    Raises</span>
</span><span id="validate_laser_pattern_settings-2943"><a href="#validate_laser_pattern_settings-2943"><span class="linenos">2943</span></a><span class="sd">    ------</span>
</span><span id="validate_laser_pattern_settings-2944"><a href="#validate_laser_pattern_settings-2944"><span class="linenos">2944</span></a><span class="sd">    KeyError</span>
</span><span id="validate_laser_pattern_settings-2945"><a href="#validate_laser_pattern_settings-2945"><span class="linenos">2945</span></a><span class="sd">        If required settings are missing from the .yml file or if multiple pattern types are specified.</span>
</span><span id="validate_laser_pattern_settings-2946"><a href="#validate_laser_pattern_settings-2946"><span class="linenos">2946</span></a><span class="sd">    ValueError</span>
</span><span id="validate_laser_pattern_settings-2947"><a href="#validate_laser_pattern_settings-2947"><span class="linenos">2947</span></a><span class="sd">        If the laser pattern settings are invalid.</span>
</span><span id="validate_laser_pattern_settings-2948"><a href="#validate_laser_pattern_settings-2948"><span class="linenos">2948</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_laser_pattern_settings-2949"><a href="#validate_laser_pattern_settings-2949"><span class="linenos">2949</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_laser_pattern_settings-2950"><a href="#validate_laser_pattern_settings-2950"><span class="linenos">2950</span></a>        <span class="c1"># determine type of pattern (only one allowed)</span>
</span><span id="validate_laser_pattern_settings-2951"><a href="#validate_laser_pattern_settings-2951"><span class="linenos">2951</span></a>        <span class="n">type_set_db</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="validate_laser_pattern_settings-2952"><a href="#validate_laser_pattern_settings-2952"><span class="linenos">2952</span></a>        <span class="k">if</span> <span class="n">type_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_laser_pattern_settings-2953"><a href="#validate_laser_pattern_settings-2953"><span class="linenos">2953</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="validate_laser_pattern_settings-2954"><a href="#validate_laser_pattern_settings-2954"><span class="linenos">2954</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;type&#39; settings sub-dictionary found in &#39;pattern&#39; settings in &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="validate_laser_pattern_settings-2955"><a href="#validate_laser_pattern_settings-2955"><span class="linenos">2955</span></a>            <span class="p">)</span>
</span><span id="validate_laser_pattern_settings-2956"><a href="#validate_laser_pattern_settings-2956"><span class="linenos">2956</span></a>
</span><span id="validate_laser_pattern_settings-2957"><a href="#validate_laser_pattern_settings-2957"><span class="linenos">2957</span></a>        <span class="n">box_settings</span> <span class="o">=</span> <span class="n">type_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
</span><span id="validate_laser_pattern_settings-2958"><a href="#validate_laser_pattern_settings-2958"><span class="linenos">2958</span></a>        <span class="n">line_settings</span> <span class="o">=</span> <span class="n">type_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">)</span>
</span><span id="validate_laser_pattern_settings-2959"><a href="#validate_laser_pattern_settings-2959"><span class="linenos">2959</span></a>        <span class="k">if</span> <span class="n">box_settings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_laser_pattern_settings-2960"><a href="#validate_laser_pattern_settings-2960"><span class="linenos">2960</span></a>            <span class="n">box_pattern</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="validate_laser_pattern_settings-2961"><a href="#validate_laser_pattern_settings-2961"><span class="linenos">2961</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="validate_laser_pattern_settings-2962"><a href="#validate_laser_pattern_settings-2962"><span class="linenos">2962</span></a>            <span class="n">box_pattern</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">none_value_dictionary</span><span class="p">(</span><span class="n">box_settings</span><span class="p">)</span>
</span><span id="validate_laser_pattern_settings-2963"><a href="#validate_laser_pattern_settings-2963"><span class="linenos">2963</span></a>        <span class="k">if</span> <span class="n">line_settings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_laser_pattern_settings-2964"><a href="#validate_laser_pattern_settings-2964"><span class="linenos">2964</span></a>            <span class="n">line_pattern</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="validate_laser_pattern_settings-2965"><a href="#validate_laser_pattern_settings-2965"><span class="linenos">2965</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="validate_laser_pattern_settings-2966"><a href="#validate_laser_pattern_settings-2966"><span class="linenos">2966</span></a>            <span class="n">line_pattern</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">none_value_dictionary</span><span class="p">(</span><span class="n">line_settings</span><span class="p">)</span>
</span><span id="validate_laser_pattern_settings-2967"><a href="#validate_laser_pattern_settings-2967"><span class="linenos">2967</span></a>        <span class="k">if</span> <span class="n">box_pattern</span> <span class="o">==</span> <span class="n">line_pattern</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="validate_laser_pattern_settings-2968"><a href="#validate_laser_pattern_settings-2968"><span class="linenos">2968</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="validate_laser_pattern_settings-2969"><a href="#validate_laser_pattern_settings-2969"><span class="linenos">2969</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file in &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. No pattern type settings found.&quot;</span>
</span><span id="validate_laser_pattern_settings-2970"><a href="#validate_laser_pattern_settings-2970"><span class="linenos">2970</span></a>            <span class="p">)</span>
</span><span id="validate_laser_pattern_settings-2971"><a href="#validate_laser_pattern_settings-2971"><span class="linenos">2971</span></a>        <span class="k">if</span> <span class="n">box_pattern</span> <span class="o">==</span> <span class="n">line_pattern</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="validate_laser_pattern_settings-2972"><a href="#validate_laser_pattern_settings-2972"><span class="linenos">2972</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="validate_laser_pattern_settings-2973"><a href="#validate_laser_pattern_settings-2973"><span class="linenos">2973</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file in &#39;laser&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. Pattern settings for one and only one type are allowed. Type settings found for both &#39;box&#39; and &#39;line&#39; type. Please leave one set of type settings completely blank, enter &#39;null&#39; for each parameter, or remove the unused subdictionary completely from the .yml file.&quot;</span>
</span><span id="validate_laser_pattern_settings-2974"><a href="#validate_laser_pattern_settings-2974"><span class="linenos">2974</span></a>            <span class="p">)</span>
</span><span id="validate_laser_pattern_settings-2975"><a href="#validate_laser_pattern_settings-2975"><span class="linenos">2975</span></a>        <span class="n">validate_laser_mode_settings</span><span class="p">(</span>
</span><span id="validate_laser_pattern_settings-2976"><a href="#validate_laser_pattern_settings-2976"><span class="linenos">2976</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
</span><span id="validate_laser_pattern_settings-2977"><a href="#validate_laser_pattern_settings-2977"><span class="linenos">2977</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="validate_laser_pattern_settings-2978"><a href="#validate_laser_pattern_settings-2978"><span class="linenos">2978</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="validate_laser_pattern_settings-2979"><a href="#validate_laser_pattern_settings-2979"><span class="linenos">2979</span></a>        <span class="p">)</span>
</span><span id="validate_laser_pattern_settings-2980"><a href="#validate_laser_pattern_settings-2980"><span class="linenos">2980</span></a>
</span><span id="validate_laser_pattern_settings-2981"><a href="#validate_laser_pattern_settings-2981"><span class="linenos">2981</span></a>        <span class="k">if</span> <span class="n">box_pattern</span><span class="p">:</span>
</span><span id="validate_laser_pattern_settings-2982"><a href="#validate_laser_pattern_settings-2982"><span class="linenos">2982</span></a>            <span class="n">validate_laser_box_settings</span><span class="p">(</span>
</span><span id="validate_laser_pattern_settings-2983"><a href="#validate_laser_pattern_settings-2983"><span class="linenos">2983</span></a>                <span class="n">settings</span><span class="o">=</span><span class="n">box_settings</span><span class="p">,</span>
</span><span id="validate_laser_pattern_settings-2984"><a href="#validate_laser_pattern_settings-2984"><span class="linenos">2984</span></a>                <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="validate_laser_pattern_settings-2985"><a href="#validate_laser_pattern_settings-2985"><span class="linenos">2985</span></a>                <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="validate_laser_pattern_settings-2986"><a href="#validate_laser_pattern_settings-2986"><span class="linenos">2986</span></a>            <span class="p">)</span>
</span><span id="validate_laser_pattern_settings-2987"><a href="#validate_laser_pattern_settings-2987"><span class="linenos">2987</span></a>            <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="o">.</span><span class="n">BOX</span>
</span><span id="validate_laser_pattern_settings-2988"><a href="#validate_laser_pattern_settings-2988"><span class="linenos">2988</span></a>        <span class="k">elif</span> <span class="n">line_pattern</span><span class="p">:</span>
</span><span id="validate_laser_pattern_settings-2989"><a href="#validate_laser_pattern_settings-2989"><span class="linenos">2989</span></a>            <span class="n">validate_laser_line_settings</span><span class="p">(</span>
</span><span id="validate_laser_pattern_settings-2990"><a href="#validate_laser_pattern_settings-2990"><span class="linenos">2990</span></a>                <span class="n">settings</span><span class="o">=</span><span class="n">line_settings</span><span class="p">,</span>
</span><span id="validate_laser_pattern_settings-2991"><a href="#validate_laser_pattern_settings-2991"><span class="linenos">2991</span></a>                <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="validate_laser_pattern_settings-2992"><a href="#validate_laser_pattern_settings-2992"><span class="linenos">2992</span></a>                <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="validate_laser_pattern_settings-2993"><a href="#validate_laser_pattern_settings-2993"><span class="linenos">2993</span></a>            <span class="p">)</span>
</span><span id="validate_laser_pattern_settings-2994"><a href="#validate_laser_pattern_settings-2994"><span class="linenos">2994</span></a>            <span class="k">return</span> <span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="o">.</span><span class="n">LINE</span>
</span><span id="validate_laser_pattern_settings-2995"><a href="#validate_laser_pattern_settings-2995"><span class="linenos">2995</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="validate_laser_pattern_settings-2996"><a href="#validate_laser_pattern_settings-2996"><span class="linenos">2996</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_laser_pattern_settings-2997"><a href="#validate_laser_pattern_settings-2997"><span class="linenos">2997</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid laser pattern settings for step </span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">. Supported types are </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">LaserPatternType</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="validate_laser_pattern_settings-2998"><a href="#validate_laser_pattern_settings-2998"><span class="linenos">2998</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for laser pattern setting dictionary.</p>

<p>This function validates the laser pattern settings dictionary based on the specified yml format and determines the type of pattern (box or line).</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    The dictionary containing the laser pattern settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
step_name : str
    The name of the step in the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>tbt.LaserPatternType
    The type of the laser pattern (box or line).</p>

<h2 id="raises">Raises</h2>

<p>KeyError
    If required settings are missing from the .yml file or if multiple pattern types are specified.
ValueError
    If the laser pattern settings are invalid.</p>
</div>


                </section>
                <section id="validate_fib_pattern_settings">
                            <input id="validate_fib_pattern_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_fib_pattern_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span>,</span><span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="types.html#FIBRectanglePattern">pytribeam.types.FIBRectanglePattern</a></span><span class="p">,</span> <span class="n"><a href="types.html#FIBRegularCrossSection">pytribeam.types.FIBRegularCrossSection</a></span><span class="p">,</span> <span class="n"><a href="types.html#FIBCleaningCrossSection">pytribeam.types.FIBCleaningCrossSection</a></span><span class="p">,</span> <span class="n"><a href="types.html#FIBStreamPattern">pytribeam.types.FIBStreamPattern</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="validate_fib_pattern_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_fib_pattern_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_fib_pattern_settings-3001"><a href="#validate_fib_pattern_settings-3001"><span class="linenos">3001</span></a><span class="k">def</span> <span class="nf">validate_fib_pattern_settings</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3002"><a href="#validate_fib_pattern_settings-3002"><span class="linenos">3002</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3003"><a href="#validate_fib_pattern_settings-3003"><span class="linenos">3003</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3004"><a href="#validate_fib_pattern_settings-3004"><span class="linenos">3004</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3005"><a href="#validate_fib_pattern_settings-3005"><span class="linenos">3005</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3006"><a href="#validate_fib_pattern_settings-3006"><span class="linenos">3006</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
</span><span id="validate_fib_pattern_settings-3007"><a href="#validate_fib_pattern_settings-3007"><span class="linenos">3007</span></a>    <span class="n">tbt</span><span class="o">.</span><span class="n">FIBRectanglePattern</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3008"><a href="#validate_fib_pattern_settings-3008"><span class="linenos">3008</span></a>    <span class="n">tbt</span><span class="o">.</span><span class="n">FIBRegularCrossSection</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3009"><a href="#validate_fib_pattern_settings-3009"><span class="linenos">3009</span></a>    <span class="n">tbt</span><span class="o">.</span><span class="n">FIBCleaningCrossSection</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3010"><a href="#validate_fib_pattern_settings-3010"><span class="linenos">3010</span></a>    <span class="n">tbt</span><span class="o">.</span><span class="n">FIBStreamPattern</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3011"><a href="#validate_fib_pattern_settings-3011"><span class="linenos">3011</span></a><span class="p">]:</span>
</span><span id="validate_fib_pattern_settings-3012"><a href="#validate_fib_pattern_settings-3012"><span class="linenos">3012</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_fib_pattern_settings-3013"><a href="#validate_fib_pattern_settings-3013"><span class="linenos">3013</span></a><span class="sd">    Perform schema checking for FIB pattern setting dictionary.</span>
</span><span id="validate_fib_pattern_settings-3014"><a href="#validate_fib_pattern_settings-3014"><span class="linenos">3014</span></a>
</span><span id="validate_fib_pattern_settings-3015"><a href="#validate_fib_pattern_settings-3015"><span class="linenos">3015</span></a><span class="sd">    This function validates the FIB pattern settings dictionary based on the specified yml format and determines the type of pattern (rectangle, regular cross section, cleaning cross section, or selected area).</span>
</span><span id="validate_fib_pattern_settings-3016"><a href="#validate_fib_pattern_settings-3016"><span class="linenos">3016</span></a>
</span><span id="validate_fib_pattern_settings-3017"><a href="#validate_fib_pattern_settings-3017"><span class="linenos">3017</span></a><span class="sd">    Parameters</span>
</span><span id="validate_fib_pattern_settings-3018"><a href="#validate_fib_pattern_settings-3018"><span class="linenos">3018</span></a><span class="sd">    ----------</span>
</span><span id="validate_fib_pattern_settings-3019"><a href="#validate_fib_pattern_settings-3019"><span class="linenos">3019</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="validate_fib_pattern_settings-3020"><a href="#validate_fib_pattern_settings-3020"><span class="linenos">3020</span></a><span class="sd">        The microscope object for which to validate the FIB pattern settings.</span>
</span><span id="validate_fib_pattern_settings-3021"><a href="#validate_fib_pattern_settings-3021"><span class="linenos">3021</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_fib_pattern_settings-3022"><a href="#validate_fib_pattern_settings-3022"><span class="linenos">3022</span></a><span class="sd">        The dictionary containing the FIB pattern settings.</span>
</span><span id="validate_fib_pattern_settings-3023"><a href="#validate_fib_pattern_settings-3023"><span class="linenos">3023</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_fib_pattern_settings-3024"><a href="#validate_fib_pattern_settings-3024"><span class="linenos">3024</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_fib_pattern_settings-3025"><a href="#validate_fib_pattern_settings-3025"><span class="linenos">3025</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_fib_pattern_settings-3026"><a href="#validate_fib_pattern_settings-3026"><span class="linenos">3026</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_fib_pattern_settings-3027"><a href="#validate_fib_pattern_settings-3027"><span class="linenos">3027</span></a>
</span><span id="validate_fib_pattern_settings-3028"><a href="#validate_fib_pattern_settings-3028"><span class="linenos">3028</span></a><span class="sd">    Returns</span>
</span><span id="validate_fib_pattern_settings-3029"><a href="#validate_fib_pattern_settings-3029"><span class="linenos">3029</span></a><span class="sd">    -------</span>
</span><span id="validate_fib_pattern_settings-3030"><a href="#validate_fib_pattern_settings-3030"><span class="linenos">3030</span></a><span class="sd">    Union[tbt.FIBRectanglePattern, tbt.FIBRegularCrossSection, tbt.FIBCleaningCrossSection, tbt.FIBStreamPattern]</span>
</span><span id="validate_fib_pattern_settings-3031"><a href="#validate_fib_pattern_settings-3031"><span class="linenos">3031</span></a><span class="sd">        The validated FIB pattern object.</span>
</span><span id="validate_fib_pattern_settings-3032"><a href="#validate_fib_pattern_settings-3032"><span class="linenos">3032</span></a>
</span><span id="validate_fib_pattern_settings-3033"><a href="#validate_fib_pattern_settings-3033"><span class="linenos">3033</span></a><span class="sd">    Raises</span>
</span><span id="validate_fib_pattern_settings-3034"><a href="#validate_fib_pattern_settings-3034"><span class="linenos">3034</span></a><span class="sd">    ------</span>
</span><span id="validate_fib_pattern_settings-3035"><a href="#validate_fib_pattern_settings-3035"><span class="linenos">3035</span></a><span class="sd">    KeyError</span>
</span><span id="validate_fib_pattern_settings-3036"><a href="#validate_fib_pattern_settings-3036"><span class="linenos">3036</span></a><span class="sd">        If required settings are missing from the .yml file or if multiple pattern types are specified.</span>
</span><span id="validate_fib_pattern_settings-3037"><a href="#validate_fib_pattern_settings-3037"><span class="linenos">3037</span></a><span class="sd">    ValueError</span>
</span><span id="validate_fib_pattern_settings-3038"><a href="#validate_fib_pattern_settings-3038"><span class="linenos">3038</span></a><span class="sd">        If the application file is unsupported or invalid for the specified pattern type.</span>
</span><span id="validate_fib_pattern_settings-3039"><a href="#validate_fib_pattern_settings-3039"><span class="linenos">3039</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_fib_pattern_settings-3040"><a href="#validate_fib_pattern_settings-3040"><span class="linenos">3040</span></a>
</span><span id="validate_fib_pattern_settings-3041"><a href="#validate_fib_pattern_settings-3041"><span class="linenos">3041</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3042"><a href="#validate_fib_pattern_settings-3042"><span class="linenos">3042</span></a>        <span class="n">application_file</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;application_file&quot;</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3043"><a href="#validate_fib_pattern_settings-3043"><span class="linenos">3043</span></a>        <span class="c1"># determine type of pattern (only one allowed)</span>
</span><span id="validate_fib_pattern_settings-3044"><a href="#validate_fib_pattern_settings-3044"><span class="linenos">3044</span></a>        <span class="n">type_set_db</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3045"><a href="#validate_fib_pattern_settings-3045"><span class="linenos">3045</span></a>        <span class="k">if</span> <span class="n">type_set_db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3046"><a href="#validate_fib_pattern_settings-3046"><span class="linenos">3046</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3047"><a href="#validate_fib_pattern_settings-3047"><span class="linenos">3047</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file, no &#39;type&#39; settings sub-dictionary found in &#39;pattern&#39; settings in &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="validate_fib_pattern_settings-3048"><a href="#validate_fib_pattern_settings-3048"><span class="linenos">3048</span></a>            <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3049"><a href="#validate_fib_pattern_settings-3049"><span class="linenos">3049</span></a>        <span class="n">rectangle_settings</span> <span class="o">=</span> <span class="n">type_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rectangle&quot;</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3050"><a href="#validate_fib_pattern_settings-3050"><span class="linenos">3050</span></a>        <span class="n">regular_cross_section_settings</span> <span class="o">=</span> <span class="n">type_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;regular_cross_section&quot;</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3051"><a href="#validate_fib_pattern_settings-3051"><span class="linenos">3051</span></a>        <span class="n">cleaning_cross_section_settings</span> <span class="o">=</span> <span class="n">type_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3052"><a href="#validate_fib_pattern_settings-3052"><span class="linenos">3052</span></a>        <span class="n">selected_area_settings</span> <span class="o">=</span> <span class="n">type_set_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selected_area&quot;</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3053"><a href="#validate_fib_pattern_settings-3053"><span class="linenos">3053</span></a>
</span><span id="validate_fib_pattern_settings-3054"><a href="#validate_fib_pattern_settings-3054"><span class="linenos">3054</span></a>        <span class="n">pattern_settings</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="validate_fib_pattern_settings-3055"><a href="#validate_fib_pattern_settings-3055"><span class="linenos">3055</span></a>            <span class="n">rectangle_settings</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3056"><a href="#validate_fib_pattern_settings-3056"><span class="linenos">3056</span></a>            <span class="n">regular_cross_section_settings</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3057"><a href="#validate_fib_pattern_settings-3057"><span class="linenos">3057</span></a>            <span class="n">cleaning_cross_section_settings</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3058"><a href="#validate_fib_pattern_settings-3058"><span class="linenos">3058</span></a>            <span class="n">selected_area_settings</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3059"><a href="#validate_fib_pattern_settings-3059"><span class="linenos">3059</span></a>        <span class="p">]</span>
</span><span id="validate_fib_pattern_settings-3060"><a href="#validate_fib_pattern_settings-3060"><span class="linenos">3060</span></a>        <span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3061"><a href="#validate_fib_pattern_settings-3061"><span class="linenos">3061</span></a>            <span class="n">rectangle_pattern</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3062"><a href="#validate_fib_pattern_settings-3062"><span class="linenos">3062</span></a>            <span class="n">regular_cross_section_pattern</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3063"><a href="#validate_fib_pattern_settings-3063"><span class="linenos">3063</span></a>            <span class="n">cleaning_cross_section_pattern</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3064"><a href="#validate_fib_pattern_settings-3064"><span class="linenos">3064</span></a>            <span class="n">selected_area_pattern</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3065"><a href="#validate_fib_pattern_settings-3065"><span class="linenos">3065</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3066"><a href="#validate_fib_pattern_settings-3066"><span class="linenos">3066</span></a>        <span class="c1"># pattern_names = [val.value for val in tbt.FIBPatternType]  # remembers order</span>
</span><span id="validate_fib_pattern_settings-3067"><a href="#validate_fib_pattern_settings-3067"><span class="linenos">3067</span></a>        <span class="c1"># assert pattern_names == [</span>
</span><span id="validate_fib_pattern_settings-3068"><a href="#validate_fib_pattern_settings-3068"><span class="linenos">3068</span></a>        <span class="c1">#     &quot;rectangle&quot;,</span>
</span><span id="validate_fib_pattern_settings-3069"><a href="#validate_fib_pattern_settings-3069"><span class="linenos">3069</span></a>        <span class="c1">#     &quot;regular_cross_section&quot;,</span>
</span><span id="validate_fib_pattern_settings-3070"><a href="#validate_fib_pattern_settings-3070"><span class="linenos">3070</span></a>        <span class="c1">#     &quot;cleaning_cross_section&quot;,</span>
</span><span id="validate_fib_pattern_settings-3071"><a href="#validate_fib_pattern_settings-3071"><span class="linenos">3071</span></a>        <span class="c1">#     &quot;selected_area&quot;,</span>
</span><span id="validate_fib_pattern_settings-3072"><a href="#validate_fib_pattern_settings-3072"><span class="linenos">3072</span></a>        <span class="c1"># ]</span>
</span><span id="validate_fib_pattern_settings-3073"><a href="#validate_fib_pattern_settings-3073"><span class="linenos">3073</span></a>        <span class="n">pattern_names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="validate_fib_pattern_settings-3074"><a href="#validate_fib_pattern_settings-3074"><span class="linenos">3074</span></a>            <span class="s2">&quot;rectangle&quot;</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3075"><a href="#validate_fib_pattern_settings-3075"><span class="linenos">3075</span></a>            <span class="s2">&quot;regular_cross_section&quot;</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3076"><a href="#validate_fib_pattern_settings-3076"><span class="linenos">3076</span></a>            <span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3077"><a href="#validate_fib_pattern_settings-3077"><span class="linenos">3077</span></a>            <span class="s2">&quot;selected_area&quot;</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3078"><a href="#validate_fib_pattern_settings-3078"><span class="linenos">3078</span></a>        <span class="p">]</span>
</span><span id="validate_fib_pattern_settings-3079"><a href="#validate_fib_pattern_settings-3079"><span class="linenos">3079</span></a>        <span class="n">pattern_types</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="validate_fib_pattern_settings-3080"><a href="#validate_fib_pattern_settings-3080"><span class="linenos">3080</span></a>            <span class="n">rectangle_pattern</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3081"><a href="#validate_fib_pattern_settings-3081"><span class="linenos">3081</span></a>            <span class="n">regular_cross_section_pattern</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3082"><a href="#validate_fib_pattern_settings-3082"><span class="linenos">3082</span></a>            <span class="n">cleaning_cross_section_pattern</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3083"><a href="#validate_fib_pattern_settings-3083"><span class="linenos">3083</span></a>            <span class="n">selected_area_pattern</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3084"><a href="#validate_fib_pattern_settings-3084"><span class="linenos">3084</span></a>        <span class="p">]</span>
</span><span id="validate_fib_pattern_settings-3085"><a href="#validate_fib_pattern_settings-3085"><span class="linenos">3085</span></a>
</span><span id="validate_fib_pattern_settings-3086"><a href="#validate_fib_pattern_settings-3086"><span class="linenos">3086</span></a>        <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pattern_settings</span><span class="p">)):</span>
</span><span id="validate_fib_pattern_settings-3087"><a href="#validate_fib_pattern_settings-3087"><span class="linenos">3087</span></a>            <span class="n">db</span> <span class="o">=</span> <span class="n">pattern_settings</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span>
</span><span id="validate_fib_pattern_settings-3088"><a href="#validate_fib_pattern_settings-3088"><span class="linenos">3088</span></a>            <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3089"><a href="#validate_fib_pattern_settings-3089"><span class="linenos">3089</span></a>                <span class="n">pattern_types</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="validate_fib_pattern_settings-3090"><a href="#validate_fib_pattern_settings-3090"><span class="linenos">3090</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3091"><a href="#validate_fib_pattern_settings-3091"><span class="linenos">3091</span></a>                <span class="n">pattern_types</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">none_value_dictionary</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3092"><a href="#validate_fib_pattern_settings-3092"><span class="linenos">3092</span></a>
</span><span id="validate_fib_pattern_settings-3093"><a href="#validate_fib_pattern_settings-3093"><span class="linenos">3093</span></a>        <span class="c1"># one and only one type of pattern can have settings</span>
</span><span id="validate_fib_pattern_settings-3094"><a href="#validate_fib_pattern_settings-3094"><span class="linenos">3094</span></a>        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pattern_types</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3095"><a href="#validate_fib_pattern_settings-3095"><span class="linenos">3095</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3096"><a href="#validate_fib_pattern_settings-3096"><span class="linenos">3096</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid .yml file in &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. Pattern settings for one and only one type are allowed. Please provide settings for only one of the supported pattern types: </span><span class="si">{</span><span class="p">[</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">pattern_names</span><span class="p">]</span><span class="si">}</span><span class="s2">. For unused pattern types, leave the type settings completely blank, enter &#39;null&#39; for each parameter, or remove the unused subdictionary completely from the .yml file.&quot;</span>
</span><span id="validate_fib_pattern_settings-3097"><a href="#validate_fib_pattern_settings-3097"><span class="linenos">3097</span></a>            <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3098"><a href="#validate_fib_pattern_settings-3098"><span class="linenos">3098</span></a>        <span class="n">pattern_type</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="p">(</span><span class="n">pattern_names</span><span class="p">[</span><span class="n">pattern_types</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="kc">True</span><span class="p">)])</span>
</span><span id="validate_fib_pattern_settings-3099"><a href="#validate_fib_pattern_settings-3099"><span class="linenos">3099</span></a>
</span><span id="validate_fib_pattern_settings-3100"><a href="#validate_fib_pattern_settings-3100"><span class="linenos">3100</span></a>    <span class="c1"># check application file</span>
</span><span id="validate_fib_pattern_settings-3101"><a href="#validate_fib_pattern_settings-3101"><span class="linenos">3101</span></a>    <span class="n">valid_applications</span> <span class="o">=</span> <span class="n">application_files</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3102"><a href="#validate_fib_pattern_settings-3102"><span class="linenos">3102</span></a>    <span class="c1"># TODO make this print out pretty</span>
</span><span id="validate_fib_pattern_settings-3103"><a href="#validate_fib_pattern_settings-3103"><span class="linenos">3103</span></a>    <span class="c1"># display_applications = &quot;,&quot;.join(valid_applications)</span>
</span><span id="validate_fib_pattern_settings-3104"><a href="#validate_fib_pattern_settings-3104"><span class="linenos">3104</span></a>    <span class="c1"># display_applications = ut.tabular_list(data=valid_applications)</span>
</span><span id="validate_fib_pattern_settings-3105"><a href="#validate_fib_pattern_settings-3105"><span class="linenos">3105</span></a>    <span class="k">if</span> <span class="n">application_file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_applications</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3106"><a href="#validate_fib_pattern_settings-3106"><span class="linenos">3106</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3107"><a href="#validate_fib_pattern_settings-3107"><span class="linenos">3107</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported FIB application file of &#39;</span><span class="si">{</span><span class="n">application_file</span><span class="si">}</span><span class="s2">&#39; on step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">. Supported applications on this microscope are: </span><span class="se">\n</span><span class="si">{</span><span class="n">valid_applications</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="validate_fib_pattern_settings-3108"><a href="#validate_fib_pattern_settings-3108"><span class="linenos">3108</span></a>        <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3109"><a href="#validate_fib_pattern_settings-3109"><span class="linenos">3109</span></a>
</span><span id="validate_fib_pattern_settings-3110"><a href="#validate_fib_pattern_settings-3110"><span class="linenos">3110</span></a>    <span class="k">if</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="o">.</span><span class="n">RECTANGLE</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3111"><a href="#validate_fib_pattern_settings-3111"><span class="linenos">3111</span></a>        <span class="n">validate_fib_box_settings</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3112"><a href="#validate_fib_pattern_settings-3112"><span class="linenos">3112</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">rectangle_settings</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3113"><a href="#validate_fib_pattern_settings-3113"><span class="linenos">3113</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3114"><a href="#validate_fib_pattern_settings-3114"><span class="linenos">3114</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3115"><a href="#validate_fib_pattern_settings-3115"><span class="linenos">3115</span></a>            <span class="n">pattern_type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3116"><a href="#validate_fib_pattern_settings-3116"><span class="linenos">3116</span></a>        <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3117"><a href="#validate_fib_pattern_settings-3117"><span class="linenos">3117</span></a>
</span><span id="validate_fib_pattern_settings-3118"><a href="#validate_fib_pattern_settings-3118"><span class="linenos">3118</span></a>        <span class="n">pattern</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPattern</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3119"><a href="#validate_fib_pattern_settings-3119"><span class="linenos">3119</span></a>            <span class="n">application</span><span class="o">=</span><span class="n">application_file</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3120"><a href="#validate_fib_pattern_settings-3120"><span class="linenos">3120</span></a>            <span class="nb">type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3121"><a href="#validate_fib_pattern_settings-3121"><span class="linenos">3121</span></a>            <span class="n">geometry</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBRectanglePattern</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3122"><a href="#validate_fib_pattern_settings-3122"><span class="linenos">3122</span></a>                <span class="n">center_um</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3123"><a href="#validate_fib_pattern_settings-3123"><span class="linenos">3123</span></a>                    <span class="n">x</span><span class="o">=</span><span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3124"><a href="#validate_fib_pattern_settings-3124"><span class="linenos">3124</span></a>                    <span class="n">y</span><span class="o">=</span><span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3125"><a href="#validate_fib_pattern_settings-3125"><span class="linenos">3125</span></a>                <span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3126"><a href="#validate_fib_pattern_settings-3126"><span class="linenos">3126</span></a>                <span class="n">width_um</span><span class="o">=</span><span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;width_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3127"><a href="#validate_fib_pattern_settings-3127"><span class="linenos">3127</span></a>                <span class="n">height_um</span><span class="o">=</span><span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;height_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3128"><a href="#validate_fib_pattern_settings-3128"><span class="linenos">3128</span></a>                <span class="n">depth_um</span><span class="o">=</span><span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;depth_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3129"><a href="#validate_fib_pattern_settings-3129"><span class="linenos">3129</span></a>                <span class="n">scan_direction</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanDirection</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3130"><a href="#validate_fib_pattern_settings-3130"><span class="linenos">3130</span></a>                    <span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3131"><a href="#validate_fib_pattern_settings-3131"><span class="linenos">3131</span></a>                <span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3132"><a href="#validate_fib_pattern_settings-3132"><span class="linenos">3132</span></a>                <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanType</span><span class="p">(</span><span class="n">rectangle_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_type&quot;</span><span class="p">)),</span>
</span><span id="validate_fib_pattern_settings-3133"><a href="#validate_fib_pattern_settings-3133"><span class="linenos">3133</span></a>            <span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3134"><a href="#validate_fib_pattern_settings-3134"><span class="linenos">3134</span></a>        <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3135"><a href="#validate_fib_pattern_settings-3135"><span class="linenos">3135</span></a>        <span class="c1"># make sure application file is valid for this pattern type:</span>
</span><span id="validate_fib_pattern_settings-3136"><a href="#validate_fib_pattern_settings-3136"><span class="linenos">3136</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3137"><a href="#validate_fib_pattern_settings-3137"><span class="linenos">3137</span></a>            <span class="n">geometry</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">geometry</span>
</span><span id="validate_fib_pattern_settings-3138"><a href="#validate_fib_pattern_settings-3138"><span class="linenos">3138</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">set_default_application_file</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3139"><a href="#validate_fib_pattern_settings-3139"><span class="linenos">3139</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3140"><a href="#validate_fib_pattern_settings-3140"><span class="linenos">3140</span></a>                <span class="n">center_x</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">center_um</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3141"><a href="#validate_fib_pattern_settings-3141"><span class="linenos">3141</span></a>                <span class="n">center_y</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">center_um</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3142"><a href="#validate_fib_pattern_settings-3142"><span class="linenos">3142</span></a>                <span class="n">width</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">width_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3143"><a href="#validate_fib_pattern_settings-3143"><span class="linenos">3143</span></a>                <span class="n">height</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">height_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3144"><a href="#validate_fib_pattern_settings-3144"><span class="linenos">3144</span></a>                <span class="n">depth</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">depth_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3145"><a href="#validate_fib_pattern_settings-3145"><span class="linenos">3145</span></a>            <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3146"><a href="#validate_fib_pattern_settings-3146"><span class="linenos">3146</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">clear_patterns</span><span class="p">()</span>
</span><span id="validate_fib_pattern_settings-3147"><a href="#validate_fib_pattern_settings-3147"><span class="linenos">3147</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3148"><a href="#validate_fib_pattern_settings-3148"><span class="linenos">3148</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3149"><a href="#validate_fib_pattern_settings-3149"><span class="linenos">3149</span></a>                <span class="sa">f</span><span class="s1">&#39;Invalid application file of &quot;</span><span class="si">{</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="si">}</span><span class="s1">&quot; for Rectangle pattern type. Please select or create an appropriate application file.&#39;</span>
</span><span id="validate_fib_pattern_settings-3150"><a href="#validate_fib_pattern_settings-3150"><span class="linenos">3150</span></a>            <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3151"><a href="#validate_fib_pattern_settings-3151"><span class="linenos">3151</span></a>
</span><span id="validate_fib_pattern_settings-3152"><a href="#validate_fib_pattern_settings-3152"><span class="linenos">3152</span></a>        <span class="k">return</span> <span class="n">pattern</span>
</span><span id="validate_fib_pattern_settings-3153"><a href="#validate_fib_pattern_settings-3153"><span class="linenos">3153</span></a>    <span class="k">elif</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="o">.</span><span class="n">REGULAR_CROSS_SECTION</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3154"><a href="#validate_fib_pattern_settings-3154"><span class="linenos">3154</span></a>        <span class="n">validate_fib_box_settings</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3155"><a href="#validate_fib_pattern_settings-3155"><span class="linenos">3155</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">regular_cross_section_settings</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3156"><a href="#validate_fib_pattern_settings-3156"><span class="linenos">3156</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3157"><a href="#validate_fib_pattern_settings-3157"><span class="linenos">3157</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3158"><a href="#validate_fib_pattern_settings-3158"><span class="linenos">3158</span></a>            <span class="n">pattern_type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3159"><a href="#validate_fib_pattern_settings-3159"><span class="linenos">3159</span></a>        <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3160"><a href="#validate_fib_pattern_settings-3160"><span class="linenos">3160</span></a>        <span class="n">pattern</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPattern</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3161"><a href="#validate_fib_pattern_settings-3161"><span class="linenos">3161</span></a>            <span class="n">application</span><span class="o">=</span><span class="n">application_file</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3162"><a href="#validate_fib_pattern_settings-3162"><span class="linenos">3162</span></a>            <span class="nb">type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3163"><a href="#validate_fib_pattern_settings-3163"><span class="linenos">3163</span></a>            <span class="n">geometry</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBRegularCrossSection</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3164"><a href="#validate_fib_pattern_settings-3164"><span class="linenos">3164</span></a>                <span class="n">center_um</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3165"><a href="#validate_fib_pattern_settings-3165"><span class="linenos">3165</span></a>                    <span class="n">x</span><span class="o">=</span><span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3166"><a href="#validate_fib_pattern_settings-3166"><span class="linenos">3166</span></a>                    <span class="n">y</span><span class="o">=</span><span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3167"><a href="#validate_fib_pattern_settings-3167"><span class="linenos">3167</span></a>                <span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3168"><a href="#validate_fib_pattern_settings-3168"><span class="linenos">3168</span></a>                <span class="n">width_um</span><span class="o">=</span><span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;width_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3169"><a href="#validate_fib_pattern_settings-3169"><span class="linenos">3169</span></a>                <span class="n">height_um</span><span class="o">=</span><span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;height_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3170"><a href="#validate_fib_pattern_settings-3170"><span class="linenos">3170</span></a>                <span class="n">depth_um</span><span class="o">=</span><span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;depth_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3171"><a href="#validate_fib_pattern_settings-3171"><span class="linenos">3171</span></a>                <span class="n">scan_direction</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanDirection</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3172"><a href="#validate_fib_pattern_settings-3172"><span class="linenos">3172</span></a>                    <span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3173"><a href="#validate_fib_pattern_settings-3173"><span class="linenos">3173</span></a>                <span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3174"><a href="#validate_fib_pattern_settings-3174"><span class="linenos">3174</span></a>                <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanType</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3175"><a href="#validate_fib_pattern_settings-3175"><span class="linenos">3175</span></a>                    <span class="n">regular_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_type&quot;</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3176"><a href="#validate_fib_pattern_settings-3176"><span class="linenos">3176</span></a>                <span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3177"><a href="#validate_fib_pattern_settings-3177"><span class="linenos">3177</span></a>            <span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3178"><a href="#validate_fib_pattern_settings-3178"><span class="linenos">3178</span></a>        <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3179"><a href="#validate_fib_pattern_settings-3179"><span class="linenos">3179</span></a>        <span class="c1"># make sure application file is valid for this pattern type:</span>
</span><span id="validate_fib_pattern_settings-3180"><a href="#validate_fib_pattern_settings-3180"><span class="linenos">3180</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3181"><a href="#validate_fib_pattern_settings-3181"><span class="linenos">3181</span></a>            <span class="n">geometry</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">geometry</span>
</span><span id="validate_fib_pattern_settings-3182"><a href="#validate_fib_pattern_settings-3182"><span class="linenos">3182</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">set_default_application_file</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3183"><a href="#validate_fib_pattern_settings-3183"><span class="linenos">3183</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">create_regular_cross_section</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3184"><a href="#validate_fib_pattern_settings-3184"><span class="linenos">3184</span></a>                <span class="n">center_x</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">center_um</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3185"><a href="#validate_fib_pattern_settings-3185"><span class="linenos">3185</span></a>                <span class="n">center_y</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">center_um</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3186"><a href="#validate_fib_pattern_settings-3186"><span class="linenos">3186</span></a>                <span class="n">width</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">width_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3187"><a href="#validate_fib_pattern_settings-3187"><span class="linenos">3187</span></a>                <span class="n">height</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">height_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3188"><a href="#validate_fib_pattern_settings-3188"><span class="linenos">3188</span></a>                <span class="n">depth</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">depth_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3189"><a href="#validate_fib_pattern_settings-3189"><span class="linenos">3189</span></a>            <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3190"><a href="#validate_fib_pattern_settings-3190"><span class="linenos">3190</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">clear_patterns</span><span class="p">()</span>
</span><span id="validate_fib_pattern_settings-3191"><a href="#validate_fib_pattern_settings-3191"><span class="linenos">3191</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3192"><a href="#validate_fib_pattern_settings-3192"><span class="linenos">3192</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3193"><a href="#validate_fib_pattern_settings-3193"><span class="linenos">3193</span></a>                <span class="sa">f</span><span class="s1">&#39;Invalid application file of &quot;</span><span class="si">{</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="si">}</span><span class="s1">&quot; for Regular Cross Section pattern type. Please select or create an appropriate application file.&#39;</span>
</span><span id="validate_fib_pattern_settings-3194"><a href="#validate_fib_pattern_settings-3194"><span class="linenos">3194</span></a>            <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3195"><a href="#validate_fib_pattern_settings-3195"><span class="linenos">3195</span></a>        <span class="k">return</span> <span class="n">pattern</span>
</span><span id="validate_fib_pattern_settings-3196"><a href="#validate_fib_pattern_settings-3196"><span class="linenos">3196</span></a>    <span class="k">elif</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="o">.</span><span class="n">CLEANING_CROSS_SECTION</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3197"><a href="#validate_fib_pattern_settings-3197"><span class="linenos">3197</span></a>        <span class="n">validate_fib_box_settings</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3198"><a href="#validate_fib_pattern_settings-3198"><span class="linenos">3198</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">cleaning_cross_section_settings</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3199"><a href="#validate_fib_pattern_settings-3199"><span class="linenos">3199</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3200"><a href="#validate_fib_pattern_settings-3200"><span class="linenos">3200</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3201"><a href="#validate_fib_pattern_settings-3201"><span class="linenos">3201</span></a>            <span class="n">pattern_type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3202"><a href="#validate_fib_pattern_settings-3202"><span class="linenos">3202</span></a>        <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3203"><a href="#validate_fib_pattern_settings-3203"><span class="linenos">3203</span></a>        <span class="n">pattern</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPattern</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3204"><a href="#validate_fib_pattern_settings-3204"><span class="linenos">3204</span></a>            <span class="n">application</span><span class="o">=</span><span class="n">application_file</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3205"><a href="#validate_fib_pattern_settings-3205"><span class="linenos">3205</span></a>            <span class="nb">type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3206"><a href="#validate_fib_pattern_settings-3206"><span class="linenos">3206</span></a>            <span class="n">geometry</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBCleaningCrossSection</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3207"><a href="#validate_fib_pattern_settings-3207"><span class="linenos">3207</span></a>                <span class="n">center_um</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3208"><a href="#validate_fib_pattern_settings-3208"><span class="linenos">3208</span></a>                    <span class="n">x</span><span class="o">=</span><span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3209"><a href="#validate_fib_pattern_settings-3209"><span class="linenos">3209</span></a>                    <span class="n">y</span><span class="o">=</span><span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3210"><a href="#validate_fib_pattern_settings-3210"><span class="linenos">3210</span></a>                <span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3211"><a href="#validate_fib_pattern_settings-3211"><span class="linenos">3211</span></a>                <span class="n">width_um</span><span class="o">=</span><span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;width_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3212"><a href="#validate_fib_pattern_settings-3212"><span class="linenos">3212</span></a>                <span class="n">height_um</span><span class="o">=</span><span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;height_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3213"><a href="#validate_fib_pattern_settings-3213"><span class="linenos">3213</span></a>                <span class="n">depth_um</span><span class="o">=</span><span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;depth_um&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3214"><a href="#validate_fib_pattern_settings-3214"><span class="linenos">3214</span></a>                <span class="n">scan_direction</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanDirection</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3215"><a href="#validate_fib_pattern_settings-3215"><span class="linenos">3215</span></a>                    <span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3216"><a href="#validate_fib_pattern_settings-3216"><span class="linenos">3216</span></a>                <span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3217"><a href="#validate_fib_pattern_settings-3217"><span class="linenos">3217</span></a>                <span class="n">scan_type</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanType</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3218"><a href="#validate_fib_pattern_settings-3218"><span class="linenos">3218</span></a>                    <span class="n">cleaning_cross_section_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_type&quot;</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3219"><a href="#validate_fib_pattern_settings-3219"><span class="linenos">3219</span></a>                <span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3220"><a href="#validate_fib_pattern_settings-3220"><span class="linenos">3220</span></a>            <span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3221"><a href="#validate_fib_pattern_settings-3221"><span class="linenos">3221</span></a>        <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3222"><a href="#validate_fib_pattern_settings-3222"><span class="linenos">3222</span></a>        <span class="c1"># make sure application file is valid for this pattern type:</span>
</span><span id="validate_fib_pattern_settings-3223"><a href="#validate_fib_pattern_settings-3223"><span class="linenos">3223</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3224"><a href="#validate_fib_pattern_settings-3224"><span class="linenos">3224</span></a>            <span class="n">geometry</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">geometry</span>
</span><span id="validate_fib_pattern_settings-3225"><a href="#validate_fib_pattern_settings-3225"><span class="linenos">3225</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">set_default_application_file</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3226"><a href="#validate_fib_pattern_settings-3226"><span class="linenos">3226</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">create_cleaning_cross_section</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3227"><a href="#validate_fib_pattern_settings-3227"><span class="linenos">3227</span></a>                <span class="n">center_x</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">center_um</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3228"><a href="#validate_fib_pattern_settings-3228"><span class="linenos">3228</span></a>                <span class="n">center_y</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">center_um</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3229"><a href="#validate_fib_pattern_settings-3229"><span class="linenos">3229</span></a>                <span class="n">width</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">width_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3230"><a href="#validate_fib_pattern_settings-3230"><span class="linenos">3230</span></a>                <span class="n">height</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">height_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3231"><a href="#validate_fib_pattern_settings-3231"><span class="linenos">3231</span></a>                <span class="n">depth</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">depth_um</span> <span class="o">*</span> <span class="n">Conversions</span><span class="o">.</span><span class="n">UM_TO_M</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3232"><a href="#validate_fib_pattern_settings-3232"><span class="linenos">3232</span></a>            <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3233"><a href="#validate_fib_pattern_settings-3233"><span class="linenos">3233</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">clear_patterns</span><span class="p">()</span>
</span><span id="validate_fib_pattern_settings-3234"><a href="#validate_fib_pattern_settings-3234"><span class="linenos">3234</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3235"><a href="#validate_fib_pattern_settings-3235"><span class="linenos">3235</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3236"><a href="#validate_fib_pattern_settings-3236"><span class="linenos">3236</span></a>                <span class="sa">f</span><span class="s1">&#39;Invalid application file of &quot;</span><span class="si">{</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="si">}</span><span class="s1">&quot; for Cleaning Cross Section pattern type. Please select or create an appropriate application file.&#39;</span>
</span><span id="validate_fib_pattern_settings-3237"><a href="#validate_fib_pattern_settings-3237"><span class="linenos">3237</span></a>            <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3238"><a href="#validate_fib_pattern_settings-3238"><span class="linenos">3238</span></a>        <span class="k">return</span> <span class="n">pattern</span>
</span><span id="validate_fib_pattern_settings-3239"><a href="#validate_fib_pattern_settings-3239"><span class="linenos">3239</span></a>    <span class="k">elif</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="o">.</span><span class="n">SELECTED_AREA</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3240"><a href="#validate_fib_pattern_settings-3240"><span class="linenos">3240</span></a>        <span class="n">validate_fib_selected_area_settings</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3241"><a href="#validate_fib_pattern_settings-3241"><span class="linenos">3241</span></a>            <span class="n">settings</span><span class="o">=</span><span class="n">selected_area_settings</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3242"><a href="#validate_fib_pattern_settings-3242"><span class="linenos">3242</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3243"><a href="#validate_fib_pattern_settings-3243"><span class="linenos">3243</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3244"><a href="#validate_fib_pattern_settings-3244"><span class="linenos">3244</span></a>            <span class="n">pattern_type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3245"><a href="#validate_fib_pattern_settings-3245"><span class="linenos">3245</span></a>        <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3246"><a href="#validate_fib_pattern_settings-3246"><span class="linenos">3246</span></a>        <span class="n">pattern</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPattern</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3247"><a href="#validate_fib_pattern_settings-3247"><span class="linenos">3247</span></a>            <span class="n">application</span><span class="o">=</span><span class="n">application_file</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3248"><a href="#validate_fib_pattern_settings-3248"><span class="linenos">3248</span></a>            <span class="nb">type</span><span class="o">=</span><span class="n">pattern_type</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3249"><a href="#validate_fib_pattern_settings-3249"><span class="linenos">3249</span></a>            <span class="n">geometry</span><span class="o">=</span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBStreamPattern</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3250"><a href="#validate_fib_pattern_settings-3250"><span class="linenos">3250</span></a>                <span class="n">dwell_us</span><span class="o">=</span><span class="n">selected_area_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dwell_us&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3251"><a href="#validate_fib_pattern_settings-3251"><span class="linenos">3251</span></a>                <span class="n">repeats</span><span class="o">=</span><span class="n">selected_area_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;repeats&quot;</span><span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3252"><a href="#validate_fib_pattern_settings-3252"><span class="linenos">3252</span></a>                <span class="n">recipe</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">selected_area_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;recipe_file&quot;</span><span class="p">)),</span>
</span><span id="validate_fib_pattern_settings-3253"><a href="#validate_fib_pattern_settings-3253"><span class="linenos">3253</span></a>                <span class="n">mask</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">selected_area_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mask_file&quot;</span><span class="p">)),</span>
</span><span id="validate_fib_pattern_settings-3254"><a href="#validate_fib_pattern_settings-3254"><span class="linenos">3254</span></a>            <span class="p">),</span>
</span><span id="validate_fib_pattern_settings-3255"><a href="#validate_fib_pattern_settings-3255"><span class="linenos">3255</span></a>        <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3256"><a href="#validate_fib_pattern_settings-3256"><span class="linenos">3256</span></a>
</span><span id="validate_fib_pattern_settings-3257"><a href="#validate_fib_pattern_settings-3257"><span class="linenos">3257</span></a>        <span class="c1"># make sure application file is valid for this pattern type:</span>
</span><span id="validate_fib_pattern_settings-3258"><a href="#validate_fib_pattern_settings-3258"><span class="linenos">3258</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3259"><a href="#validate_fib_pattern_settings-3259"><span class="linenos">3259</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">set_default_application_file</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3260"><a href="#validate_fib_pattern_settings-3260"><span class="linenos">3260</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3261"><a href="#validate_fib_pattern_settings-3261"><span class="linenos">3261</span></a>                <span class="n">center_x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3262"><a href="#validate_fib_pattern_settings-3262"><span class="linenos">3262</span></a>                <span class="n">center_y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3263"><a href="#validate_fib_pattern_settings-3263"><span class="linenos">3263</span></a>                <span class="n">width</span><span class="o">=</span><span class="mf">10.0e-6</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3264"><a href="#validate_fib_pattern_settings-3264"><span class="linenos">3264</span></a>                <span class="n">height</span><span class="o">=</span><span class="mf">10.0e-6</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3265"><a href="#validate_fib_pattern_settings-3265"><span class="linenos">3265</span></a>                <span class="n">depth</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">,</span>
</span><span id="validate_fib_pattern_settings-3266"><a href="#validate_fib_pattern_settings-3266"><span class="linenos">3266</span></a>            <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3267"><a href="#validate_fib_pattern_settings-3267"><span class="linenos">3267</span></a>            <span class="n">microscope</span><span class="o">.</span><span class="n">patterning</span><span class="o">.</span><span class="n">clear_patterns</span><span class="p">()</span>
</span><span id="validate_fib_pattern_settings-3268"><a href="#validate_fib_pattern_settings-3268"><span class="linenos">3268</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3269"><a href="#validate_fib_pattern_settings-3269"><span class="linenos">3269</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3270"><a href="#validate_fib_pattern_settings-3270"><span class="linenos">3270</span></a>                <span class="sa">f</span><span class="s1">&#39;Invalid application file of &quot;</span><span class="si">{</span><span class="n">pattern</span><span class="o">.</span><span class="n">application</span><span class="si">}</span><span class="s1">&quot; for Selected Area pattern. Please use an application file for Rectangle milling.&#39;</span>
</span><span id="validate_fib_pattern_settings-3271"><a href="#validate_fib_pattern_settings-3271"><span class="linenos">3271</span></a>            <span class="p">)</span>
</span><span id="validate_fib_pattern_settings-3272"><a href="#validate_fib_pattern_settings-3272"><span class="linenos">3272</span></a>
</span><span id="validate_fib_pattern_settings-3273"><a href="#validate_fib_pattern_settings-3273"><span class="linenos">3273</span></a>        <span class="k">return</span> <span class="n">pattern</span>
</span><span id="validate_fib_pattern_settings-3274"><a href="#validate_fib_pattern_settings-3274"><span class="linenos">3274</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="validate_fib_pattern_settings-3275"><a href="#validate_fib_pattern_settings-3275"><span class="linenos">3275</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="validate_fib_pattern_settings-3276"><a href="#validate_fib_pattern_settings-3276"><span class="linenos">3276</span></a>            <span class="sa">f</span><span class="s2">&quot;Invalid pattern type of </span><span class="si">{</span><span class="n">pattern_type</span><span class="si">}</span><span class="s2">. Supported pattern types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="validate_fib_pattern_settings-3277"><a href="#validate_fib_pattern_settings-3277"><span class="linenos">3277</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for FIB pattern setting dictionary.</p>

<p>This function validates the FIB pattern settings dictionary based on the specified yml format and determines the type of pattern (rectangle, regular cross section, cleaning cross section, or selected area).</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object for which to validate the FIB pattern settings.
settings : dict
    The dictionary containing the FIB pattern settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
step_name : str
    The name of the step in the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>Union[tbt.FIBRectanglePattern, tbt.FIBRegularCrossSection, tbt.FIBCleaningCrossSection, tbt.FIBStreamPattern]
    The validated FIB pattern object.</p>

<h2 id="raises">Raises</h2>

<p>KeyError
    If required settings are missing from the .yml file or if multiple pattern types are specified.
ValueError
    If the application file is unsupported or invalid for the specified pattern type.</p>
</div>


                </section>
                <section id="validate_fib_box_settings">
                            <input id="validate_fib_box_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_fib_box_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pattern_type</span><span class="p">:</span> <span class="n"><a href="types.html#FIBPatternType">pytribeam.types.FIBPatternType</a></span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_fib_box_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_fib_box_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_fib_box_settings-3280"><a href="#validate_fib_box_settings-3280"><span class="linenos">3280</span></a><span class="k">def</span> <span class="nf">validate_fib_box_settings</span><span class="p">(</span>
</span><span id="validate_fib_box_settings-3281"><a href="#validate_fib_box_settings-3281"><span class="linenos">3281</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3282"><a href="#validate_fib_box_settings-3282"><span class="linenos">3282</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3283"><a href="#validate_fib_box_settings-3283"><span class="linenos">3283</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3284"><a href="#validate_fib_box_settings-3284"><span class="linenos">3284</span></a>    <span class="n">pattern_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3285"><a href="#validate_fib_box_settings-3285"><span class="linenos">3285</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_fib_box_settings-3286"><a href="#validate_fib_box_settings-3286"><span class="linenos">3286</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_fib_box_settings-3287"><a href="#validate_fib_box_settings-3287"><span class="linenos">3287</span></a><span class="sd">    Perform schema checking for FIB box pattern setting dictionary.</span>
</span><span id="validate_fib_box_settings-3288"><a href="#validate_fib_box_settings-3288"><span class="linenos">3288</span></a>
</span><span id="validate_fib_box_settings-3289"><a href="#validate_fib_box_settings-3289"><span class="linenos">3289</span></a><span class="sd">    This function validates the FIB box pattern settings dictionary based on the specified yml format.</span>
</span><span id="validate_fib_box_settings-3290"><a href="#validate_fib_box_settings-3290"><span class="linenos">3290</span></a>
</span><span id="validate_fib_box_settings-3291"><a href="#validate_fib_box_settings-3291"><span class="linenos">3291</span></a><span class="sd">    Parameters</span>
</span><span id="validate_fib_box_settings-3292"><a href="#validate_fib_box_settings-3292"><span class="linenos">3292</span></a><span class="sd">    ----------</span>
</span><span id="validate_fib_box_settings-3293"><a href="#validate_fib_box_settings-3293"><span class="linenos">3293</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_fib_box_settings-3294"><a href="#validate_fib_box_settings-3294"><span class="linenos">3294</span></a><span class="sd">        The dictionary containing the FIB box pattern settings.</span>
</span><span id="validate_fib_box_settings-3295"><a href="#validate_fib_box_settings-3295"><span class="linenos">3295</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_fib_box_settings-3296"><a href="#validate_fib_box_settings-3296"><span class="linenos">3296</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_fib_box_settings-3297"><a href="#validate_fib_box_settings-3297"><span class="linenos">3297</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_fib_box_settings-3298"><a href="#validate_fib_box_settings-3298"><span class="linenos">3298</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_fib_box_settings-3299"><a href="#validate_fib_box_settings-3299"><span class="linenos">3299</span></a><span class="sd">    pattern_type : tbt.FIBPatternType</span>
</span><span id="validate_fib_box_settings-3300"><a href="#validate_fib_box_settings-3300"><span class="linenos">3300</span></a><span class="sd">        The type of the FIB pattern.</span>
</span><span id="validate_fib_box_settings-3301"><a href="#validate_fib_box_settings-3301"><span class="linenos">3301</span></a>
</span><span id="validate_fib_box_settings-3302"><a href="#validate_fib_box_settings-3302"><span class="linenos">3302</span></a><span class="sd">    Returns</span>
</span><span id="validate_fib_box_settings-3303"><a href="#validate_fib_box_settings-3303"><span class="linenos">3303</span></a><span class="sd">    -------</span>
</span><span id="validate_fib_box_settings-3304"><a href="#validate_fib_box_settings-3304"><span class="linenos">3304</span></a><span class="sd">    bool</span>
</span><span id="validate_fib_box_settings-3305"><a href="#validate_fib_box_settings-3305"><span class="linenos">3305</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_fib_box_settings-3306"><a href="#validate_fib_box_settings-3306"><span class="linenos">3306</span></a>
</span><span id="validate_fib_box_settings-3307"><a href="#validate_fib_box_settings-3307"><span class="linenos">3307</span></a><span class="sd">    Raises</span>
</span><span id="validate_fib_box_settings-3308"><a href="#validate_fib_box_settings-3308"><span class="linenos">3308</span></a><span class="sd">    ------</span>
</span><span id="validate_fib_box_settings-3309"><a href="#validate_fib_box_settings-3309"><span class="linenos">3309</span></a><span class="sd">    ValueError</span>
</span><span id="validate_fib_box_settings-3310"><a href="#validate_fib_box_settings-3310"><span class="linenos">3310</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="validate_fib_box_settings-3311"><a href="#validate_fib_box_settings-3311"><span class="linenos">3311</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_fib_box_settings-3312"><a href="#validate_fib_box_settings-3312"><span class="linenos">3312</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_fib_box_settings-3313"><a href="#validate_fib_box_settings-3313"><span class="linenos">3313</span></a>        <span class="c1"># flattens nested dictionary, adding &quot;_&quot; separator</span>
</span><span id="validate_fib_box_settings-3314"><a href="#validate_fib_box_settings-3314"><span class="linenos">3314</span></a>        <span class="n">flat_settings</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_fib_box_settings-3315"><a href="#validate_fib_box_settings-3315"><span class="linenos">3315</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_fib_box_settings-3316"><a href="#validate_fib_box_settings-3316"><span class="linenos">3316</span></a>            <span class="p">{</span>
</span><span id="validate_fib_box_settings-3317"><a href="#validate_fib_box_settings-3317"><span class="linenos">3317</span></a>                <span class="s2">&quot;center_x_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_fib_box_settings-3318"><a href="#validate_fib_box_settings-3318"><span class="linenos">3318</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3319"><a href="#validate_fib_box_settings-3319"><span class="linenos">3319</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;x_um&#39; parameter for pattern &#39;center&#39; sub-dictionary must be a float. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;center_x_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;center_x_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3320"><a href="#validate_fib_box_settings-3320"><span class="linenos">3320</span></a>                <span class="p">),</span>
</span><span id="validate_fib_box_settings-3321"><a href="#validate_fib_box_settings-3321"><span class="linenos">3321</span></a>                <span class="s2">&quot;center_y_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_fib_box_settings-3322"><a href="#validate_fib_box_settings-3322"><span class="linenos">3322</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3323"><a href="#validate_fib_box_settings-3323"><span class="linenos">3323</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;y_um&#39; parameter for pattern &#39;center&#39; sub-dictionary must be a float. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;center_y_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;center_y_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3324"><a href="#validate_fib_box_settings-3324"><span class="linenos">3324</span></a>                <span class="p">),</span>
</span><span id="validate_fib_box_settings-3325"><a href="#validate_fib_box_settings-3325"><span class="linenos">3325</span></a>                <span class="s2">&quot;width_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_fib_box_settings-3326"><a href="#validate_fib_box_settings-3326"><span class="linenos">3326</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3327"><a href="#validate_fib_box_settings-3327"><span class="linenos">3327</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3328"><a href="#validate_fib_box_settings-3328"><span class="linenos">3328</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;width_um&#39; parameter must be a float. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;width_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;width_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3329"><a href="#validate_fib_box_settings-3329"><span class="linenos">3329</span></a>                <span class="p">),</span>
</span><span id="validate_fib_box_settings-3330"><a href="#validate_fib_box_settings-3330"><span class="linenos">3330</span></a>                <span class="s2">&quot;height_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_fib_box_settings-3331"><a href="#validate_fib_box_settings-3331"><span class="linenos">3331</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3332"><a href="#validate_fib_box_settings-3332"><span class="linenos">3332</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3333"><a href="#validate_fib_box_settings-3333"><span class="linenos">3333</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;height_um&#39; parameter must be a float. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;height_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;height_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3334"><a href="#validate_fib_box_settings-3334"><span class="linenos">3334</span></a>                <span class="p">),</span>
</span><span id="validate_fib_box_settings-3335"><a href="#validate_fib_box_settings-3335"><span class="linenos">3335</span></a>                <span class="s2">&quot;depth_um&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_fib_box_settings-3336"><a href="#validate_fib_box_settings-3336"><span class="linenos">3336</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3337"><a href="#validate_fib_box_settings-3337"><span class="linenos">3337</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3338"><a href="#validate_fib_box_settings-3338"><span class="linenos">3338</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;depth_um&#39; parameter must be a float. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;depth_um&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;depth_um&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3339"><a href="#validate_fib_box_settings-3339"><span class="linenos">3339</span></a>                <span class="p">),</span>
</span><span id="validate_fib_box_settings-3340"><a href="#validate_fib_box_settings-3340"><span class="linenos">3340</span></a>                <span class="s2">&quot;scan_direction&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_fib_box_settings-3341"><a href="#validate_fib_box_settings-3341"><span class="linenos">3341</span></a>                    <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3342"><a href="#validate_fib_box_settings-3342"><span class="linenos">3342</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanDirection</span><span class="p">),</span>
</span><span id="validate_fib_box_settings-3343"><a href="#validate_fib_box_settings-3343"><span class="linenos">3343</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;scan_direction&#39; parameter must be a valid scan direction type. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;scan_direction&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; was requested but supported values are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanDirection</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3344"><a href="#validate_fib_box_settings-3344"><span class="linenos">3344</span></a>                <span class="p">),</span>
</span><span id="validate_fib_box_settings-3345"><a href="#validate_fib_box_settings-3345"><span class="linenos">3345</span></a>                <span class="s2">&quot;scan_type&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_fib_box_settings-3346"><a href="#validate_fib_box_settings-3346"><span class="linenos">3346</span></a>                    <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3347"><a href="#validate_fib_box_settings-3347"><span class="linenos">3347</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanType</span><span class="p">),</span>
</span><span id="validate_fib_box_settings-3348"><a href="#validate_fib_box_settings-3348"><span class="linenos">3348</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;scan_type&#39; parameter must be a valid scan type type. &#39;</span><span class="si">{</span><span class="n">flat_settings</span><span class="p">[</span><span class="s1">&#39;scan_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; was requested but supported values are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternScanType</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3349"><a href="#validate_fib_box_settings-3349"><span class="linenos">3349</span></a>                <span class="p">),</span>
</span><span id="validate_fib_box_settings-3350"><a href="#validate_fib_box_settings-3350"><span class="linenos">3350</span></a>            <span class="p">},</span>
</span><span id="validate_fib_box_settings-3351"><a href="#validate_fib_box_settings-3351"><span class="linenos">3351</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_fib_box_settings-3352"><a href="#validate_fib_box_settings-3352"><span class="linenos">3352</span></a>        <span class="p">)</span>
</span><span id="validate_fib_box_settings-3353"><a href="#validate_fib_box_settings-3353"><span class="linenos">3353</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_fib_box_settings-3354"><a href="#validate_fib_box_settings-3354"><span class="linenos">3354</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">flat_settings</span><span class="p">)</span>
</span><span id="validate_fib_box_settings-3355"><a href="#validate_fib_box_settings-3355"><span class="linenos">3355</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="validate_fib_box_settings-3356"><a href="#validate_fib_box_settings-3356"><span class="linenos">3356</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_fib_box_settings-3357"><a href="#validate_fib_box_settings-3357"><span class="linenos">3357</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="validate_fib_box_settings-3358"><a href="#validate_fib_box_settings-3358"><span class="linenos">3358</span></a>        <span class="p">)</span>
</span><span id="validate_fib_box_settings-3359"><a href="#validate_fib_box_settings-3359"><span class="linenos">3359</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for FIB box pattern setting dictionary.</p>

<p>This function validates the FIB box pattern settings dictionary based on the specified yml format.</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    The dictionary containing the FIB box pattern settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
step_name : str
    The name of the step in the .yml file.
pattern_type : tbt.FIBPatternType
    The type of the FIB pattern.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the yml version is unsupported or if the settings do not satisfy the specified schema.</p>
</div>


                </section>
                <section id="validate_fib_selected_area_settings">
                            <input id="validate_fib_selected_area_settings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_fib_selected_area_settings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pattern_type</span><span class="p">:</span> <span class="n"><a href="types.html#FIBPatternType">pytribeam.types.FIBPatternType</a></span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="validate_fib_selected_area_settings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_fib_selected_area_settings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_fib_selected_area_settings-3362"><a href="#validate_fib_selected_area_settings-3362"><span class="linenos">3362</span></a><span class="k">def</span> <span class="nf">validate_fib_selected_area_settings</span><span class="p">(</span>
</span><span id="validate_fib_selected_area_settings-3363"><a href="#validate_fib_selected_area_settings-3363"><span class="linenos">3363</span></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3364"><a href="#validate_fib_selected_area_settings-3364"><span class="linenos">3364</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3365"><a href="#validate_fib_selected_area_settings-3365"><span class="linenos">3365</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3366"><a href="#validate_fib_selected_area_settings-3366"><span class="linenos">3366</span></a>    <span class="n">pattern_type</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">FIBPatternType</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3367"><a href="#validate_fib_selected_area_settings-3367"><span class="linenos">3367</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="validate_fib_selected_area_settings-3368"><a href="#validate_fib_selected_area_settings-3368"><span class="linenos">3368</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_fib_selected_area_settings-3369"><a href="#validate_fib_selected_area_settings-3369"><span class="linenos">3369</span></a><span class="sd">    Perform schema checking for FIB selected area pattern setting dictionary.</span>
</span><span id="validate_fib_selected_area_settings-3370"><a href="#validate_fib_selected_area_settings-3370"><span class="linenos">3370</span></a>
</span><span id="validate_fib_selected_area_settings-3371"><a href="#validate_fib_selected_area_settings-3371"><span class="linenos">3371</span></a><span class="sd">    This function validates the FIB selected area pattern settings dictionary based on the specified yml format.</span>
</span><span id="validate_fib_selected_area_settings-3372"><a href="#validate_fib_selected_area_settings-3372"><span class="linenos">3372</span></a>
</span><span id="validate_fib_selected_area_settings-3373"><a href="#validate_fib_selected_area_settings-3373"><span class="linenos">3373</span></a><span class="sd">    Parameters</span>
</span><span id="validate_fib_selected_area_settings-3374"><a href="#validate_fib_selected_area_settings-3374"><span class="linenos">3374</span></a><span class="sd">    ----------</span>
</span><span id="validate_fib_selected_area_settings-3375"><a href="#validate_fib_selected_area_settings-3375"><span class="linenos">3375</span></a><span class="sd">    settings : dict</span>
</span><span id="validate_fib_selected_area_settings-3376"><a href="#validate_fib_selected_area_settings-3376"><span class="linenos">3376</span></a><span class="sd">        The dictionary containing the FIB selected area pattern settings.</span>
</span><span id="validate_fib_selected_area_settings-3377"><a href="#validate_fib_selected_area_settings-3377"><span class="linenos">3377</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="validate_fib_selected_area_settings-3378"><a href="#validate_fib_selected_area_settings-3378"><span class="linenos">3378</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="validate_fib_selected_area_settings-3379"><a href="#validate_fib_selected_area_settings-3379"><span class="linenos">3379</span></a><span class="sd">    step_name : str</span>
</span><span id="validate_fib_selected_area_settings-3380"><a href="#validate_fib_selected_area_settings-3380"><span class="linenos">3380</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="validate_fib_selected_area_settings-3381"><a href="#validate_fib_selected_area_settings-3381"><span class="linenos">3381</span></a><span class="sd">    pattern_type : tbt.FIBPatternType</span>
</span><span id="validate_fib_selected_area_settings-3382"><a href="#validate_fib_selected_area_settings-3382"><span class="linenos">3382</span></a><span class="sd">        The type of the FIB pattern.</span>
</span><span id="validate_fib_selected_area_settings-3383"><a href="#validate_fib_selected_area_settings-3383"><span class="linenos">3383</span></a>
</span><span id="validate_fib_selected_area_settings-3384"><a href="#validate_fib_selected_area_settings-3384"><span class="linenos">3384</span></a><span class="sd">    Returns</span>
</span><span id="validate_fib_selected_area_settings-3385"><a href="#validate_fib_selected_area_settings-3385"><span class="linenos">3385</span></a><span class="sd">    -------</span>
</span><span id="validate_fib_selected_area_settings-3386"><a href="#validate_fib_selected_area_settings-3386"><span class="linenos">3386</span></a><span class="sd">    bool</span>
</span><span id="validate_fib_selected_area_settings-3387"><a href="#validate_fib_selected_area_settings-3387"><span class="linenos">3387</span></a><span class="sd">        True if the settings are valid, False otherwise.</span>
</span><span id="validate_fib_selected_area_settings-3388"><a href="#validate_fib_selected_area_settings-3388"><span class="linenos">3388</span></a>
</span><span id="validate_fib_selected_area_settings-3389"><a href="#validate_fib_selected_area_settings-3389"><span class="linenos">3389</span></a><span class="sd">    Raises</span>
</span><span id="validate_fib_selected_area_settings-3390"><a href="#validate_fib_selected_area_settings-3390"><span class="linenos">3390</span></a><span class="sd">    ------</span>
</span><span id="validate_fib_selected_area_settings-3391"><a href="#validate_fib_selected_area_settings-3391"><span class="linenos">3391</span></a><span class="sd">    ValueError</span>
</span><span id="validate_fib_selected_area_settings-3392"><a href="#validate_fib_selected_area_settings-3392"><span class="linenos">3392</span></a><span class="sd">        If the yml version is unsupported or if the settings do not satisfy the specified schema.</span>
</span><span id="validate_fib_selected_area_settings-3393"><a href="#validate_fib_selected_area_settings-3393"><span class="linenos">3393</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_fib_selected_area_settings-3394"><a href="#validate_fib_selected_area_settings-3394"><span class="linenos">3394</span></a>    <span class="k">if</span> <span class="n">yml_format</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="validate_fib_selected_area_settings-3395"><a href="#validate_fib_selected_area_settings-3395"><span class="linenos">3395</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="validate_fib_selected_area_settings-3396"><a href="#validate_fib_selected_area_settings-3396"><span class="linenos">3396</span></a>            <span class="p">{</span>
</span><span id="validate_fib_selected_area_settings-3397"><a href="#validate_fib_selected_area_settings-3397"><span class="linenos">3397</span></a>                <span class="s2">&quot;dwell_us&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_fib_selected_area_settings-3398"><a href="#validate_fib_selected_area_settings-3398"><span class="linenos">3398</span></a>                    <span class="nb">float</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3399"><a href="#validate_fib_selected_area_settings-3399"><span class="linenos">3399</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3400"><a href="#validate_fib_selected_area_settings-3400"><span class="linenos">3400</span></a>                    <span class="c1"># check all float error versions of modulus</span>
</span><span id="validate_fib_selected_area_settings-3401"><a href="#validate_fib_selected_area_settings-3401"><span class="linenos">3401</span></a>                    <span class="n">Or</span><span class="p">(</span>
</span><span id="validate_fib_selected_area_settings-3402"><a href="#validate_fib_selected_area_settings-3402"><span class="linenos">3402</span></a>                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
</span><span id="validate_fib_selected_area_settings-3403"><a href="#validate_fib_selected_area_settings-3403"><span class="linenos">3403</span></a>                            <span class="n">x</span> <span class="o">%</span> <span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3404"><a href="#validate_fib_selected_area_settings-3404"><span class="linenos">3404</span></a>                            <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3405"><a href="#validate_fib_selected_area_settings-3405"><span class="linenos">3405</span></a>                            <span class="n">abs_tol</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span> <span class="o">/</span> <span class="mf">1e5</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3406"><a href="#validate_fib_selected_area_settings-3406"><span class="linenos">3406</span></a>                        <span class="p">),</span>
</span><span id="validate_fib_selected_area_settings-3407"><a href="#validate_fib_selected_area_settings-3407"><span class="linenos">3407</span></a>                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
</span><span id="validate_fib_selected_area_settings-3408"><a href="#validate_fib_selected_area_settings-3408"><span class="linenos">3408</span></a>                            <span class="n">x</span> <span class="o">%</span> <span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3409"><a href="#validate_fib_selected_area_settings-3409"><span class="linenos">3409</span></a>                            <span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3410"><a href="#validate_fib_selected_area_settings-3410"><span class="linenos">3410</span></a>                            <span class="n">abs_tol</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span> <span class="o">/</span> <span class="mf">1e5</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3411"><a href="#validate_fib_selected_area_settings-3411"><span class="linenos">3411</span></a>                        <span class="p">),</span>
</span><span id="validate_fib_selected_area_settings-3412"><a href="#validate_fib_selected_area_settings-3412"><span class="linenos">3412</span></a>                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
</span><span id="validate_fib_selected_area_settings-3413"><a href="#validate_fib_selected_area_settings-3413"><span class="linenos">3413</span></a>                            <span class="n">x</span> <span class="o">%</span> <span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3414"><a href="#validate_fib_selected_area_settings-3414"><span class="linenos">3414</span></a>                            <span class="o">-</span><span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3415"><a href="#validate_fib_selected_area_settings-3415"><span class="linenos">3415</span></a>                            <span class="n">abs_tol</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span> <span class="o">/</span> <span class="mf">1e5</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3416"><a href="#validate_fib_selected_area_settings-3416"><span class="linenos">3416</span></a>                        <span class="p">),</span>
</span><span id="validate_fib_selected_area_settings-3417"><a href="#validate_fib_selected_area_settings-3417"><span class="linenos">3417</span></a>                    <span class="p">),</span>
</span><span id="validate_fib_selected_area_settings-3418"><a href="#validate_fib_selected_area_settings-3418"><span class="linenos">3418</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;dwell_us&#39; parameter must be a positive float and an integer multiple of the base dwell time, </span><span class="si">{</span><span class="w"> </span><span class="n">Constants</span><span class="o">.</span><span class="n">stream_pattern_base_dwell_us</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Conversions</span><span class="o">.</span><span class="n">US_TO_NS</span><span class="si">}</span><span class="s2"> ns. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dwell_us&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; us of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;dwell_us&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3419"><a href="#validate_fib_selected_area_settings-3419"><span class="linenos">3419</span></a>                <span class="p">),</span>
</span><span id="validate_fib_selected_area_settings-3420"><a href="#validate_fib_selected_area_settings-3420"><span class="linenos">3420</span></a>                <span class="s2">&quot;repeats&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_fib_selected_area_settings-3421"><a href="#validate_fib_selected_area_settings-3421"><span class="linenos">3421</span></a>                    <span class="nb">int</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3422"><a href="#validate_fib_selected_area_settings-3422"><span class="linenos">3422</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3423"><a href="#validate_fib_selected_area_settings-3423"><span class="linenos">3423</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;repeats&#39; parameter must be a positive integer. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;repeats&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;repeats&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3424"><a href="#validate_fib_selected_area_settings-3424"><span class="linenos">3424</span></a>                <span class="p">),</span>
</span><span id="validate_fib_selected_area_settings-3425"><a href="#validate_fib_selected_area_settings-3425"><span class="linenos">3425</span></a>                <span class="s2">&quot;recipe_file&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_fib_selected_area_settings-3426"><a href="#validate_fib_selected_area_settings-3426"><span class="linenos">3426</span></a>                    <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3427"><a href="#validate_fib_selected_area_settings-3427"><span class="linenos">3427</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">(),</span>
</span><span id="validate_fib_selected_area_settings-3428"><a href="#validate_fib_selected_area_settings-3428"><span class="linenos">3428</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.py&quot;</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3429"><a href="#validate_fib_selected_area_settings-3429"><span class="linenos">3429</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;recipe_file&#39; parameter must be a valid file path string with the extension &#39;.py&#39; and must already exist. The recipe file &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;recipe_file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3430"><a href="#validate_fib_selected_area_settings-3430"><span class="linenos">3430</span></a>                <span class="p">),</span>
</span><span id="validate_fib_selected_area_settings-3431"><a href="#validate_fib_selected_area_settings-3431"><span class="linenos">3431</span></a>                <span class="s2">&quot;mask_file&quot;</span><span class="p">:</span> <span class="n">And</span><span class="p">(</span>
</span><span id="validate_fib_selected_area_settings-3432"><a href="#validate_fib_selected_area_settings-3432"><span class="linenos">3432</span></a>                    <span class="nb">str</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3433"><a href="#validate_fib_selected_area_settings-3433"><span class="linenos">3433</span></a>                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.tif&quot;</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3434"><a href="#validate_fib_selected_area_settings-3434"><span class="linenos">3434</span></a>                    <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;In &#39;fib&#39; step_type for step &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; and pattern type &#39;</span><span class="si">{</span><span class="n">pattern_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;, &#39;mask&#39; parameter must be a file path string with a file extension of &#39;.tif&#39;. &#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;mask_file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; of type &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;mask_file&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&#39; was requested.&quot;</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3435"><a href="#validate_fib_selected_area_settings-3435"><span class="linenos">3435</span></a>                <span class="p">),</span>
</span><span id="validate_fib_selected_area_settings-3436"><a href="#validate_fib_selected_area_settings-3436"><span class="linenos">3436</span></a>            <span class="p">},</span>
</span><span id="validate_fib_selected_area_settings-3437"><a href="#validate_fib_selected_area_settings-3437"><span class="linenos">3437</span></a>            <span class="n">ignore_extra_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="validate_fib_selected_area_settings-3438"><a href="#validate_fib_selected_area_settings-3438"><span class="linenos">3438</span></a>        <span class="p">)</span>
</span><span id="validate_fib_selected_area_settings-3439"><a href="#validate_fib_selected_area_settings-3439"><span class="linenos">3439</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_fib_selected_area_settings-3440"><a href="#validate_fib_selected_area_settings-3440"><span class="linenos">3440</span></a>        <span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="validate_fib_selected_area_settings-3441"><a href="#validate_fib_selected_area_settings-3441"><span class="linenos">3441</span></a>    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
</span><span id="validate_fib_selected_area_settings-3442"><a href="#validate_fib_selected_area_settings-3442"><span class="linenos">3442</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_fib_selected_area_settings-3443"><a href="#validate_fib_selected_area_settings-3443"><span class="linenos">3443</span></a>            <span class="sa">f</span><span class="s2">&quot;Error. Unsupported yml version </span><span class="si">{</span><span class="n">yml_format</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
</span><span id="validate_fib_selected_area_settings-3444"><a href="#validate_fib_selected_area_settings-3444"><span class="linenos">3444</span></a>        <span class="p">)</span>
</span><span id="validate_fib_selected_area_settings-3445"><a href="#validate_fib_selected_area_settings-3445"><span class="linenos">3445</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Perform schema checking for FIB selected area pattern setting dictionary.</p>

<p>This function validates the FIB selected area pattern settings dictionary based on the specified yml format.</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    The dictionary containing the FIB selected area pattern settings.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.
step_name : str
    The name of the step in the .yml file.
pattern_type : tbt.FIBPatternType
    The type of the FIB pattern.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the settings are valid, False otherwise.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the yml version is unsupported or if the settings do not satisfy the specified schema.</p>
</div>


                </section>
                <section id="step">
                            <input id="step-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">step</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">microscope</span><span class="p">:</span> <span class="n"><a href="types.html#Microscope">pytribeam.types.Microscope</a></span>,</span><span class="param">	<span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">general_settings</span><span class="p">:</span> <span class="n"><a href="types.html#GeneralSettings">pytribeam.types.GeneralSettings</a></span>,</span><span class="param">	<span class="n">yml_format</span><span class="p">:</span> <span class="n"><a href="types.html#YMLFormatVersion">pytribeam.types.YMLFormatVersion</a></span></span><span class="return-annotation">) -> <span class="n"><a href="types.html#Step">pytribeam.types.Step</a></span>:</span></span>

                <label class="view-source-button" for="step-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#step"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="step-3448"><a href="#step-3448"><span class="linenos">3448</span></a><span class="k">def</span> <span class="nf">step</span><span class="p">(</span>
</span><span id="step-3449"><a href="#step-3449"><span class="linenos">3449</span></a>    <span class="n">microscope</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Microscope</span><span class="p">,</span>
</span><span id="step-3450"><a href="#step-3450"><span class="linenos">3450</span></a>    <span class="c1"># slice_number: str,</span>
</span><span id="step-3451"><a href="#step-3451"><span class="linenos">3451</span></a>    <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="step-3452"><a href="#step-3452"><span class="linenos">3452</span></a>    <span class="n">step_settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="step-3453"><a href="#step-3453"><span class="linenos">3453</span></a>    <span class="n">general_settings</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">GeneralSettings</span><span class="p">,</span>
</span><span id="step-3454"><a href="#step-3454"><span class="linenos">3454</span></a>    <span class="n">yml_format</span><span class="p">:</span> <span class="n">tbt</span><span class="o">.</span><span class="n">YMLFormatVersion</span><span class="p">,</span>
</span><span id="step-3455"><a href="#step-3455"><span class="linenos">3455</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Step</span><span class="p">:</span>
</span><span id="step-3456"><a href="#step-3456"><span class="linenos">3456</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="step-3457"><a href="#step-3457"><span class="linenos">3457</span></a><span class="sd">    Create a step object for different step types, including validation.</span>
</span><span id="step-3458"><a href="#step-3458"><span class="linenos">3458</span></a>
</span><span id="step-3459"><a href="#step-3459"><span class="linenos">3459</span></a><span class="sd">    This function creates a `Step` object for the specified step type and performs validation.</span>
</span><span id="step-3460"><a href="#step-3460"><span class="linenos">3460</span></a>
</span><span id="step-3461"><a href="#step-3461"><span class="linenos">3461</span></a><span class="sd">    Parameters</span>
</span><span id="step-3462"><a href="#step-3462"><span class="linenos">3462</span></a><span class="sd">    ----------</span>
</span><span id="step-3463"><a href="#step-3463"><span class="linenos">3463</span></a><span class="sd">    microscope : tbt.Microscope</span>
</span><span id="step-3464"><a href="#step-3464"><span class="linenos">3464</span></a><span class="sd">        The microscope object for which to create the step.</span>
</span><span id="step-3465"><a href="#step-3465"><span class="linenos">3465</span></a><span class="sd">    step_name : str</span>
</span><span id="step-3466"><a href="#step-3466"><span class="linenos">3466</span></a><span class="sd">        The name of the step in the .yml file.</span>
</span><span id="step-3467"><a href="#step-3467"><span class="linenos">3467</span></a><span class="sd">    step_settings : dict</span>
</span><span id="step-3468"><a href="#step-3468"><span class="linenos">3468</span></a><span class="sd">        The dictionary containing the step settings.</span>
</span><span id="step-3469"><a href="#step-3469"><span class="linenos">3469</span></a><span class="sd">    general_settings : tbt.GeneralSettings</span>
</span><span id="step-3470"><a href="#step-3470"><span class="linenos">3470</span></a><span class="sd">        The general settings object.</span>
</span><span id="step-3471"><a href="#step-3471"><span class="linenos">3471</span></a><span class="sd">    yml_format : tbt.YMLFormatVersion</span>
</span><span id="step-3472"><a href="#step-3472"><span class="linenos">3472</span></a><span class="sd">        The format specified by the version of the .yml file.</span>
</span><span id="step-3473"><a href="#step-3473"><span class="linenos">3473</span></a>
</span><span id="step-3474"><a href="#step-3474"><span class="linenos">3474</span></a><span class="sd">    Returns</span>
</span><span id="step-3475"><a href="#step-3475"><span class="linenos">3475</span></a><span class="sd">    -------</span>
</span><span id="step-3476"><a href="#step-3476"><span class="linenos">3476</span></a><span class="sd">    tbt.Step</span>
</span><span id="step-3477"><a href="#step-3477"><span class="linenos">3477</span></a><span class="sd">        The step object.</span>
</span><span id="step-3478"><a href="#step-3478"><span class="linenos">3478</span></a>
</span><span id="step-3479"><a href="#step-3479"><span class="linenos">3479</span></a><span class="sd">    Raises</span>
</span><span id="step-3480"><a href="#step-3480"><span class="linenos">3480</span></a><span class="sd">    ------</span>
</span><span id="step-3481"><a href="#step-3481"><span class="linenos">3481</span></a><span class="sd">    NotImplementedError</span>
</span><span id="step-3482"><a href="#step-3482"><span class="linenos">3482</span></a><span class="sd">        If the step type is unsupported.</span>
</span><span id="step-3483"><a href="#step-3483"><span class="linenos">3483</span></a><span class="sd">    KeyError</span>
</span><span id="step-3484"><a href="#step-3484"><span class="linenos">3484</span></a><span class="sd">        If required settings are missing or invalid.</span>
</span><span id="step-3485"><a href="#step-3485"><span class="linenos">3485</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="step-3486"><a href="#step-3486"><span class="linenos">3486</span></a>
</span><span id="step-3487"><a href="#step-3487"><span class="linenos">3487</span></a>    <span class="c1"># parsing settings</span>
</span><span id="step-3488"><a href="#step-3488"><span class="linenos">3488</span></a>    <span class="n">step_type_value</span> <span class="o">=</span> <span class="n">step_settings</span><span class="p">[</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_general_key</span><span class="p">][</span>
</span><span id="step-3489"><a href="#step-3489"><span class="linenos">3489</span></a>        <span class="n">yml_format</span><span class="o">.</span><span class="n">step_type_key</span>
</span><span id="step-3490"><a href="#step-3490"><span class="linenos">3490</span></a>    <span class="p">]</span>
</span><span id="step-3491"><a href="#step-3491"><span class="linenos">3491</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">valid_enum_entry</span><span class="p">(</span><span class="n">step_type_value</span><span class="p">,</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="p">):</span>
</span><span id="step-3492"><a href="#step-3492"><span class="linenos">3492</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="step-3493"><a href="#step-3493"><span class="linenos">3493</span></a>            <span class="sa">f</span><span class="s2">&quot;Unsupported step type of &#39;</span><span class="si">{</span><span class="n">step_type_value</span><span class="si">}</span><span class="s2">&#39;, for step name &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; supported types are: </span><span class="si">{</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="step-3494"><a href="#step-3494"><span class="linenos">3494</span></a>        <span class="p">)</span>
</span><span id="step-3495"><a href="#step-3495"><span class="linenos">3495</span></a>    <span class="n">step_type</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="p">(</span><span class="n">step_type_value</span><span class="p">)</span>
</span><span id="step-3496"><a href="#step-3496"><span class="linenos">3496</span></a>
</span><span id="step-3497"><a href="#step-3497"><span class="linenos">3497</span></a>    <span class="n">step_number</span> <span class="o">=</span> <span class="n">step_settings</span><span class="p">[</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_general_key</span><span class="p">][</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_number_key</span><span class="p">]</span>
</span><span id="step-3498"><a href="#step-3498"><span class="linenos">3498</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step_number</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">step_number</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="step-3499"><a href="#step-3499"><span class="linenos">3499</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="step-3500"><a href="#step-3500"><span class="linenos">3500</span></a>            <span class="sa">f</span><span class="s2">&quot;Invalid step number of &#39;</span><span class="si">{</span><span class="n">step_number</span><span class="si">}</span><span class="s2">&#39;, for step name &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. Must be a positive integer greater than 0.&quot;</span>
</span><span id="step-3501"><a href="#step-3501"><span class="linenos">3501</span></a>        <span class="p">)</span>
</span><span id="step-3502"><a href="#step-3502"><span class="linenos">3502</span></a>    <span class="n">step_frequency</span> <span class="o">=</span> <span class="n">step_settings</span><span class="p">[</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_general_key</span><span class="p">][</span>
</span><span id="step-3503"><a href="#step-3503"><span class="linenos">3503</span></a>        <span class="n">yml_format</span><span class="o">.</span><span class="n">step_frequency_key</span>
</span><span id="step-3504"><a href="#step-3504"><span class="linenos">3504</span></a>    <span class="p">]</span>
</span><span id="step-3505"><a href="#step-3505"><span class="linenos">3505</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step_frequency</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">step_frequency</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="step-3506"><a href="#step-3506"><span class="linenos">3506</span></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
</span><span id="step-3507"><a href="#step-3507"><span class="linenos">3507</span></a>            <span class="sa">f</span><span class="s2">&quot;Invalid step frequency of &#39;</span><span class="si">{</span><span class="n">step_frequency</span><span class="si">}</span><span class="s2">&#39;, for step name &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. Must be a positive integer greater than 0.&quot;</span>
</span><span id="step-3508"><a href="#step-3508"><span class="linenos">3508</span></a>        <span class="p">)</span>
</span><span id="step-3509"><a href="#step-3509"><span class="linenos">3509</span></a>    <span class="n">stage_db</span> <span class="o">=</span> <span class="n">step_settings</span><span class="p">[</span><span class="n">yml_format</span><span class="o">.</span><span class="n">step_general_key</span><span class="p">][</span>
</span><span id="step-3510"><a href="#step-3510"><span class="linenos">3510</span></a>        <span class="n">yml_format</span><span class="o">.</span><span class="n">step_stage_settings_key</span>
</span><span id="step-3511"><a href="#step-3511"><span class="linenos">3511</span></a>    <span class="p">]</span>
</span><span id="step-3512"><a href="#step-3512"><span class="linenos">3512</span></a>
</span><span id="step-3513"><a href="#step-3513"><span class="linenos">3513</span></a>    <span class="c1"># check and validate stage</span>
</span><span id="step-3514"><a href="#step-3514"><span class="linenos">3514</span></a>    <span class="n">stage_settings</span> <span class="o">=</span> <span class="n">stage_position_settings</span><span class="p">(</span>
</span><span id="step-3515"><a href="#step-3515"><span class="linenos">3515</span></a>        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="step-3516"><a href="#step-3516"><span class="linenos">3516</span></a>        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="step-3517"><a href="#step-3517"><span class="linenos">3517</span></a>        <span class="n">general_settings</span><span class="o">=</span><span class="n">general_settings</span><span class="p">,</span>
</span><span id="step-3518"><a href="#step-3518"><span class="linenos">3518</span></a>        <span class="n">step_stage_settings</span><span class="o">=</span><span class="n">stage_db</span><span class="p">,</span>
</span><span id="step-3519"><a href="#step-3519"><span class="linenos">3519</span></a>        <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="step-3520"><a href="#step-3520"><span class="linenos">3520</span></a>    <span class="p">)</span>
</span><span id="step-3521"><a href="#step-3521"><span class="linenos">3521</span></a>
</span><span id="step-3522"><a href="#step-3522"><span class="linenos">3522</span></a>    <span class="c1"># TODO</span>
</span><span id="step-3523"><a href="#step-3523"><span class="linenos">3523</span></a>    <span class="c1"># operation_settings, could use match statement in python &gt;= 3.10</span>
</span><span id="step-3524"><a href="#step-3524"><span class="linenos">3524</span></a>    <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="o">.</span><span class="n">EBSD</span><span class="p">:</span>
</span><span id="step-3525"><a href="#step-3525"><span class="linenos">3525</span></a>        <span class="n">operation_settings</span> <span class="o">=</span> <span class="n">ebsd</span><span class="p">(</span>
</span><span id="step-3526"><a href="#step-3526"><span class="linenos">3526</span></a>            <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="step-3527"><a href="#step-3527"><span class="linenos">3527</span></a>            <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="step-3528"><a href="#step-3528"><span class="linenos">3528</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="step-3529"><a href="#step-3529"><span class="linenos">3529</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="step-3530"><a href="#step-3530"><span class="linenos">3530</span></a>        <span class="p">)</span>
</span><span id="step-3531"><a href="#step-3531"><span class="linenos">3531</span></a>    <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="o">.</span><span class="n">EDS</span><span class="p">:</span>
</span><span id="step-3532"><a href="#step-3532"><span class="linenos">3532</span></a>        <span class="n">operation_settings</span> <span class="o">=</span> <span class="n">eds</span><span class="p">(</span>
</span><span id="step-3533"><a href="#step-3533"><span class="linenos">3533</span></a>            <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="step-3534"><a href="#step-3534"><span class="linenos">3534</span></a>            <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="step-3535"><a href="#step-3535"><span class="linenos">3535</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="step-3536"><a href="#step-3536"><span class="linenos">3536</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="step-3537"><a href="#step-3537"><span class="linenos">3537</span></a>        <span class="p">)</span>
</span><span id="step-3538"><a href="#step-3538"><span class="linenos">3538</span></a>    <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">:</span>
</span><span id="step-3539"><a href="#step-3539"><span class="linenos">3539</span></a>        <span class="n">operation_settings</span> <span class="o">=</span> <span class="n">image</span><span class="p">(</span>
</span><span id="step-3540"><a href="#step-3540"><span class="linenos">3540</span></a>            <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="step-3541"><a href="#step-3541"><span class="linenos">3541</span></a>            <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="step-3542"><a href="#step-3542"><span class="linenos">3542</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="step-3543"><a href="#step-3543"><span class="linenos">3543</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="step-3544"><a href="#step-3544"><span class="linenos">3544</span></a>        <span class="p">)</span>
</span><span id="step-3545"><a href="#step-3545"><span class="linenos">3545</span></a>    <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="o">.</span><span class="n">LASER</span><span class="p">:</span>
</span><span id="step-3546"><a href="#step-3546"><span class="linenos">3546</span></a>        <span class="n">operation_settings</span> <span class="o">=</span> <span class="n">laser</span><span class="p">(</span>
</span><span id="step-3547"><a href="#step-3547"><span class="linenos">3547</span></a>            <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="step-3548"><a href="#step-3548"><span class="linenos">3548</span></a>            <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="step-3549"><a href="#step-3549"><span class="linenos">3549</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="step-3550"><a href="#step-3550"><span class="linenos">3550</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="step-3551"><a href="#step-3551"><span class="linenos">3551</span></a>        <span class="p">)</span>
</span><span id="step-3552"><a href="#step-3552"><span class="linenos">3552</span></a>    <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="o">.</span><span class="n">CUSTOM</span><span class="p">:</span>
</span><span id="step-3553"><a href="#step-3553"><span class="linenos">3553</span></a>        <span class="n">operation_settings</span> <span class="o">=</span> <span class="n">custom</span><span class="p">(</span>
</span><span id="step-3554"><a href="#step-3554"><span class="linenos">3554</span></a>            <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="step-3555"><a href="#step-3555"><span class="linenos">3555</span></a>            <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="step-3556"><a href="#step-3556"><span class="linenos">3556</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="step-3557"><a href="#step-3557"><span class="linenos">3557</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="step-3558"><a href="#step-3558"><span class="linenos">3558</span></a>        <span class="p">)</span>
</span><span id="step-3559"><a href="#step-3559"><span class="linenos">3559</span></a>    <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="n">tbt</span><span class="o">.</span><span class="n">StepType</span><span class="o">.</span><span class="n">FIB</span><span class="p">:</span>
</span><span id="step-3560"><a href="#step-3560"><span class="linenos">3560</span></a>        <span class="n">operation_settings</span> <span class="o">=</span> <span class="n">fib</span><span class="p">(</span>
</span><span id="step-3561"><a href="#step-3561"><span class="linenos">3561</span></a>            <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
</span><span id="step-3562"><a href="#step-3562"><span class="linenos">3562</span></a>            <span class="n">step_settings</span><span class="o">=</span><span class="n">step_settings</span><span class="p">,</span>
</span><span id="step-3563"><a href="#step-3563"><span class="linenos">3563</span></a>            <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="step-3564"><a href="#step-3564"><span class="linenos">3564</span></a>            <span class="n">yml_format</span><span class="o">=</span><span class="n">yml_format</span><span class="p">,</span>
</span><span id="step-3565"><a href="#step-3565"><span class="linenos">3565</span></a>        <span class="p">)</span>
</span><span id="step-3566"><a href="#step-3566"><span class="linenos">3566</span></a>
</span><span id="step-3567"><a href="#step-3567"><span class="linenos">3567</span></a>    <span class="n">step_object</span> <span class="o">=</span> <span class="n">tbt</span><span class="o">.</span><span class="n">Step</span><span class="p">(</span>
</span><span id="step-3568"><a href="#step-3568"><span class="linenos">3568</span></a>        <span class="nb">type</span><span class="o">=</span><span class="n">step_type</span><span class="p">,</span>
</span><span id="step-3569"><a href="#step-3569"><span class="linenos">3569</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
</span><span id="step-3570"><a href="#step-3570"><span class="linenos">3570</span></a>        <span class="n">number</span><span class="o">=</span><span class="n">step_number</span><span class="p">,</span>
</span><span id="step-3571"><a href="#step-3571"><span class="linenos">3571</span></a>        <span class="n">frequency</span><span class="o">=</span><span class="n">step_frequency</span><span class="p">,</span>
</span><span id="step-3572"><a href="#step-3572"><span class="linenos">3572</span></a>        <span class="n">stage</span><span class="o">=</span><span class="n">stage_settings</span><span class="p">,</span>
</span><span id="step-3573"><a href="#step-3573"><span class="linenos">3573</span></a>        <span class="n">operation_settings</span><span class="o">=</span><span class="n">operation_settings</span><span class="p">,</span>
</span><span id="step-3574"><a href="#step-3574"><span class="linenos">3574</span></a>    <span class="p">)</span>
</span><span id="step-3575"><a href="#step-3575"><span class="linenos">3575</span></a>
</span><span id="step-3576"><a href="#step-3576"><span class="linenos">3576</span></a>    <span class="k">return</span> <span class="n">step_object</span>
</span></pre></div>


            <div class="docstring"><p>Create a step object for different step types, including validation.</p>

<p>This function creates a <code>Step</code> object for the specified step type and performs validation.</p>

<h2 id="parameters">Parameters</h2>

<p>microscope : tbt.Microscope
    The microscope object for which to create the step.
step_name : str
    The name of the step in the .yml file.
step_settings : dict
    The dictionary containing the step settings.
general_settings : tbt.GeneralSettings
    The general settings object.
yml_format : tbt.YMLFormatVersion
    The format specified by the version of the .yml file.</p>

<h2 id="returns">Returns</h2>

<p>tbt.Step
    The step object.</p>

<h2 id="raises">Raises</h2>

<p>NotImplementedError
    If the step type is unsupported.
KeyError
    If required settings are missing or invalid.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>