<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>pyTriBeam User Guide</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">pyTriBeam User Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><img src="logo_color.png" alt="Project Logo" /></p>
<p><code>pytribeam</code> provides tools for automated acquisition of data on the TriBeam scanning electron microscope using Thermo Fisher Scientific's <code>autoscript</code> API, which provides a <code>python</code> interface for microscope interactions. <code>pytribeam</code> is geared specifically for 3D data collection with the use of an integrated femtosecond laser, but offers many higher-level functionalities applicable to single SEM or dual-beam SEM/FIB (both Gallium and Xenon Plasma) platforms utilizing <code>autoscript</code>.</p>
<p>Utilization of this tool does not require advanced experience with <code>python</code>, but it is generally expected that users will be experienced in the use and operation of the microscope platform and understand the various steps required to create workflows for automated data collection. This package assumes users are able to orient and place their sample at the eucentric position within the microscope, and are able to determine various machine settings (including, but not limited to, detector selection and settings, determination of milling geometries and settings, etc.) required for automated data collection.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>This process uses <strong>AutoScript 4.8.1</strong> and <strong>TriBeam_API_Python 2_2.1</strong> provided by Thermo Fisher Scientific, which is a Windows-only configuration.</p>
<h2 id="pre-installation"><a class="header" href="#pre-installation">Pre-installation</a></h2>
<ul>
<li>
<p>Uninstall any prior installations of AutoScript</p>
</li>
<li>
<p>Follow the Autoscript installation instructions provided by Thermo Fisher Scientific</p>
</li>
<li>
<p>With <code>AutoScript_4.8.1.exe</code>, install <strong>Autoscript</strong> according to Thermo Fisher Scientific's instructions:</p>
<ul>
<li>Section 5 - Procedure, select the appropriate scripting configuration. This codebase has been tested in both "Local" and "Offline" Scripting Configurations.
<ul>
<li><em>Select Components</em> screen
<ul>
<li>AutoScript Client components
<ul>
<li>We recommend not installing the following: PyCharm Community IDE, .NET API, preferring to use VS Code as an IDE</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Select the installer option to add Python to the system Path.</li>
<li>Register to activate AutoScript license on this computer.</li>
<li>Restart the computer.</li>
</ul>
</li>
<li>
<p>Follow the Laser Control installation instructions provided by Thermo Fisher Scientific</p>
<ul>
<li>Install iFast and Python APIs</li>
</ul>
</li>
</ul>
<p>The AutoScript installer installs the following modules (generated with <code>pip freeze</code>):</p>
<pre><code class="language-sh">appdirs==1.4.4
argon2-cffi-bindings==21.2.0
argon2_cffi==21.3.0
attrs==21.2.0
autoscript-core @ file:///C:/Program%20Files/Thermo%20Scientific%20AutoScript/PythonPackages/autoscript_core-5.17.0-py3-none-any.whl
autoscript-sdb-microscope-client @ file:///C:/Program%20Files/Thermo%20Scientific%20AutoScript/PythonPackages/autoscript_sdb_microscope_client-4.8.1-py3-none-any.whl
autoscript-sdb-microscope-client-tests @ file:///C:/Program%20Files/Thermo%20Scientific%20AutoScript/PythonPackages/autoscript_sdb_microscope_client_tests-4.8.1-py3-none-any.whl
autoscript-toolkit @ file:///C:/Program%20Files/Thermo%20Scientific%20AutoScript/PythonPackages/autoscript_toolkit-4.8.1-py3-none-any.whl
backcall==0.2.0
bleach==4.1.0
build==0.7.0
ceres_solver==2.1.0
certifi==2021.5.30
cffi==1.14.6
charset-normalizer==2.0.3
colorama==0.4.6
configobj==5.1.0.dev0
cycler==0.11.0
Cython==0.29.33
decorator==5.1.0
defusedxml==0.7.1
docutils==0.17.1
entrypoints==0.4
fonttools==4.31.1
h5py==3.6.0
idna==3.1
imagecodecs==2022.2.22
imageio==2.16.2
importlib_metadata==4.11.4
intel_fortran_rt==2022.0.3
intel_openmp==2021.4.28
ipykernel==5.5.6
ipython==7.31.1
ipython-genutils==0.2.0
jedi==0.18.0
Jinja2==3.0.3
joblib==1.1.0
jsonschema==3.2.0
jupyter-client==6.1.12
jupyter-core==4.8.1
jupyterlab-pygments==0.1.2
kiwisolver==1.4.0
libaec==1.0.6
libbz2==1.0.8
libfreetype==2.12.1
libgflags==2.2.2
libglog==0.6.0
libharfbuzz==3.2.0
libhdf5==1.12.1
libicu==70.1
liblcms2==2.12
liblz4==1.9.3
liblzma==5.2.5
libopenjpeg==2.4.0.post1
libpng==1.6.37
libprotobuf==3.13.0
libqhull==8.0.2
libsodium==1.0.18
libtiff==4.3.0
libturbojpeg==2.1.2
libyaml==0.2.5
libz==1.2.11
libzmq==4.3.4
libzstd==1.5.0
Markdown==3.3.7
MarkupSafe==2.1.1
matplotlib==3.5.1
matplotlib-inline==0.1.6
mfc_runtime==14
mistune==0.8.4
mkl==2021.3.0
mkl-service==2.4.0
msvc_runtime==14
nbclient==0.5.12
nbconvert==6.4.2
nbformat==5.2.0
nest-asyncio==1.5.4
networkx==2.7.1
notebook==6.4.8
numexpr==2.8.1
numpy==1.21.2
opencv_python==4.6.0
packaging==22.0
pandas==1.3.2
pandocfilters==1.5.0
parso==0.8.2
pep517==0.9.1
pickleshare==0.7.5
Pillow-SIMD==9.0.0.post1
prometheus-client==0.13.1
prompt-toolkit==3.0.24
psutil==5.8.0
pycparser==2.20
Pygments==2.8.1
pyparsing==2.4.7
pyrsistent==0.15.3
PySide6==6.2.3
python-dateutil==2.8.2
pytz==2022.6
PyWavelets==1.3.0
pywin32==301
pywinpty==2.0.4
PyYAML==5.4.1
pyzmq==22.3.0
qtbase==6.2.3
qtconsole==5.3.0
qtdeclarative==6.2.3
qtmultimedia==6.2.3
QtPy==2.3.0
qtshadertools==6.2.3
qtsvg==6.2.3
qttools==6.2.3
requests==2.26.0
scikit-image==0.19.2
scikit-learn==1.0.2
scipy==1.8.0
Send2Trash==1.8.0
shiboken6==6.2.3
sip==6.5.1
six==1.16.0
terminado==0.13.2
testpath==0.5.0
thermoscientific-logging @ file:///C:/Program%20Files/Thermo%20Scientific%20AutoScript/PythonPackages/thermoscientific_logging-5.17.0-py3-none-any.whl
threadpoolctl==3.1.0
tifffile==2022.4.8
toml==0.10.2
tomli==2.0.1
toolz==0.11.1
tornado==6.1
traitlets==5.1.0
urllib3==1.26.3
wcwidth==0.2.5
webencodings==0.5.1
zipp==3.7.0
</code></pre>
<p>Confirm the installation location of Autoscript's python environment, which should default to the following path: <code>C:/Program Files/Enthought/Python/envs/Autoscript/python.exe</code>. You can verify this by running the following in the Command Prompt (<code>cmd.exe</code>):</p>
<pre><code class="language-sh">where python
</code></pre>
<p>which should output something similar to the following:</p>
<pre><code class="language-sh">C:\Program Files\Enthought\Python\envs\AutoScript\python.exe 
</code></pre>
<!-- ```sh
C:\Users\apolon\.conda\envs\pyebsd\python.exe
C:\Program Files\Enthought\Python\envs\AutoScript\python.exe
C:\Users\apolon\AppData\Local\Microsoft\WindowsApps\python.exe
``` -->
<h2 id="main-installation"><a class="header" href="#main-installation">Main Installation</a></h2>
<p>Installation can be performed by running the provided batch file <a href="https://github.com/sandialabs/pytribeam/blob/main/install.bat">install.bat</a> from the local directory where you want to install the package. This can be accomplished simply by double clicking on the <code>install.bat</code> file from the Windows Explorer. Options are provided for both client and developer (editable) use. This will install the wheels of various open-source python packages included with the package that are provided here: <a href="https://github.com/sandialabs/pytribeam/tree/main/wheelhouse">wheels</a>. Wheels are provided in order to eliminate the need for internet connectivity on the microscope.</p>
<p><strong>NOTE</strong>: Developer (editable) use provides the user with the ability to modify and expand the source code, such as adjusting default values in the <code>constants</code> module, which would be needed to run unit tests included in the package, as running of tests are tied to specific machine names provided in the <code>constants</code> module. Compiled unit test coverage for the package can be found for the latest release without installing as a developer here: <a href="https://sandialabs.github.io/pytribeam/coverage_reports/combined/htmlcov/index.html">test-coverage</a>.</p>
<p>After running the <code>install.bat</code> script, confirm the package installation by opening a new terminal and run the following to list the available package commands:</p>
<pre><code class="language-sh">pytribeam
</code></pre>
<p>which should generate the following output along with any relevant warning messages:</p>
<pre><code class="language-plaintext">WARNING: Laser API not imported!
	Laser control, as well as EBSD and EDS control are unavailable.

--------
pytribeam
--------

pytribeam
    (this command)

pytribeam_info
    Prints the module version and ThermoFisher Scientific Autoscript and Laser
    API version requirements.

pytribeam_gui
    Launches GUI for creating configuration .yml files and to control
    experimental collection.

pytribeam_exp &lt;path_to_file&gt;.yml
    Runs 3D data collection workflow based off of input .yml file.

    Example:
        path/to/experiment/directory&gt; pytribeam_exp path/to/config/file.yml


</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="reference-frame-conventions"><a class="header" href="#reference-frame-conventions">Reference Frame Conventions</a></h1>
<p>The general approach for 3D data collection adopted by this package is to use stage movements to ensure that the cut face is placed at the same relative distance to each beam regardless of the slice number. Therefore, when imaging the cut face, the electron beam working distance (distance between electron beam and image surface) should remain constant (fixed) over the course of the experiment. <code>pytribeam</code> provides automation to control stage movement throughout a serial-sectioning experiment to enable this expected beahvior.</p>
<p>To achieve the needed stage movements, a slice thickness and initial stage positions (for operations on the first slice) are requested from the user. All subsequent stage positions are calculated on the basis of these initial settings, so in order to ensure the cut face remains at the same working distance and location as the initial cut face, it is important to understand the reference frame conventions utilized by this package.</p>
<p><strong>WARNING:</strong> Incorrect selections of <strong>sectioning_axis</strong>, and <strong>pre_tilt_deg</strong> in <strong><a href="reference_frame/../config_file/general/index.html">General Experiment Settings</a></strong>, or <strong>rotation_side</strong> in <strong><a href="reference_frame/../config_file/steps/general/index.html">General Step Settings</a></strong> can result in acquisition with incorrect slice thicknesses and an apparent drift of the sample during data collection. This can result in loss of data or failed experiments.</p>
<h2 id="stage-axes"><a class="header" href="#stage-axes">Stage Axes</a></h2>
<p>The TriBeam has a 5-axis stage, including 3 translational axes (X, Y, Z) and two angular axes (T, R). The X and Y axes move the sample in-plane around the chamber, while the Z axis brings the stage closer or further from the electron beam pole piece. The angular tilt axis (T) tilts the stage about the X-axis to access different imaging/milling geometries, and the angular rotation axis (R) rotates the sample about the Z-axis for various sample alignment operations.</p>
<p>All stage coordinates are tracked in Thermo Fisher Scientific's <strong>RAW</strong> coordinate system, which differs from that utilized in the xTUI. The most notable change for users familiar with normal SEM operation is that the positive Z-direction moves the sample stage toward the electron column pole piece, not the working-distance "Z-linked" convention direction where Z is measured as the distance between the sample and the electron beam pole piece.</p>
<p>When facing the front chamber door, with the FIB column to the left of the electron column and the laser (if installed) to the right of the electron column, the following axes conventions are utilized:</p>
<ul>
<li>the positive X (+X) direction is coming out of the front chamber door</li>
<li>the positive Y (+Y) direction is to the right (toward the laser beam)</li>
<li>the positive Z (+Z) direction is toward the electron column</li>
<li>the positive T (+T) directions tilts the stage counterclockwise about the X axis</li>
<li>the positive R (+R) direction rotates the sample clockwise about the Z axis</li>
</ul>
<p>Ilustrations of these conventions follow below:
<img src="reference_frame/stage_side_view.png" alt="Stage Axes Side View" />
<em>Stage axes side view, as viewed standing in front of the TriBeam and facing the Front Chamber Door.</em></p>
<p><img src="reference_frame/stage_top_down.png" alt="Stage Axes Top-Down View" />
<em>Stage axes top down view, as viewed looking down (bird's eye view) onto the sample stage standing in front of the TriBeam and facing the Front Chamber Door.</em></p>
<h2 id="pre-tilt-angles"><a class="header" href="#pre-tilt-angles">Pre-tilt angles</a></h2>
<p>In order to access the various geometries required for data collection with all the detectors in the TriBeam, from glancing-angle FIB milling to EBSD collection, a pre-tilted sample is generally required to remain within stage hardware limits. Correctly identifying the pre-tilt used for a TriBeam data acquisition experiment is critical to ensure that the cut face of the sample remains at a consistent working distance throughout the experiment.</p>
<p>In <code>pytribeam</code>, we adopt a pre-tilt convention that tends to differ from most FIB experimentalist conventions, which stems from the difference in milling geometries, namely between surface normal and surface parallel (also called glancing angle) milling. Conventional FIB milling is typically conducted using surface normal geometries, wherein the sample surface is oriented perpendicular to the incoming ion beam to allow the ion beam to effectively "drill" into the sample. However, milling for large volume 3D datasets in <code>pytribeam</code> adopts a surface parallel milling geometry, where the milled area (or cut face) is set up to be parallel to the incoming beam. In this orientation, only the leading edge of the beam (either laser or ion) interacts with the surface, which has numerous advantages. Pre-tilt angles are therefore measured in terms of glancing-angle geometries, and are therefore typically the complementary angle of the pre-tilt angle convention used by surface normal milling geometries, (i.e., <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">an</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord">90°</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">or</span><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>).</p>
<p>The pre-tilt angle for <code>pytribeam</code> of your sample can most readily be found by determining what angle the tilt (T) axis would need to be set to in order to enable surface parallel milling with the laser beam. As the laser beam is mounted with a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">60°</span></span></span></span> offset from parallel with the electron beam in the TriBeam, it will cut into a completely flat sample (perpendicualrly oriented to the electron beam, typical for conventional electron imaging) at a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">30°</span></span></span></span> tilt angle.</p>
<p>A sample without pre-tilt (<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">0°</span></span></span></span> pre-tilt) would need to compensate for this cutting angle and need to be tilted to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord">+</span><span class="mord">30°</span></span></span></span> to have its top surface parallel with the incoming laser beam. If a user intends to use <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord">6°</span></span></span></span> for their laser milling step, this would signify a pre-tilt of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">36°</span></span></span></span> to align the top surface of the sample parallel to the laser beam during milling.</p>
<p>In general, the sum of the tilt angle to orient the top surface of the sample parallel to the laser beam and the pre-tilt angle should therefore be equal to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">30°</span></span></span></span>:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">s</span><span class="mpunct mtight">,</span><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">ser</span><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">hinin</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">re</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">lt</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">30°</span></span></span></span></span></p>
<p><strong>WARNING:</strong> This second example utilizing a T axis position of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord">6°</span></span></span></span> for the laser milling step is generally considered to be a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">54°</span></span></span></span> pretilt by FIB convention (the complementary angle of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">36°</span></span></span></span>), but will result in incorrect slice thicknesses and sample drift over time if used for a <code>pytribeam</code> experiment. The standard stub provided by Thermo Fisher for TriBeam datasets typically has a pretilt of either <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">36°</span></span></span></span> or <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">54°</span></span></span></span> depending on the orientation of the sample. When using <code>pytribeam</code>, please be sure to think of pre-tilt angles in terms of the above equation for glancing-angle milling of the sample.</p>
<h2 id="rotation-side"><a class="header" href="#rotation-side">Rotation Side</a></h2>
<p>In order to maintain the sample's working distance and preserve its location in the original field of view throughout an experiment, a pre-tilted sample will generally require a combination of both Z and Y axis movements as material is removed. <code>pytribeam</code> includes automated stage movement routines that takes these corrections into account to adjust these axes accordingly. As serial-sectioning iteratively removes material, the change in the Z axis position will always be positive given the axis conventions described <a href="reference_frame%5Cindex.html#stage-axes">above</a>. However, the direction of the Y axis movement will be determined based on the orientation of the sample and necessary adjustments due to limitations on stage tilt values. This behavior is captured with the <strong>rotation_side</strong> parameter included in stage positions for every step in a <code>pytribeam</code> workflow, which controls the sign of this movement. This parameter has 3 possible enumerations, including:</p>
<ul>
<li><strong>FSL_MILL</strong>: correction for pre-tilted sample stage movement when the sample is rotated on the side of laser milling operations. Results in a correction along the negative Y direction.</li>
<li><strong>FIB_MILL</strong>: correction for pre-tilted sample stage movement when the sample is rotated on the side of ion milling operations. Results in a correction along the positive Y direction.</li>
<li><strong>EBEAM NORMAL</strong>: correction for pre-tilted sample stage movement when no pre-tilt adjustment is needed, a special case currently utilized only in custom scripts and not recommended for normal operations.</li>
</ul>
<p>To explain the use of the normal operating modes, either <strong>FSL_MILL</strong> or <strong>FIB_MILL</strong>, the following example is provided for a sample utilizing a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">30°</span></span></span></span> pre-tilt, and a slice thickness <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>. The correct movement of the sample for subsequent slices can be determined using trigonometry as follows:</p>
<h3 id="laser-milling-step"><a class="header" href="#laser-milling-step">Laser milling step</a></h3>
<p>For a laser milling step, the user should select <strong>FSL_MILL</strong> for the <strong>rotation_side</strong> step setting, which correctly adjusts the Y axis position along the negative direction for this operation.</p>
<p>In this step, the stage tilt will remain at <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">0°</span></span></span></span> as the pre-tilt angle is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">30°</span></span></span></span> as discussed <a href="reference_frame%5Cindex.html#pre-tilt-angles">above</a>. The sample surface forms the long leg of a 30-60-90 triangle, with the slice thickness (the movement of the sample from Slice <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> to its previous location on Slice <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>) forming the short leg (black triangle). Using geometric properties of triangles, the Y and Z axis movements required to achieve the desired slice thickness can be decomposed into an additional inner 30-60-90 triangle (gray triangle) to calculate the absolute Y and Z axis moves required. For a slice thickness <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">10.0</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">μ</span><span class="mord mathnormal">m</span></span></span></span>, the Z axis must move <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.383em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.038em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.399em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">3</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">8.66</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">μ</span><span class="mord mathnormal">m</span></span></span></span> in the positive direction and the Y-axis must move <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1696em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8246em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">5.00</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">μ</span><span class="mord mathnormal">m</span></span></span></span> in the negative direction. This is illustrated below, where we want to move the sample position at <strong>Slice n</strong> to the previous cutting location at <strong>Slice n-1</strong>:</p>
<p><img src="reference_frame/rotation_side_fsl.png" alt="Rotation side FSL" />
<em>Geometric calculation of stage movements required to bring the sample surface to the fixed milling location, which involves moving the Y and Z axes to bring point <strong>Slice n</strong> to point <strong>Slice n-1</strong>. The Y axis must move by <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1696em;vertical-align:-0.345em;"></span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8246em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> and the Z axis must move by <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.383em;vertical-align:-0.345em;"></span><span class="mord">+</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.038em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.399em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">3</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> for this operation.</em></p>
<h3 id="electron-imaging-step-surface-normal-imaging"><a class="header" href="#electron-imaging-step-surface-normal-imaging">Electron imaging step (surface normal imaging)</a></h3>
<p>For an electron imaging step, it may be advantageous to have the cut sample surface perpendicular to the electron beam to reduce distortions and the need for additional post-processing that arises from imaging of tilted sample surfaces. However, it may not be possible to achieve a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord">30°</span></span></span></span> sample tilt on the T axis necessary to achieve this orientation for the pretilted sample as described. Luckily, this geometry can still be achieved if the sample is first rotated by <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">180°</span></span></span></span> using the R axis. This will then enable the user to orient the cut sample surface perpendicular to the electron beam by tilting the stage T axis to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord">+</span><span class="mord">30°</span></span></span></span> to offset the pre-tilt.</p>
<p>As we have rotated the sample <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">180°</span></span></span></span> for this operation the user should select <strong>FIB_MILL</strong> for the <strong>rotation_side</strong> step setting, which correctly adjusts the Y axis position along the positive direction for this operation.</p>
<p>In this step, the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">30°</span></span></span></span> rotation of the tilt axis T rotates the Z and Y axes as well, so we can use geometric properties of parallel lines and triangles to find the correct orientation of the 30-60-90 triangle in this case, with the slice thickness (the movement of the sample from Slice <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> to its previous location on Slice <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>) forming the short leg (black triangle). Using geometric properties, the Y and Z axis movements required to achieve the desired slice thickness can be decomposed into an additional outer 30-60-90 triangle (gray triangle) to calculate the absolute Y and Z axis moves required. For a slice thickness <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">10.0</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">μ</span><span class="mord mathnormal">m</span></span></span></span>, the Z axis must move <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.383em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.038em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.399em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">3</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">8.66</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">μ</span><span class="mord mathnormal">m</span></span></span></span> in the positive direction and the Y-axis must move <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1696em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8246em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">5.00</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">μ</span><span class="mord mathnormal">m</span></span></span></span>, now in the positive direction. This is illustrated below, where we want to move the sample position at <strong>Slice n</strong> to the previous cutting location at <strong>Slice n-1</strong>:</p>
<p><img src="reference_frame/rotation_side_fib.png" alt="Rotation side FIB" />
<em>Geometric calculation of stage movements required to bring the sample surface to the fixed imaging location, which involves moving the Y and Z axes to bring point <strong>Slice n</strong> to point <strong>Slice n-1</strong>. The Y axis must move by <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1696em;vertical-align:-0.345em;"></span><span class="mord">+</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8246em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> and the Z axis must move by <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.383em;vertical-align:-0.345em;"></span><span class="mord">+</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.038em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.399em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">3</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> for this operation.</em></p>
<p>Note that the magnitude of the stage movement is the same for both axes for both the <a href="reference_frame%5Cindex.html#laser-milling-step">laser milling step</a> and the <a href="reference_frame%5Cindex.html#electron-imaging-step-surface-normal-imaging">electron imaging step</a>, but that the sign of the Y axis movement is opposite due to the rotation of the stage. This is the critical functionality of the <strong>rotation_side</strong> parameter.</p>
<h2 id="imaging-quadrants"><a class="header" href="#imaging-quadrants">Imaging quadrants</a></h2>
<p><code>pytribeam</code> adopts the same imaging view (quad) convention as that of Thermo Fisher Scientific. When the xTUI screen is divdided into 4 quadrants of equal size, the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7936em;"></span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7936em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span></span></span></span> quadrant will be in the top left corner, the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span></span> quadrant in the top right corner, the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span></span> quadrant in the bottom left corner, and the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span></span></span></span> quadrant in the bottom right corner as illustrated below:</p>
<p><img src="reference_frame/quadrants.png" alt="Imaging quadrants" /></p>
<p><em>Image viewing quadrants as seen in xTUI.</em></p>
<h2 id="image-coordinate-system"><a class="header" href="#image-coordinate-system">Image Coordinate System</a></h2>
<p><code>pytribeam</code> supports the use of reduced area imaging for certain scan modes, specifically for the use of the <a href="reference_frame/../config_file/steps/image/index.html#auto_cb">auto contrast/brightness</a> functionality. This area is specified with a scan width and scan height ranging from <em>0.0</em> to <em>1.0</em>, with the origin (0,0) in the upper left corner, and the point (1,1) in the bottom right corner as in the following image:</p>
<p><img src="reference_frame/image_coord.png" alt="Imaging coordinate system" /></p>
<p><em>Image cooridnate system as seen in xTUI.</em></p>
<h2 id="patterning-coordinate-system"><a class="header" href="#patterning-coordinate-system">Patterning Coordinate System</a></h2>
<p><code>pytribeam</code> supports the use of patterning for <a href="reference_frame/../config_file/steps/fib/index.html#mill">ion beam milling</a>. The patterning coordinate system is defined with the origin as the center of the scan field of view, both horizontally and vertically with pattern centers defined in units of length around this origin point. Thus pattern centers can range from <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2251em;vertical-align:-0.345em;"></span><span class="mord">±</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">sc</span><span class="mord mathnormal mtight">an</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> in the horizontal direction and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2772em;vertical-align:-0.345em;"></span><span class="mord">±</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">sc</span><span class="mord mathnormal mtight">anh</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> in the vertical direction for the scan field of view. This is illustrated below:</p>
<p><img src="reference_frame/pattern_coord.png" alt="Patterning coordinate system" /></p>
<p><em>Patterning cooridnate system as seen in xTUI.</em></p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="configuration-file-yml"><a class="header" href="#configuration-file-yml">Configuration File (.yml)</a></h1>
<p>The following describes the creation and validation of a configuration file, which is expected to be in the .yml file format. Configuration files are separated into three main sections, namely:</p>
<ul>
<li>
<p><strong>config_file_version</strong> (<em>float</em>): The <code>.yml</code> file format, a float. Specific functionality in the <code>pytribeam</code> module is tied to different versions of configuration files. The most current <code>.yml</code> file version is <code>1.0</code>.</p>
</li>
<li>
<p><strong>general</strong> (<em>dict</em>): General settings applicable to the entire experiment, a dictionary. Details for individual keys can be found in <strong><a href="config_file/./general/index.html">General Settings</a></strong>.</p>
</li>
<li>
<p><strong>steps</strong> (<em>dict</em>): Settings for all individual steps or operations of an experiment, a dictionary. Details for individual sub-dictionaries outlining a specific step type can be found in <strong><a href="config_file/./steps/index.html">Step Settings</a></strong>.</p>
</li>
</ul>
<h2 id="notes-on-configuration-file-parameters"><a class="header" href="#notes-on-configuration-file-parameters">Notes on configuration file parameters</a></h2>
<ul>
<li>
<p>Various parameters rely on default constants (both ranges and specific values), some of which can be adjusted by the user in the configuration file, but most of which are defined in the <code>constants</code> module. Variables defined in the <code>constants</code> module can only be modified if the user installs the <code>pytribeam</code> package in an editable format (see <strong><a href="config_file/../installation/index.html">Installation</a></strong> for more details) and adjusts the default values before using the package.</p>
</li>
<li>
<p>Some parameters are optional or may need to be left blank to avoid conflicting with other settings. In these cases, users may opt not to provide an entry for the parameter. This can be achieved by leaving the entry blank or by entering the <code>NoneType</code> value for <code>.yml</code> files, which should be entered as the <em>string</em> <code>null</code>.</p>
</li>
<li>
<p>At the beginning of an experiment, all parameters are processed through a validator to catch obvious issues or errors with configuration file parameters. Although this cannot catch all possible invalid configuration file parameters, a description of issues is provided where possible to help resolve these validation errors. This validator can also be accessed directly in the GUI prior to running an experiment (see <strong><a href="config_file/../gui/index.html">GUI</a></strong> for details on use).</p>
</li>
</ul>
<h2 id=""><a class="header" href="#"></a></h2>
<p>The subsequent sections detail individual settings for both the <strong>general</strong> and <strong>steps</strong> dictionaries.</p>
<!-- [Preprocessor]: preprocessors.md
[Renderer]: renderers.md
[Environment Variable]: environment-variables.md --><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="general-settings"><a class="header" href="#general-settings">General Settings</a></h1>
<ul>
<li>
<p><strong>slice_thickness_um</strong> (<em>float</em>): The sectioning slice thickness in micron units, a float. This parameter controls stage movements, and should generally be larger than the observed stage repeatability. Limits are enforced from the <strong>slice_thickness_limit_um</strong> variable in the <code>constants</code> module, which defaults to an inclusive range of 0.0 to 30.0 microns. Slice thicknesses greater than or equal to 2.0 microns are recommended depending on stage precision and accuracy. Slice thicknesses larger than 30.0 microns are not recommended due to the laser spot size, but these can be achieved using multiple thinner laser milling operations in conjunction with the <strong>frequency</strong> parameter (see <strong><a href="config_file/general/../steps/general/index.html">General Step Settings</a></strong>) to intermittently perform any imaging or other data collection step.</p>
</li>
<li>
<p><strong>max_slice_num</strong> (<em>int</em>): The number of slices to collect in the experiemnt, an integer. This parameter must be greater than 0.</p>
</li>
<li>
<p><strong>pre_tilt_deg</strong> (<em>float</em>): The pre-tilt angle of the specimen in degree units, a float. This controls compound stage movements to ensure pre-tilted specimens move toward the respective beam (electron, ion, or laser) correctly. To correctly identify the <strong>pre_tilt_deg</strong> for your specimen, please consult <strong><a href="config_file/general/../../reference_frame/#pre-tilt-angles">Reference Frame Conventions</a></strong> for examples and a more detailed description of the conventions adopted in this tool. For a <strong>sectioning_axis</strong> of <strong>Z</strong>, limits are enforced by the <strong>pre_tilt_limit_deg_generic</strong> variable in the <code>constants</code> module, which defaults to an inclusive range of -60.0 to 60.0 degrees. For all other <strong>sectioning_axis</strong> values, <strong>pre_tilt_deg</strong> is enforced by the <strong>pre_tilt_limit_deg_non_Z_sectioning</strong> variable in the <code>constants</code> module, which defaults to a <strong>pre_tilt_deg</strong> of 0.0 degrees only.</p>
</li>
<li>
<p><strong>sectioning_axis</strong> (<em>str</em>): The sectioning direction used to calculate stage movements, a string which must be a member of the <strong>SectioningAxis</strong> enum in the <code>types</code> module. Please consult <strong><a href="config_file/general/../../reference_frame/#stage-axes">Reference Frame Conventions</a></strong> for examples and a more detailed description of the conventions adopted in this tool to understand the signs of these directions. The available enumeration values are:</p>
<ul>
<li><strong>X+</strong>: sectioning along the positive x-axis</li>
<li><strong>X-</strong>: sectioning along the negative x-axis</li>
<li><strong>Y+</strong>: sectioning along the positive y-axis</li>
<li><strong>Y-</strong>: sectioning along the negative y-axis</li>
<li><strong>Z</strong>: sectioning along the positive z-axis</li>
</ul>
<p><strong>NOTE</strong>: Only a <strong>sectioning_axis</strong> of <strong>Z</strong> is currently supported. Future updates will target this additional functionality.</p>
</li>
<li>
<p><strong>stage_translation_tol_um</strong> (<em>float</em>): The allowable tolerance for translation stages (X, Y, and Z axes), in micron units. During requested stage movements, requests to individual translation axes for movement will only be sent if the target position is further than this value from the current axis position. A default value of 0.5 micron is included in the <code>constants</code> module, but this default will be overwritten by the user-provided value in the configuration file. This value should be significantly smaller than the <strong>slice_thickness_um</strong> to minimize slice thickness variation throughout an experiment.</p>
</li>
<li>
<p><strong>stage_angular_tol_deg</strong> (<em>float</em>): The allowable tolerance for angular stages (R and T axes), in degree units. During requested stage movements, requests to individual angular axes for movement will only be sent if the target position is further than this value from the current axis position. A default value of 0.02 degrees is included in the <code>constants</code> module, but this default will be overwritten by the user-provided value in the configuration file.</p>
</li>
<li>
<p><strong>connection_host</strong> (<em>str</em>): The host server or IP address to connect to the microscope, a string. The value of this variable is system-dependent and is related to the setup configuration utilized while installing the <code>autoscript</code> software from Thermo Fisher Scientific. Examples include <code>localhost</code> and <code>196.168.0.1</code>. This connection, along with the provided <strong>connection_port</strong> will be tested during <code>.yml</code> validation.</p>
</li>
<li>
<p><strong>connection_port</strong> (<em>int</em>): The port on the <strong>connection_host</strong> with which to initialize the microscope connection, an integer and optional parameter. If no <strong>connection_port</strong> is needed, leave this entry blank or enter the the <code>NoneType</code> keyword in the <code>.yml</code> (<code>null</code>).</p>
</li>
<li>
<p><strong>EBSD_OEM</strong> (<em>str</em>): The original equipment manufacturer (OEM) of the EBSD detector used in the system, a string which must be a member of the <strong>ExternalDeviceOEM</strong> enum in the <code>types</code> module. If no OEM is provided, control over the EBSD detector will not be enabled during data collection. If EDS is also enabled in this experiment, the values must match, but EDS can be disabled by providing the <code>NoneType</code> keyword in the <code>.yml</code> (<code>null</code>). The available enumeration values are:</p>
<ul>
<li><strong>Oxford</strong>: Oxford Instruments detector</li>
<li><strong>EDAX</strong>: EDAX detector</li>
<li><code>None</code>: Enter the keyword <code>null</code> or leave the entry blank in the .yml file. This will disable EDS detector control for the experiment.</li>
</ul>
</li>
<li>
<p><strong>EDS_OEM</strong> (<em>str</em>): The original equipment manufacturer (OEM) of the EDS detector used in the system, a string which must be a member of the <strong>ExternalDeviceOEM</strong> enum in the <code>types</code> module. If no OEM is provided, control over the EDS detector will not be enabled during data collection. If EBSD is also enabled in this experiment, the values must match, but EBSD can be disabled by providing the <code>NoneType</code> keyword in the <code>.yml</code> (<code>null</code>). The available enumeration values are:</p>
<ul>
<li><strong>Oxford</strong>: Oxford Instruments detector</li>
<li><strong>EDAX</strong>: EDAX detector</li>
<li><code>None</code>: Enter the keyword <code>null</code> or leave the entry blank in the .yml file. This will disable EDS detector control for the experiment.</li>
</ul>
</li>
<li>
<p><strong>exp_dir</strong> (<em>str</em>): Experimental directory to store the log file and any images captured by the microscope, a string. The specific directory does not need to exist and will be automatically generated at the start of the experiment, but a valid creatable path must be provided (e.g. <code>exp_dir = "C:/path/to/experimental/directory"</code>). As EBSD and EDS data is generally collected on a separate machine and specific map settings must be preset by the user (see <strong><a href="config_file/general/../steps/ebsd_eds/index.html">EBSD and EDS Settings</a></strong> for details on external device integration), these data will not be automatically included in the experimental directory, are likely to not be stored on the same machine, and may have unqiue file naming conventions that do not correspond with those handled directly by the <code>pytribeam</code> package.</p>
</li>
<li>
<p><strong>h5_log_name</strong> (<em>str</em>): Filename for the log file that automatically stores various state information during data collection, a string. Log files are saved in the <code>.h5</code> HDF (Hierarchical Data Format) extension. The suffix <code>.h5</code> is automatically added to the end of the user-provided value (if needed), so an entry of <code>h5_log_name</code> or <code>h5_log_name.h5</code> will result in the creation of the same log file (<code>h5_log_name.h5</code>) within the experimental directory.</p>
</li>
<li>
<p><strong>step_count</strong> (<em>int</em>): The number of steps in the experiment, an integer. Used to validate the configuration file. Must be greater than zero and be equal to the number of steps contained in the <strong>steps</strong> section of the <code>.yml</code> settings as described in <strong><a href="config_file/general/../steps/index.html">Step Settings</a></strong>. This value should auto-update when using the <strong><a href="config_file/general/../../gui/index.html">GUI</a></strong>.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="step-settings"><a class="header" href="#step-settings">Step Settings</a></h1>
<p>Configuration files contain a list of all the individual operations that form the data acquisition pipeline. These comprise one of the root level elements of the <code>.yml</code> file called <code>steps:</code>.</p>
<p>Each step is designated as a nested mapping with the highest-level nesting designating the name of the step. For each step, these settings are broken down further into lower level nested mappings. All steps must contain a <code>step_general</code> nested mapping that contains information applicable to all step types. Depending on the specific step type, other unique nested mappings at the same level of <code>step_general</code> key-value pairs will be required. The following subsections provide more detailed information on these nested mappings, namely:</p>
<ul>
<li>
<p><strong><a href="config_file/steps/../steps/general/index.html">Step General</a></strong>: Step settings applicable to all step types, including stage position and frequency settings.</p>
</li>
<li>
<p><strong><a href="config_file/steps/../steps/image/index.html">Image</a></strong>: Step settings to take images with the electron or ion beams.</p>
</li>
<li>
<p><strong><a href="config_file/steps/../steps/laser/index.html">Laser</a></strong>: Step settings to perform patterning/milling with the femtosecond laser beam.</p>
</li>
<li>
<p><strong><a href="config_file/steps/../steps/fib/index.html">FIB</a></strong>: Step settings to perform patterning/milling with the focused ion beam.</p>
</li>
<li>
<p><strong><a href="config_file/steps/../steps/ebsd_eds/index.html">EBSD and EDS</a></strong>: Step settings to collect EBSD, EDS, or EBSD with concurrent (combined) EDS data.</p>
</li>
<li>
<p><strong><a href="config_file/steps/../steps/custom/index.html">Custom</a></strong>: Step settings to run a custom script as an operation. Recommended for advanced users only.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="step-general-settings"><a class="header" href="#step-general-settings">Step General Settings</a></h1>
<p>General settings required for each step, independent of the specific step type.</p>
<ul>
<li>
<p><strong>step_type</strong> (<em>str</em>): The type of operation to be completed, a string which must be a member of the <strong>StepType</strong> enum in the <code>types</code> module. The available enumerations are</p>
<ul>
<li>
<p><strong>image</strong>: A step to collect a micrograph with either the electron or ion beams.</p>
</li>
<li>
<p><strong>laser</strong>: A step to ablate material with the femtosecond laser.</p>
</li>
<li>
<p><strong>fib</strong>: A step to mill material with the ion beam, will also collect an image of the surface.</p>
</li>
<li>
<p><strong>ebsd</strong>: A step to initiate an EBSD scan that has been preset by the user on the EBSD-controlled computer. Users must utilize a EBSD OEM supported by Thermo Fisher to utilize this functionality.</p>
</li>
<li>
<p><strong>eds</strong>: A step to initiate an EDS scan that has been preset by the user on the EBSD-controlled computer. Users must utilize a EDS OEM supported by Thermo Fisher to utilize this functionality.</p>
</li>
<li>
<p><strong>custom</strong>: A step to run a custom script as a subprocess.</p>
</li>
</ul>
</li>
<li>
<p><strong>step_number</strong> (<em>int</em>): The total number of steps in the experiment, an integer. This parameter must be greater than 0.</p>
</li>
<li>
<p><strong>frequency</strong> (<em>int</em>): How often to perform a specific step, an integer. For some frequency <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span>, the step will be performed every <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0435em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span></span></span></span> slice. Useful for intermittent collection of some data types that can take longer to collect, such as EDS. This parameter must be greater than 0, and a frequency of 1 will perform this step on every slice.</p>
</li>
</ul>
<h2 id="stage"><a class="header" href="#stage">stage</a></h2>
<p>Information on location of the stage and how the stage should be moved.</p>
<ul>
<li>
<p><strong>rotation_side</strong> (<em>str</em>): The side on the R axis on which the step should be completed, a string which must be a member of the <strong>RotationSide</strong> enum in the <code>types</code> module. Primarily controls how the Y axis will move (positive or negative direction) when the sample is pretilted. More details can be found <a href="config_file/steps/general/../../../reference_frame/index.html#rotation-side">here</a>. The available enumerations are</p>
<ul>
<li><strong>fsl_mill</strong>: Typically used for laser machining and EBSD operations.</li>
<li><strong>fib_mill</strong>: Typically used for FIB milling and imaging operations.</li>
<li><strong>ebeam_normal</strong>: A special case currently utilized only in custom scripts. Not recommended for normal operations.</li>
</ul>
</li>
</ul>
<h3 id="initial_position"><a class="header" href="#initial_position">initial_position</a></h3>
<p>The starting position of the step on the first slice, taken in Thermo Fisher Scientific's <strong>RAW</strong> Stage Coordinate system. For details on this, click <a href="config_file/steps/general/../../../reference_frame/index.html#stage-axes">here</a>.</p>
<ul>
<li>
<p><strong>x_mm</strong> (<em>float</em>): The starting <strong>RAW</strong> position of the X axis in units of millimeters, a float.</p>
</li>
<li>
<p><strong>y_mm</strong> (<em>float</em>): The starting <strong>RAW</strong> position of the Y axis in units of millimeters, a float.</p>
</li>
<li>
<p><strong>z_mm</strong> (<em>float</em>): The starting <strong>RAW</strong> position of the Z axis in units of millimeters, a float.</p>
</li>
<li>
<p><strong>t_deg</strong> (<em>float</em>): The starting <strong>RAW</strong> position of the T axis in units of degrees, a float.</p>
</li>
<li>
<p><strong>r_deg</strong> (<em>float</em>): The starting <strong>RAW</strong> position of the R axis in units of degrees, a float.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="image-step-settings"><a class="header" href="#image-step-settings">Image Step Settings</a></h1>
<p>Specific settings for an image type step, which provides options for setting many of the relevant imaging parameters for the beam used (voltage, current, etc.), the detector (type, mode, etc.), and the scan (resolution, dwell, etc.). For any imaging step, the image will be saved in folder sharing the name of the step (highest level of the dictionary contained with the <code>steps:</code> key) within the experimental directory variable (<strong>exp_dir</strong>) specified in the <strong><a href="config_file/steps/image/../../general/index.html">General Settings</a></strong> dictionary.</p>
<ul>
<li><strong>bit_depth</strong> (<em>int</em>): The bit depth of the saved imaged, an integer. Must be a member of the <strong>ColorDepth</strong> enum in the <code>types</code> module. Only 8 or 16 bit depths are supported, and images with custom resolutions (i.e not a <strong>PRESET</strong>, resolution, see here for more details) will automatically be saved at a bit depth of 8. 8-bit images have a grayscale color range of 0-255 (<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>), while 16-bit images have a grayscale color range of 0-65,535 (<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">16</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>).</li>
</ul>
<h2 id="beam"><a class="header" href="#beam">beam</a></h2>
<p>Various settings to control the imaging beam to save a micrograph.</p>
<ul>
<li>
<p><strong>type</strong> (<em>str</em>): The type of beam used to take the image, a string. Must be one of the enumerated <strong>BeamType</strong> values defined in the 1types` module. The supported enum values are:</p>
<ul>
<li><strong>electron</strong>: The electron beam.</li>
<li><strong>ion</strong>: The ion beam. If a FIB step type is selected, the imaging beam must be an <strong>ion</strong> beam type.</li>
</ul>
</li>
<li>
<p><strong>voltage_kv</strong> (<em>float</em>): The accelerating voltage of the beam in kiloVolts, a float.</p>
</li>
<li>
<p><strong>voltage_tol_kv</strong> (<em>float</em>): The allowed tolerance on the measured beam voltage that will trigger a call to adjust the voltage. An absolute value in kiloVolts, a float. If the requested beam voltage is 20.0 kV with a voltage tolerance of 0.5 kV, the system will attempt to adjust the beam voltage if the measured beam voltage is less than 19.5 kV or greater than 20.5 kV.</p>
</li>
<li>
<p><strong>current_na</strong> (<em>float</em>): The current of the beam in nanoAmps, a float.</p>
</li>
<li>
<p><strong>current_tol_na</strong> (<em>float</em>): The allowed tolerance on the measured beam current that will trigger a call to adjust the amperage. An absolute value in nanoAmps, a float. If the requested beam voltage is 15.0 nA with a current tolerance of 1.0 nA, the system will attempt to adjust the beam current if the measured beam current is less than 14.0 nA or greater than 16.0 nA.</p>
</li>
<li>
<p><strong>hfw_mm</strong> (<em>float</em>): The horizontal field width view of the scan field in units of millimeters, a float. This directly controls the magnification of the beam.</p>
</li>
<li>
<p><strong>working_dist_mm</strong> (<em>float</em>): The working distance in units of millimeters, a float. This directly controls the focus of the beam, with an in-focus image working distance measuring the distance from the pole piece to the sample surface being imaged.</p>
</li>
<li>
<p><strong>dynamic_focus</strong> (<em>bool</em>): A flag whether or not to utilize dynamic focus, a boolean value of either <code>True</code> or <code>False</code>. Dynamic focus is typically used in concert with a correctly set sample tilt angle to dynamically adjust the working distance of the beam as the beam scans from the top to the bottom of the image. Dynamic focus cannot be used for ion imaging and only works for a <strong>scan_rotation</strong> (see <a href="config_file/steps/image%5Cindex.html#scan">here</a>) of 0 degrees.</p>
</li>
<li>
<p><strong>tilt_correction</strong> (<em>bool</em>): A flag whether or not to utilize tilt correction, a boolean value of either <code>True</code> or <code>False</code>. Tilt correction is typically used in concert with a correctly set sample tilt angle to adjust the spacing of the vertical scan controller to remove linear distortions of a tilted plane, which may appear foreshortened relative to imaging beam. Tilt correction cannot be used for ion imaging and only works for a <strong>scan_rotation</strong> (see <a href="config_file/steps/image%5Cindex.html#scan">here</a>) of 0 degrees.</p>
</li>
</ul>
<h2 id="detector"><a class="header" href="#detector">detector</a></h2>
<p>Various settings to control the imaging detector to save a micrograph.</p>
<ul>
<li>
<p><strong>type</strong> (<em>str</em>): The type of detector used to collect the image, a string. Must be an enumerated value in the<strong>DetectorType</strong> class defined in the <code>types </code> module, which contains all possible supported detector types, some of which may not be available on your system. Some examples of common detector types that are supported include:</p>
<ul>
<li><strong>ABS</strong>: annular backscatter detector, an insertable device.</li>
<li><strong>CBS</strong>: concentric backscatter detector, an insertable device.</li>
<li><strong>ETD</strong>: Everhart Thornley detector</li>
<li><strong>ICE</strong>: Ion conversion and electron detector</li>
<li><strong>TLD</strong>: Through Lens Detector</li>
</ul>
</li>
<li>
<p><strong>mode</strong> (<em>str</em>): The mode of the detector used to collect the image, a string. Must be an enumerated value in the <strong>DetectorMode</strong> class defined in the <code>types </code> module, which contains all possible supported detector modes, some of which may not be available on your system and are specific to individual detector types. Some examples of common detector modes that are supported on the <strong>ETD</strong> detector include:</p>
<ul>
<li><strong>SecondaryElectrons</strong>: secondary electrons</li>
<li><strong>BackscatterElectrons</strong>: backscattered electrons</li>
</ul>
</li>
<li>
<p><strong>brightness</strong> (<em>float</em>): The brightness of the active detector, a float from <em>0.0</em> to <em>1.0</em>. Controls the voltage offset of the detector. Manually sets the brightness and cannot be combined with the auto contrast/brightness (<strong>auto_cb</strong>) functionality.</p>
</li>
<li>
<p><strong>contrast</strong> (<em>float</em>): The contrast of the active detector, a float from <em>0.0</em> to <em>1.0</em>. Controls the electronic gain of the detector. Manually sets the contrast and cannot be combined with the auto contrast/brightness (<strong>auto_cb</strong>) functionality.</p>
</li>
</ul>
<h3 id="auto_cb"><a class="header" href="#auto_cb">auto_cb</a></h3>
<p>Settings to utilize the auto contrast/brightness adjustment of the active detector. Sets the active region (or sub_region) of the active imaging quadrant in which to perform the automated routine. Future releases may provide additional functionlity to adjust the auto contrast/brightness routine. For details on the sub_region coordinate system, see <a href="config_file/steps/image/../../../reference_frame/index.html#image-coordinate-system">here</a>. The specific settings for the <strong>auto_cb</strong> operaton are:</p>
<ul>
<li><strong>left</strong> (<em>float</em>): The position of the left edge of the region of interest, a float from <em>0.0</em> to <em>1.0</em>, with <em>0.0</em> representing the left edge of the image and <em>1.0</em> representing the right edge of the image.</li>
<li><strong>width</strong> (<em>float</em>): The width of the rectangle starting from the <strong>left</strong> edge of the box. The sum of <strong>left</strong> + <strong>width</strong> must be less than or equal to <em>1.0</em>.</li>
<li><strong>top</strong> (<em>float</em>): The position of the top edge of the region of interest, a float from <em>0.0</em> to <em>1.0</em>, with <em>0.0</em> representing the top edge of the image and <em>1.0</em> representing the bottom edge of the image.</li>
<li><strong>height</strong> (<em>float</em>): The height of the rectangle starting from the <strong>top</strong>* edge of the box. The sum of <strong>top</strong> + <strong>height</strong> must be less than or equal to <em>1.0</em>.</li>
</ul>
<h2 id="scan"><a class="header" href="#scan">scan</a></h2>
<p>Various settings to control the scan settings to save a micrograph. The time to collect an image can be roughly calculated by multiplying the dwell time by the number of pixels as determined by the resolution of the image. For example, using a preset resolution of <strong>6144x4096</strong> with a 3 microsecond dwell time will take roughly 75.5 seconds to collect.</p>
<ul>
<li>
<p><strong>rotation_deg</strong> (<em>float</em>): The rotation of the scan field in degrees, a float. Non-zero values of <strong>rotation_deg</strong> cannot be used in combination with <strong>tilt_correction</strong> and <strong>dynamic_focus</strong> settings (see <a href="config_file/steps/image%5Cindex.html#beam">above</a>).</p>
</li>
<li>
<p><strong>dwell_time_us</strong> (<em>float</em>): The time the beam should dwell at each pixel in the scan field, in units of microseconds, a float. Must be a positive, non-zero value within the dwell time limits of the tool.</p>
</li>
<li>
<p><strong>resolution</strong> (<em>str</em>): The resolution of the image to be collected, a string in the form of <strong>WIDTH</strong>x<strong>HEIGHT</strong>. Many preset resolutions (mostly with 3:2 aspect ratios) are supported, including:</p>
<ul>
<li>512x442</li>
<li>768x512</li>
<li>1024x884</li>
<li>1536x1024</li>
<li>2048x1768</li>
<li>3072x2048</li>
<li>4096x3536</li>
<li>6144x4096</li>
</ul>
</li>
</ul>
<p>Custom resolutions from 12 up to 65,535 pixels on edge are also supported, but care should be taken to account for potential lensing distortions and sample drift when collecting large numbers of pixels across large fields of view, which can take several minutes to collect. Custom (non-preset) resolutions can also only be saved to images of 8-bit colordepth (grayscale values of 0-255).</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="laser-step-settings"><a class="header" href="#laser-step-settings">Laser Step Settings</a></h1>
<p>Specific settings for a laser type step, which provides options for setting many of the relevant patterning parameters for machining with the femtosecond laser beam.</p>
<ul>
<li><strong>objective_position_mm</strong> (<em>float</em>): Position of the objective in the laser injection port, in millimeters, a float. Used to control the position of the focal point of the laser beam. Good settings for this can be determined from calibrating the laser beam. Both the 1030 nm and 515 nm wavelength beams will tend to have slightly different optimal positions for milling. Various additional properties of the objective position are controlledin the <code>constants</code> module, including:
<ul>
<li>An absolute position tolerance of 0.005 millimeters is used to determine whether or not a requested objective position movement was sucessful.</li>
<li>A safe <strong>retracted</strong> position is set to 2.5 millimeters.</li>
<li>Objective positions limits are set to between 2.0 and 29.0 millimeters (inclusive).</li>
</ul>
</li>
</ul>
<h2 id="pulse"><a class="header" href="#pulse">pulse</a></h2>
<p>Various settings to control the laser pulse used for patterning.</p>
<ul>
<li>
<p><strong>wavelength_nm</strong> (<em>int</em>): The wavelength of laser light, must be one of the enumerated types specified in the <code>types</code> module, an integer. The two wavelengths are achieved with or without the use of second-harmonic generation (frequency doubling), which converts the native 1030 nm wavelength light to 515 nm.</p>
<ul>
<li><strong>515</strong>: 515 nm light achieved via second-harmonic generation. Generally better for finer polishing with the laser.</li>
<li><strong>1030</strong>: 1030 nm native light from the fiber laser. Generally better for large scale removal of material and/or rough cutting.</li>
</ul>
</li>
<li>
<p><strong>divider</strong> (<em>int</em>): Ratio of generated pulses to deliver to the sample surface, an integer. A pulse divider of <strong>1</strong> will deliver all pulses to the sample surface, a divdier of <strong>2</strong> will deliver every <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span></span> pulse, a divider of <strong>n</strong> will deliver every <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span></span></span></span> pulse to the surface. Higher pulse dividers can be useful for more beam sensitive materials.</p>
</li>
<li>
<p><strong>energy_uj</strong> (<em>float</em>): The energy of an individual pulse, in microJoules, a float. To protect the various optics used to deliver the laser to the chamber, maximum pulse energy values may differ for changing values of <strong>pulse_divider</strong>.</p>
</li>
<li>
<p><strong>polarization</strong> (<em>str</em>): The polarization of the laser light, as controlled by a flipper polarizer configuration. <strong>NOTE</strong> Polarization mode can be set, but currently there is no way to verify the current active polarization via the laser API. Must be an enumerated member of the <strong>LaserPolarziation</strong> class in the <code>types</code> module. Currently supported values include:</p>
<ul>
<li><strong>vertical</strong>: Vertically polarized light</li>
<li><strong>horizontal</strong>: Horizontatlly polarized light.</li>
</ul>
</li>
</ul>
<h2 id="beam_shift"><a class="header" href="#beam_shift">beam_shift</a></h2>
<p>The beam shift to apply to the laser beam <em>in addition</em> to what is already present in the manual shift in Thermo Fisher Scientific's Laser Control GUI. If you plan to switch laser wavelengths during an experiment and need to apply different beam shifts for each wavelength of light, be sure to set the beam shifts to 0.0 micron in Thermo Fisher Scientific's Laser Control GUI and instead input the determined shifts here for each laser step.</p>
<ul>
<li>
<p><strong>x_um</strong> (<em>float</em>): The beam shift along the x-direction in microns, a float.</p>
</li>
<li>
<p><strong>y_um</strong> (<em>float</em>): The beam shift along the y-direction in microns, a float.</p>
</li>
</ul>
<h2 id="pattern"><a class="header" href="#pattern">pattern</a></h2>
<p>Various settings to control the laser pattern used for machining.</p>
<ul>
<li>
<p><strong>rotation_deg</strong> (<em>float</em>): The rotation of the entire pattern in degrees, a float.</p>
</li>
<li>
<p><strong>mode</strong> (<em>str</em>):</p>
<ul>
<li><strong>fine</strong>: Fine patterning mode, generally better for polishing of surfaces. Requires a value for the <strong>pulses_per_pixel</strong> parameter.</li>
<li><strong>coarse</strong>: Coarse patterning mode, generally better for rough cutting or removal of large amounts of material. Requires a value for the <strong>pixel_dwell</strong> parameter.</li>
</ul>
</li>
<li>
<p><strong>pulses_per_pixel</strong> (<em>int</em>): Number of pulses to put down at each pixel location in the pattern, a positive, non-zero integer. Locations are determined by the pattern size and pitch. Can only be used with <strong>fine</strong> patterning mode.</p>
</li>
<li>
<p><strong>pixel_dwell_ms</strong> (<em>float</em>): Time to dwell at each pixel location in the pattern, a positive, non-zero float. Locations are determined by the pattern size and pitch. Can only be used with <strong>coarse</strong> patterning mode.</p>
</li>
</ul>
<h3 id="type"><a class="header" href="#type">type</a></h3>
<p>Various settings for the geometry and shape of the pattern. Must be a valid enumerated value in the <strong>LaserPatternType</strong> class defined in the <code>types</code> module. Currently supported pattern types include:
- <strong>box</strong>
- <strong>line</strong></p>
<ul>
<li>
<p><strong>box</strong>:
A box pattern type requiring the following parameters:</p>
<ul>
<li>
<p><strong>passes</strong> (<em>int</em>): The number of times to repeat the entire pattern, a non-zero, positive integer.</p>
</li>
<li>
<p><strong>size_x_um</strong> (<em>float</em>): The size of the pattern along the x-direction (width) in microns, a float.</p>
</li>
<li>
<p><strong>size_y_um</strong> (<em>float</em>): The size of the pattern along the y-direction (height) in microns, a float.</p>
</li>
<li>
<p><strong>pitch_x_um</strong> (<em>float</em>): The spacing of adjacent pixels along the x-direction in microns, a float. Controls the spacing of columns of points in the pattern.</p>
</li>
<li>
<p><strong>pitch_y_um</strong> (<em>float</em>): The spacing of adjacent pixels along the y-direction in microns, a float. Controls the spacing of rows of points in the pattern.</p>
</li>
<li>
<p><strong>scan_type</strong> (<em>str</em>):
Controls the sequence of points scanned in combination with the <strong>coordinate_ref</strong> parameter. Must be a member of the <strong>LaserScanType</strong> enum class defined in the <code>types</code> module. Currently supported values for <strong>box</strong> patterns include:</p>
<ul>
<li><strong>serpentine</strong>: Pattern will be executed from left to right on the first and all other odd-numbered rows, and from right to left on the second and all other even-numbered rows, creating a serpentine, or snake scan pattern.</li>
<li><strong>raster</strong>: Pattern will be executed from left to right on every row, mimicking how an electron beam image is typically captured.</li>
</ul>
</li>
<li>
<p><strong>coorindate_ref</strong> (<em>str</em>):
Defines the origin of box for positioning the pattern relative to the applied beam shift.</p>
<ul>
<li><strong>center</strong>: box will be drawn around the currently applied beam shift position, centering it evenly in both x- and y-directions.</li>
<li><strong>uppercenter</strong>: box will be drawn vertically down from the currently applied beam shift position, but centered along the x-direction. The typically preferred <strong>coordinate_ref</strong> value for most 3D datasets.</li>
<li><strong>upperleft</strong>: box will be drawn using the currently applied beam shift position as the top left corner of the pattern.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>line</strong>:
A box pattern type requiring the following parameters:</p>
<ul>
<li>
<p><strong>passes</strong> (<em>int</em>): The number of times to repeat the entire pattern, a non-zero, positive integer.</p>
</li>
<li>
<p><strong>size_um</strong> (<em>float</em>): The size of the pattern in microns, a float.</p>
</li>
<li>
<p><strong>pitch_um</strong> (<em>float</em>): The spacing of adjacent pixels in microns, a float.</p>
</li>
<li>
<p><strong>scan_type</strong> (<em>str</em>):
Controls the sequence of points scanned. Must be a member of the <strong>LaserScanType</strong> enum class defined in the <code>types</code> module. Currently supported values for <strong>line</strong> patterns include:</p>
<ul>
<li><strong>single</strong>: Every pass starts at the beginning of the pattern and ends at the end of the pattern, repeating the pattern in the same direction. The 1-D equivalent of the <strong>raster</strong> scan_type for <strong>box</strong> patterns.</li>
<li><strong>lap</strong>: Every subsequent pass reverses the direction of the previous pass. The 1-D equivalent of the <strong>serpentine</strong> scan_type for <strong>box</strong> patterns.</li>
</ul>
</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="fib-step-settings"><a class="header" href="#fib-step-settings">FIB Step Settings</a></h1>
<p>Specific settings for a FIB type step, which provides options for milling with the ion beam.</p>
<p>Some intro text, image vs mill settings, do not need to be the same</p>
<h2 id="image-settings"><a class="header" href="#image-settings">Image Settings</a></h2>
<p>FIB steps have an internal set of imaging settings that follows the same convention as a standard image. This image is collected prior to any patterning or milling. Please see <a href="config_file/steps/fib/../image/index.html">here</a> for more information on <strong>Image Settings</strong>. If you do not need to mill with ion beam and only want to take an image, use an <strong>image</strong> type step instead. For FIB type steps, the image will always be taken with the ion beam.</p>
<h2 id="mill"><a class="header" href="#mill">mill</a></h2>
<p>FIB milling settings contain nested mappings for the beam settings and pattern settings.</p>
<h3 id="beam-1"><a class="header" href="#beam-1">beam</a></h3>
<p>Beam settings follow the same conventions as described in <a href="config_file/steps/fib/../image/#beam">beam settings</a>. This allows the user to change various settings between the image and pattern, such as using a lower accelerating voltage or beam current for ion imaging and a higher beam current and/or voltage for the actual milling operation.</p>
<p>Although the user has the option to change other settings such as the <strong>horizontal field width</strong> (magnification) between imaging and milling, it is generally recommended to keep this value constant. As with the imaging operation in a FIB step type, only an ion beam can be used for patterning for these milling operations, which also means <strong>dynamic focus</strong> and <strong>tilt correction</strong> are not accessible for this data type. Users should also note that any <strong>scan rotation</strong> applied from the imaging settings in a FIB step type will be maintained when the milling pattern is placed, so care should be taken to ensure the patterning settings are determined at the same scanning conditions.</p>
<h3 id="pattern-1"><a class="header" href="#pattern-1">pattern</a></h3>
<p>Patterning settings for the ion beam contain various nested mappings depending on the type of patterning desired.</p>
<ul>
<li><strong>application_file</strong> (<em>str</em>): The application file preset, a string. All pattern types require the use of a preset recipe that controls various low-level settings of patterning such as <em>overlap</em> of adjacent pixels, <em>dwell time</em>, <em>defocus</em>, and <em>blur</em>. Nearly all microscopes will come with a variety of default recipes, including <strong>Si</strong> and <strong>Al</strong>, but many users also develop and create their own recipes. Any custom application files created by the user should be saved in the same directory location as the default application files in order to be accessed by this tool.</li>
</ul>
<p>When using the <a href="config_file/steps/fib/../../../gui/README.html">GUI</a>, a dynamic list of the available application files for your particular system will automatically be generated. When not using the GUI, users can determine this list themselves by running the following <code>python</code> script:</p>
<pre><code class="language-python">import pytribeam.types as tbt
import pytribeam.utilities as ut
import pytribeam.factory as factory

# define parameters for your specific microscope connection
connection_host = "localhost" # a string or NoneType
connection_port = None # a string or NoneType

# create the microscope object and connect to it
microscope = tbt.Microscope()
ut.connect_microscope(
    microscope=microscope,
    connection_host=connection_host,
    connection_port=connection_port,
)

# determine what application files are available on this connection
found_application_files = factory.active_fib_applications(
    microscope=microscope
) # returns a list
print("Found the following application files:")
for item in found_application_files:
    print(f"\t{item}")
    
</code></pre>
<h4 id="type-1"><a class="header" href="#type-1">type</a></h4>
<p>There are currently supported pattern types, which must be an enumerated member of the <em>FIBPatternType</em>* class in the <code>types</code> module. Currently supported pattern types include:</p>
<ul>
<li><strong>rectangle</strong>: A rectangle pattern type.</li>
<li><strong>regular_cross_section</strong>: A regular cross-section pattern type.</li>
<li><strong>cleaning_cross_section</strong>: A cleaning cross-section pattern type.</li>
<li><strong>selected_area</strong>: Specialty functionality requiring some python scripting knoweldge to make arbitrary scan geometries. Details on usage can be found <a href="config_file/steps/fib/./selected_area_milling/index.html">here</a></li>
</ul>
<p>Settings for one and only one pattern type are supported for a given FIB step. If more complex milling geometries are desired, please see the section on the<a href="config_file/steps/fib/./selected_area_milling/index.html"><strong>selected_area</strong></a> pattern type.</p>
<p>The <strong>rectangle</strong>, <strong>regular_cross_section</strong> and <strong>cleaning_cross_section</strong> pattern types all have the same set of parameters, namely:</p>
<ul>
<li>
<p><strong>center</strong>: The center of the pattern using the <a href="config_file/steps/fib/../../../reference_frame/index.html#patterning-coordinate-system">Patterning coorindate system</a>.</p>
<ul>
<li><strong>x_um</strong> (<em>float</em>): location of the pattern center along the x-axis in microns, a float.</li>
<li><strong>y_um</strong> (<em>float</em>): location of the pattern center along the y-axis in microns, a float.</li>
</ul>
</li>
<li>
<p><strong>width_um</strong> (<em>float</em>): The width of the pattern along the x-axis in microns, a float.</p>
</li>
<li>
<p><strong>height_um</strong> (<em>float</em>): The height of the pattern along y-axis in microns, a float.</p>
</li>
<li>
<p><strong>depth_um</strong> (<em>float</em>): The depth of the pattern along z-axis (into the sample) in microns, a float.</p>
</li>
<li>
<p><strong>scan_direction</strong> (<em>str</em>): The scan direction controls the direction of scanning of box type patterns, which includes <strong>rectangle</strong>, <strong>regular_cross_section</strong> and <strong>cleaning_cross_Section</strong> patterns. The <strong>scan_direction</strong> must be an enumerated value in the <strong>FIBPatternScanDirection</strong> class in the <code>types</code> module. Currently supported values include:</p>
<ul>
<li><strong>BottomToTop</strong></li>
<li><strong>TopToBottom</strong></li>
<li><strong>LeftToRight</strong></li>
<li><strong>RightToLeft</strong></li>
<li><strong>DynamicTopToBottom</strong></li>
<li><strong>DynamicAllDirections</strong></li>
<li><strong>DynamicLeftToRight</strong></li>
</ul>
</li>
<li>
<p><strong>scan_type</strong> (<em>str</em>): Controls the sequence of points scanned in combination with the <strong>scan_direction</strong> parameter. Must be a member of the <strong>FIPatternScanType</strong> enum class defined in the <code>types</code> module. Currently supported values include:</p>
<ul>
<li><strong>Serpentine</strong>: Reverse direction (left-to-right switch to right-to-left, or top-to-bottom switches to bottom-to-top) on every subsequent line.</li>
<li><strong>Raster</strong>: Repeat the patterning direction (left-to-right, bottom-to-top, etc.) on every line.</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="selected-area-milling"><a class="header" href="#selected-area-milling">Selected Area Milling</a></h1>
<p>When simple box-like patterns will not suffice, user of <code>pytribeam</code> can utilized the <strong>selected_area</strong> pattern type, which generates a stream file based off a masked image. Originally designed for non-prismatic or non-rectangular sample shapes, this approach enables users to create an image processing workflow based off the ion image taken at the start of the FIB step type to make arbitrary patterns defined on a per-pixel basis. Unlike other supported pattern types, the <strong>selected_area</strong> pattern type has its own set of user defined parameters, including:</p>
<ul>
<li>
<p><strong>dwell_us</strong> (<em>float</em>): The time to dwell on each pixel in a pass in microseconds, a float. The dwell time must be a positive float <em>and</em> an integer multiple of the base dwell time, which is set to 25 ns in the <code>constants</code> module.</p>
</li>
<li>
<p><strong>repeats</strong> (<em>int</em>): The number of times to repeat the pattern, a positive integer.</p>
</li>
<li>
<p><strong>recipe_file</strong> (<em>str</em>): The path to the recipe file that will perform image processing. The parameter must be a valid file path string with the extension <code>.py</code> and must already exist. See <a href="config_file/steps/fib/selected_area_milling%5Cindex.html#implementation">Implementation</a> below for more details.</p>
</li>
<li>
<p><strong>mask_file</strong> (<em>str</em>): The path to the mask file created by the <strong>recipe_file</strong> script. Must be a valid file path string with the extension <code>.tif</code>, and must be created by the time the <strong>recipe_file</strong> script has finished execution.</p>
</li>
</ul>
<h2 id="implementation"><a class="header" href="#implementation">Implementation</a></h2>
<p>In order to utilize the selected area milling functionality, the user must be able to create a <code>python</code> script that performs the necessary image processing routine to create a binarized mask. This mask can either be a true binary array image (only values of <code>True</code> or <code>False</code>), or an integer array of values containing only <code>0</code> or <code>1</code>. This binary mask will be used to create a stream file.</p>
<p><strong>NOTE</strong>: Mask arrays containing any other values may not work as expected. Future releases may target the utilization of scalar values to automatically adjust dwell times, but for now only fully binarized masks will create the expected behavior.</p>
<p>When the stream file is created, the provided image is automatically scaled to a width of 4096, with nearest neighbor interpolation only. This means that for a FIB image with horizontal field width of 500 microns, the created stream pattern will have a pixel step size of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">120</span></span></span></span> nanometers. It is important to take this pixel density into account when selecting the number of <strong>repeats</strong> for the selected area pattern.</p>
<p>In order to ensure that the stream pattern is scaled correctly, there will also be a single point placed in the upper left corner of the scan field at the start of the stream pattern and a single point in the lower right corner of the scan field at the end of the stream pattern (see <a href="config_file/steps/fib/selected_area_milling/../../../../reference_frame/README.html#patterning-coordinate-system">patterning coordinate frame</a> for more details). This enforces that the stream file will be executed using the <strong>TopToBottom</strong> scan direction and the <strong>Raster</strong> scan type.</p>
<h3 id="a-working-example"><a class="header" href="#a-working-example">A working example</a></h3>
<p>Below is an example ion image taken of a sample pedestal in a glancing angle configuration. The image has been manipulated and mirrored across the horizontal axis in order to create a V-shaped area that would represent the area we want to mill. The black regions arise from the image manipulation in order to make a complex shape in cross-section to illustrate the utility of the selected area arpproach.</p>
<p><img src="config_file/steps/fib/selected_area_milling/fib_image.png" alt="fib_image" />
<em>A representative ion beam image taken of a sample pedestal in a glancing angle FIB milling configuration. The image has been synthetically manipulated with a slight rotation and mirroring operations to create a non-prismatic shape ill-suited for conventional box-type patterning geometries. Continued backtilting of the sample (higher degree of glancing) will foreshorten the width of the bright region, which has previously been machined with the laser, while reducing the amount of backtilting (less glancing angle) will increase the width of the bright region. The pedestal appears upside down as we are looking from the perspective of the ion beam, and the black areas are the result of the image manipulation to create an complex geometry region to mill.</em></p>
<p>The pedestal appears to be flipped upside down as we are imaging from the perspective of the ion beam. The laser-machined region is the bright V-shaped area near the center of the image, and the textured gray region above this is the side of our sample pedestal. Typically after laser machining the region of interest for glancing angle milling will appear much brighter than the rest of the sample.</p>
<p>We want to create a binarized mask of the V-shaped region of interest in order to create our stream file. The end result of our image processing produces the following image:</p>
<p><img src="config_file/steps/fib/selected_area_milling/fib_mask.png" alt="fib_mask" />
<em>The masked version of the original image after image processing. We have successfuly isolated the V-shaped region of interest without need to draw a much larger box pattern.</em></p>
<p>This image was produced with the following script, which we will discuss in further detail below:</p>
<pre><code class="language-python"># python standard libraries
from pathlib import Path
import sys

# 3rd party libraries included with autoscript
from PIL import Image as pil_img
import numpy as np
from skimage import filters, measure


def process_image(
    input_path: Path,
    output_path: Path,
) -&gt; bool:
    # open the image
    with pil_img.open(input_path) as test_img:
        # convert to numpy array
        fib_img = np.asarray(test_img)
        
        # find and apply an Otsu filter
        threshold = filters.threshold_otsu(fib_img)
        segmented = fib_img &gt; threshold

    # Remove all but the largest continuous feature by:

    # label connected components
    labeled_img, num_features = measure.label(
        segmented,
        return_num=True,
        connectivity=1,
    )

    # find largest componet:
    largest = None
    max_size = 0
    for component in range(1, num_features + 1):
        size = np.sum(labeled_img == component)
        if size &gt; max_size:
            max_size = size
            largest = component

    # mask largest component (remove all others)
    mask = labeled_img == largest

    # write out image
    mask = pil_img.fromarray(mask)
    mask.save(output_path)

    return True


if __name__ == "__main__":
    # Get input and output paths passed from the subprocess:
    input_path = Path(sys.argv[1])
    output_path = Path(sys.argv[2])

    # Process the image
    process_image(
        input_path=input_path,
        output_path=output_path,
    )
</code></pre>
<h3 id="the-image-processing-script"><a class="header" href="#the-image-processing-script">The image processing script</a></h3>
<p>Looking at the above script used to generate the binarized mask, we can see there are three main sections to the script. This same rough structure should be maintained for any custom recipe file created by the user. Several of the imports in the first part must be included, and the standard entry point, <code>if __name__ == "__main__":</code> section should not be modified by the user. The user should only modify the <code>process_image</code> function to achieve the desired image processing routine. More details on the various parts of the script follow below:</p>
<ul>
<li>
<p>Part 1, library imports:</p>
<p>The top several lines contain several <code>import</code> statements. Here we are bringing in various libraries, either native to <code>python</code> or included in the <code>pytribeam</code> package, to perform various tasks. The first two imports are critical and must be included in the final recipe file:</p>
<pre><code class="language-python"># python standard libraries
from pathlib import Path
import sys
</code></pre>
<p>The remainder of the import statements can be modified by the user depending on the nature of the image processing workflow. This example uses a variety of simple tools (<code>pillow</code>, <code>numpy</code>, and <code>scikit-image</code>) to import, segment, and write out image data that will already be avialable in your <code>python</code> environment.</p>
</li>
<li>
<p>Part 2: The image processing recipe.</p>
<p>All of the image processing to generate the desired binarized mask is achieved through the <code>process_image()</code> function.</p>
<p>The example script performs the following operations to generate the binarized mask image shown <a href="config_file/steps/fib/selected_area_milling%5Cindex.html#a-working-example">above</a>:
- Import the image using the <code>Pillow</code> library
- Convert the image to a <code>numpy</code> array
- Apply a simple Otsu threshold
- Remove all but the largest continuous feature:
- Label connected components
- Find the largest continuous component
- Mask the largest component, removing all others
- Save out the image</p>
<p>Users may implement their own image processing routines and bring in any other functions or packages they deem necessary or helpful to get their desired result. It is, however, imperative that the users be sure to write out the final image as a <code>.tif</code> file before the end of the <code>process_image()</code> function. Users should there plan to retain at least the following lines, or something similar, at the end of their <code>process_image()</code> function:</p>
<pre><code class="language-python"># write out image
mask = pil_img.fromarray(mask)
mask.save(output_path)

return True
</code></pre>
</li>
<li>
<p>Part 3: The standard entry point.</p>
<p>Users should not adjust the last several lines of this example, as this is required by <code>pytribeam</code> to correctly pass the user-defined settings of where to find the input grayscale ion image (automatically defined by the experimental directory, the step name, and the slice number) and where to save the ouput mask image (the <strong>mask_file</strong> user parameter). These lines allow the initiated subprocess from the main <code>pytribeam</code> acquisition loop to parse parameters correctly:</p>
<pre><code class="language-python">if __name__ == "__main__":
    # Get input and output paths passed from the subprocess:
    input_path = Path(sys.argv[1])
    output_path = Path(sys.argv[2])

    # Process the image
    process_image(
        input_path=input_path,
        output_path=output_path,
    )
</code></pre>
</li>
</ul>
<p>Users can test their script by calling the following, provided they have correctly defined the variables <code>recipe_file</code>, <code>input_image_path</code> and <code>mask_file</code> as strings. The following should create the <code>mask_file</code> image at the user-defined location:</p>
<pre><code class="language-python">import subprocess

output = subprocess.run(
[
    "python",
    recipe_file, # recipe_file
    input_image_path, # input path,
    mask_file, # outputpath,
],
capture_output=True,
)
if output.returncode != 0:
raise ValueError(
    f"Subprocess call did not execute correctly."
)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="ebsd-and-eds-settings"><a class="header" href="#ebsd-and-eds-settings">EBSD and EDS Settings</a></h1>
<p>Settings for EBSD and EDS type steps are exactly equivalent to those for Image type steps. Settings for imaging conditions can be found <a href="config_file/steps/ebsd_eds/../image/index.html">here</a>.</p>
<p>Automation for the insertion and removal of these detectors, as well as starting collection of the maps with the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span></span> party vendor are included in these special step types and require no additional parameters in the <code>pytribeam</code> configuration file. However, due to current limitations in API access across vendors, users must setup their own maps independently, and only one map type is supported at this time. Therefore, users cannot create experiment pipelines that contain both EBSD and EDS type steps (only one or the other), which is enforced by validation at run time. However, both supported vendors do offer the capability to concurrently capture EDS spectra with EBSD patterns, which users can set up independently prior to inititaing an experiment.</p>
<p>The only difference in settings from a standard <strong>Image</strong> step type applies specifically to <strong>EBSD</strong> type steps, which have one additional parameter:</p>
<ul>
<li><strong>concurrent_EDS</strong> (<em>bool</em>): <code>True</code> or <code>False</code> flag needed to ensure we insert and retract both detectors if requested. For concurrent EDS with EBSD, both sets of scan parameters must be defined first by the user.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="custom"><a class="header" href="#custom">Custom</a></h1>
<p>Beyond the built-in step types described previously, <code>pytribeam</code> also enables users to create their own custom scripts to run during an acquisition experiment. This can be useful for prototyping new workflows, or performing unique operations that are specific to the user's instrument or configuation. <code>pytribeam</code> offers this adapter for advanced users that are comfortable with creating their own automation workflows, either with the lower-level functionality of <code>pytribeam</code> package, which is described in <a href="https://sandialabs.github.io/pytribeam/docs/api/pytribeam.html">API documentation</a>, or through any other executable package the users have access to.</p>
<p>All custom scripts are executed as a subprocess via the main <code>python</code> loop. To assist in various operations that may be of interest to users of the <strong>Custom</strong> step type, <code>pytribeam</code> creates a <code>.yml</code> file prior to the execution of the subprocess called <code>slice_info.yml</code> that is saved in the user-defined experimental directory. This file is automatically deleted after sucessfull execution of the subprocess and contains the following information:
- exp_dir: The experimental directory as a string
- slice_number: The current active slice number as an integer</p>
<p>Additional information could be included in the <code>.yml</code> file upon request for future releases.</p>
<p>The <strong>Custom</strong> step type takes the following parameters:</p>
<ul>
<li>
<p><strong>script_path</strong> (<em>str</em>): The path of the script the user intends to run. The file must exist, and does not necessarilly have to a <code>python</code> file (see below)</p>
</li>
<li>
<p><strong>executable_path</strong> (<em>str</em>): The path to any valid executable installed on the machine. The executable must exist, and should be able to run the <strong>script_path</strong> as an argument from the command line.</p>
</li>
</ul>
<p>As <strong>Custom</strong> scripts were generally designed for <code>python</code> scripts using the <code>subprocess</code> module, users should expect the following to be executable from the command line while using a <strong>Custom</strong> script:</p>
<pre><code class="language-sh">path/to/exectuable.exe path/to/script.file_extension
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="example-configuration"><a class="header" href="#example-configuration">Example configuration</a></h1>
<p>Below is an example valid two-step configuration <code>.yml</code> file containing two different imaging steps:</p>
<pre><code class="language-yml">config_file_version: 1.0
general:
  slice_thickness_um: 2.0
  max_slice_num: 3
  pre_tilt_deg: 33.5
  sectioning_axis: Z
  stage_translational_tol_um: 0.5
  stage_angular_tol_deg: 0.02
  connection_host: localhost
  connection_port: null
  EBSD_OEM: null
  EDS_OEM: null
  exp_dir: ./
  h5_log_name: log_verbose.h5
  step_count: 2
steps:
  image:
    step_general:
      step_type: image
      step_number: 1
      frequency: 1
      stage:
        rotation_side: fsl_mill
        initial_position:
          x_mm: 1.0
          y_mm: 1.999
          z_mm: 5.002
          t_deg: 0.0
          r_deg: -50.0
    beam:
      type: electron
      voltage_kv: 5.0
      voltage_tol_kv: 0.25
      current_na: 5.0
      current_tol_na: 0.25
      hfw_mm: 0.9
      working_dist_mm: 4.093
      dynamic_focus: null
      tilt_correction: null
    detector:
      type: ETD
      mode: SecondaryElectrons
      brightness: 0.2
      contrast: 0.3
      auto_cb:
        left: null
        width: null
        top: null
        height: null
    scan:
      rotation_deg: 0.0
      dwell_time_us: 1.0
      resolution: 768x512
    bit_depth: 8
  image2:
    step_general:
      step_type: image
      step_number: 2
      frequency: 1
      stage:
        rotation_side: fib_mill
        initial_position:
          x_mm: 0.0
          y_mm: 0.0
          z_mm: 0.0
          t_deg: 0.0
          r_deg: 0.0
    beam:
      type: electron
      voltage_kv: 20.0
      voltage_tol_kv: 1.0
      current_na: 0.45
      current_tol_na: 0.0225
      hfw_mm: 0.01
      working_dist_mm: 0.0
      dynamic_focus: null
      tilt_correction: null
    detector:
      type: ETD
      mode: SecondaryElectrons
      brightness: 0.2
      contrast: 0.3
      auto_cb:
        left: null
        width: null
        top: null
        height: null
    scan:
      rotation_deg: 0.0
      dwell_time_us: 1.0
      resolution: 1024x884
    bit_depth: 8
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="gui"><a class="header" href="#gui">GUI</a></h1>
<p><code>pytribeam</code> includes a native GUI built on python standard libraries to assist users with the creation of <a href="gui/../config_file/index.html">configuration files</a> and to start and monitor experiments. Use of the GUI is the recommended mode of operation of the package, but users can also run an experiment directly from the command line (see <a href="gui/../cli/index.html">command line interface</a> for more details on this functionality).</p>
<p>After a successful install of the package following the <a href="gui/../installation/index.html">installation instructions</a>, users can launch the GUI in one of two ways:</p>
<ul>
<li>running the command <code>pytribeam_gui</code> from any console. The console must stay open while the GUI application is running.</li>
<li>running the included <code>GUI.ps1</code> script with powershell by right-clicking on the icon and selecting "Run with PowerShell". This will only open the GUI window.</li>
</ul>
<p>Users should see the following landing page when loading the GUI:</p>
<p><img src="gui/landing_page.png" alt="landing_page" /></p>
<p>The langing page is broken up into several sections, namely:</p>
<ul>
<li><a href="gui%5Cindex.html#menu-bar"><strong>Menu Bar</strong></a></li>
<li><a href="gui%5Cindex.html#experiment-configuration"><strong>Experiment Configuration</strong></a></li>
<li><a href="gui%5Cindex.html#acquisition-management"><strong>Acquisition Management</strong></a></li>
<li><a href="gui%5Cindex.html#acquisition-monitoring"><strong>Acquisition Monitoring</strong></a></li>
</ul>
<h2 id="menu-bar"><a class="header" href="#menu-bar">Menu Bar</a></h2>
<p>The top menu bar provides various functionalities, including:</p>
<ul>
<li><strong>Help</strong>: This will attempt to open the user guide, either a local version of the userguide, or the online version stored <a href="https://sandialabs.github.io/pytribeam/docs/userguide/book/index.html">here</a>. If you want a local version, please download the built book (the entirety of the <code>book</code> folder) from the <code>gh-pages</code> branch <a href="https://github.com/sandialabs/pytribeam/tree/gh-pages/docs/userguide">here</a> and put it in the following location relative to where you installed the package: <code>./docs/userguide/</code>.</li>
<li><strong>Clear terminal</strong>: Clear any messages below the welcome message in the central console window.</li>
<li><strong>Test connections</strong>: Checks whether <code>pytribeam</code> can successfully talk with the Laser and any 3rd party EBSD or EDS detectors. A window will pop-up displaying the results of the test. Thermo Fisher Scientific's Laser application must be open to connect, and EBSD and EDS connectivity additionally requires a connection to the Laser.</li>
<li><strong>Export Log</strong>: Opens <code>Save As...</code> file dialog to export the contents of the terminal to a text file.</li>
<li><strong>Change Theme</strong>: Switch between <em>Dark</em> and <em>Light</em> themes for the GUI.</li>
<li><strong>Exit</strong>: Exits the program. This should not be performed while an acquisition is running, instead the experiment should be stopped as described <a href="gui%5Cindex.html#acquisition-management">below</a>.</li>
</ul>
<h2 id="experiment-configuration"><a class="header" href="#experiment-configuration">Experiment Configuration</a></h2>
<p>The upper-left side of the GUI contains tools for creating, editing, and validating configuration files. A new configuration file can be created by clicking the <strong>Create</strong> button, which opens up a new window with the <strong>TriBeam Configurator</strong>, details on which can be found <a href="gui/./configurator/index.html">here</a>.</p>
<p>Exisiting configuration files can be loaded by clicking the <strong>Load</strong> button, which will open up a file browser. Once a configuration file is created or loaded, the configurator can be reopened by clicking the <strong>Edit</strong> button or validated by clicking the <strong>Validate</strong>  button. Validation includes a full-suite of checks on configuration files intended to catch any invalid or improper settings that can stop an acquisition from running. This validation is always performed at the start/continuation of an experiment, but its use in the GUI can help to identify any errors prior to the start of an acquisition.</p>
<h2 id="acquisition-management"><a class="header" href="#acquisition-management">Acquisition Management</a></h2>
<p>The bottom-left side of the GUI contains various buttons for starting and stopping an acquisition, and also provides the user with direct control over what slice and step to begin acquiring a dataset. This includes the following buttons:</p>
<ul>
<li><strong>Start experiment</strong>: Begin acquisition at the currently displayed starting slice and step.</li>
<li><strong>Stop after current step</strong>: Cleanly exit data acquistion at the end of the step currently being exectued.</li>
<li><strong>Stop after current slice</strong>: Cleanly exit data acquisiton at the end of the slice currently being collected (will complete all remaining steps on that slice in order).</li>
<li><strong>Hard stop</strong>: Stops the experiment as quickly as possible by severing the microscope connection. Also throws the <code>Esc</code> command to the xTUI to stop any in-process stage movements. Control over insertable devices already in motion is not guaranteed after this has been pressed, but no additional commands will be sent to the microscope by <code>pytribeam</code> after this button has been pressed.</li>
</ul>
<h2 id="acquisition-monitoring"><a class="header" href="#acquisition-monitoring">Acquisition Monitoring</a></h2>
<p>The right-side of the GUI contains a large terminal window to capture output from the data acquisition that updates the user on current activities such as stage destination positions, whether detectors are being inserted or retracted, beam voltage adjustments, and more. Any warning or error messages generated during an acquisition will also be output to this terminal. The terminal currently has no limit on output length (10 million ASCII characters, over 100,000 lines, should take less than 10 MB of RAM), but this may change in the future. It is advisable to clear the terminal using the Menu bar when restarting/resuming an experiment to avoid any potential performance issues. Below the terminal window is high-level data related to total experiment progress, the current slice and step, as well as an average slice time.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="configurator"><a class="header" href="#configurator">Configurator</a></h1>
<p>The TriBeam Configurator is a built-in tool for the GUI to assist users with correctly creating experiment configuration files. Upon opening from the main GUI, the user should see the following:</p>
<p><img src="gui/configurator/configurator.png" alt="configurator_landing_page" /></p>
<p>The configurator is principally concerned with creation, editing, saving and validation of <code>.yml</code> files that store experiment settings for an entire data acuqisition pipeline. The configurator is broken up into three main sections:</p>
<ul>
<li><a href="gui/configurator%5Cindex.html#menu-bar"><strong>Menu Bar</strong></a></li>
<li><a href="gui/configurator%5Cindex.html#pipeline-editor"><strong>Pipeline Editor</strong></a></li>
<li><a href="gui/configurator%5Cindex.html#step-editor"><strong>Step Editor</strong></a></li>
</ul>
<h2 id="menu-bar-1"><a class="header" href="#menu-bar-1">Menu Bar</a></h2>
<p>The menu bar contains several buttons, namely:</p>
<ul>
<li>
<p><strong>Menu</strong>: Options for creating new configuration files, loading or saving the current configuration. This contains multiple options:</p>
<ul>
<li><strong>New</strong>: Create a new configuration file.</li>
<li><strong>Load</strong>: Load an existing configuration file.</li>
<li><strong>Save</strong>: Save/overwrite the current configuration file. Will not attempt to validate the file</li>
<li><strong>Save as</strong>: Save the current configuration file. Will not attempt to validate the file.</li>
<li><strong>Save &amp; Exit</strong>: will attempt to validate the current configuration. If successful, will overwrite and close the configurator.</li>
</ul>
</li>
<li>
<p><strong>Validate</strong>: Options for validating all or part of the configuration file. The status of the current file (<em>VALID</em>, <em>INVALID</em>, or <em>UNVALIDATED</em>) appears on the right side of the pipeline editor. Validation will report the first error (if any are found) in each respective step. Options include, namely:</p>
<ul>
<li><strong>Full</strong>: Validate entire configuration file.</li>
<li><strong>Step</strong>: Validate the currently selected step only.</li>
<li><strong>General</strong>: Validate the general settings (considered to be Step 0, but not an operation) only.
<strong>NOTE</strong> A general step must be validated before any individual steps can be validated.</li>
</ul>
</li>
<li>
<p><strong>Microscope</strong>: Contains various utilities for reading properties directly from the microscope. Users are encouraged to setup stage and imaging conditions manually in xTUI and then utilize these utilities to directly copy settings into the configuration file, which will account for the vast majority of settings. Current utilities include:</p>
<ul>
<li>
<p><strong>Import stage positions...</strong>: Reads current microscope stage position (in RAW stage coordinates) and records these values in the currently selected step. Applies to all step types.</p>
</li>
<li>
<p><strong>Import imaging conditions...</strong>: Reads current microscope imaging conditions (voltage, current, resolution, detector settings, etc.) for the active quadrant and records these values in the currently selected step. Applies to <strong>Image</strong>, <strong>FIB</strong> and <strong>EBSD_EDS</strong> step types.</p>
</li>
<li>
<p><strong>Import laser settings...</strong>: Reads current laser settings and records these values (beam settings, patterning, etc.).</p>
<ul>
<li><strong>NOTE</strong>: There is currently no method to actively read the <strong>Polarization</strong> parameter from the laser directly, so this value will default to <em>vertical</em> polarization automatically. Please manually select <em>horizontal</em> polarization after importing laser settings if this configuration is desired. Applies to <strong>Laser</strong> step types.</li>
</ul>
<p><strong>NOTE</strong>: There is currently no method to actively read the <strong>Pattern</strong> settings in a <strong>FIB</strong> step type, these values must be manually input by the user.</p>
</li>
</ul>
</li>
<li>
<p><strong>Version</strong>: Drop-down menu to select the version of configuration file to be completed by the configurator. Different versions of configuration files in future releases will have differing settings parameters to accommodate new features.</p>
</li>
</ul>
<h2 id="pipeline-editor"><a class="header" href="#pipeline-editor">Pipeline Editor</a></h2>
<p>The left side of the configurator shows the layout of the current pipeline. All experiments must start with a general settings step, which captures high-level information about the experiment. Steps can be added by clicking the <strong>Add Step</strong> button, which brings a dropdown menu for the various supported step types. See <a href="gui/configurator/../../config_file/steps/index.html">here</a> for more information on various step types supported by <code>pytribeam</code>. Steps in the pipeline editor are denoted with their sequence, a user-editable step name, and the step type in parentheses.</p>
<p>To adjust the order of operations, right-click on a step to bring up a new dropdown menu for the following:</p>
<ul>
<li><strong>Delete</strong>: Remove the step from the pipeline.</li>
<li><strong>Move Up</strong>: Move the selected step one position up in the pipeline.</li>
<li><strong>Move Down</strong>: Move the selected step one position down in the pipeline.</li>
</ul>
<h2 id="step-editor"><a class="header" href="#step-editor">Step Editor</a></h2>
<p>The right-side of the configurator is used for filling out specific settings for a particular step. There are various sections with dropdown menus that can be expanded by clicking on the right-facing triangles on the left side of each section. These sections can similarly be collapsed by clicking the upside-down triangle as desired.</p>
<p>A quick description of each variable can be seen by hovering over the variable name on the left side of the step editor section.</p>
<p>The step editor contains several different types of inputs, including:</p>
<ul>
<li>
<p><strong>open entry boxes</strong>: Receive string, integer, or floating point input, which generally have a wide open bar with left formatted text. Several of these will be grayed out for automatically recorded values (e.g. <strong>Step Number</strong> and <strong>Step Type</strong>, which are determined by the Pipeline Editor). A subset of these are for filepath locations, which additionally have a button with ellipses on it on the far right side that will open a file browser to select the correct path.</p>
</li>
<li>
<p><strong>button selection</strong>: User may select from a list of specifically enumerated values. Examples include <strong>Beam Type</strong> or <strong>Detector Type</strong> for an imaging type step. Some of these may have no filled value, even after using the Microscope utilities described above, and require the user to select the value. For example, the <a href="gui/configurator/../../reference_frame/#rotation-side"><strong>Rotation Side</strong></a> parameter under Stage settings must be selected by the user.</p>
</li>
<li>
<p><strong>radio buttons</strong>: On/Off selection variables for boolean variables. Examples include <strong>Use Dynamic Focus</strong> and <strong>Use Tilt Correction</strong> in an imaging type step.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
